/*
  d3plus-plot v0.5.28
  A reusable javascript x/y plot built on D3.
  Copyright (c) 2017 D3plus - https://d3plus.org
  @license MIT
*/
if(typeof Object.assign!=="function"){Object.defineProperty(Object,"assign",{value:function t(e){"use strict";if(e===null){throw new TypeError("Cannot convert undefined or null to object")}var i=Object(e);for(var n=1;n<arguments.length;n++){var r=arguments[n];if(r!==null){for(var s in r){if(Object.prototype.hasOwnProperty.call(r,s)){i[s]=r[s]}}}}return i},writable:true,configurable:true})}if(!Array.prototype.includes){Object.defineProperty(Array.prototype,"includes",{value:function t(e,i){var n=Object(this);var r=n.length>>>0;if(r===0)return false;var s=i|0;var o=Math.max(s>=0?s:r-Math.abs(s),0);function a(t,e){return t===e||typeof t==="number"&&typeof e==="number"&&isNaN(t)&&isNaN(e)}while(o<r){if(a(n[o],e)){return true}o++}return false}})}(function(t,e){typeof exports==="object"&&typeof module!=="undefined"?e(exports,require("d3plus-common"),require("d3-array"),require("d3-collection"),require("d3-scale"),require("d3-shape"),require("d3plus-axis"),require("d3plus-color"),require("d3plus-shape"),require("d3plus-viz")):typeof define==="function"&&define.amd?define("d3plus-plot",["exports","d3plus-common","d3-array","d3-collection","d3-scale","d3-shape","d3plus-axis","d3plus-color","d3plus-shape","d3plus-viz"],e):e(t.d3plus={},t.d3plusCommon,t.d3Array,t.d3Collection,t.scales,t.d3Shape,t.d3plusAxis,t.d3plusColor,t.shapes,t.d3plusViz)})(this,function(t,e,i,n,r,s,o,a,f,c){"use strict";var u=function(t){if(t.includes("d3plus-buffer-start")){return t}var e=["d3plus-buffer-start"];t.forEach(function(t){e.push(t);e.push("d3plus-buffer-"+t)});return e};var h=function(t,e,r,s,o){var a=this;if(o===void 0)o=10;var f=this._discrete==="x"?r:e;var c=f.domain().slice();if(this._discrete==="x"){c.reverse()}var h,d;if(this._stacked){var _=n.nest().key(function(t){return t[a._discrete]}).entries(t).map(function(t){return t.values.map(function(t){return t[a._discrete==="x"?"y":"x"]})});d=_.map(function(t){return i.sum(t.filter(function(t){return t>0}))});h=_.map(function(t){return i.sum(t.filter(function(t){return t<0}))})}else{d=t.map(function(t){return t[a._discrete==="x"?"y":"x"]});h=d}var l=f(i.max(d));if(l!==f(0)){l+=this._discrete==="x"?-o:o}l=f.invert(l);var p=f(i.min(h));if(p!==f(0)){p+=this._discrete==="x"?o:-o}p=f.invert(p);if(l>c[1]){c[1]=l}if(p<c[0]){c[0]=p}if(this._discrete==="x"){c.reverse()}f.domain(c);var g=this._discrete==="x"?e:r;g.domain(u(g.domain()));return[e,r]};var d=function(t,e,i,n,r){var s=e.domain().slice(),o=i.domain().slice();var a=e.range(),f=i.range();if(!e.invert){s=u(s)}if(!i.invert){o=u(o)}t.forEach(function(t){var c=r?r:n.r(t.data,t.i)*2;if(e.invert&&e(t.x)-a[0]<c){var u=e.invert(e(t.x)-c);if(u<s[0]){s[0]=u}}if(e.invert&&a[1]-e(t.x)<c){var h=e.invert(e(t.x)+c);if(h>s[1]){s[1]=h}}if(i.invert&&i(t.y)-f[0]<c){var d=i.invert(i(t.y)-c);if(d>o[0]){o[0]=d}}if(i.invert&&f[1]-i(t.y)<c){var _=i.invert(i(t.y)+c);if(_<o[1]){o[1]=_}}});e.domain(s).range(a);i.domain(o).range(f);return[e,i]};var _=function(t,e,i,n){var r=e.domain().slice(),s=i.domain().slice();var o=e.range(),a=i.range();if(!e.invert){r=u(r)}if(!i.invert){s=u(s)}t.forEach(function(t){var f=n.height(t.data,t.i),c=n.width(t.data,t.i);if(e.invert&&e(t.x)-o[0]<c){var u=e.invert(e(t.x)-c);if(u<r[0]){r[0]=u}}if(e.invert&&o[1]-e(t.x)<c){var h=e.invert(e(t.x)+c);if(h>r[1]){r[1]=h}}if(i.invert&&i(t.y)-a[0]<f){var d=i.invert(i(t.y)-f);if(d>s[0]){s[0]=d}}if(i.invert&&a[1]-i(t.y)<f){var _=i.invert(i(t.y)+f);if(_<s[1]){s[1]=_}}});e.domain(r);i.domain(s);return[e,i]};var l=function(t,e,n){var r=this;var s=this._discrete==="x"?n:e;var o=s.domain().slice();if(this._discrete==="x"){o.reverse()}var a=t.map(function(t){return t[r._discrete==="x"?"y":"x"]});var f=s.invert(s(i.max(a))+(this._discrete==="x"?-10:10));if(f>o[1]){o[1]=f}if(this._discrete==="x"){o.reverse()}s.domain(o);return[e,n]};function p(t){return this._sizeScaleD3(this._size?this._size(t):null)}var g=function(t){function c(){var i=this;t.call(this);this._annotations=[];this._barPadding=0;this._buffer={Bar:h,Circle:d,Line:l,Rect:_};this._groupPadding=5;this._shape=e.constant("Circle");this._shapeConfig=e.assign(this._shapeConfig,{Area:{label:function(t,e){return i._stacked?i._drawLabel(t,e):false},labelConfig:{fontResize:true}},Bar:{labelConfig:{textAnchor:function(){return i._discrete==="x"?"middle":"end"},verticalAlign:function(){return i._discrete==="x"?"top":"middle"}}},Circle:{r:p.bind(this)},Line:{fill:e.constant("none"),label:false,stroke:function(t,e){return a.colorAssign(i._id(t,e))},strokeWidth:e.constant(1)},Rect:{height:function(t){return p.bind(i)(t)*2},width:function(t){return p.bind(i)(t)*2}}});this._sizeMax=20;this._sizeMin=5;this._sizeScale="sqrt";this._stackOffset=s.stackOffsetDiverging;this._stackOrder=s.stackOrderNone;this._x=e.accessor("x");this._xAxis=(new o.AxisBottom).align("end");this._x2Axis=(new o.AxisTop).align("start");this._xTest=(new o.AxisBottom).align("end").gridSize(0);this._xConfig={title:"X Axis"};this._x2Config={};this._y=e.accessor("y");this._yAxis=(new o.AxisLeft).align("start");this._y2Axis=(new o.AxisRight).align("end");this._yTest=(new o.AxisLeft).align("start").gridSize(0);this._yConfig={gridConfig:{stroke:function(t){var e=i._yAxis.domain();return e[e.length-1]===t.id?"transparent":"#ccc"}},title:"Y Axis"};this._y2Config={}}if(t)c.__proto__=t;c.prototype=Object.create(t&&t.prototype);c.prototype.constructor=c;c.prototype._draw=function a(c){var u=this;t.prototype._draw.call(this,c);if(!this._filteredData.length){return this}var h=function(t,e){return u._stacked?""+(u._groupBy.length>1?u._ids(t,e).slice(0,-1).join("_"):"group"):""+u._ids(t,e).join("_")};var d=this._filteredData.map(function(t,e){return{__d3plus__:true,data:t,group:h(t,e),i:e,id:u._ids(t,e).slice(0,u._drawDepth+1).join("_"),shape:u._shape(t,e),x:u._x(t,e),y:u._y(t,e)}});if(this._size){var _=i.extent(d,function(t){return u._size(t.data)});this._sizeScaleD3=function(){return u._sizeMin};this._sizeScaleD3=r["scale"+this._sizeScale.charAt(0).toUpperCase()+this._sizeScale.slice(1)]().domain(_).range([_[0]===_[1]?this._sizeMax:i.min([this._sizeMax/2,this._sizeMin]),this._sizeMax])}else{this._sizeScaleD3=function(){return u._sizeMin}}var l=this._height-this._margin.top-this._margin.bottom,p=this._discrete?this._discrete==="x"?"y":"x":undefined,g=this._select,x="translate("+this._margin.left+", "+this._margin.top+")",y=this._transition,v=this._width-this._margin.left-this._margin.right;var m=this._time&&d[0].x===this._time(d[0].data,d[0].i),k=this._time&&d[0].y===this._time(d[0].data,d[0].i);for(var C=0;C<d.length;C++){var b=d[C];if(m){b.x=o.date(b.x)}if(k){b.y=o.date(b.y)}b.discrete=b.shape==="Bar"?b[u._discrete]+"_"+b.group:""+b[u._discrete]}var A,w,z,O;if(this._stacked){var S=n.nest().key(function(t){return t.group}).entries(d).reduce(function(t,e){if(!t[e.key]){t[e.key]=0}t[e.key]+=i.sum(e.values,function(t){return t[p]});return t},{});d=d.sort(function(t,e){var i=t[u._discrete],n=e[u._discrete];if(i-n!==0){return i-n}if(t.group!==e.group){return S[e.group]-S[t.group]}return e[p]-t[p]});A=Array.from(new Set(d.map(function(t){return t.discrete})));O=Array.from(new Set(d.map(function(t){return t.id})));z=n.nest().key(function(t){return t.discrete}).entries(d).map(function(t){return t.values});z.forEach(function(t){var e=Array.from(new Set(t.map(function(t){return t.id})));if(e.length<O.length){O.forEach(function(i){if(!e.includes(i)){var n=d.filter(function(t){return t.id===i})[0];if(n.shape==="Area"){var r=h(n.data,n.i);var s={__d3plus__:true,data:n.data,discrete:n.shape==="Bar"?t[0][u._discrete]+"_"+r:""+t[0][u._discrete],group:r,id:i,shape:n.shape};s[u._discrete]=t[0][u._discrete];s[p]=0;d.push(s)}}})}});d.sort(function(t,e){return t[u._discrete]-e[u._discrete]});var P=this._stackOrder;if(P instanceof Array){O.sort(function(t,e){return P.indexOf(t)-P.indexOf(e)})}else if(P===s.stackOrderNone){O.sort(function(t,e){return t.localeCompare(e)})}z=s.stack().keys(O).offset(this._stackOffset).order(P instanceof Array?s.stackOrderNone:P).value(function(t,e){var i=t.filter(function(t){return t.id===e});return i.length?i[0][p]:0})(z);w={};w[this._discrete]=i.extent(d,function(t){return t[u._discrete]});w[p]=[i.min(z.map(function(t){return i.min(t.map(function(t){return t[0]}))})),i.max(z.map(function(t){return i.max(t.map(function(t){return t[1]}))}))]}else{w={x:i.extent(d,function(t){return t.x}),y:i.extent(d,function(t){return t.y})}}var j=this._xDomain?this._xDomain.slice():w.x,D="Linear";if(j[0]===void 0){j[0]=w.x[0]}if(j[1]===void 0){j[1]=w.x[1]}if(m){j=j.map(o.date);D="Time"}else if(this._discrete==="x"){j=Array.from(new Set(d.sort(function(t,e){return u._xSort?u._xSort(t.data,e.data):t.x-e.x}).map(function(t){return t.x})));D="Ordinal"}var L=this._yDomain?this._yDomain.slice():w.y,M="Linear";if(L[0]===void 0){L[0]=w.y[0]}if(L[1]===void 0){L[1]=w.y[1]}if(k){L=L.map(o.date);M="Time"}else if(this._discrete==="y"){L=Array.from(new Set(d.sort(function(t,e){return u._ySort?u._ySort(t.data,e.data):t.y-e.y}).map(function(t){return t.y})));M="Ordinal"}w={x:j,y:L};if(p&&this._baseline!==void 0){var T=this._baseline;if(w[p][0]>T){w[p][0]=T}else if(w[p][1]<T){w[p][1]=T}}var B=r["scale"+D]().domain(w.x).range(i.range(0,v+1,v/(w.x.length-1))),q=r["scale"+M]().domain(w.y.reverse()).range(i.range(0,l+1,l/(w.y.length-1)));var E=n.nest().key(function(t){return t.shape}).entries(d);if(this._xConfig.scale!=="log"&&this._yConfig.scale!=="log"){E.forEach(function(t){if(u._buffer[t.key]){var e=u._buffer[t.key].bind(u)(t.values,B,q,u._shapeConfig[t.key]);if(u._xConfig.scale!=="log"){B=e[0]}if(u._yConfig.scale!=="log"){q=e[1]}}})}j=B.domain();L=q.domain();var N=e.elem("g.d3plus-plot-test",{enter:{opacity:0},parent:this._select}),R=this._discrete==="x"&&!m?w.x:undefined,U=this._discrete==="y"&&!k?w.y:undefined;var V={gridConfig:{stroke:!this._discrete||this._discrete==="x"?this._yTest.gridConfig().stroke:"transparent"}};this._yTest.domain(L).height(l).scale(M.toLowerCase()).select(N.node()).ticks(U).width(v).config(V).config(this._yConfig).render();var W=this._yTest.outerBounds();var X=W.width?W.width+this._yTest.padding():undefined;var Y={gridConfig:{stroke:!this._discrete||this._discrete==="y"?this._xTest.gridConfig().stroke:"transparent"}};this._xTest.domain(j).height(l).range([undefined,undefined]).scale(D.toLowerCase()).select(N.node()).ticks(R).width(v).config(Y).config(this._xConfig).render();var F=i.max([X,this._xTest._getRange()[0]]);this._xTest.range([F,undefined]).render();var G=e.elem("g.d3plus-plot-x-axis",{parent:g,transition:y,enter:{transform:x},update:{transform:x}});var H=F>X?F-X:0;var I="translate("+(this._margin.left+H)+", "+this._margin.top+")";var J=e.elem("g.d3plus-plot-y-axis",{parent:g,transition:y,enter:{transform:I},update:{transform:I}});var K=e.elem("g.d3plus-plot-x2-axis",{parent:g,transition:y,enter:{transform:x},update:{transform:x}});this._xAxis.domain(j).height(l).range([F,undefined]).scale(D.toLowerCase()).select(G.node()).ticks(R).width(v).config(Y).config(this._xConfig).render();B=function(t){if(u._xConfig.scale==="log"&&t===0){t=j[0]<0?-1:1}return u._xAxis._getPosition.bind(u._xAxis)(t)};var Q=this._xAxis._getRange();this._x2Axis.config(Y).domain(j).gridSize(0).height(l).labels([]).range([F,undefined]).scale(D.toLowerCase()).select(K.node()).ticks([]).width(Q[Q.length-1]+this._xAxis.padding()).title(false).tickSize(0).barConfig({"stroke-width":this._discrete?0:this._xAxis.barConfig()["stroke-width"]}).config(this._x2Config).render();this._yAxis.domain(L).height(l).range([this._xAxis.outerBounds().y,this._xTest.outerBounds().y]).scale(M.toLowerCase()).select(J.node()).ticks(U).width(Q[Q.length-1]+this._xAxis.padding()).config(V).config(this._yConfig).render();this._y2Axis.config(V).domain(L).gridSize(0).height(l).labels([]).range([this._xAxis.outerBounds().y,this._xTest.outerBounds().y]).scale(M.toLowerCase()).select(J.node()).ticks([]).width(Q[Q.length-1]+this._xAxis.padding()).title(false).tickSize(0).barConfig({"stroke-width":this._discrete?0:this._yAxis.barConfig()["stroke-width"]}).config(this._y2Config).render();q=function(t){if(u._yConfig.scale==="log"&&t===0){t=L[0]<0?-1:1}return u._yAxis._getPosition.bind(u._yAxis)(t)};var Z=this._yAxis._getRange();var $=e.elem("g.d3plus-plot-annotations",{parent:g,transition:y,enter:{transform:x},update:{transform:x}}).node();this._annotations.forEach(function(t){(new f[t.shape]).config(t).config({x:function(t){return B(t.x)},x0:u._discrete==="x"?function(t){return B(t.x)}:B(0),x1:u._discrete==="x"?null:function(t){return B(t.x)},y:function(t){return q(t.y)},y0:u._discrete==="y"?function(t){return q(t.y)}:q(0)-tt,y1:u._discrete==="y"?null:function(t){return q(t.y)-tt}}).select($).render()});var tt=this._xAxis.barConfig()["stroke-width"];if(tt){tt/=2}var et={duration:this._duration,label:function(t){return u._drawLabel(t.data,t.i)},select:e.elem("g.d3plus-plot-shapes",{parent:g,transition:y,enter:{transform:x},update:{transform:x}}).node(),x:function(t){return B(t.x)},x0:this._discrete==="x"?function(t){return B(t.x)}:B(0),x1:this._discrete==="x"?null:function(t){return B(t.x)},y:function(t){return q(t.y)},y0:this._discrete==="y"?function(t){return q(t.y)}:q(0)-tt,y1:this._discrete==="y"?null:function(t){return q(t.y)-tt}};if(this._stacked){var it=p==="x"?B:q;et[""+p]=et[p+"0"]=function(t){var e=O.indexOf(t.id),i=A.indexOf(t.discrete);return e>=0?it(z[e][i][0]):it(0)};et[p+"1"]=function(t){var e=O.indexOf(t.id),i=A.indexOf(t.discrete);return e>=0?it(z[e][i][1]):it(0)}}var nt=Object.keys(this._on);E.forEach(function(t){var s=(new f[t.key]).config(et).data(t.values);if(t.key==="Bar"){var o;var a=u._discrete==="x"?B:q;var c=(u._discrete==="x"?j:L).filter(function(t){return typeof t!=="string"||t.indexOf("d3plus-buffer-")<0});var h=u._discrete==="x"?Q:Z;if(c.length>1){o=a(c[1])-a(c[0])}else{o=h[h.length-1]-h[0]}o-=u._groupPadding;var d=o;var _=n.nest().key(function(t){return t[u._discrete]}).key(function(t){return t.group}).entries(t.values);var l=i.merge(_.map(function(t){return t.values.map(function(t){return t.key})}));var p=Array.from(new Set(l));if(i.max(_.map(function(t){return t.values.length}))===1){s[u._discrete](function(t,e){return et[u._discrete](t,e)})}else{d=(d-u._barPadding*p.length-1)/p.length;var g=o/2-d/2;var x=r.scaleLinear().domain([0,p.length-1]).range([-g,g]);s[u._discrete](function(t,e){return et[u._discrete](t,e)+x(p.indexOf(t.group))})}s.width(d);s.height(d)}var y=nt.filter(function(e){return e.includes("."+t.key)}),v=nt.filter(function(t){return!t.includes(".")}),m=nt.filter(function(t){return t.includes(".shape")});var k=function(t){s.on(v[t],function(e){return u._on[v[t]](e.data,e.i)})};for(var C=0;C<v.length;C++)k(C);var b=function(t){s.on(m[t],function(e){return u._on[m[t]](e.data,e.i)})};for(var A=0;A<m.length;A++)b(A);var w=function(t){s.on(y[t],function(e){return u._on[y[t]](e.data,e.i)})};for(var z=0;z<y.length;z++)w(z);s.config(e.configPrep.bind(u)(u._shapeConfig,"shape",t.key)).render();u._shapes.push(s)});return this};c.prototype.annotations=function t(e){return arguments.length?(this._annotations=e instanceof Array?e:[e],this):this._annotations};c.prototype.barPadding=function t(e){return arguments.length?(this._barPadding=e,this):this._barPadding};c.prototype.baseline=function t(e){return arguments.length?(this._baseline=e,this):this._baseline};c.prototype.discrete=function t(e){return arguments.length?(this._discrete=e,this):this._discrete};c.prototype.groupPadding=function t(e){return arguments.length?(this._groupPadding=e,this):this._groupPadding};c.prototype.size=function t(i){return arguments.length?(this._size=typeof i==="function"||!i?i:e.accessor(i),this):this._size};c.prototype.sizeMax=function t(e){return arguments.length?(this._sizeMax=e,this):this._sizeMax};c.prototype.sizeMin=function t(e){return arguments.length?(this._sizeMin=e,this):this._sizeMin};c.prototype.sizeScale=function t(e){return arguments.length?(this._sizeScale=e,this):this._sizeScale};c.prototype.stacked=function t(e){return arguments.length?(this._stacked=e,this):this._stacked};c.prototype.stackOffset=function t(e){return arguments.length?(this._stackOffset=typeof e==="function"?e:s["stackOffset"+(e.charAt(0).toUpperCase()+e.slice(1))],this):this._stackOffset};c.prototype.stackOrder=function t(e){return arguments.length?(this._stackOrder=typeof e==="string"?s["stackOrder"+(e.charAt(0).toUpperCase()+e.slice(1))]:e,this):this._stackOrder};c.prototype.x=function t(i){if(arguments.length){if(typeof i==="function"){this._x=i}else{this._x=e.accessor(i);if(!this._aggs[i]&&this._discrete==="x"){this._aggs[i]=function(t){var e=Array.from(new Set(t));return e.length===1?e[0]:e}}}return this}else{return this._x}};c.prototype.xConfig=function t(i){return arguments.length?(this._xConfig=e.assign(this._xConfig,i),this):this._xConfig};c.prototype.x2Config=function t(i){return arguments.length?(this._x2Config=e.assign(this._x2Config,i),this):this._x2Config};c.prototype.xDomain=function t(e){return arguments.length?(this._xDomain=e,this):this._xDomain};c.prototype.xSort=function t(e){return arguments.length?(this._xSort=e,this):this._xSort};c.prototype.y=function t(i){if(arguments.length){if(typeof i==="function"){this._y=i}else{this._y=e.accessor(i);if(!this._aggs[i]&&this._discrete==="y"){this._aggs[i]=function(t){var e=Array.from(new Set(t));return e.length===1?e[0]:e}}}return this}else{return this._y}};c.prototype.yConfig=function t(i){if(arguments.length){if(i.domain){i.domain=i.domain.slice().reverse()}this._yConfig=e.assign(this._yConfig,i);return this}return this._yConfig};c.prototype.y2Config=function t(i){return arguments.length?(this._y2Config=e.assign(this._y2Config,i),this):this._y2Config};c.prototype.yDomain=function t(e){return arguments.length?(this._yDomain=e,this):this._yDomain};c.prototype.ySort=function t(e){return arguments.length?(this._ySort=e,this):this._ySort};return c}(c.Viz);var x=function(t){function i(){t.call(this);this._baseline=0;this._discrete="x";this._shape=e.constant("Area");this.x("x")}if(t)i.__proto__=t;i.prototype=Object.create(t&&t.prototype);i.prototype.constructor=i;return i}(g);var y=function(t){function i(){t.call(this);this._baseline=0;this._discrete="x";this._shape=e.constant("Bar");this.x("x")}if(t)i.__proto__=t;i.prototype=Object.create(t&&t.prototype);i.prototype.constructor=i;return i}(g);var v=function(t){function i(){t.call(this);this._discrete="x";this._shape=e.constant("Line");this.x("x")}if(t)i.__proto__=t;i.prototype=Object.create(t&&t.prototype);i.prototype.constructor=i;return i}(g);var m=function(t){function e(){t.call(this);this._stacked=true}if(t)e.__proto__=t;e.prototype=Object.create(t&&t.prototype);e.prototype.constructor=e;return e}(x);t.AreaPlot=x;t.BarChart=y;t.LinePlot=v;t.Plot=g;t.StackedArea=m;Object.defineProperty(t,"__esModule",{value:true})});