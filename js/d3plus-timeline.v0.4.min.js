/*
  d3plus-timeline v0.4.11
  An easy-to-use javascript timeline.
  Copyright (c) 2019 D3plus - https://d3plus.org
  @license MIT
*/
if(typeof Object.assign!=="function"){Object.defineProperty(Object,"assign",{value:function t(i){"use strict";if(i===null){throw new TypeError("Cannot convert undefined or null to object")}var e=Object(i);for(var n=1;n<arguments.length;n++){var s=arguments[n];if(s!==null){for(var r in s){if(Object.prototype.hasOwnProperty.call(s,r)){e[r]=s[r]}}}}return e},writable:true,configurable:true})}if(!Array.prototype.includes){Object.defineProperty(Array.prototype,"includes",{value:function t(i,e){var n=Object(this);var s=n.length>>>0;if(s===0)return false;var r=e|0;var h=Math.max(r>=0?r:s-Math.abs(r),0);function o(t,i){return t===i||typeof t==="number"&&typeof i==="number"&&isNaN(t)&&isNaN(i)}while(h<s){if(o(n[h],i)){return true}h++}return false}})}if(!String.prototype.includes){Object.defineProperty(String.prototype,"includes",{value:function(t,i){if(typeof i!=="number"){i=0}if(i+t.length>this.length){return false}else{return this.indexOf(t,i)!==-1}}})}if(!Array.prototype.find){Object.defineProperty(Array.prototype,"find",{value:function(t){if(this==null){throw new TypeError('"this" is null or not defined')}var i=Object(this);var e=i.length>>>0;if(typeof t!=="function"){throw new TypeError("predicate must be a function")}var n=arguments[1];var s=0;while(s<e){var r=i[s];if(t.call(n,r,s,i)){return r}s++}return undefined},configurable:true,writable:true})}if(!String.prototype.startsWith){Object.defineProperty(String.prototype,"startsWith",{value:function(t,i){i=!i||i<0?0:+i;return this.substring(i,i+t.length)===t}})}if(typeof window!=="undefined"){(function(){var n=function(t,i){var e=t.nodeType;if(e===3){i.push(t.textContent.replace(/&/,"&amp;").replace(/</,"&lt;").replace(">","&gt;"))}else if(e===1){i.push("<",t.tagName);if(t.hasAttributes()){[].forEach.call(t.attributes,function(t){i.push(" ",t.item.name,"='",t.item.value,"'")})}if(t.hasChildNodes()){i.push(">");[].forEach.call(t.childNodes,function(t){n(t,i)});i.push("</",t.tagName,">")}else{i.push("/>")}}else if(e==8){i.push("\x3c!--",t.nodeValue,"--\x3e")}};Object.defineProperty(SVGElement.prototype,"innerHTML",{get:function(){var t=[];var i=this.firstChild;while(i){n(i,t);i=i.nextSibling}return t.join("")},set:function(t){while(this.firstChild){this.removeChild(this.firstChild)}try{var i=new DOMParser;i.async=false;var e="<svg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'>"+t+"</svg>";var n=i.parseFromString(e,"text/xml").documentElement;var s=n.firstChild;while(s){this.appendChild(this.ownerDocument.importNode(s,true));s=s.nextSibling}}catch(t){}}});Object.defineProperty(SVGElement.prototype,"innerSVG",{get:function(){return this.innerHTML},set:function(t){this.innerHTML=t}})})()}(function(t,i){typeof exports==="object"&&typeof module!=="undefined"?i(exports,require("d3-array"),require("d3-brush"),require("d3-scale"),require("d3-selection"),require("d3plus-axis"),require("d3plus-common"),require("d3plus-text")):typeof define==="function"&&define.amd?define("d3plus-timeline",["exports","d3-array","d3-brush","d3-scale","d3-selection","d3plus-axis","d3plus-common","d3plus-text"],i):i(t.d3plus={},t.d3Array,t.d3Brush,t.d3Scale,t.d3Selection,t.d3plusAxis,t.d3plusCommon,t.d3plusText)})(this,function(t,v,m,y,h,k,C,B){"use strict";var i=function(g){function t(){var i=this;g.call(this);this._barConfig=Object.assign({},this._barConfig,{"stroke-width":function(){return i._buttonBehaviorCurrent==="buttons"?0:1}});this._brushing=true;this._brushFilter=function(){return!h.event.button&&h.event.detail<2};this._buttonAlign="middle";this._buttonBehavior="auto";this._buttonPadding=10;this._buttonHeight=30;this._domain=[2001,2010];this._gridSize=0;this._handleConfig={fill:"#444"};this._handleSize=6;this._height=100;this._labelOffset=false;this._on={};this.orient("bottom");this._scale="time";this._selectionConfig={fill:"#777","stroke-width":0};this._shape="Rect";this._shapeConfig=Object.assign({},this._shapeConfig,{labelBounds:function(t){return i._buttonBehaviorCurrent==="buttons"?{x:t.labelBounds.x,y:-5,width:t.labelBounds.width,height:i._buttonHeight}:t.labelBounds},fill:function(){return i._buttonBehaviorCurrent==="buttons"?"#EEE":"#444"},height:function(t){return i._buttonBehaviorCurrent==="buttons"?i._buttonHeight:t.tick?10:0},width:function(t){return i._buttonBehaviorCurrent==="buttons"?i._ticksWidth/i._availableTicks.length:t.tick?i._domain.map(function(t){return k.date(t).getTime()}).includes(t.id)?2:1:0},y:function(t){return i._buttonBehaviorCurrent==="buttons"?i._align==="middle"?i._height/2:i._align==="start"?i._margin.top+i._buttonHeight/2:i._height-i._buttonHeight/2-i._margin.bottom:t.y}});this._snapping=true}if(g)t.__proto__=g;t.prototype=Object.create(g&&g.prototype);t.prototype.constructor=t;t.prototype._brushBrush=function t(){if(h.event.sourceEvent&&h.event.sourceEvent.offsetX&&h.event.selection!==null&&(!this._brushing||this._snapping)){var i=this._updateDomain();this._brushGroup.call(this._brush.move,this._updateBrushLimit(i))}this._brushStyle();if(this._on.brush){this._on.brush(this._selection)}};t.prototype._brushEnd=function t(){if(!h.event.sourceEvent){return}var i=this._updateDomain();this._brushStyle();if(this._brushing||!this._snapping){this._brushGroup.transition(this._transition).call(this._brush.move,this._updateBrushLimit(i))}if(this._on.end){this._on.end(this._selection)}};t.prototype._brushStart=function t(){if(h.event.sourceEvent!==null&&(!this._brushing||this._snapping)){var i=this._updateDomain();this._brushGroup.call(this._brush.move,this._updateBrushLimit(i))}this._brushStyle();if(this._on.start){this._on.start()}};t.prototype._brushStyle=function t(){var i=this._position;var e=i.height;var n=this._shape==="Circle"?typeof this._shapeConfig.r==="function"?this._shapeConfig.r({tick:true})*2:this._shapeConfig.r:this._shape==="Rect"?typeof this._shapeConfig[e]==="function"?this._shapeConfig[e]({tick:true}):this._shapeConfig[e]:this._tickSize;var s=this._brushGroup.selectAll(".overlay").attr("cursor",this._brushing?"crosshair":"pointer");var r=this._brushGroup.selectAll(".selection").call(C.attrize,this._selectionConfig).attr("height",n);var h=this._brushGroup.selectAll(".handle").call(C.attrize,this._handleConfig).attr("height",this._buttonBehaviorCurrent==="buttons"?this._buttonHeight:n+this._handleSize);if(this._buttonBehaviorCurrent==="buttons"){var o=this._align==="middle"?this._height/2-this._buttonHeight/2:this._align==="start"?this._margin.top:this._height-this._buttonHeight-this._margin.bottom;h.attr("y",o);s.attr("x",this._marginLeft).attr("width",this._ticksWidth);r.attr("y",o)}};t.prototype._updateDomain=function t(){var i=h.mouse(this._select.node())[0];var e=h.event.selection&&this._brushing?h.event.selection:[i,i];if(this._buttonBehaviorCurrent==="ticks"){e=e.map(this._d3Scale.invert)}e=e.map(Number);if(h.event.type==="brush"&&this._brushing&&this._buttonBehaviorCurrent==="buttons"){var n=h.event.selection.map(function(t){return Math.abs(t-h.event.sourceEvent.offsetX)});e=n[1]<=n[0]?[h.event.selection[0],h.event.sourceEvent.offsetX].sort(function(t,i){return t-i}):[h.event.sourceEvent.offsetX,h.event.selection[1]].sort(function(t,i){return t-i})}var s=this._buttonBehaviorCurrent==="ticks"?this._availableTicks.map(Number):this._d3Scale.range();if(this._buttonBehaviorCurrent==="ticks"){e[0]=k.date(C.closest(e[0],s));e[1]=k.date(C.closest(e[1],s))}else{e[0]=C.closest(e[0],s);e[1]=C.closest(e[1],s)}var r=+e[0]===+e[1];if(h.event.type==="brush"||h.event.type==="end"){this._selection=this._buttonBehaviorCurrent==="ticks"?r?e[0]:e:r?k.date(this._availableTicks[s.indexOf(e[0])]):[k.date(this._availableTicks[s.indexOf(e[0])]),k.date(this._availableTicks[s.indexOf(e[1])])]}return e};t.prototype._updateBrushLimit=function t(i){var e=this._buttonBehaviorCurrent==="ticks"?i.map(k.date).map(this._d3Scale):i;if(e[0]===e[1]){e[0]-=.1;e[1]+=.1}if(this._buttonBehaviorCurrent==="buttons"){var n=.5*(this._ticksWidth/this._availableTicks.length-this._handleSize);e[0]-=n;e[1]+=n}return e};t.prototype.render=function t(i){var o=this;var e=this._position;var n=e.height;var s=e.y;if(this._buttonBehavior!=="ticks"){var a=this._ticks?this._ticks.map(k.date):this._domain.map(k.date);var u=y.scaleTime().domain(a).range([0,this._width]);a=this._ticks?a:u.ticks();if(!this._tickFormat){this._tickFormat=u.tickFormat(a.length-1,this._tickSpecifier)}var l=0;a.forEach(function(t,i){var e=o._shapeConfig.labelConfig.fontFamily(t,i),n=o._shapeConfig.labelConfig.fontSize(t,i);var s=B.textWrap().fontFamily(e).fontSize(n).lineHeight(o._shapeConfig.lineHeight?o._shapeConfig.lineHeight(t,i):undefined);var r=s(u.tickFormat(a.length-1,o._tickSpecifier)(t));var h=r.lines.length?Math.ceil(v.max(r.lines.map(function(t){return B.textWidth(t,{"font-family":e,"font-size":n})})))+n/4:0;if(h%2){h++}if(l<h){l=h+2*o._buttonPadding}});this._ticksWidth=l*a.length}this._buttonBehaviorCurrent=this._buttonBehavior==="auto"?this._ticksWidth<this._width?"buttons":"ticks":this._buttonBehavior;if(this._buttonBehaviorCurrent==="buttons"){this._scale="ordinal";this._labelRotation=0;if(!this._brushing){this._handleSize=0}var r=y.scaleTime().domain(this._domain.map(k.date)).ticks().map(this._tickFormat).map(Number);this._domain=this._ticks?this._ticks.map(k.date):Array.from(Array(r[r.length-1]-r[0]+1),function(t,i){return r[0]+i}).map(k.date);this._ticks=this._domain;var h=.5*this._ticksWidth/this._ticks.length;this._marginLeft=this._buttonAlign==="middle"?(this._width-this._ticksWidth)/2:this._buttonAlign==="end"?this._width-this._ticksWidth:0;var _=this._buttonAlign==="middle"?(this._width+this._ticksWidth)/2:this._buttonAlign==="start"?this._ticksWidth:undefined;this._range=[this._buttonAlign==="start"?undefined:this._marginLeft+h,this._buttonAlign==="end"?undefined:_-h]}if(this._ticks){this._domain=this._buttonBehaviorCurrent==="ticks"?[this._ticks[0],this._ticks[this._ticks.length-1]]:this._ticks.map(k.date)}this._labels=this._ticks;g.prototype.render.call(this,i);var c=this._outerBounds[s],f=this._d3Scale.range();var d=this._brush=m.brushX().extent([[f[0],c],[f[f.length-1],c+this._outerBounds[n]]]).filter(this._brushFilter).handleSize(this._handleSize).on("start",this._brushStart.bind(this)).on("brush",this._brushBrush.bind(this)).on("end",this._brushEnd.bind(this));var p=this._buttonBehaviorCurrent==="ticks"?this._availableTicks[this._availableTicks.length-1]:f[f.length-1];var b=this._selection===void 0?[p,p]:this._selection instanceof Array?this._buttonBehaviorCurrent==="buttons"?this._selection.map(function(t){return f[o._ticks.map(Number).indexOf(+t)]}).slice():this._selection.slice():this._buttonBehaviorCurrent==="buttons"?[f[this._ticks.map(Number).indexOf(+this._selection)],f[this._ticks.map(Number).indexOf(+this._selection)]]:[this._selection,this._selection];this._updateBrushLimit(b);this._brushGroup=C.elem("g.brushGroup",{parent:this._group});this._brushGroup.call(d).transition(this._transition).call(d.move,this._buttonBehaviorCurrent==="ticks"?this._updateBrushLimit(b):b);this._outerBounds.y-=this._handleSize/2;this._outerBounds.height+=this._handleSize/2;return this};t.prototype.buttonPadding=function t(i){return arguments.length?(this._buttonPadding=i,this):this._buttonPadding};t.prototype.brushing=function t(i){return arguments.length?(this._brushing=i,this):this._brushing};t.prototype.brushFilter=function t(i){return arguments.length?(this._brushFilter=i,this):this._brushFilter};t.prototype.buttonAlign=function t(i){return arguments.length?(this._buttonAlign=i,this):this._buttonAlign};t.prototype.buttonBehavior=function t(i){return arguments.length?(this._buttonBehavior=i,this):this._buttonBehavior};t.prototype.buttonHeight=function t(i){return arguments.length?(this._buttonHeight=i,this):this._buttonHeight};t.prototype.handleConfig=function t(i){return arguments.length?(this._handleConfig=Object.assign(this._handleConfig,i),this):this._handleConfig};t.prototype.handleSize=function t(i){return arguments.length?(this._handleSize=i,this):this._handleSize};t.prototype.on=function t(i,e){return arguments.length===2?(this._on[i]=e,this):arguments.length?typeof i==="string"?this._on[i]:(this._on=Object.assign({},this._on,i),this):this._on};t.prototype.selectionConfig=function t(i){return arguments.length?(this._selectionConfig=Object.assign(this._selectionConfig,i),this):this._selectionConfig};t.prototype.selection=function t(i){return arguments.length?(this._selection=i,this):this._selection};t.prototype.snapping=function t(i){return arguments.length?(this._snapping=i,this):this._snapping};return t}(k.Axis);t.Timeline=i;Object.defineProperty(t,"__esModule",{value:true})});