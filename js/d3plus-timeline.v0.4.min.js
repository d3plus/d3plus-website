/*
  d3plus-timeline v0.4.2
  An easy-to-use javascript timeline.
  Copyright (c) 2018 D3plus - https://d3plus.org
  @license MIT
*/
if(typeof Object.assign!=="function"){Object.defineProperty(Object,"assign",{value:function t(i){"use strict";if(i===null){throw new TypeError("Cannot convert undefined or null to object")}var e=Object(i);for(var s=1;s<arguments.length;s++){var n=arguments[s];if(n!==null){for(var h in n){if(Object.prototype.hasOwnProperty.call(n,h)){e[h]=n[h]}}}}return e},writable:true,configurable:true})}if(!Array.prototype.includes){Object.defineProperty(Array.prototype,"includes",{value:function t(i,e){var s=Object(this);var n=s.length>>>0;if(n===0)return false;var h=e|0;var r=Math.max(h>=0?h:n-Math.abs(h),0);function o(t,i){return t===i||typeof t==="number"&&typeof i==="number"&&isNaN(t)&&isNaN(i)}while(r<n){if(o(s[r],i)){return true}r++}return false}})}(function(t,i){typeof exports==="object"&&typeof module!=="undefined"?i(exports,require("d3-array"),require("d3-brush"),require("d3-scale"),require("d3-selection"),require("d3plus-axis"),require("d3plus-common"),require("d3plus-text")):typeof define==="function"&&define.amd?define("d3plus-timeline",["exports","d3-array","d3-brush","d3-scale","d3-selection","d3plus-axis","d3plus-common","d3plus-text"],i):i(t.d3plus={},t.d3Array,t.d3Brush,t.d3Scale,t.d3Selection,t.d3plusAxis,t.d3plusCommon,t.d3plusText)})(this,function(t,i,e,s,n,h,r,o){"use strict";var u=function(t){function u(){var i=this;t.call(this);this._barConfig=Object.assign({},this._barConfig,{"stroke-width":function(){return i._buttonBehaviorCurrent==="buttons"?0:1}});this._brushing=true;this._brushFilter=function(){return!n.event.button&&n.event.detail<2};this._buttonBehavior="auto";this._buttonHeight=30;this._buttonPadding=12;this._domain=[2001,2010];this._gridSize=0;this._handleConfig={fill:"#444"};this._handleSize=6;this._height=100;this._on={};this.orient("bottom");this._scale="time";this._selectionConfig={fill:"#777","stroke-width":0};this._shape="Rect";this._shapeConfig=Object.assign({},this._shapeConfig,{labelBounds:function(t){return i._buttonBehaviorCurrent==="buttons"?{x:t.labelBounds.x,y:-5,width:t.labelBounds.width,height:i._buttonHeight}:t.labelBounds},fill:function(){return i._buttonBehaviorCurrent==="buttons"?"#EEE":"#444"},height:function(t){return i._buttonBehaviorCurrent==="buttons"?i._buttonHeight:t.tick?10:0},width:function(t){return i._buttonBehaviorCurrent==="buttons"?i._ticksWidth/i._availableTicks.length:t.tick?i._domain.map(function(t){return h.date(t).getTime()}).includes(t.id)?2:1:0},y:function(t){return i._buttonBehaviorCurrent==="buttons"?i._height/2:t.y}});this._snapping=true}if(t)u.__proto__=t;u.prototype=Object.create(t&&t.prototype);u.prototype.constructor=u;u.prototype._brushBrush=function t(){if(n.event.sourceEvent&&n.event.sourceEvent.offsetX&&n.event.selection!==null&&(!this._brushing||this._snapping)){var i=this._updateDomain();this._brushGroup.call(this._brush.move,this._updateBrushLimit(i))}this._brushStyle();if(this._on.brush){this._on.brush(this._selection)}};u.prototype._brushEnd=function t(){if(!n.event.sourceEvent){return}var i=this._updateDomain();this._brushStyle();if(this._brushing||!this._snapping){this._brushGroup.transition(this._transition).call(this._brush.move,this._updateBrushLimit(i))}if(this._on.end){this._on.end(this._selection)}};u.prototype._brushStart=function t(){if(n.event.sourceEvent!==null&&(!this._brushing||this._snapping)){var i=this._updateDomain();this._brushGroup.call(this._brush.move,this._updateBrushLimit(i))}this._brushStyle();if(this._on.start){this._on.start()}};u.prototype._brushStyle=function t(){var i=this._position;var e=i.height;var s=this._shape==="Circle"?typeof this._shapeConfig.r==="function"?this._shapeConfig.r({tick:true})*2:this._shapeConfig.r:this._shape==="Rect"?typeof this._shapeConfig[e]==="function"?this._shapeConfig[e]({tick:true}):this._shapeConfig[e]:this._tickSize;var n=this._brushGroup.selectAll(".overlay").attr("cursor",this._brushing?"crosshair":"pointer");var h=this._brushGroup.selectAll(".selection").call(r.attrize,this._selectionConfig).attr("height",s);var o=this._brushGroup.selectAll(".handle").call(r.attrize,this._handleConfig).attr("height",this._buttonBehaviorCurrent==="buttons"?this._buttonHeight:s+this._handleSize);if(this._buttonBehaviorCurrent==="buttons"){var u=this._height/2-this._buttonHeight/2;o.attr("y",u);n.attr("x",this._marginLeft).attr("width",this._ticksWidth);h.attr("y",u)}};u.prototype._updateDomain=function t(){var i=this._buttonBehaviorCurrent==="ticks"?(n.event.selection&&this._brushing?n.event.selection:[n.event.sourceEvent.offsetX,n.event.sourceEvent.offsetX]).map(this._d3Scale.invert).map(Number):(n.event.selection&&this._brushing?n.event.selection:[n.event.sourceEvent.offsetX,n.event.sourceEvent.offsetX]).map(Number);if(n.event.type==="brush"&&this._brushing&&this._buttonBehaviorCurrent==="buttons"){var e=n.event.selection.map(function(t){return Math.abs(t-n.event.sourceEvent.offsetX)});i=e[1]<=e[0]?[n.event.selection[0],n.event.sourceEvent.offsetX].sort(function(t,i){return t-i}):[n.event.sourceEvent.offsetX,n.event.selection[1]].sort(function(t,i){return t-i})}var s=this._buttonBehaviorCurrent==="ticks"?this._availableTicks.map(Number):this._d3Scale.range();if(this._buttonBehaviorCurrent==="ticks"){i[0]=h.date(r.closest(i[0],s));i[1]=h.date(r.closest(i[1],s))}else{i[0]=r.closest(i[0],s);i[1]=r.closest(i[1],s)}var o=+i[0]===+i[1];if(n.event.type==="brush"||n.event.type==="end"){this._selection=this._buttonBehaviorCurrent==="ticks"?o?i[0]:i:o?h.date(this._availableTicks[s.indexOf(i[0])]):[h.date(this._availableTicks[s.indexOf(i[0])]),h.date(this._availableTicks[s.indexOf(i[1])])]}return i};u.prototype._updateBrushLimit=function t(i){var e=this._buttonBehaviorCurrent==="ticks"?i.map(h.date).map(this._d3Scale):i;if(e[0]===e[1]){e[0]-=.1;e[1]+=.1}if(this._buttonBehaviorCurrent==="buttons"){var s=.5*(this._ticksWidth/this._availableTicks.length-this._handleSize);e[0]-=s;e[1]+=s}return e};u.prototype.render=function n(u){var a=this;var _=this._position;var l=_.height;var c=_.y;if(this._buttonBehavior!=="ticks"){var d=this._ticks?this._ticks.map(h.date):this._domain.map(h.date);var f=s.scaleTime().domain(d).range([0,this._width]),b=f.tickFormat();d=this._ticks?d:f.ticks();this._ticksWidth=d.reduce(function(t,e,s){var n=a._shapeConfig.labelConfig.fontFamily(e,s),h=a._shapeConfig.labelConfig.fontSize(e,s);var r=o.textWrap().fontFamily(n).fontSize(h).lineHeight(a._shapeConfig.lineHeight?a._shapeConfig.lineHeight(e,s):undefined);var u=r(b(e));var _=u.lines.length?Math.ceil(i.max(u.lines.map(function(t){return o.textWidth(t,{"font-family":n,"font-size":h})})))+h/4:0;if(_%2){_++}return t+_+2*a._buttonPadding},0)}this._buttonBehaviorCurrent=this._buttonBehavior==="auto"?this._ticksWidth<this._width?"buttons":"ticks":this._buttonBehavior;if(this._ticks&&!this._labels){if(this._buttonBehaviorCurrent==="ticks"){this._domain=[i.min(this._ticks),i.max(this._ticks)]}this.labels(this._ticks)}if(this._buttonBehaviorCurrent==="buttons"){if(!this._ticks){this._ticks=Array.from(Array(this._domain[this._domain.length-1]-this._domain[0]+1),function(t,i){return a._domain[0]+i})}if(!this._brushing){this._handleSize=0}this._scale="ordinal";this._domain=this._ticks}if(this._ticksWidth&&this._buttonBehaviorCurrent==="buttons"){var p=this._ticks?this._ticks.map(h.date):this._domain.map(h.date);var v=s.scaleTime().domain(p).range([0,this._ticksWidth]);p=this._ticks?p:v.ticks();var g=.5*this._ticksWidth/p.length;this._marginLeft=this._align==="middle"?(this._width-this._ticksWidth)/2:this._align==="end"?this._width-this._ticksWidth:0;var m=this._align==="middle"?(this._width+this._ticksWidth)/2-g:this._align==="start"?this._ticksWidth-g:undefined;this._range=[this._align==="start"?undefined:this._marginLeft+g,m]}t.prototype.render.call(this,u);var y=this._outerBounds[c],k=this._d3Scale.range();var C=this._brush=e.brushX().extent([[k[0],y],[k[k.length-1],y+this._outerBounds[l]]]).filter(this._brushFilter).handleSize(this._handleSize).on("start",this._brushStart.bind(this)).on("brush",this._brushBrush.bind(this)).on("end",this._brushEnd.bind(this));var B=this._buttonBehaviorCurrent==="ticks"?this._availableTicks[this._availableTicks.length-1]:k[k.length-1];var S=this._selection===void 0?[B,B]:this._selection instanceof Array?this._selection.slice():[this._selection,this._selection];this._updateBrushLimit(S);this._brushGroup=r.elem("g.brushGroup",{parent:this._group});this._brushGroup.call(C).transition(this._transition).call(C.move,this._buttonBehaviorCurrent==="ticks"?this._updateBrushLimit(S):S);this._outerBounds.y-=this._handleSize/2;this._outerBounds.height+=this._handleSize/2;return this};u.prototype.brushing=function t(i){return arguments.length?(this._brushing=i,this):this._brushing};u.prototype.brushFilter=function t(i){return arguments.length?(this._brushFilter=i,this):this._brushFilter};u.prototype.buttonBehavior=function t(i){return arguments.length?(this._buttonBehavior=i,this):this._buttonBehavior};u.prototype.buttonHeight=function t(i){return arguments.length?(this._buttonHeight=i,this):this._buttonHeight};u.prototype.buttonPadding=function t(i){return arguments.length?(this._buttonPadding=i,this):this._buttonPadding};u.prototype.handleConfig=function t(i){return arguments.length?(this._handleConfig=Object.assign(this._handleConfig,i),this):this._handleConfig};u.prototype.handleSize=function t(i){return arguments.length?(this._handleSize=i,this):this._handleSize};u.prototype.on=function t(i,e){return arguments.length===2?(this._on[i]=e,this):arguments.length?typeof i==="string"?this._on[i]:(this._on=Object.assign({},this._on,i),this):this._on};u.prototype.selectionConfig=function t(i){return arguments.length?(this._selectionConfig=Object.assign(this._selectionConfig,i),this):this._selectionConfig};u.prototype.selection=function t(i){return arguments.length?(this._selection=i,this):this._selection};u.prototype.snapping=function t(i){return arguments.length?(this._snapping=i,this):this._snapping};return u}(h.Axis);t.Timeline=u;Object.defineProperty(t,"__esModule",{value:true})});