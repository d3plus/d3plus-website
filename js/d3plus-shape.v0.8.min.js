/*
  d3plus-shape v0.8.1
  Fancy SVG shapes for visualizations
  Copyright (c) 2016 D3plus - https://d3plus.org
  @license MIT
*/
!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports,require("d3plus-common"),require("d3-selection"),require("d3-transition"),require("d3plus-color"),require("d3plus-text"),require("d3-collection"),require("d3-shape")):"function"==typeof define&&define.amd?define("d3plus-shape",["exports","d3plus-common","d3-selection","d3-transition","d3plus-color","d3plus-text","d3-collection","d3-shape"],i):i(t.d3plus=t.d3plus||{},t.d3plusCommon,t.d3Selection,t.d3Transition,t.d3plusColor,t.d3plusText,t.d3Collection,t.d3Shape)}(this,function(t,i,n,e,r,o,s,a){"use strict";var h={select:n.select,transition:e.transition},c=function(){this._duration=600,this._height=i.accessor("height"),this._id=i.accessor("url"),this._select,this._url=i.accessor("url"),this._width=i.accessor("width"),this._x=i.accessor("x",0),this._y=i.accessor("y",0)};c.prototype.render=function(t){var i=this;void 0===this._select&&this.select(h.select("body").append("svg").style("width",window.innerWidth+"px").style("height",window.innerHeight+"px").style("display","block").node());var n=this._select.selectAll(".d3plus-shape-image").data(this._data,this._id),e=n.enter().append("image").attr("class","d3plus-shape-image").attr("opacity",0),r=h.transition().duration(this._duration),o=this,s=e.merge(n);return s.attr("xlink:href",this._url).transition(r).attr("opacity",1).attr("width",function(t,n){return i._width(t,n)}).attr("height",function(t,n){return i._height(t,n)}).attr("x",function(t,n){return i._x(t,n)}).attr("y",function(t,n){return i._y(t,n)}).each(function(t,i){var n=h.select(this),e=o._url(t,i),r=0===e.indexOf("http://")||0===e.indexOf("https://");if(!r||0===e.indexOf(window.location.hostname)){var s=new Image;s.src=e,s.crossOrigin="Anonymous",s.onload=function(){var t=document.createElement("canvas");t.width=this.width,t.height=this.height;var i=t.getContext("2d");i.drawImage(this,0,0),n.attr("xlink:href",t.toDataURL("image/png"))}}}),n.exit().transition(r).attr("width",function(t,n){return i._width(t,n)}).attr("height",function(t,n){return i._height(t,n)}).attr("x",function(t,n){return i._x(t,n)}).attr("y",function(t,n){return i._y(t,n)}).attr("opacity",0).remove(),t&&setTimeout(t,this._duration+100),this},c.prototype.data=function(t){return arguments.length?(this._data=t,this):this._data},c.prototype.duration=function(t){return arguments.length?(this._duration=t,this):this._duration},c.prototype.height=function(t){return arguments.length?(this._height="function"==typeof t?t:i.constant(t),this):this._height},c.prototype.id=function(t){return arguments.length?(this._id=t,this):this._id},c.prototype.select=function(t){return arguments.length?(this._select=h.select(t),this):this._select},c.prototype.url=function(t){return arguments.length?(this._url=t,this):this._url},c.prototype.width=function(t){return arguments.length?(this._width="function"==typeof t?t:i.constant(t),this):this._width},c.prototype.x=function(t){return arguments.length?(this._x="function"==typeof t?t:i.constant(t),this):this._x},c.prototype.y=function(t){return arguments.length?(this._y="function"==typeof t?t:i.constant(t),this):this._y};var l={select:n.select,selectAll:n.selectAll,transition:e.transition},u=function(){var t=this;this._backgroundImage=i.constant(!1),this._data=[],this._duration=600,this._fill=i.constant("black"),this._fontColor=function(i,n){return r.contrast(t._fill(i,n))},this._fontFamily=i.constant("Verdana"),this._fontResize=i.constant(!1),this._fontSize=i.constant(12),this._id=function(t,i){return void 0!==t.id?t.id:i},this._label=i.constant(!1),this._labelPadding=i.constant(5),this._on={},this._opacity=i.constant(1),this._scale=i.constant(1),this._stroke=i.constant("black"),this._strokeWidth=i.constant(0),this._textAnchor=i.constant("start"),this._verticalAlign=i.constant("top")};u.prototype._aes=function(){return{}},u.prototype._applyImage=function(t,i){void 0===i&&(i=!0);var n=this;t.each(function(t,e){var r=n._aes(t,e),o=[],s=0,a=0;if(i&&(r.r||r.w&&r.h)){s=r.r?2*r.r:r.h,a=r.r?2*r.r:r.w;var h=n._backgroundImage(t,e);h&&o.push({url:h})}(new c).data(o).duration(n._duration).height(s).select(this).width(a).x(-a/2).y(-s/2).render()})},u.prototype._applyLabels=function(t,i){void 0===i&&(i=!0);var n=this;t.each(function(t,e){var r=[];if(i){var s=n._label(t,e);if(n._labelBounds&&s!==!1&&void 0!==s){var a=n._labelBounds(n._aes(t,e),e);if(a){s.constructor!==Array&&(s=[s]);for(var h=n._fontColor(t,e),c=n._fontFamily(t,e),l=n._fontResize(t,e),u=n._fontSize(t,e),p=n._lineHeight(t,e),_=n._labelPadding(t,e),d=n._textAnchor(t,e),f=n._verticalAlign(t,e),y=0;y<s.length;y++){var g=a.constructor===Array?a[y]:Object.assign({},a),x=_.constructor===Array?_[y]:_;g.height-=2*x,g.width-=2*x,g.x+=x,g.y+=x,g.id=n._id(t,e)+"_"+y,g.text=s[y],g.fC=h.constructor===Array?h[y]:h,g.fF=c.constructor===Array?c[y]:c,g.fR=l.constructor===Array?l[y]:l,g.fS=u.constructor===Array?u[y]:u,g.lH=p.constructor===Array?p[y]:p,g.tA=d.constructor===Array?d[y]:d,g.vA=f.constructor===Array?f[y]:f,r.push(g)}}}}o.textBox().data(r).delay(n._duration/2).duration(n._duration).fontColor(function(t){return t.fC}).fontFamily(function(t){return t.fF}).fontResize(function(t){return t.fR}).fontSize(function(t){return t.fS}).lineHeight(function(t){return t.lH}).textAnchor(function(t){return t.tA}).verticalAlign(function(t){return t.vA}).select(this)()})},u.prototype._applyStyle=function(t){var i=this;t.attr("fill",function(t,n){return i._fill(t,n)}).attr("stroke",function(t,n){return i._stroke(t,n)}).attr("stroke-width",function(t,n){return i._strokeWidth(t,n)})},u.prototype.backgroundImage=function(t){return arguments.length?(this._backgroundImage="function"==typeof t?t:i.constant(t),this):this._backgroundImage},u.prototype.config=function t(i){var n=this;if(arguments.length){for(var e in i)({}).hasOwnProperty.call(i,e)&&e in n&&n[e](i[e]);return this}var t={};for(var r in this.prototype.constructor)"config"!==r&&{}.hasOwnProperty.call(n,r)&&(t[r]=n[r]());return t},u.prototype.data=function(t){return arguments.length?(this._data=t,this):this._data},u.prototype.duration=function(t){return arguments.length?(this._duration=t,this):this._duration},u.prototype.fill=function(t){return arguments.length?(this._fill="function"==typeof t?t:i.constant(t),this):this._fill},u.prototype.fontColor=function(t){return arguments.length?(this._fontColor="function"==typeof t?t:i.constant(t),this):this._fontColor},u.prototype.fontFamily=function(t){return arguments.length?(this._fontFamily="function"==typeof t?t:i.constant(t),this):this._fontFamily},u.prototype.fontResize=function(t){return arguments.length?(this._fontResize="function"==typeof t?t:i.constant(t),this):this._fontResize},u.prototype.fontSize=function(t){return arguments.length?(this._fontSize="function"==typeof t?t:i.constant(t),this):this._fontSize},u.prototype.id=function(t){return arguments.length?(this._id=t,this):this._id},u.prototype.label=function(t){return arguments.length?(this._label="function"==typeof t?t:i.constant(t),this):this._label},u.prototype.labelBounds=function(t){return arguments.length?(this._labelBounds=t,this):this._labelBounds},u.prototype.labelPadding=function(t){return arguments.length?(this._labelPadding="function"==typeof t?t:i.constant(t),this):this._labelPadding},u.prototype.lineHeight=function(t){return arguments.length?(this._lineHeight="function"==typeof t?t:i.constant(t),this):this._lineHeight},u.prototype.on=function(t,i){return 2===arguments.length?(this._on[t]=i,this):arguments.length?this._on[t]:this._on},u.prototype.opacity=function(t){return arguments.length?(this._opacity="function"==typeof t?t:i.constant(t),this):this._opacity},u.prototype.render=function(t){var i=this;return void 0===this._select&&this.select(l.select("body").append("svg").style("width",window.innerWidth+"px").style("height",window.innerHeight+"px").style("display","block").node()),void 0===this._lineHeight&&this.lineHeight(function(t,n){return 1.1*i._fontSize(t,n)}),this._transition=l.transition().duration(this._duration),t&&setTimeout(t,this._duration+100),this},u.prototype.scale=function(t){return arguments.length?(this._scale="function"==typeof t?t:i.constant(t),this):this._scale},u.prototype.select=function(t){return arguments.length?(this._select=l.select(t),this):this._select},u.prototype.stroke=function(t){return arguments.length?(this._stroke="function"==typeof t?t:i.constant(t),this):this._stroke},u.prototype.strokeWidth=function(t){return arguments.length?(this._strokeWidth="function"==typeof t?t:i.constant(t),this):this._strokeWidth},u.prototype.textAnchor=function(t){return arguments.length?(this._textAnchor="function"==typeof t?t:i.constant(t),this):this._textAnchor},u.prototype.verticalAlign=function(t){return arguments.length?(this._verticalAlign="function"==typeof t?t:i.constant(t),this):this._verticalAlign};var p=function(t){function n(){t.call(this),this._r=i.accessor("r"),this._x=i.accessor("x"),this._y=i.accessor("y")}return t&&(n.__proto__=t),n.prototype=Object.create(t&&t.prototype),n.prototype.constructor=n,n.prototype._applyPosition=function(t){var i=this;t.attr("r",function(t,n){return i._r(t,n)}).attr("x",function(t,n){return-i._r(t,n)/2}).attr("y",function(t,n){return-i._r(t,n)/2})},n.prototype.render=function(i){var n=this;t.prototype.render.call(this,i);var e=this._select.selectAll(".d3plus-shape-circle").data(this._data,this._id);e.transition(this._transition).attr("transform",function(t,i){return"translate("+n._x(t,i)+","+n._y(t,i)+")"}),e.select("circle").transition(this._transition).call(this._applyStyle.bind(this)),e.exit().transition().delay(this._duration).remove(),e.exit().select("circle").transition(this._transition).attr("r",0).attr("x",0).attr("y",0),e.exit().call(this._applyImage.bind(this),!1).call(this._applyLabels.bind(this),!1);var r=e.enter().append("g").attr("class","d3plus-shape-circle").attr("id",function(t,i){return"d3plus-shape-circle-"+n._id(t,i)}).attr("transform",function(t,i){return"translate("+n._x(t,i)+","+n._y(t,i)+")"});r.append("circle").attr("r",0).attr("x",0).attr("y",0).call(this._applyStyle.bind(this));var o=r.merge(e);o.select("circle").transition(this._transition).call(this._applyPosition.bind(this)),o.call(this._applyImage.bind(this)).call(this._applyLabels.bind(this)).transition(this._transition).attr("opacity",this._opacity);for(var s=Object.keys(this._on),a=0;a<s.length;a++)o.on(s[a],n._on[s[a]]);return this},n.prototype._aes=function(t,i){return{r:this._r(t,i)}},n.prototype.r=function(t){return arguments.length?(this._r="function"==typeof t?t:i.constant(t),this):this._r},n.prototype.update=function(t){var i=this,n=this._select.selectAll(t),r=e.transition().duration(this._duration);return n.call(this._applyImage.bind(this)).call(this._applyLabels.bind(this)).transition(r).attr("opacity",this._opacity).attr("transform",function(t,n){return"translate("+i._x(t,n)+","+i._y(t,n)+")scale("+i._scale(t,n)+")"}),n.select("circle").transition(r).call(this._applyStyle.bind(this)).call(this._applyPosition.bind(this)),this},n.prototype.x=function(t){return arguments.length?(this._x="function"==typeof t?t:i.constant(t),this):this._x},n.prototype.y=function(t){return arguments.length?(this._y="function"==typeof t?t:i.constant(t),this):this._y},n}(u),_=function(t){function n(){t.call(this),this._fill=i.constant("none"),this._path=a.line().defined(function(t){return t}),this._strokeWidth=i.constant(1),this._x=i.accessor("x"),this._y=i.accessor("y")}return t&&(n.__proto__=t),n.prototype=Object.create(t&&t.prototype),n.prototype.constructor=n,n.prototype.render=function(i){var n=this;t.prototype.render.call(this,i);var e=s.nest().key(this._id).entries(this._data);this._path.x(this._x).y(this._y);var r=this._select.selectAll(".d3plus-shape-line").data(e,function(t){return t.key});r.select("path").transition(this._transition).attr("d",function(t){return n._path(t.values)}).call(this._applyStyle.bind(this)),r.exit().transition().delay(this._duration).remove(),r.exit().call(this._applyLabels.bind(this),!1);var o=r.enter().append("g").attr("class","d3plus-shape-line").attr("id",function(t){return"d3plus-shape-line-"+t.key});o.append("path").attr("d",function(t){return n._path(t.values)}).call(this._applyStyle.bind(this));var a=o.merge(r);a.call(this._applyLabels.bind(this)).transition(this._transition).attr("opacity",this._opacity);for(var h=Object.keys(this._on),c=0;c<h.length;c++)a.on(h[c],n._on[h[c]]);return this},n.prototype._aes=function(t,i){var n=this;return{points:t.values.map(function(t){return[n._x(t,i),n._y(t,i)]})}},n.prototype.update=function(t){var i=this,n=this._select.selectAll(t),r=e.transition().duration(this._duration);return n.call(this._applyLabels.bind(this)).transition(r).attr("opacity",this._opacity),n.select("path").transition(r).attr("d",function(t){return i._path(t.values)}),this},n.prototype.x=function(t){return arguments.length?(this._x="function"==typeof t?t:i.constant(t),this):this._x},n.prototype.y=function(t){return arguments.length?(this._y="function"==typeof t?t:i.constant(t),this):this._y},n}(u),d=function(t){function n(){t.call(this),this._height=i.accessor("height"),this._labelBounds=function(t){return{width:t.width,height:t.height,x:-t.width/2,y:-t.height/2}},this._width=i.accessor("width"),this._x=i.accessor("x"),this._y=i.accessor("y")}return t&&(n.__proto__=t),n.prototype=Object.create(t&&t.prototype),n.prototype.constructor=n,n.prototype.render=function(i){var n=this;t.prototype.render.call(this,i);var e=this._select.selectAll(".d3plus-shape-rect").data(this._data,this._id);e.transition(this._transition).attr("transform",function(t,i){return"translate("+n._x(t,i)+","+n._y(t,i)+")"}),e.select("rect").transition(this._transition).call(this._applyStyle.bind(this)),e.exit().transition().delay(this._duration).remove(),e.exit().select("rect").transition(this._transition).attr("width",0).attr("height",0).attr("x",0).attr("y",0),e.exit().call(this._applyImage.bind(this),!1).call(this._applyLabels.bind(this),!1);var r=e.enter().append("g").attr("class","d3plus-shape-rect").attr("id",function(t,i){return"d3plus-shape-rect-"+n._id(t,i)}).attr("transform",function(t,i){return"translate("+n._x(t,i)+","+n._y(t,i)+")"});r.append("rect").attr("width",0).attr("height",0).attr("x",0).attr("y",0).call(this._applyStyle.bind(this));var o=r.merge(e);o.select("rect").transition(this._transition).call(this._applyPosition.bind(this)),o.call(this._applyImage.bind(this)).call(this._applyLabels.bind(this)).transition(this._transition).attr("opacity",this._opacity);for(var s=Object.keys(this._on),a=0;a<s.length;a++)o.on(s[a],n._on[s[a]]);return this},n.prototype._aes=function(t,i){return{width:this._width(t,i),height:this._height(t,i)}},n.prototype._applyPosition=function(t){var i=this;t.attr("width",function(t,n){return i._width(t,n)}).attr("height",function(t,n){return i._height(t,n)}).attr("x",function(t,n){return-i._width(t,n)/2}).attr("y",function(t,n){return-i._height(t,n)/2})},n.prototype.height=function(t){return arguments.length?(this._height="function"==typeof t?t:i.constant(t),this):this._height},n.prototype.update=function(t){var i=this,n=this._select.selectAll(t),r=e.transition().duration(this._duration);return n.call(this._applyImage.bind(this)).call(this._applyLabels.bind(this)).transition(r).attr("opacity",this._opacity).attr("transform",function(t,n){return"translate("+i._x(t,n)+","+i._y(t,n)+")scale("+i._scale(t,n)+")"}),n.select("rect").transition(r).call(this._applyStyle.bind(this)).call(this._applyPosition.bind(this)),this},n.prototype.width=function(t){return arguments.length?(this._width="function"==typeof t?t:i.constant(t),this):this._width},n.prototype.x=function(t){return arguments.length?(this._x="function"==typeof t?t:i.constant(t),this):this._x},n.prototype.y=function(t){return arguments.length?(this._y="function"==typeof t?t:i.constant(t),this):this._y},n}(u);t.Circle=p,t.Image=c,t.Line=_,t.Rect=d,t.Shape=u,Object.defineProperty(t,"__esModule",{value:!0})});