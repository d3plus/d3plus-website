/*
  d3plus-shape v0.8.12
  Fancy SVG shapes for visualizations
  Copyright (c) 2016 D3plus - https://d3plus.org
  @license MIT
*/
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("d3-transition"),require("d3plus-common"),require("d3plus-text"),require("d3-selection"),require("d3plus-color"),require("d3-array"),require("d3-collection"),require("d3-shape")):"function"==typeof define&&define.amd?define("d3plus-shape",["exports","d3-transition","d3plus-common","d3plus-text","d3-selection","d3plus-color","d3-array","d3-collection","d3-shape"],n):n(t.d3plus=t.d3plus||{},t.d3Transition,t.d3plusCommon,t.d3plusText,t.d3Selection,t.d3plusColor,t.d3Array,t.d3Collection,t.paths)}(this,function(t,n,i,e,r,o,s,a,h){"use strict";var c=function(){this._duration=600,this._height=i.accessor("height"),this._id=i.accessor("url"),this._select,this._url=i.accessor("url"),this._width=i.accessor("width"),this._x=i.accessor("x",0),this._y=i.accessor("y",0)};c.prototype.render=function(t){var i=this;void 0===this._select&&this.select(r.select("body").append("svg").style("width",window.innerWidth+"px").style("height",window.innerHeight+"px").style("display","block").node());var e=this._select.selectAll(".d3plus-shape-image").data(this._data,this._id),o=e.enter().append("image").attr("class","d3plus-shape-image").attr("opacity",0),s=n.transition().duration(this._duration),a=this,h=o.merge(e);return h.attr("xlink:href",this._url).transition(s).attr("opacity",1).attr("width",function(t,n){return i._width(t,n)}).attr("height",function(t,n){return i._height(t,n)}).attr("x",function(t,n){return i._x(t,n)}).attr("y",function(t,n){return i._y(t,n)}).each(function(t,n){var i=r.select(this),e=a._url(t,n),o=0===e.indexOf("http://")||0===e.indexOf("https://");if(!o||0===e.indexOf(window.location.hostname)){var s=new c;s.src=e,s.crossOrigin="Anonymous",s.onload=function(){var t=document.createElement("canvas");t.width=this.width,t.height=this.height;var n=t.getContext("2d");n.drawImage(this,0,0),i.attr("xlink:href",t.toDataURL("image/png"))}}}),e.exit().transition(s).attr("width",function(t,n){return i._width(t,n)}).attr("height",function(t,n){return i._height(t,n)}).attr("x",function(t,n){return i._x(t,n)}).attr("y",function(t,n){return i._y(t,n)}).attr("opacity",0).remove(),t&&setTimeout(t,this._duration+100),this},c.prototype.data=function(t){return arguments.length?(this._data=t,this):this._data},c.prototype.duration=function(t){return arguments.length?(this._duration=t,this):this._duration},c.prototype.height=function(t){return arguments.length?(this._height="function"==typeof t?t:i.constant(t),this):this._height},c.prototype.id=function(t){return arguments.length?(this._id=t,this):this._id},c.prototype.select=function(t){return arguments.length?(this._select=r.select(t),this):this._select},c.prototype.url=function(t){return arguments.length?(this._url=t,this):this._url},c.prototype.width=function(t){return arguments.length?(this._width="function"==typeof t?t:i.constant(t),this):this._width},c.prototype.x=function(t){return arguments.length?(this._x="function"==typeof t?t:i.constant(t),this):this._x},c.prototype.y=function(t){return arguments.length?(this._y="function"==typeof t?t:i.constant(t),this):this._y};var l=function(){var t=this;this._backgroundImage=i.constant(!1),this._data=[],this._duration=600,this._fill=i.constant("black"),this._fontColor=function(n,i){return o.contrast(t._fill(n,i))},this._fontFamily=i.constant("Verdana"),this._fontResize=i.constant(!1),this._fontSize=i.constant(12),this._id=function(t,n){return void 0!==t.id?t.id:n},this._label=i.constant(!1),this._labelPadding=i.constant(5),this._on={},this._opacity=i.constant(1),this._scale=i.constant(1),this._stroke=i.constant("black"),this._strokeWidth=i.constant(0),this._textAnchor=i.constant("start"),this._verticalAlign=i.constant("top")};l.prototype._aes=function(){return{}},l.prototype._applyEvents=function(t){var n=this,e=t.selectAll(".hitArea").data(this._hitArea?[0]:[]);e.exit().remove(),e=e.enter().append("rect").attr("class","hitArea").attr("fill","none").merge(e).data(function(t){return[t]}).each(function(t){var e=n._hitArea(t,n._data.indexOf(t));e?r.select(this).call(i.attrize,e):r.select(this).remove()});for(var o=this._hitArea?e:t,s=Object.keys(this._on),a=function(t){o.on(s[t],function(i,e){var r="hitArea"===this.className.baseVal,o=r?this.parentNode:this;n._on[s[t]].bind(o)(i,r?n._data.indexOf(i):e)})},h=0;h<s.length;h++)a(h)},l.prototype._applyImage=function(t,n){void 0===n&&(n=!0);var i=this;t.each(function(t,e){var r=i._aes(t,e),o=[],s=0,a=0;if(n&&(r.r||r.width&&r.height)){s=r.r?2*r.r:r.height,a=r.r?2*r.r:r.width;var h=i._backgroundImage(t,e);h&&o.push({url:h})}(new c).data(o).duration(i._duration).height(s).select(this).width(a).x(-a/2).y(-s/2).render()})},l.prototype._applyLabels=function(t,n){void 0===n&&(n=!0);var i=this;t.each(function(t,r){var o=t;t.nested&&t.key&&t.values&&(o=t.values[0]);var s=[];if(n){var a=i._label(o,r);if(i._labelBounds&&a!==!1&&void 0!==a){var h=i._labelBounds(o,r,i._aes(t,r));if(h){a.constructor!==Array&&(a=[a]);for(var c=i._fontColor(o,r),l=i._fontFamily(o,r),u=i._fontResize(o,r),p=i._fontSize(o,r),_=i._lineHeight(o,r),d=i._labelPadding(o,r),f=i._textAnchor(o,r),y=i._verticalAlign(o,r),g=0;g<a.length;g++){var v=h.constructor===Array?h[g]:Object.assign({},h),x=d.constructor===Array?d[g]:d;v.height-=2*x,v.width-=2*x,v.x+=x,v.y+=x,v.id=i._id(o,r)+"_"+g,v.text=a[g],v.fC=c.constructor===Array?c[g]:c,v.fF=l.constructor===Array?l[g]:l,v.fR=u.constructor===Array?u[g]:u,v.fS=p.constructor===Array?p[g]:p,v.lH=_.constructor===Array?_[g]:_,v.tA=f.constructor===Array?f[g]:f,v.vA=y.constructor===Array?y[g]:y,s.push(v)}}}}(new e.TextBox).data(s).delay(i._duration/2).duration(i._duration).fontColor(function(t){return t.fC}).fontFamily(function(t){return t.fF}).fontResize(function(t){return t.fR}).fontSize(function(t){return t.fS}).lineHeight(function(t){return t.lH}).textAnchor(function(t){return t.tA}).verticalAlign(function(t){return t.vA}).select(this).render()})},l.prototype._applyStyle=function(t){var n=this;t.attr("fill",function(t,i){return n._fill(t,i)}).attr("stroke",function(t,i){return n._stroke(t,i)}).attr("stroke-width",function(t,i){return n._strokeWidth(t,i)})},l.prototype.backgroundImage=function(t){return arguments.length?(this._backgroundImage="function"==typeof t?t:i.constant(t),this):this._backgroundImage},l.prototype.config=function t(n){var i=this;if(arguments.length){for(var e in n)({}).hasOwnProperty.call(n,e)&&e in i&&i[e](n[e]);return this}var t={};for(var r in this.prototype.constructor)"config"!==r&&{}.hasOwnProperty.call(i,r)&&(t[r]=i[r]());return t},l.prototype.data=function(t){return arguments.length?(this._data=t,this):this._data},l.prototype.duration=function(t){return arguments.length?(this._duration=t,this):this._duration},l.prototype.fill=function(t){return arguments.length?(this._fill="function"==typeof t?t:i.constant(t),this):this._fill},l.prototype.fontColor=function(t){return arguments.length?(this._fontColor="function"==typeof t?t:i.constant(t),this):this._fontColor},l.prototype.fontFamily=function(t){return arguments.length?(this._fontFamily="function"==typeof t?t:i.constant(t),this):this._fontFamily},l.prototype.fontResize=function(t){return arguments.length?(this._fontResize="function"==typeof t?t:i.constant(t),this):this._fontResize},l.prototype.fontSize=function(t){return arguments.length?(this._fontSize="function"==typeof t?t:i.constant(t),this):this._fontSize},l.prototype.hitArea=function(t){return arguments.length?(this._hitArea="function"==typeof t?t:i.constant(t),this):this._hitArea},l.prototype.id=function(t){return arguments.length?(this._id=t,this):this._id},l.prototype.label=function(t){return arguments.length?(this._label="function"==typeof t?t:i.constant(t),this):this._label},l.prototype.labelBounds=function(t){return arguments.length?(this._labelBounds="function"==typeof t?t:i.constant(t),this):this._labelBounds},l.prototype.labelPadding=function(t){return arguments.length?(this._labelPadding="function"==typeof t?t:i.constant(t),this):this._labelPadding},l.prototype.lineHeight=function(t){return arguments.length?(this._lineHeight="function"==typeof t?t:i.constant(t),this):this._lineHeight},l.prototype.on=function(t,n){return 2===arguments.length?(this._on[t]=n,this):arguments.length?"string"==typeof t?this._on[t]:(this._on=Object.assign({},this._on,t),this):this._on},l.prototype.opacity=function(t){return arguments.length?(this._opacity="function"==typeof t?t:i.constant(t),this):this._opacity},l.prototype.render=function(t){var i=this;return void 0===this._select&&this.select(r.select("body").append("svg").style("width",window.innerWidth+"px").style("height",window.innerHeight+"px").style("display","block").node()),void 0===this._lineHeight&&this.lineHeight(function(t,n){return 1.1*i._fontSize(t,n)}),this._transition=n.transition().duration(this._duration),t&&setTimeout(t,this._duration+100),this},l.prototype.scale=function(t){return arguments.length?(this._scale="function"==typeof t?t:i.constant(t),this):this._scale},l.prototype.select=function(t){return arguments.length?(this._select=r.select(t),this):this._select},l.prototype.stroke=function(t){return arguments.length?(this._stroke="function"==typeof t?t:i.constant(t),this):this._stroke},l.prototype.strokeWidth=function(t){return arguments.length?(this._strokeWidth="function"==typeof t?t:i.constant(t),this):this._strokeWidth},l.prototype.textAnchor=function(t){return arguments.length?(this._textAnchor="function"==typeof t?t:i.constant(t),this):this._textAnchor},l.prototype.verticalAlign=function(t){return arguments.length?(this._verticalAlign="function"==typeof t?t:i.constant(t),this):this._verticalAlign};var u=function(t){function r(){t.call(this),this._r=i.accessor("r"),this._x=i.accessor("x"),this._y=i.accessor("y")}return t&&(r.__proto__=t),r.prototype=Object.create(t&&t.prototype),r.prototype.constructor=r,r.prototype._applyPosition=function(t){var n=this;t.attr("r",function(t,i){return n._r(t,i)}).attr("x",function(t,i){return-n._r(t,i)/2}).attr("y",function(t,i){return-n._r(t,i)/2})},r.prototype.render=function(n){var i=this;t.prototype.render.call(this,n);var r=this._select.selectAll(".d3plus-Circle").data(this._data,this._id);r.transition(this._transition).attr("transform",function(t,n){return"translate("+i._x(t,n)+","+i._y(t,n)+")"}),r.select("circle").transition(this._transition).call(this._applyStyle.bind(this)),r.exit().transition().delay(this._duration).remove(),r.exit().select("circle").transition(this._transition).attr("r",0).attr("x",0).attr("y",0),r.exit().call(this._applyImage.bind(this),!1).call(this._applyLabels.bind(this),!1);var o=r.enter().append("g").attr("class",function(t,n){return"d3plus-Shape d3plus-Circle d3plus-id-"+e.strip(i._id(t,n))}).attr("transform",function(t,n){return"translate("+i._x(t,n)+","+i._y(t,n)+")"});o.append("circle").attr("r",0).attr("x",0).attr("y",0).call(this._applyStyle.bind(this));var s=o.merge(r);return s.select("circle").transition(this._transition).call(this._applyPosition.bind(this)),s.call(this._applyImage.bind(this)).call(this._applyLabels.bind(this)).attr("pointer-events","none").transition(this._transition).attr("opacity",this._opacity).transition().attr("pointer-events","all"),this._applyEvents(s),this},r.prototype._aes=function(t,n){return{r:this._r(t,n)}},r.prototype.r=function(t){return arguments.length?(this._r="function"==typeof t?t:i.constant(t),this):this._r},r.prototype.update=function(t){var i=this,e=this._select.selectAll(t),r=n.transition().duration(this._duration);return e.call(this._applyImage.bind(this)).call(this._applyLabels.bind(this)).transition(r).attr("opacity",this._opacity).attr("transform",function(t,n){return"translate("+i._x(t,n)+","+i._y(t,n)+")scale("+i._scale(t,n)+")"}),e.select("circle").transition(r).call(this._applyStyle.bind(this)).call(this._applyPosition.bind(this)),this},r.prototype.x=function(t){return arguments.length?(this._x="function"==typeof t?t:i.constant(t),this):this._x},r.prototype.y=function(t){return arguments.length?(this._y="function"==typeof t?t:i.constant(t),this):this._y},r}(l),p=function(t){function r(){t.call(this),this._curve="linear",this._fill=i.constant("none"),this._path=h.line().defined(function(t){return t}),this._strokeWidth=i.constant(1),this._x=i.accessor("x"),this._y=i.accessor("y")}return t&&(r.__proto__=t),r.prototype=Object.create(t&&t.prototype),r.prototype.constructor=r,r.prototype.render=function(n){var i=this;t.prototype.render.call(this,n);var r=a.nest().key(this._id).entries(this._data).map(function(t){var n=s.extent(t.values,function(t){return t.x});t.xR=n,t.width=n[1]-n[0],t.x=n[0]+t.width/2;var i=s.extent(t.values,function(t){return t.y});return t.yR=i,t.height=i[1]-i[0],t.y=i[0]+t.height/2,t.nested=!0,t});this._path.curve(h["curve"+this._curve.charAt(0).toUpperCase()+this._curve.slice(1)]).x(this._x).y(this._y);var o=this._select.selectAll(".d3plus-Line").data(r,function(t){return t.key});o.transition(this._transition).attr("transform",function(t){return"translate("+t.x+", "+t.y+")"}),o.select("path").transition(this._transition).attr("transform",function(t){return"translate("+(-t.xR[0]-t.width/2)+", "+(-t.yR[0]-t.height/2)+")"}).attr("d",function(t){return i._path(t.values)}).call(this._applyStyle.bind(this)),o.exit().transition().delay(this._duration).remove(),o.exit().call(this._applyLabels.bind(this),!1);var c=o.enter().append("g").attr("class",function(t){return"d3plus-Shape d3plus-Line d3plus-id-"+e.strip(t.key)}).attr("transform",function(t){return"translate("+t.x+", "+t.y+")"}).attr("opacity",0);c.append("path").attr("transform",function(t){return"translate("+(-t.xR[0]-t.width/2)+", "+(-t.yR[0]-t.height/2)+")"}).attr("d",function(t){return i._path(t.values)}).call(this._applyStyle.bind(this));var l=c.merge(o);return l.call(this._applyLabels.bind(this)).attr("pointer-events","none").transition(this._transition).attr("opacity",this._opacity).transition().attr("pointer-events","none"),this._applyEvents(l),this},r.prototype._aes=function(t,n){var i=this;return{points:t.values.map(function(t){return[i._x(t,n),i._y(t,n)]})}},r.prototype.curve=function(t){return arguments.length?(this._curve=t,this):this._curve},r.prototype.update=function(t){var i=this,e=this._select.selectAll(t),r=n.transition().duration(this._duration);return e.call(this._applyLabels.bind(this)).transition(r).attr("opacity",this._opacity),e.select("path").transition(r).attr("d",function(t){return i._path(t.values)}),this},r.prototype.x=function(t){return arguments.length?(this._x="function"==typeof t?t:i.constant(t),this):this._x},r.prototype.y=function(t){return arguments.length?(this._y="function"==typeof t?t:i.constant(t),this):this._y},r}(l),_=function(t){function r(){t.call(this),this._height=i.accessor("height"),this._labelBounds=function(t,n,i){return{width:i.width,height:i.height,x:-i.width/2,y:-i.height/2}},this._width=i.accessor("width"),this._x=i.accessor("x"),this._y=i.accessor("y")}return t&&(r.__proto__=t),r.prototype=Object.create(t&&t.prototype),r.prototype.constructor=r,r.prototype.render=function(n){var i=this;t.prototype.render.call(this,n);var r=this._select.selectAll(".d3plus-Rect").data(this._data,this._id);r.transition(this._transition).attr("transform",function(t,n){return"translate("+i._x(t,n)+","+i._y(t,n)+")"}),r.select("rect").transition(this._transition).call(this._applyStyle.bind(this)),r.exit().transition().delay(this._duration).remove(),r.exit().select("rect").transition(this._transition).attr("width",0).attr("height",0).attr("x",0).attr("y",0),r.exit().call(this._applyImage.bind(this),!1).call(this._applyLabels.bind(this),!1);var o=r.enter().append("g").attr("class",function(t,n){return"d3plus-Shape d3plus-Rect d3plus-id-"+e.strip(i._id(t,n))}).attr("transform",function(t,n){return"translate("+i._x(t,n)+","+i._y(t,n)+")"});o.append("rect").attr("width",0).attr("height",0).attr("x",0).attr("y",0).call(this._applyStyle.bind(this));var s=o.merge(r);return s.select("rect").transition(this._transition).call(this._applyPosition.bind(this)),s.call(this._applyImage.bind(this)).call(this._applyLabels.bind(this)).attr("pointer-events","none").transition(this._transition).attr("opacity",this._opacity).transition().attr("pointer-events","all"),this._applyEvents(s),this},r.prototype._aes=function(t,n){return{width:this._width(t,n),height:this._height(t,n)}},r.prototype._applyPosition=function(t){var n=this;t.attr("width",function(t,i){return n._width(t,i)}).attr("height",function(t,i){return n._height(t,i)}).attr("x",function(t,i){return-n._width(t,i)/2}).attr("y",function(t,i){return-n._height(t,i)/2})},r.prototype.height=function(t){return arguments.length?(this._height="function"==typeof t?t:i.constant(t),this):this._height},r.prototype.update=function(t){var i=this,e=this._select.selectAll(t),r=n.transition().duration(this._duration);return e.call(this._applyImage.bind(this)).call(this._applyLabels.bind(this)).transition(r).attr("opacity",this._opacity).attr("transform",function(t,n){return"translate("+i._x(t,n)+","+i._y(t,n)+")scale("+i._scale(t,n)+")"}),e.select("rect").transition(r).call(this._applyStyle.bind(this)).call(this._applyPosition.bind(this)),this},r.prototype.width=function(t){return arguments.length?(this._width="function"==typeof t?t:i.constant(t),this):this._width},r.prototype.x=function(t){return arguments.length?(this._x="function"==typeof t?t:i.constant(t),this):this._x},r.prototype.y=function(t){return arguments.length?(this._y="function"==typeof t?t:i.constant(t),this):this._y},r}(l);t.Circle=u,t.Image=c,t.Line=p,t.Rect=_,t.Shape=l,Object.defineProperty(t,"__esModule",{value:!0})});