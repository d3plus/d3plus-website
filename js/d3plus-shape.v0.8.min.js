/*
  d3plus-shape v0.8.19
  Fancy SVG shapes for visualizations
  Copyright (c) 2016 D3plus - https://d3plus.org
  @license MIT
*/
(function(t,i){typeof exports==="object"&&typeof module!=="undefined"?i(exports,require("d3-array"),require("d3-collection"),require("d3-interpolate-path"),require("d3-selection"),require("d3-shape"),require("d3-transition"),require("d3plus-common"),require("d3plus-text"),require("d3plus-color")):typeof define==="function"&&define.amd?define("d3plus-shape",["exports","d3-array","d3-collection","d3-interpolate-path","d3-selection","d3-shape","d3-transition","d3plus-common","d3plus-text","d3plus-color"],i):i(t.d3plus=t.d3plus||{},t.d3Array,t.d3Collection,t.d3InterpolatePath,t.d3Selection,t.paths,t.d3Transition,t.d3plusCommon,t.d3plusText,t.d3plusColor)})(this,function(t,i,n,e,r,s,o,a,h,c){"use strict";var l=function t(){this._duration=600;this._height=a.accessor("height");this._id=a.accessor("url");this._select;this._url=a.accessor("url");this._width=a.accessor("width");this._x=a.accessor("x",0);this._y=a.accessor("y",0)};l.prototype.render=function t(i){var n=this;if(this._select===void 0)this.select(r.select("body").append("svg").style("width",window.innerWidth+"px").style("height",window.innerHeight+"px").style("display","block").node());var e=this._select.selectAll(".d3plus-shape-image").data(this._data,this._id);var s=e.enter().append("image").attr("class","d3plus-shape-image").attr("opacity",0);var a=o.transition().duration(this._duration),h=this,c=s.merge(e);c.attr("xlink:href",this._url).transition(a).attr("opacity",1).attr("width",function(t,i){return n._width(t,i)}).attr("height",function(t,i){return n._height(t,i)}).attr("x",function(t,i){return n._x(t,i)}).attr("y",function(t,i){return n._y(t,i)}).each(function(t,i){var n=r.select(this),e=h._url(t,i);var s=e.indexOf("http://")===0||e.indexOf("https://")===0;if(!s||e.indexOf(window.location.hostname)===0){var o=new l;o.src=e;o.crossOrigin="Anonymous";o.onload=function(){var t=document.createElement("canvas");t.width=this.width;t.height=this.height;var i=t.getContext("2d");i.drawImage(this,0,0);n.attr("xlink:href",t.toDataURL("image/png"))}}});e.exit().transition(a).attr("width",function(t,i){return n._width(t,i)}).attr("height",function(t,i){return n._height(t,i)}).attr("x",function(t,i){return n._x(t,i)}).attr("y",function(t,i){return n._y(t,i)}).attr("opacity",0).remove();if(i)setTimeout(i,this._duration+100);return this};l.prototype.data=function t(i){return arguments.length?(this._data=i,this):this._data};l.prototype.duration=function t(i){return arguments.length?(this._duration=i,this):this._duration};l.prototype.height=function t(i){return arguments.length?(this._height=typeof i==="function"?i:a.constant(i),this):this._height};l.prototype.id=function t(i){return arguments.length?(this._id=i,this):this._id};l.prototype.select=function t(i){return arguments.length?(this._select=r.select(i),this):this._select};l.prototype.url=function t(i){return arguments.length?(this._url=i,this):this._url};l.prototype.width=function t(i){return arguments.length?(this._width=typeof i==="function"?i:a.constant(i),this):this._width};l.prototype.x=function t(i){return arguments.length?(this._x=typeof i==="function"?i:a.constant(i),this):this._x};l.prototype.y=function t(i){return arguments.length?(this._y=typeof i==="function"?i:a.constant(i),this):this._y};var u=function(t){function i(){var i=this;t.call(this);this._backgroundImage=a.constant(false);this._data=[];this._duration=600;this._fill=a.constant("black");this._fontColor=function(t,n){return c.contrast(i._fill(t,n))};this._fontFamily=a.constant("Verdana");this._fontResize=a.constant(false);this._fontSize=a.constant(12);this._id=function(t,i){return t.id!==void 0?t.id:i};this._label=a.constant(false);this._labelPadding=a.constant(5);this._opacity=a.constant(1);this._scale=a.constant(1);this._stroke=a.constant("black");this._strokeWidth=a.constant(0);this._textAnchor=a.constant("start");this._verticalAlign=a.constant("top")}if(t)i.__proto__=t;i.prototype=Object.create(t&&t.prototype);i.prototype.constructor=i;i.prototype._aes=function t(){return{}};i.prototype._applyEvents=function t(i){var n=this;var e=i.selectAll(".hitArea").data(this._hitArea?[0]:[]);e.exit().remove();e=e.enter().append("rect").attr("class","hitArea").attr("fill","none").merge(e).data(function(t){return[t]}).each(function(t){var i=n._hitArea(t,n._data.indexOf(t));if(i)r.select(this).call(a.attrize,i);else r.select(this).remove()});var s=this._hitArea?e:i;var o=Object.keys(this._on);var h=function(t){s.on(o[t],function(i,e){if(!n._on[o[t]])return;var r=this.className.baseVal==="hitArea";var s=r?this.parentNode:this;n._on[o[t]].bind(s)(i,r?n._data.indexOf(i):e)})};for(var c=0;c<o.length;c++)h(c)};i.prototype._applyImage=function t(i,n){if(n===void 0)n=true;var e=this;i.each(function(t,i){var r=e._aes(t,i);var s=[];var o=0,a=0;if(n&&(r.r||r.width&&r.height)){o=r.r?r.r*2:r.height;a=r.r?r.r*2:r.width;var h=e._backgroundImage(t,i);if(h)s.push({url:h})}(new l).data(s).duration(e._duration).height(o).select(this).width(a).x(-a/2).y(-o/2).render()})};i.prototype._applyLabels=function t(i,n){if(n===void 0)n=true;var e=this;i.each(function(t,i){var r=t;if(t.nested&&t.key&&t.values){r=t.values[0];i=e._data.indexOf(r)}var s=[];if(n){var o=e._label(r,i);if(e._labelBounds&&o!==false&&o!==void 0){var a=e._labelBounds(r,i,e._aes(t,i));if(a){if(o.constructor!==Array)o=[o];var c=e._fontColor(r,i),l=e._fontFamily(r,i),u=e._fontResize(r,i),p=e._fontSize(r,i),_=e._lineHeight(r,i),d=e._labelPadding(r,i),f=e._textAnchor(r,i),y=e._verticalAlign(r,i);for(var v=0;v<o.length;v++){var g=a.constructor===Array?a[v]:Object.assign({},a),x=d.constructor===Array?d[v]:d;g.height-=x*2;g.width-=x*2;g.x+=x;g.y+=x;g.id=e._id(r,i)+"_"+v;g.text=o[v];g.fC=c.constructor===Array?c[v]:c;g.fF=l.constructor===Array?l[v]:l;g.fR=u.constructor===Array?u[v]:u;g.fS=p.constructor===Array?p[v]:p;g.lH=_.constructor===Array?_[v]:_;g.tA=f.constructor===Array?f[v]:f;g.vA=y.constructor===Array?y[v]:y;s.push(g)}}}}(new h.TextBox).data(s).delay(e._duration/2).duration(e._duration).fontColor(function(t){return t.fC}).fontFamily(function(t){return t.fF}).fontResize(function(t){return t.fR}).fontSize(function(t){return t.fS}).lineHeight(function(t){return t.lH}).textAnchor(function(t){return t.tA}).verticalAlign(function(t){return t.vA}).select(this).render()})};i.prototype._applyStyle=function t(i){var n=this;function e(t,i){return t.nested&&t.key&&t.values?this(t.values[0],n._data.indexOf(t.values[0])):this(t,i)}i.attr("fill",e.bind(this._fill)).attr("stroke",e.bind(this._stroke)).attr("stroke-width",e.bind(this._strokeWidth))};i.prototype.backgroundImage=function t(i){return arguments.length?(this._backgroundImage=typeof i==="function"?i:a.constant(i),this):this._backgroundImage};i.prototype.data=function t(i){return arguments.length?(this._data=i,this):this._data};i.prototype.duration=function t(i){return arguments.length?(this._duration=i,this):this._duration};i.prototype.fill=function t(i){return arguments.length?(this._fill=typeof i==="function"?i:a.constant(i),this):this._fill};i.prototype.fontColor=function t(i){return arguments.length?(this._fontColor=typeof i==="function"?i:a.constant(i),this):this._fontColor};i.prototype.fontFamily=function t(i){return arguments.length?(this._fontFamily=typeof i==="function"?i:a.constant(i),this):this._fontFamily};i.prototype.fontResize=function t(i){return arguments.length?(this._fontResize=typeof i==="function"?i:a.constant(i),this):this._fontResize};i.prototype.fontSize=function t(i){return arguments.length?(this._fontSize=typeof i==="function"?i:a.constant(i),this):this._fontSize};i.prototype.hitArea=function t(i){return arguments.length?(this._hitArea=typeof i==="function"?i:a.constant(i),this):this._hitArea};i.prototype.id=function t(i){return arguments.length?(this._id=i,this):this._id};i.prototype.label=function t(i){return arguments.length?(this._label=typeof i==="function"?i:a.constant(i),this):this._label};i.prototype.labelBounds=function t(i){return arguments.length?(this._labelBounds=typeof i==="function"?i:a.constant(i),this):this._labelBounds};i.prototype.labelPadding=function t(i){return arguments.length?(this._labelPadding=typeof i==="function"?i:a.constant(i),this):this._labelPadding};i.prototype.lineHeight=function t(i){return arguments.length?(this._lineHeight=typeof i==="function"?i:a.constant(i),this):this._lineHeight};i.prototype.opacity=function t(i){return arguments.length?(this._opacity=typeof i==="function"?i:a.constant(i),this):this._opacity};i.prototype.render=function t(i){var n=this;if(this._select===void 0)this.select(r.select("body").append("svg").style("width",window.innerWidth+"px").style("height",window.innerHeight+"px").style("display","block").node());if(this._lineHeight===void 0)this.lineHeight(function(t,i){return n._fontSize(t,i)*1.1});this._transition=o.transition().duration(this._duration);if(i)setTimeout(i,this._duration+100);return this};i.prototype.scale=function t(i){return arguments.length?(this._scale=typeof i==="function"?i:a.constant(i),this):this._scale};i.prototype.select=function t(i){return arguments.length?(this._select=r.select(i),this):this._select};i.prototype.stroke=function t(i){return arguments.length?(this._stroke=typeof i==="function"?i:a.constant(i),this):this._stroke};i.prototype.strokeWidth=function t(i){return arguments.length?(this._strokeWidth=typeof i==="function"?i:a.constant(i),this):this._strokeWidth};i.prototype.textAnchor=function t(i){return arguments.length?(this._textAnchor=typeof i==="function"?i:a.constant(i),this):this._textAnchor};i.prototype.verticalAlign=function t(i){return arguments.length?(this._verticalAlign=typeof i==="function"?i:a.constant(i),this):this._verticalAlign};return i}(a.BaseClass);var p=function(t){function c(){t.call(this);this._curve="linear";this._defined=function(){return true};this._x=a.accessor("x");this._x0=a.accessor("x");this._x1=null;this._y=a.constant(0);this._y0=a.constant(0);this._y1=a.accessor("y")}if(t)c.__proto__=t;c.prototype=Object.create(t&&t.prototype);c.prototype.constructor=c;c.prototype.render=function o(a){var c=this;t.prototype.render.call(this,a);var l=this._path=s.area().defined(this._defined).curve(s["curve"+this._curve.charAt(0).toUpperCase()+this._curve.slice(1)]).x(this._x).x0(this._x0).x1(this._x1).y(this._y).y0(this._y0).y1(this._y1);var u=s.area().defined(function(t){return t}).curve(s["curve"+this._curve.charAt(0).toUpperCase()+this._curve.slice(1)]).x(this._x).x0(this._x0).x1(this._x1).y(this._y).y0(this._y0).y1(this._y1);var p=n.nest().key(this._id).entries(this._data).map(function(t){var n=i.extent(t.values.map(c._x).concat(t.values.map(c._x0)).concat(c._x1?t.values.map(c._x1):[]));t.xR=n;t.width=n[1]-n[0];t.x=n[0]+t.width/2;var e=i.extent(t.values.map(c._y).concat(t.values.map(c._y0)).concat(c._y1?t.values.map(c._y1):[]));t.yR=e;t.height=e[1]-e[0];t.y=e[0]+t.height/2;t.nested=true;return t});var _=this._select.selectAll(".d3plus-Area").data(p,function(t){return t.key});_.transition(this._transition).attr("transform",function(t){return"translate("+t.x+", "+t.y+")"});_.select("path").transition(this._transition).attr("transform",function(t){return"translate("+(-t.xR[0]-t.width/2)+", "+(-t.yR[0]-t.height/2)+")"}).attrTween("d",function(t){return e.interpolatePath(r.select(this).attr("d"),l(t.values))}).call(this._applyStyle.bind(this));_.exit().select("path").transition(this._transition).attrTween("d",function(t){return e.interpolatePath(r.select(this).attr("d"),u(t.values))});_.exit().transition().delay(this._duration).remove();_.exit().call(this._applyLabels.bind(this),false);var d=_.enter().append("g").attr("class",function(t){return"d3plus-Shape d3plus-Area d3plus-id-"+h.strip(t.key)}).attr("transform",function(t){return"translate("+t.x+", "+t.y+")"}).attr("opacity",0);d.append("path").attr("transform",function(t){return"translate("+(-t.xR[0]-t.width/2)+", "+(-t.yR[0]-t.height/2)+")"}).attr("d",function(t){return l(t.values)}).call(this._applyStyle.bind(this));var f=d.merge(_);f.call(this._applyLabels.bind(this)).attr("pointer-events","none").transition(this._transition).attr("opacity",this._opacity).transition().attr("pointer-events","all");this._applyEvents(f);return this};c.prototype._aes=function t(i,n){var e=this;return{points:i.values.map(function(t){return[e._x(t,n),e._y(t,n)]})}};c.prototype.curve=function t(i){return arguments.length?(this._curve=i,this):this._curve};c.prototype.defined=function t(i){return arguments.length?(this._defined=i,this):this._defined};c.prototype.update=function t(i){var n=this;var e=this._select.selectAll(i),r=o.transition().duration(this._duration);e.call(this._applyLabels.bind(this)).transition(r).attr("opacity",this._opacity);e.select("path").transition(r).attr("d",function(t){return n._path(t.values)});return this};c.prototype.x=function t(i){return arguments.length?(this._x=typeof i==="function"?i:a.constant(i),this):this._x};c.prototype.x0=function t(i){return arguments.length?(this._x0=typeof i==="function"?i:a.constant(i),this):this._x0};c.prototype.x1=function t(i){return arguments.length?(this._x1=typeof i==="function"||i===null?i:a.constant(i),this):this._x1};c.prototype.y=function t(i){return arguments.length?(this._y=typeof i==="function"?i:a.constant(i),this):this._y};c.prototype.y0=function t(i){return arguments.length?(this._y0=typeof i==="function"?i:a.constant(i),this):this._y0};c.prototype.y1=function t(i){return arguments.length?(this._y1=typeof i==="function"||i===null?i:a.constant(i),this):this._y1};return c}(u);var _=function(t){function i(){t.call(this);this._r=a.accessor("r");this._x=a.accessor("x");this._y=a.accessor("y")}if(t)i.__proto__=t;i.prototype=Object.create(t&&t.prototype);i.prototype.constructor=i;i.prototype._applyPosition=function t(i){var n=this;i.attr("r",function(t,i){return n._r(t,i)}).attr("x",function(t,i){return-n._r(t,i)/2}).attr("y",function(t,i){return-n._r(t,i)/2})};i.prototype.render=function i(n){var e=this;t.prototype.render.call(this,n);var r=this._select.selectAll(".d3plus-Circle").data(this._data,this._id);r.transition(this._transition).attr("transform",function(t,i){return"translate("+e._x(t,i)+","+e._y(t,i)+")"});r.select("circle").transition(this._transition).call(this._applyStyle.bind(this));r.exit().transition().delay(this._duration).remove();r.exit().select("circle").transition(this._transition).attr("r",0).attr("x",0).attr("y",0);r.exit().call(this._applyImage.bind(this),false).call(this._applyLabels.bind(this),false);var s=r.enter().append("g").attr("class",function(t,i){return"d3plus-Shape d3plus-Circle d3plus-id-"+h.strip(e._id(t,i))}).attr("transform",function(t,i){return"translate("+e._x(t,i)+","+e._y(t,i)+")"});s.append("circle").attr("r",0).attr("x",0).attr("y",0).call(this._applyStyle.bind(this));var o=s.merge(r);o.select("circle").transition(this._transition).call(this._applyPosition.bind(this));o.call(this._applyImage.bind(this)).call(this._applyLabels.bind(this)).attr("pointer-events","none").transition(this._transition).attr("opacity",this._opacity).transition().attr("pointer-events","all");this._applyEvents(o);return this};i.prototype._aes=function t(i,n){return{r:this._r(i,n)}};i.prototype.r=function t(i){return arguments.length?(this._r=typeof i==="function"?i:a.constant(i),this):this._r};i.prototype.update=function t(i){var n=this;var e=this._select.selectAll(i),r=o.transition().duration(this._duration);e.call(this._applyImage.bind(this)).call(this._applyLabels.bind(this)).transition(r).attr("opacity",this._opacity).attr("transform",function(t,i){return"translate("+n._x(t,i)+","+n._y(t,i)+")scale("+n._scale(t,i)+")"});e.select("circle").transition(r).call(this._applyStyle.bind(this)).call(this._applyPosition.bind(this));return this};i.prototype.x=function t(i){return arguments.length?(this._x=typeof i==="function"?i:a.constant(i),this):this._x};i.prototype.y=function t(i){return arguments.length?(this._y=typeof i==="function"?i:a.constant(i),this):this._y};return i}(u);var d=function(t){function c(){t.call(this);this._curve="linear";this._defined=function(t){return t};this._fill=a.constant("none");this._path=s.line();this._strokeWidth=a.constant(1);this._x=a.accessor("x");this._y=a.accessor("y")}if(t)c.__proto__=t;c.prototype=Object.create(t&&t.prototype);c.prototype.constructor=c;c.prototype.render=function o(a){var c=this;t.prototype.render.call(this,a);var l=this;var u=n.nest().key(this._id).entries(this._data).map(function(t){var n=i.extent(t.values,c._x);t.xR=n;t.width=n[1]-n[0];t.x=n[0]+t.width/2;var e=i.extent(t.values,c._y);t.yR=e;t.height=e[1]-e[0];t.y=e[0]+t.height/2;t.nested=true;return t});this._path.curve(s["curve"+this._curve.charAt(0).toUpperCase()+this._curve.slice(1)]).defined(this._defined).x(this._x).y(this._y);var p=this._select.selectAll(".d3plus-Line").data(u,function(t){return t.key});p.transition(this._transition).attr("transform",function(t){return"translate("+t.x+", "+t.y+")"});p.select("path").transition(this._transition).attr("transform",function(t){return"translate("+(-t.xR[0]-t.width/2)+", "+(-t.yR[0]-t.height/2)+")"}).attrTween("d",function(t){return e.interpolatePath(r.select(this).attr("d"),l._path(t.values))}).call(this._applyStyle.bind(this));p.exit().transition().delay(this._duration).remove();p.exit().call(this._applyLabels.bind(this),false);var _=p.enter().append("g").attr("class",function(t){return"d3plus-Shape d3plus-Line d3plus-id-"+h.strip(t.key)}).attr("transform",function(t){return"translate("+t.x+", "+t.y+")"}).attr("opacity",0);_.append("path").attr("transform",function(t){return"translate("+(-t.xR[0]-t.width/2)+", "+(-t.yR[0]-t.height/2)+")"}).attr("d",function(t){return c._path(t.values)}).call(this._applyStyle.bind(this));var d=_.merge(p);d.call(this._applyLabels.bind(this)).attr("pointer-events","none").transition(this._transition).attr("opacity",this._opacity).transition().attr("pointer-events","all");this._applyEvents(d);return this};c.prototype._aes=function t(i,n){var e=this;return{points:i.values.map(function(t){return[e._x(t,n),e._y(t,n)]})}};c.prototype.curve=function t(i){return arguments.length?(this._curve=i,this):this._curve};c.prototype.defined=function t(i){return arguments.length?(this._defined=i,this):this._defined};c.prototype.update=function t(i){var n=this;var e=this._select.selectAll(i),r=o.transition().duration(this._duration);e.call(this._applyLabels.bind(this)).transition(r).attr("opacity",this._opacity);e.select("path").transition(r).attr("d",function(t){return n._path(t.values)});return this};c.prototype.x=function t(i){return arguments.length?(this._x=typeof i==="function"?i:a.constant(i),this):this._x};c.prototype.y=function t(i){return arguments.length?(this._y=typeof i==="function"?i:a.constant(i),this):this._y};return c}(u);var f=function(t){function i(){t.call(this);this._height=a.accessor("height");this._labelBounds=function(t,i,n){return{width:n.width,height:n.height,x:-n.width/2,y:-n.height/2}};this._width=a.accessor("width");this._x=a.accessor("x");this._y=a.accessor("y")}if(t)i.__proto__=t;i.prototype=Object.create(t&&t.prototype);i.prototype.constructor=i;i.prototype.render=function i(n){var e=this;t.prototype.render.call(this,n);var r=this._select.selectAll(".d3plus-Rect").data(this._data,this._id);r.transition(this._transition).attr("transform",function(t,i){return"translate("+e._x(t,i)+","+e._y(t,i)+")"});r.select("rect").transition(this._transition).call(this._applyStyle.bind(this));r.exit().transition().delay(this._duration).remove();r.exit().select("rect").transition(this._transition).attr("width",0).attr("height",0).attr("x",0).attr("y",0);r.exit().call(this._applyImage.bind(this),false).call(this._applyLabels.bind(this),false);var s=r.enter().append("g").attr("class",function(t,i){return"d3plus-Shape d3plus-Rect d3plus-id-"+h.strip(e._id(t,i))}).attr("transform",function(t,i){return"translate("+e._x(t,i)+","+e._y(t,i)+")"});s.append("rect").attr("width",0).attr("height",0).attr("x",0).attr("y",0).call(this._applyStyle.bind(this));var o=s.merge(r);o.select("rect").transition(this._transition).call(this._applyPosition.bind(this));o.call(this._applyImage.bind(this)).call(this._applyLabels.bind(this)).attr("pointer-events","none").transition(this._transition).attr("opacity",this._opacity).transition().attr("pointer-events","all");this._applyEvents(o);return this};i.prototype._aes=function t(i,n){return{width:this._width(i,n),height:this._height(i,n)}};i.prototype._applyPosition=function t(i){var n=this;i.attr("width",function(t,i){return n._width(t,i)}).attr("height",function(t,i){return n._height(t,i)}).attr("x",function(t,i){return-n._width(t,i)/2}).attr("y",function(t,i){return-n._height(t,i)/2})};i.prototype.height=function t(i){return arguments.length?(this._height=typeof i==="function"?i:a.constant(i),this):this._height};i.prototype.update=function t(i){var n=this;var e=this._select.selectAll(i),r=o.transition().duration(this._duration);e.call(this._applyImage.bind(this)).call(this._applyLabels.bind(this)).transition(r).attr("opacity",this._opacity).attr("transform",function(t,i){return"translate("+n._x(t,i)+","+n._y(t,i)+")scale("+n._scale(t,i)+")"});e.select("rect").transition(r).call(this._applyStyle.bind(this)).call(this._applyPosition.bind(this));return this};i.prototype.width=function t(i){return arguments.length?(this._width=typeof i==="function"?i:a.constant(i),this):this._width};i.prototype.x=function t(i){return arguments.length?(this._x=typeof i==="function"?i:a.constant(i),this):this._x};i.prototype.y=function t(i){return arguments.length?(this._y=typeof i==="function"?i:a.constant(i),this):this._y};return i}(u);t.Area=p;t.Circle=_;t.Image=l;t.Line=d;t.Rect=f;t.Shape=u;Object.defineProperty(t,"__esModule",{value:true})});