/*
  d3plus-plot v0.6.0
  A reusable javascript x/y plot built on D3.
  Copyright (c) 2018 D3plus - https://d3plus.org
  @license MIT
*/
if(typeof Object.assign!=="function"){Object.defineProperty(Object,"assign",{value:function t(e){"use strict";if(e===null){throw new TypeError("Cannot convert undefined or null to object")}var i=Object(e);for(var r=1;r<arguments.length;r++){var n=arguments[r];if(n!==null){for(var s in n){if(Object.prototype.hasOwnProperty.call(n,s)){i[s]=n[s]}}}}return i},writable:true,configurable:true})}if(!Array.prototype.includes){Object.defineProperty(Array.prototype,"includes",{value:function t(e,i){var r=Object(this);var n=r.length>>>0;if(n===0)return false;var s=i|0;var a=Math.max(s>=0?s:n-Math.abs(s),0);function o(t,e){return t===e||typeof t==="number"&&typeof e==="number"&&isNaN(t)&&isNaN(e)}while(a<n){if(o(r[a],e)){return true}a++}return false}})}(function(t,e){typeof exports==="object"&&typeof module!=="undefined"?e(exports,require("d3-array"),require("d3-collection"),require("d3-scale"),require("d3-shape"),require("d3plus-axis"),require("d3plus-color"),require("d3plus-common"),require("d3plus-shape"),require("d3plus-viz")):typeof define==="function"&&define.amd?define("d3plus-plot",["exports","d3-array","d3-collection","d3-scale","d3-shape","d3plus-axis","d3plus-color","d3plus-common","d3plus-shape","d3plus-viz"],e):e(t.d3plus={},t.d3Array,t.d3Collection,t.scales,t.d3Shape,t.d3plusAxis,t.d3plusColor,t.d3plusCommon,t.shapes,t.d3plusViz)})(this,function(t,Bt,Mt,Rt,qt,Et,r,Nt,Ut,e){"use strict";function p(t){if(t.includes("d3plus-buffer-start")){return t}var e=["d3plus-buffer-start"];t.forEach(function(t){e.push(t);e.push("d3plus-buffer-"+t)});return e}function n(t){var e=this;var i=t.data;var r=t.x;var n=t.y;var s=t.x2;var a=t.y2;var o=t.buffer;if(o===void 0)o=10;var f=s?"x2":"x";var u=a?"y2":"y";var c=this._discrete==="x"?n:r;var h=c.domain().slice();if(this._discrete==="x"){h.reverse()}var d,_;if(this._stacked){var l=Mt.nest().key(function(t){return t[e._discrete]}).entries(i).map(function(t){return t.values.map(function(t){return t[e._discrete==="x"?u:f]})});_=l.map(function(t){return Bt.sum(t.filter(function(t){return t>0}))});d=l.map(function(t){return Bt.sum(t.filter(function(t){return t<0}))})}else{_=i.map(function(t){return t[e._discrete==="x"?u:f]});d=_}var g=c(Bt.max(_));if(g!==c(0)){g+=this._discrete==="x"?-o:o}g=c.invert(g);var y=c(Bt.min(d));if(y!==c(0)){y+=this._discrete==="x"?o:-o}y=c.invert(y);if(g>h[1]){h[1]=g}if(y<h[0]){h[0]=y}if(this._discrete==="x"){h.reverse()}c.domain(h);var x=this._discrete==="x"?r:n;x.domain(p(x.domain()));return[r,n]}function s(t){var e=t.data;var a=t.x;var o=t.y;var i=t.x2;var r=t.y2;var f=t.config;var u=t.buffer;var c=i?"x2":"x";var h=r?"y2":"y";var d=a.domain().slice(),_=o.domain().slice();var l=a.range(),g=o.range();if(!a.invert){d=p(d)}if(!o.invert){_=p(_)}e.forEach(function(t){var e=u?u:f.r(t.data,t.i)*2;if(a.invert&&a(t[c])-l[0]<e){var i=a.invert(a(t[c])-e);if(i<d[0]){d[0]=i}}if(a.invert&&l[1]-a(t[c])<e){var r=a.invert(a(t[c])+e);if(r>d[1]){d[1]=r}}if(o.invert&&o(t[h])-g[0]<e){var n=o.invert(o(t[h])-e);if(n>_[0]){_[0]=n}}if(o.invert&&g[1]-o(t[h])<e){var s=o.invert(o(t[h])+e);if(s<_[1]){_[1]=s}}});a.domain(d).range(l);o.domain(_).range(g);return[a,o]}function a(t){var e=t.data;var o=t.x;var f=t.y;var i=t.x2;var r=t.y2;var u=t.config;var c=i?"x2":"x";var h=r?"y2":"y";var d=o.domain().slice(),_=f.domain().slice();var l=o.range(),g=f.range();if(!o.invert){d=p(d)}if(!f.invert){_=p(_)}e.forEach(function(t){var e=u.height(t.data,t.i),i=u.width(t.data,t.i);if(o.invert&&o(t[c])-l[0]<i){var r=o.invert(o(t[c])-i);if(r<d[0]){d[0]=r}}if(o.invert&&l[1]-o(t[c])<i){var n=o.invert(o(t[c])+i);if(n>d[1]){d[1]=n}}if(f.invert&&f(t[h])-g[0]<e){var s=f.invert(f(t[h])-e);if(s>_[0]){_[0]=s}}if(f.invert&&g[1]-f(t[h])<e){var a=f.invert(f(t[h])+e);if(a<_[1]){_[1]=a}}});o.domain(d);f.domain(_);return[o,f]}function o(t){var e=this;var i=t.data;var r=t.x;var n=t.y;var s=t.x2;var a=t.y2;var o=s?"x2":"x";var f=a?"y2":"y";var u=this._discrete==="x"?n:r;var c=u.domain().slice();if(this._discrete==="x"){c.reverse()}var h=i.map(function(t){return t[e._discrete==="x"?f:o]});var d=u.invert(u(Bt.max(h))+(this._discrete==="x"?-10:10));if(d>c[1]){c[1]=d}if(this._discrete==="x"){c.reverse()}u.domain(c);return[r,n]}function f(t){return this._sizeScaleD3(this._size?this._size(t):null)}var i=function(jt){function t(){var i=this;jt.call(this);this._annotations=[];this._barPadding=0;this._buffer={Bar:n,Circle:s,Line:o,Rect:a};this._groupPadding=5;this._shape=Nt.constant("Circle");this._shapeConfig=Nt.assign(this._shapeConfig,{Area:{label:function(t,e){return i._stacked?i._drawLabel(t,e):false},labelConfig:{fontResize:true}},Bar:{labelConfig:{textAnchor:function(){return i._discrete==="x"?"middle":"end"},verticalAlign:function(){return i._discrete==="x"?"top":"middle"}}},Circle:{r:f.bind(this)},Line:{fill:Nt.constant("none"),label:false,stroke:function(t,e){return r.colorAssign(i._id(t,e))},strokeWidth:Nt.constant(1)},Rect:{height:function(t){return f.bind(i)(t)*2},width:function(t){return f.bind(i)(t)*2}}});this._sizeMax=20;this._sizeMin=5;this._sizeScale="sqrt";this._stackOffset=qt.stackOffsetDiverging;this._stackOrder=qt.stackOrderNone;this._x=Nt.accessor("x");this._x2=Nt.accessor("x2");this._xAxis=(new Et.AxisBottom).align("end");this._x2Axis=(new Et.AxisTop).align("start");this._xTest=(new Et.AxisBottom).align("end").gridSize(0);this._x2Test=(new Et.AxisTop).align("start").gridSize(0);this._xConfig={title:"X Axis"};this._x2Config={padding:0};this._y=Nt.accessor("y");this._y2=Nt.accessor("y2");this._yAxis=(new Et.AxisLeft).align("start");this._yTest=(new Et.AxisLeft).align("start").gridSize(0);this._y2Axis=(new Et.AxisRight).align("end");this._y2Test=(new Et.AxisLeft).align("end").gridSize(0);this._yConfig={gridConfig:{stroke:function(t){var e=i._yAxis.domain();return e[e.length-1]===t.id?"transparent":"#ccc"}},title:"Y Axis"};this._y2Config={}}if(jt)t.__proto__=jt;t.prototype=Object.create(jt&&jt.prototype);t.prototype.constructor=t;t.prototype._draw=function t(e){var C=this;jt.prototype._draw.call(this,e);if(!this._filteredData.length){return this}var a=function(t,e){return C._stacked?""+(C._groupBy.length>1?C._ids(t,e).slice(0,-1).join("_"):"group"):""+C._ids(t,e).join("_")};var o=this._filteredData.map(function(t,e){return{__d3plus__:true,data:t,group:a(t,e),i:e,id:C._ids(t,e).slice(0,C._drawDepth+1).join("_"),shape:C._shape(t,e),x:C._x(t,e),x2:C._x2(t,e),y:C._y(t,e),y2:C._y2(t,e)}});this._formattedData=o;if(this._size){var i=Bt.extent(o,function(t){return C._size(t.data)});this._sizeScaleD3=function(){return C._sizeMin};this._sizeScaleD3=Rt["scale"+this._sizeScale.charAt(0).toUpperCase()+this._sizeScale.slice(1)]().domain(i).range([i[0]===i[1]?this._sizeMax:Bt.min([this._sizeMax/2,this._sizeMin]),this._sizeMax])}else{this._sizeScaleD3=function(){return C._sizeMin}}var r=o.some(function(t){return t.x2!==undefined}),n=o.some(function(t){return t.y2!==undefined});var s=this._height-this._margin.top-this._margin.bottom,f=this._discrete?this._discrete==="x"?"y":"x":undefined,u=this._discrete?this._discrete==="x"?"y2":"x2":undefined,c=[f,u],h=this._select,d=this._transition,_=this._width-this._margin.left-this._margin.right;var l=this._time&&o[0].x2===this._time(o[0].data,o[0].i),g=this._time&&o[0].x===this._time(o[0].data,o[0].i),y=this._time&&o[0].y2===this._time(o[0].data,o[0].i),x=this._time&&o[0].y===this._time(o[0].data,o[0].i);for(var p=0;p<o.length;p++){var v=o[p];if(g){v.x=Et.date(v.x)}if(l){v.x2=Et.date(v.x2)}if(x){v.y=Et.date(v.y)}if(y){v.y2=Et.date(v.y2)}v.discrete=v.shape==="Bar"?v[C._discrete]+"_"+v.group:""+v[C._discrete]}var m,S,b,k;if(this._stacked){var w=Mt.nest().key(function(t){return t.group}).entries(o).reduce(function(t,e){if(!t[e.key]){t[e.key]=0}t[e.key]+=Bt.sum(e.values,function(t){return t[f]});return t},{});o=o.sort(function(t,e){var i=t[C._discrete],r=e[C._discrete];if(i-r!==0){return i-r}if(t.group!==e.group){return w[e.group]-w[t.group]}return e[f]-t[f]});m=Array.from(new Set(o.map(function(t){return t.discrete})));k=Array.from(new Set(o.map(function(t){return t.id})));b=Mt.nest().key(function(t){return t.discrete}).entries(o).map(function(t){return t.values});b.forEach(function(n){var s=Array.from(new Set(n.map(function(t){return t.id})));if(s.length<k.length){k.forEach(function(e){if(!s.includes(e)){var t=o.filter(function(t){return t.id===e})[0];if(t.shape==="Area"){var i=a(t.data,t.i);var r={__d3plus__:true,data:t.data,discrete:t.shape==="Bar"?n[0][C._discrete]+"_"+i:""+n[0][C._discrete],group:i,id:e,shape:t.shape};r[C._discrete]=n[0][C._discrete];r[f]=0;o.push(r)}}})}});o.sort(function(t,e){return t[C._discrete]-e[C._discrete]});var A=this._stackOrder;if(A instanceof Array){k.sort(function(t,e){return A.indexOf(t)-A.indexOf(e)})}else if(A===qt.stackOrderNone){k.sort(function(t,e){return t.localeCompare(e)})}b=qt.stack().keys(k).offset(this._stackOffset).order(A instanceof Array?qt.stackOrderNone:A).value(function(t,e){var i=t.filter(function(t){return t.id===e});return i.length?i[0][f]:0})(b);S={};S[this._discrete]=Bt.extent(o,function(t){return t[C._discrete]});S[f]=[Bt.min(b.map(function(t){return Bt.min(t.map(function(t){return t[0]}))})),Bt.max(b.map(function(t){return Bt.max(t.map(function(t){return t[1]}))}))]}else{S={x:this._xSort?Array.from(new Set(o.filter(function(t){return t.x}).sort(function(t,e){return C._xSort(t.data,e.data)}).map(function(t){return t.x}))):Bt.extent(o,function(t){return t.x}),x2:this._x2Sort?Array.from(new Set(o.filter(function(t){return t.x2}).sort(function(t,e){return C._x2Sort(t.data,e.data)}).map(function(t){return t.x2}))):Bt.extent(o,function(t){return t.x2}),y:this._ySort?Array.from(new Set(o.filter(function(t){return t.y}).sort(function(t,e){return C._ySort(t.data,e.data)}).map(function(t){return t.y}))):Bt.extent(o,function(t){return t.y}),y2:this._y2Sort?Array.from(new Set(o.filter(function(t){return t.y2}).sort(function(t,e){return C._y2Sort(t.data,e.data)}).map(function(t){return t.y2}))):Bt.extent(o,function(t){return t.y2})}}var O=this._xDomain?this._xDomain.slice():S.x,z=this._xSort?"Ordinal":"Linear";if(O[0]===void 0){O[0]=S.x[0]}if(O[1]===void 0){O[1]=S.x[1]}if(g){O=O.map(Et.date);z="Time"}var T=this._x2Domain?this._x2Domain.slice():S.x2,D=this._x2Sort?"Ordinal":"Linear";if(T[0]===void 0){T[0]=S.x2[0]}if(T[1]===void 0){T[1]=S.x2[1]}if(l){T=T.map(Et.date);D="Time"}else if(this._discrete==="x"){O=Array.from(new Set(o.filter(function(t){return t.x}).sort(function(t,e){return C._xSort?C._xSort(t.data,e.data):t.x-e.x}).map(function(t){return t.x})));z="Ordinal";T=Array.from(new Set(o.filter(function(t){return t.x2}).sort(function(t,e){return C._x2Sort?C._x2Sort(t.data,e.data):t.x2-e.x2}).map(function(t){return t.x2})));D="Ordinal"}var L=this._yDomain?this._yDomain.slice():S.y,P=this._ySort?"Ordinal":"Linear";if(L[0]===void 0){L[0]=S.y[0]}if(L[1]===void 0){L[1]=S.y[1]}var j=this._y2Domain?this._y2Domain.slice():S.y2,B=this._y2Sort?"Ordinal":"Linear";if(j[0]===void 0){j[0]=S.y2[0]}if(j[1]===void 0){j[1]=S.y2[1]}if(x){L=L.map(Et.date);P="Time"}else if(this._discrete==="y"){L=Array.from(new Set(o.sort(function(t,e){return C._ySort?C._ySort(t.data,e.data):t.y-e.y}).map(function(t){return t.y})));P="Ordinal";j=Array.from(new Set(o.sort(function(t,e){return C._y2Sort?C._y2Sort(t.data,e.data):t.y2-e.y2}).map(function(t){return t.y2})));B="Ordinal"}if(y){j=j.map(Et.date);B="Time"}S={x:O,x2:T,y:L,y2:j};c.forEach(function(t){if(t&&C._baseline!==void 0){var e=C._baseline;if(S[t][0]>e){S[t][0]=e}else if(S[t][1]<e){S[t][1]=e}}});var M=Rt["scale"+z]().domain(S.x).range(Bt.range(0,_+1,_/(S.x.length-1))),R=Rt["scale"+D]().domain(S.x2).range(Bt.range(0,_+1,_/(S.x2.length-1))),q=Rt["scale"+P]().domain(S.y.reverse()).range(Bt.range(0,s+1,s/(S.y.length-1))),E=Rt["scale"+B]().domain(S.y2.reverse()).range(Bt.range(0,s+1,s/(S.y2.length-1)));var N=Mt.nest().key(function(t){return t.shape}).entries(o);if(this._xConfig.scale!=="log"&&this._yConfig.scale!=="log"&&(this._discrete==="x"&&P!=="Ordinal")||this._discrete==="y"&&z!=="Ordinal"){N.forEach(function(t){if(C._buffer[t.key]){var e=C._buffer[t.key].bind(C)({data:t.values,x:M,y:q,config:C._shapeConfig[t.key]});if(C._xConfig.scale!=="log"){M=e[0]}if(C._yConfig.scale!=="log"){q=e[1]}var i=C._buffer[t.key].bind(C)({data:t.values,x:R,y:E,x2:true,y2:true,config:C._shapeConfig[t.key]});if(C._x2Config.scale!=="log"){R=i[0]}if(C._y2Config.scale!=="log"){E=i[1]}}})}O=M.domain();T=R.domain();L=q.domain();j=E.domain();this._xDomain=O;var U=Nt.elem("g.d3plus-plot-test",{enter:{opacity:0},parent:this._select}),F=this._discrete==="x"&&!l?S.x2:undefined,V=this._discrete==="x"&&!g?S.x:undefined,W=this._discrete==="y"&&!y?S.y2:undefined,X=this._discrete==="y"&&!x?S.y:undefined;var Y={gridConfig:{stroke:!this._discrete||this._discrete==="x"?this._yTest.gridConfig().stroke:"transparent"}};var G={barConfig:{"stroke-width":0},gridSize:0,labels:[],title:false,tickSize:0};var H=r?{}:G;var I=n?{}:G;this._yTest.domain(L).height(s).scale(P.toLowerCase()).select(U.node()).ticks(X).width(_).config(Y).config(this._yConfig).render();var J=this._yTest.outerBounds();var K=J.width?J.width+this._yTest.padding():undefined;this._y2Test.domain(n?j:L).height(s).scale(n?B.toLowerCase():P.toLowerCase()).select(U.node()).ticks(W?W:X).width(_).config(Y).config(I).config(this._y2Config).render();var Q=this._y2Test.outerBounds();var Z=Q.width?Q.width+this._y2Test.padding():undefined;var $={gridConfig:{stroke:!this._discrete||this._discrete==="y"?this._xTest.gridConfig().stroke:"transparent"}};this._xTest.domain(O).height(s).range([undefined,undefined]).scale(z.toLowerCase()).select(U.node()).ticks(V).width(_).config($).config(this._xConfig).render();this._x2Test.domain(r?T:O).height(s).range([undefined,undefined]).scale(r?D.toLowerCase():z.toLowerCase()).select(U.node()).ticks(r?F:V).width(_).config($).tickSize(0).config(H).config(this._x2Config).render();var tt=this._x2Test.outerBounds();var et=tt.height+this._x2Test.padding();var it=Bt.max([K,this._xTest._getRange()[0],this._x2Test._getRange()[0]]);this._xTest.range([it,undefined]).render();var rt="translate("+this._margin.left+", "+(this._margin.top+et)+")";var nt="translate("+this._margin.left+", "+this._margin.top+")";var st=Nt.elem("g.d3plus-plot-x-axis",{parent:h,transition:d,enter:{transform:rt},update:{transform:rt}});var at=Nt.elem("g.d3plus-plot-x2-axis",{parent:h,transition:d,enter:{transform:nt},update:{transform:nt}});var ot=it>K?it-K:0;var ft="translate("+(this._margin.left+ot)+", "+this._margin.top+")";var ut=Nt.elem("g.d3plus-plot-y-axis",{parent:h,transition:d,enter:{transform:ft},update:{transform:ft}});var ct="translate("+this._margin.left+", "+this._margin.top+")";var ht=Nt.elem("g.d3plus-plot-y2-axis",{parent:h,transition:d,enter:{transform:ct},update:{transform:ct}});var dt=Bt.max([Z,_-this._xTest._getRange()[1],_-this._x2Test._getRange()[1]]);var _t=_-this._xTest._getRange()[1];var lt=dt-_t+this._xTest.padding();this._xAxis.domain(O).height(s-et).range([it,_-lt]).scale(z.toLowerCase()).select(st.node()).ticks(V).width(_).config($).config(this._xConfig).render();var gt=_-this._x2Test._getRange()[1];var yt=dt-gt+this._x2Test.padding();var xt=this._xTest.outerBounds();var pt=xt.height+this._xTest.padding();this._x2Axis.domain(r?T:O).height(s-pt).range([it,_-yt]).scale(D.toLowerCase()).select(at.node()).ticks(r?F:V).width(_).config($).config(H).config(this._x2Config).render();M=function(t,e){if(e==="x2"){if(C._x2Config.scale==="log"&&t===0){t=T[0]<0?-1:1}return C._x2Axis._getPosition.bind(C._x2Axis)(t)}else{if(C._xConfig.scale==="log"&&t===0){t=O[0]<0?-1:1}return C._xAxis._getPosition.bind(C._xAxis)(t)}};var vt=this._xAxis._getRange();var mt=P==="Ordinal";var Ct=mt?this._yTest.shapeConfig().labelConfig.fontSize():this._yTest.shapeConfig().labelConfig.fontSize()/2;var St=Bt.max([pt,s-this._yTest._getRange()[1],s-this._y2Test._getRange()[1]]);var bt=s-this._yTest._getRange()[1];var kt=mt?St-bt+this._yTest.padding():pt;this._yAxis.domain(L).height(s).range([this._xAxis.outerBounds().y+Ct+et,s-kt]).scale(P.toLowerCase()).select(ut.node()).ticks(X).width(vt[vt.length-1]).config(Y).config(this._yConfig).render();var wt=s-this._y2Test._getRange()[1];var At=mt?St-wt+this._y2Test.padding():pt;this._y2Axis.config(Y).domain(n?j:L).gridSize(0).height(s).range([this._xAxis.outerBounds().y+et+Ct,s-At]).scale(n?B.toLowerCase():P.toLowerCase()).select(ht.node()).width(_-Bt.max([0,dt-Z])).title(false).config(this._y2Config).config(I).render();q=function(t,e){if(e==="y2"){if(C._y2Config.scale==="log"&&t===0){t=j[0]<0?-1:1}return C._y2Axis._getPosition.bind(C._y2Axis)(t)-et}else{if(C._yConfig.scale==="log"&&t===0){t=L[0]<0?-1:1}return C._yAxis._getPosition.bind(C._yAxis)(t)-et}};var Ot=this._yAxis._getRange();var zt=Nt.elem("g.d3plus-plot-annotations",{parent:h,transition:d,enter:{transform:rt},update:{transform:rt}}).node();this._annotations.forEach(function(t){(new Ut[t.shape]).config(t).config({x:function(t){return t.x2?M(t.x2,"x2"):M(t.x)},x0:C._discrete==="x"?function(t){return t.x2?M(t.x2,"x2"):M(t.x)}:M(0),x1:C._discrete==="x"?null:function(t){return t.x2?M(t.x2,"x2"):M(t.x)},y:function(t){return t.y2?q(t.y2,"y2"):q(t.y)},y0:C._discrete==="y"?function(t){return t.y2?q(t.y2,"y2"):q(t.y)}:q(0)-Tt,y1:C._discrete==="y"?null:function(t){return t.y2?q(t.y2,"y2"):q(t.y)-Tt}}).select(zt).render()});var Tt=this._xAxis.barConfig()["stroke-width"];if(Tt){Tt/=2}var Dt={duration:this._duration,label:function(t){return C._drawLabel(t.data,t.i)},select:Nt.elem("g.d3plus-plot-shapes",{parent:h,transition:d,enter:{transform:rt},update:{transform:rt}}).node(),x:function(t){return t.x2?M(t.x2,"x2"):M(t.x)},x0:this._discrete==="x"?function(t){return t.x2?M(t.x2,"x2"):M(t.x)}:M(0),x1:this._discrete==="x"?null:function(t){return t.x2?M(t.x2,"x2"):M(t.x)},y:function(t){return t.y2?q(t.y2,"y2"):q(t.y)},y0:this._discrete==="y"?function(t){return t.y2?q(t.y2,"y2"):q(t.y)}:q(0)-Tt,y1:this._discrete==="y"?null:function(t){return t.y2?q(t.y2,"y2"):q(t.y)-Tt}};if(this._stacked){var Lt=f==="x"?M:q;Dt[""+f]=Dt[f+"0"]=function(t){var e=k.indexOf(t.id),i=m.indexOf(t.discrete);return e>=0?Lt(b[e][i][0]):Lt(0)};Dt[f+"1"]=function(t){var e=k.indexOf(t.id),i=m.indexOf(t.discrete);return e>=0?Lt(b[e][i][1]):Lt(0)}}var Pt=Object.keys(this._on);N.forEach(function(e){var t=(new Ut[e.key]).config(Dt).data(e.values);if(e.key==="Bar"){var i;var r=C._discrete==="x"?M:q;var n=(C._discrete==="x"?O:L).filter(function(t){return typeof t!=="string"||t.indexOf("d3plus-buffer-")<0});var s=C._discrete==="x"?vt:Ot;if(n.length>1){i=r(n[1])-r(n[0])}else{i=s[s.length-1]-s[0]}i-=C._groupPadding;var a=i;var o=Mt.nest().key(function(t){return t[C._discrete]}).key(function(t){return t.group}).entries(e.values);var f=Bt.merge(o.map(function(t){return t.values.map(function(t){return t.key})}));var u=Array.from(new Set(f));if(Bt.max(o.map(function(t){return t.values.length}))===1){t[C._discrete](function(t,e){return Dt[C._discrete](t,e)})}else{a=(a-C._barPadding*u.length-1)/u.length;var c=i/2-a/2;var h=Rt.scaleLinear().domain([0,u.length-1]).range([-c,c]);t[C._discrete](function(t,e){return Dt[C._discrete](t,e)+h(u.indexOf(t.group))})}t.width(a);t.height(a)}var d=Pt.filter(function(t){return t.includes("."+e.key)}),_=Pt.filter(function(t){return!t.includes(".")}),l=Pt.filter(function(t){return t.includes(".shape")});var g=function(e){t.on(_[e],function(t){return C._on[_[e]](t.data,t.i)})};for(var y=0;y<_.length;y++)g(y);var x=function(e){t.on(l[e],function(t){return C._on[l[e]](t.data,t.i)})};for(var p=0;p<l.length;p++)x(p);var v=function(e){t.on(d[e],function(t){return C._on[d[e]](t.data,t.i)})};for(var m=0;m<d.length;m++)v(m);t.config(Nt.configPrep.bind(C)(C._shapeConfig,"shape",e.key)).render();C._shapes.push(t)});return this};t.prototype.annotations=function t(e){return arguments.length?(this._annotations=e instanceof Array?e:[e],this):this._annotations};t.prototype.barPadding=function t(e){return arguments.length?(this._barPadding=e,this):this._barPadding};t.prototype.baseline=function t(e){return arguments.length?(this._baseline=e,this):this._baseline};t.prototype.discrete=function t(e){return arguments.length?(this._discrete=e,this):this._discrete};t.prototype.groupPadding=function t(e){return arguments.length?(this._groupPadding=e,this):this._groupPadding};t.prototype.size=function t(e){return arguments.length?(this._size=typeof e==="function"||!e?e:Nt.accessor(e),this):this._size};t.prototype.sizeMax=function t(e){return arguments.length?(this._sizeMax=e,this):this._sizeMax};t.prototype.sizeMin=function t(e){return arguments.length?(this._sizeMin=e,this):this._sizeMin};t.prototype.sizeScale=function t(e){return arguments.length?(this._sizeScale=e,this):this._sizeScale};t.prototype.stacked=function t(e){return arguments.length?(this._stacked=e,this):this._stacked};t.prototype.stackOffset=function t(e){return arguments.length?(this._stackOffset=typeof e==="function"?e:qt["stackOffset"+(e.charAt(0).toUpperCase()+e.slice(1))],this):this._stackOffset};t.prototype.stackOrder=function t(e){return arguments.length?(this._stackOrder=typeof e==="string"?qt["stackOrder"+(e.charAt(0).toUpperCase()+e.slice(1))]:e,this):this._stackOrder};t.prototype.x=function t(e){if(arguments.length){if(typeof e==="function"){this._x=e}else{this._x=Nt.accessor(e);if(!this._aggs[e]&&this._discrete==="x"){this._aggs[e]=function(t){var e=Array.from(new Set(t));return e.length===1?e[0]:e}}}return this}else{return this._x}};t.prototype.x2=function t(e){if(arguments.length){if(typeof e==="function"){this._x2=e}else{this._x2=Nt.accessor(e);if(!this._aggs[e]&&this._discrete==="x"){this._aggs[e]=function(t){var e=Array.from(new Set(t));return e.length===1?e[0]:e}}}return this}else{return this._x2}};t.prototype.xConfig=function t(e){return arguments.length?(this._xConfig=Nt.assign(this._xConfig,e),this):this._xConfig};t.prototype.x2Config=function t(e){return arguments.length?(this._x2Config=Nt.assign(this._x2Config,e),this):this._x2Config};t.prototype.xDomain=function t(e){return arguments.length?(this._xDomain=e,this):this._xDomain};t.prototype.x2Domain=function t(e){return arguments.length?(this._x2Domain=e,this):this._x2Domain};t.prototype.xSort=function t(e){return arguments.length?(this._xSort=e,this):this._xSort};t.prototype.x2Sort=function t(e){return arguments.length?(this._x2Sort=e,this):this._x2Sort};t.prototype.y=function t(e){if(arguments.length){if(typeof e==="function"){this._y=e}else{this._y=Nt.accessor(e);if(!this._aggs[e]&&this._discrete==="y"){this._aggs[e]=function(t){var e=Array.from(new Set(t));return e.length===1?e[0]:e}}}return this}else{return this._y}};t.prototype.y2=function t(e){if(arguments.length){if(typeof e==="function"){this._y2=e}else{this._y2=Nt.accessor(e);if(!this._aggs[e]&&this._discrete==="y2"){this._aggs[e]=function(t){var e=Array.from(new Set(t));return e.length===1?e[0]:e}}}return this}else{return this._y2}};t.prototype.yConfig=function t(e){if(arguments.length){if(e.domain){e.domain=e.domain.slice().reverse()}this._yConfig=Nt.assign(this._yConfig,e);return this}return this._yConfig};t.prototype.y2Config=function t(e){return arguments.length?(this._y2Config=Nt.assign(this._y2Config,e),this):this._y2Config};t.prototype.yDomain=function t(e){return arguments.length?(this._yDomain=e,this):this._yDomain};t.prototype.y2Domain=function t(e){return arguments.length?(this._y2Domain=e,this):this._y2Domain};t.prototype.ySort=function t(e){return arguments.length?(this._ySort=e,this):this._ySort};t.prototype.y2Sort=function t(e){return arguments.length?(this._y2Sort=e,this):this._y2Sort};return t}(e.Viz);var u=function(t){function e(){t.call(this);this._baseline=0;this._discrete="x";this._shape=Nt.constant("Area");this.x("x")}if(t)e.__proto__=t;e.prototype=Object.create(t&&t.prototype);e.prototype.constructor=e;return e}(i);var c=function(t){function e(){t.call(this);this._baseline=0;this._discrete="x";this._shape=Nt.constant("Bar");this.x("x")}if(t)e.__proto__=t;e.prototype=Object.create(t&&t.prototype);e.prototype.constructor=e;return e}(i);var h=function(t){function e(){var s=this;t.call(this);this._discrete="x";this._shape=Nt.constant("Line");this.x("x");this.y2(function(t){return s._y(t)});this.yConfig({tickFormat:function(e){var t=s._formattedData;var i=s._xDomain;var r=t.filter(function(t){return t.x===i[0]});var n=r.find(function(t){return t.y===e});return s._drawLabel(n,n.i)}});this.y2Config({tickFormat:function(e){var t=s._formattedData;var i=s._xDomain;var r=t.filter(function(t){return t.x===i[i.length-1]});var n=r.find(function(t){return t.y===e});return s._drawLabel(n,n.i)}});this.ySort(function(t,e){return e.y-t.y});this.y2Sort(function(t,e){return e.y-t.y})}if(t)e.__proto__=t;e.prototype=Object.create(t&&t.prototype);e.prototype.constructor=e;return e}(i);var d=function(t){function e(){t.call(this);this._discrete="x";this._shape=Nt.constant("Line");this.x("x")}if(t)e.__proto__=t;e.prototype=Object.create(t&&t.prototype);e.prototype.constructor=e;return e}(i);var _=function(t){function e(){t.call(this);this._stacked=true}if(t)e.__proto__=t;e.prototype=Object.create(t&&t.prototype);e.prototype.constructor=e;return e}(u);t.AreaPlot=u;t.BarChart=c;t.BumpChart=h;t.LinePlot=d;t.Plot=i;t.StackedArea=_;Object.defineProperty(t,"__esModule",{value:true})});