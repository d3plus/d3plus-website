/*
  d3plus-priestley v0.1.19
  A reusable Priestley timeline built on D3.
  Copyright (c) 2017 D3plus - https://d3plus.org
  @license MIT
*/
if(typeof Object.assign!=="function"){Object.defineProperty(Object,"assign",{value:function t(e){"use strict";if(e===null){throw new TypeError("Cannot convert undefined or null to object")}var i=Object(e);for(var r=1;r<arguments.length;r++){var n=arguments[r];if(n!==null){for(var s in n){if(Object.prototype.hasOwnProperty.call(n,s)){i[s]=n[s]}}}}return i},writable:true,configurable:true})}if(!Array.prototype.includes){Object.defineProperty(Array.prototype,"includes",{value:function t(e,i){var r=Object(this);var n=r.length>>>0;if(n===0)return false;var s=i|0;var a=Math.max(s>=0?s:n-Math.abs(s),0);function o(t,e){return t===e||typeof t==="number"&&typeof e==="number"&&isNaN(t)&&isNaN(e)}while(a<n){if(o(r[a],e)){return true}a++}return false}})}(function(t,e){typeof exports==="object"&&typeof module!=="undefined"?e(exports,require("d3-array"),require("d3-collection"),require("d3-scale"),require("d3plus-axis"),require("d3plus-common"),require("d3plus-shape"),require("d3plus-viz")):typeof define==="function"&&define.amd?define("d3plus-priestley",["exports","d3-array","d3-collection","d3-scale","d3plus-axis","d3plus-common","d3plus-shape","d3plus-viz"],e):e(t.d3plus={},t.d3Array,t.d3Collection,t.d3Scale,t.d3plusAxis,t.d3plusCommon,t.d3plusShape,t.d3plusViz)})(this,function(t,e,i,r,n,s,a,o){"use strict";var u=function(t){function o(){t.call(this);this._axis=(new n.Axis).align("end").orient("bottom");this._axisConfig={scale:"time"};this._axisTest=(new n.Axis).align("end").gridSize(0).orient("bottom");this.end("end");this.start("start")}if(t)o.__proto__=t;o.prototype=Object.create(t&&t.prototype);o.prototype.constructor=o;o.prototype.render=function o(u){var d=this;t.prototype.render.call(this,u);if(!this._filteredData){return this}var l=this._filteredData.map(function(t,e){return{__d3plus__:true,data:t,end:d._axisConfig.scale==="time"?n.date(d._end(t,e)):d._end(t,e),i:e,id:d._id(t,e),start:d._axisConfig.scale==="time"?n.date(d._start(t,e)):d._start(t,e)}}).filter(function(t){return t.end-t.start>0}).sort(function(t,e){return t.start-e.start});var h;if(this._groupBy.length>1&&this._drawDepth>0){var f=i.nest();var c=function(t){f.key(function(e){return d._groupBy[t](e.data,e.i)})};for(var p=0;p<this._drawDepth;p++)c(p);h=f.entries(l)}else{h=[{values:l}]}var _=0;h.forEach(function(t){var e=[];t.values.forEach(function(t){e=e.map(function(e){return e<=t.start?false:e});var i=e.indexOf(false);if(i<0){t.lane=_+e.length;e.push(t.end)}else{e[i]=t.end;t.lane=_+i}});_+=e.length});var g={domain:[e.min(l,function(t){return t.start})||0,e.max(l,function(t){return t.end})||0],height:this._height-this._margin.top-this._margin.bottom,width:this._width-this._margin.left-this._margin.right};var m="translate("+this._margin.left+", "+this._margin.top+")";this._axisTest.config(g).config(this._axisConfig).select(s.elem("g.d3plus-priestley-axis-test",{parent:this._select,enter:{opacity:0}}).node()).render();this._axis.config(g).config(this._axisConfig).select(s.elem("g.d3plus-priestley-axis",{parent:this._select,enter:{transform:m},update:{transform:m}}).node()).render();var y=this._axisTest._padding;var v=this._axis._d3Scale;var x=r.scalePoint().domain(e.range(0,_,1)).padding(.5).rangeRound([this._height-this._margin.bottom-this._axisTest.outerBounds().height-y,this._margin.top+y]);var b=x.step();this._shapes.push((new a.Rect).data(l).duration(this._duration).height(b>=this._padding*2?b-this._padding:b>2?b-2:b).label(function(t,e){return d._drawLabel(t.data,e)}).select(s.elem("g.d3plus-priestley-shapes",{parent:this._select}).node()).width(function(t){var e=Math.abs(v(t.end)-v(t.start));return e>2?e-2:e}).x(function(t){return v(t.start)+(v(t.end)-v(t.start))/2}).y(function(t){return x(t.lane)}).config(s.configPrep.bind(this)(this._shapeConfig,"shape","Rect")).render());return this};o.prototype.axisConfig=function t(e){return arguments.length?(this._axisConfig=s.assign(this._axisConfig,e),this):this._axisConfig};o.prototype.end=function t(i){if(arguments.length){if(typeof i==="function"){this._end=i}else{this._end=s.accessor(i);if(!this._aggs[i]){this._aggs[i]=function(t){return e.max(t)}}}return this}else{return this._end}};o.prototype.start=function t(i){if(arguments.length){if(typeof i==="function"){this._start=i}else{this._start=s.accessor(i);if(!this._aggs[i]){this._aggs[i]=function(t){return e.min(t)}}}return this}else{return this._start}};return o}(o.Viz);t.Priestley=u;Object.defineProperty(t,"__esModule",{value:true})});