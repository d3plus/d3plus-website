/*
  d3plus-priestley v0.1.15
  A reusable Priestley timeline built on D3.
  Copyright (c) 2016 D3plus - https://d3plus.org
  @license MIT
*/
(function(t,e){typeof exports==="object"&&typeof module!=="undefined"?e(exports,require("d3-array"),require("d3-collection"),require("d3-scale"),require("d3plus-axis"),require("d3plus-common"),require("d3plus-shape"),require("d3plus-viz")):typeof define==="function"&&define.amd?define("d3plus-priestley",["exports","d3-array","d3-collection","d3-scale","d3plus-axis","d3plus-common","d3plus-shape","d3plus-viz"],e):e(t.d3plus=t.d3plus||{},t.d3Array,t.d3Collection,t.d3Scale,t.d3plusAxis,t.d3plusCommon,t.d3plusShape,t.d3plusViz)})(this,function(t,e,i,s,n,r,a,o){"use strict";var d=function(t){function o(){t.call(this);this._axis=(new n.Axis).align("end").orient("bottom");this._axisConfig={scale:"time"};this._axisTest=(new n.Axis).align("end").gridSize(0).orient("bottom");this.end("end");this.start("start")}if(t)o.__proto__=t;o.prototype=Object.create(t&&t.prototype);o.prototype.constructor=o;o.prototype.render=function o(d){var u=this;t.prototype.render.call(this,d);var h=this._filteredData.map(function(t,e){return{__d3plus__:true,data:t,end:u._axisConfig.scale==="time"?n.date(u._end(t,e)):u._end(t,e),i:e,id:u._id(t,e),start:u._axisConfig.scale==="time"?n.date(u._start(t,e)):u._start(t,e)}}).filter(function(t){return t.end-t.start>0}).sort(function(t,e){return t.start-e.start});var l;if(this._groupBy.length>1&&this._drawDepth>0){var p=i.nest();var f=function(t){p.key(function(e){return u._groupBy[t](e.data,e.i)})};for(var c=0;c<this._drawDepth;c++)f(c);l=p.entries(h)}else{l=[{values:h}]}var _=0;l.forEach(function(t){var e=[];t.values.forEach(function(t){e=e.map(function(e){return e<=t.start?false:e});var i=e.indexOf(false);if(i<0){t.lane=_+e.length;e.push(t.end)}else{e[i]=t.end;t.lane=_+i}});_+=e.length});var g={domain:[e.min(h,function(t){return t.start})||0,e.max(h,function(t){return t.end})||0],height:this._height-this._margin.top-this._margin.bottom,width:this._width-this._margin.left-this._margin.right};var m="translate("+this._margin.left+", "+this._margin.top+")";this._axisTest.config(g).config(this._axisConfig).select(r.elem("g.d3plus-priestley-axis-test",{parent:this._select,enter:{opacity:0}}).node()).render();this._axis.config(g).config(this._axisConfig).select(r.elem("g.d3plus-priestley-axis",{parent:this._select,enter:{transform:m},update:{transform:m}}).node()).render();var x=this._axisTest._padding;var y=this._axis._d3Scale;var v=s.scalePoint().domain(e.range(0,_,1)).padding(.5).rangeRound([this._height-this._margin.bottom-this._axisTest.outerBounds().height-x,this._margin.top+x]);var C=v.step();this._shapes.push((new a.Rect).data(h).duration(this._duration).height(C>=this._padding*2?C-this._padding:C>2?C-2:C).label(function(t,e){return u._drawLabel(t.data,e)}).select(r.elem("g.d3plus-priestley-shapes",{parent:this._select}).node()).width(function(t){var e=Math.abs(y(t.end)-y(t.start));return e>2?e-2:e}).x(function(t){return y(t.start)+(y(t.end)-y(t.start))/2}).y(function(t){return v(t.lane)}).config(this._shapeConfigPrep("Rect")).render());return this};o.prototype.axisConfig=function t(e){return arguments.length?(this._axisConfig=r.assign(this._axisConfig,e),this):this._axisConfig};o.prototype.end=function t(i){if(arguments.length){if(typeof i==="function"){this._end=i}else{this._end=r.accessor(i);if(!this._aggs[i]){this._aggs[i]=function(t){return e.max(t)}}}return this}else{return this._end}};o.prototype.start=function t(i){if(arguments.length){if(typeof i==="function"){this._start=i}else{this._start=r.accessor(i);if(!this._aggs[i]){this._aggs[i]=function(t){return e.min(t)}}}return this}else{return this._start}};return o}(o.Viz);t.Priestley=d;Object.defineProperty(t,"__esModule",{value:true})});