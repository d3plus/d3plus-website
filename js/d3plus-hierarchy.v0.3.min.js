/*
  d3plus-hierarchy v0.3.13
  Nested, hierarchical, and cluster charts built on D3
  Copyright (c) 2017 D3plus - https://d3plus.org
  @license MIT
*/
if(typeof Object.assign!=="function"){Object.defineProperty(Object,"assign",{value:function t(e){"use strict";if(e===null){throw new TypeError("Cannot convert undefined or null to object")}var i=Object(e);for(var r=1;r<arguments.length;r++){var n=arguments[r];if(n!==null){for(var a in n){if(Object.prototype.hasOwnProperty.call(n,a)){i[a]=n[a]}}}}return i},writable:true,configurable:true})}if(!Array.prototype.includes){Object.defineProperty(Array.prototype,"includes",{value:function t(e,i){var r=Object(this);var n=r.length>>>0;if(n===0)return false;var a=i|0;var o=Math.max(a>=0?a:n-Math.abs(a),0);function s(t,e){return t===e||typeof t==="number"&&typeof e==="number"&&isNaN(t)&&isNaN(e)}while(o<n){if(s(r[o],e)){return true}o++}return false}})}(function(t,e){typeof exports==="object"&&typeof module!=="undefined"?e(exports,require("d3-array"),require("d3-shape"),require("d3plus-common"),require("d3plus-shape"),require("d3plus-viz"),require("d3-hierarchy"),require("d3-scale"),require("d3-collection")):typeof define==="function"&&define.amd?define("d3plus-hierarchy",["exports","d3-array","d3-shape","d3plus-common","d3plus-shape","d3plus-viz","d3-hierarchy","d3-scale","d3-collection"],e):e(t.d3plus={},t.d3Array,t.d3Shape,t.d3plusCommon,t.d3plusShape,t.d3plusViz,t.d3Hierarchy,t.d3Scale,t.d3Collection)})(this,function(t,e,i,r,n,a,o,s,h){"use strict";var u=function(t){function a(){t.call(this);this._shapeConfig=r.assign(this._shapeConfig,{Path:{labelConfig:{fontResize:true}}});this._innerRadius=0;this._padPixel=0;this._pie=i.pie();this._sort=function(t,e){return e.value-t.value};this._value=r.accessor("value")}if(t)a.__proto__=t;a.prototype=Object.create(t&&t.prototype);a.prototype.constructor=a;a.prototype._draw=function a(o){var s=this;t.prototype._draw.call(this,o);var h=this._height-this._margin.top-this._margin.bottom,u=this._width-this._margin.left-this._margin.right;var l=e.min([u,h])/2;var p=this._pie.padAngle(this._padAngle||this._padPixel/l).sort(this._sort).value(this._value)(this._filteredData);p.forEach(function(t,e){t.__d3plus__=true;t.i=e});var c=i.arc().innerRadius(this._innerRadius).outerRadius(l);var d="translate("+u/2+", "+h/2+")";this._shapes.push((new n.Path).data(p).d(c).select(r.elem("g.d3plus-Pie",{parent:this._select,enter:{transform:d},update:{transform:d}}).node()).config({id:function(t){return s._ids(t).join("-")},x:0,y:0}).config(r.configPrep.bind(this)(this._shapeConfig,"shape","Path")).render());return this};a.prototype.innerRadius=function t(e){return arguments.length?(this._innerRadius=e,this):this._innerRadius};a.prototype.padAngle=function t(e){return arguments.length?(this._padAngle=e,this):this._padAngle};a.prototype.padPixel=function t(e){return arguments.length?(this._padPixel=e,this):this._padPixel};a.prototype.sort=function t(e){return arguments.length?(this._sort=e,this):this._sort};a.prototype.value=function t(e){return arguments.length?(this._value=typeof e==="function"?e:r.constant(e),this):this._value};return a}(a.Viz);var l=function(t){function i(){var i=this;t.call(this);this._innerRadius=function(){return e.min([i._width-i._margin.left-i._margin.right,i._height-i._margin.top-i._margin.bottom])/4};this._padPixel=5}if(t)i.__proto__=t;i.prototype=Object.create(t&&t.prototype);i.prototype.constructor=i;return i}(u);function p(t,e){if(!(e instanceof Array)){e=[e]}var i=h.nest();for(var r=0;r<e.length;r++){i.key(e[r])}var n=i.entries(t);return c(n)}function c(t){return t.map(function(t){if(t.key&&t.values){if(t.values[0].key==="undefined"){return t.values[0].values[0]}else{t.values=c(t.values)}}return t})}var d=function(t){function i(){t.call(this);this._orient="vertical";this._separation=function(t,e){return t.parent===e.parent?1:2};this._shape=r.constant("Circle");this._shapeConfig=r.assign(this._shapeConfig,{labelConfig:{fontColor:"#444"},Path:{fill:"none",stroke:"#ccc",strokeWidth:1},r:r.constant(5),width:r.constant(10),height:r.constant(10)});this._tree=o.tree()}if(t)i.__proto__=t;i.prototype=Object.create(t&&t.prototype);i.prototype.constructor=i;i.prototype._draw=function i(a){var h=this;var u;t.prototype._draw.call(this,a);var l=this._orient==="vertical"?this._height-this._margin.top-this._margin.bottom:this._width-this._margin.left-this._margin.right,c=this._orient==="vertical"?"left":"top",d=this,_="translate("+this._margin.left+", "+this._margin.top+")",f=this._orient==="horizontal"?this._height-this._margin.top-this._margin.bottom:this._width-this._margin.left-this._margin.right;var g=this._tree.separation(this._separation).size([f,l])(o.hierarchy({key:"root",values:p(this._filteredData,this._groupBy.slice(0,this._drawDepth+1))},function(t){return t.key&&t.values?t.values:null}).sort(this._sort)).descendants().filter(function(t){return t.depth<=h._groupBy.length&&t.parent});function v(t){return r.merge(t.values.map(function(t){return t.key&&t.values?v(t):t}),d._aggs)}g.forEach(function(t,e){if(t.data.key&&t.data.values){t.data=v(t.data)}t.__d3plus__=true;t.i=e});var y=this._shapeConfig.r;if(typeof y!=="function"){y=r.constant(y)}var m=e.max(g,function(t){return t.depth===1?y(t.data,t.i):0});var b=e.max(g,function(t){return t.children?0:y(t.data,t.i)});var w=e.extent(g,function(t){return t.y});this._labelHeight=e.min([this._orient==="vertical"?50:100,(w[1]-m-b)/(this._groupBy.length+1)]);this._labelWidths=p(g,function(t){return t.depth}).map(function(t){return t.values.reduce(function(i,r,n){var a=n<t.values.length-1?t.values[n+1].x:f+h._margin[c],o=n?t.values[n-1].x:h._margin[c];return e.min([i,a-r.x,r.x-o])},f)});var x=s.scaleLinear().domain(w).range([m+this._labelHeight,l-b-this._labelHeight]);g.forEach(function(t){var e=x(t.y);if(h._orient==="horizontal"){t.y=t.x;t.x=e}else{t.y=e}});var C={parent:this._select,enter:{transform:_},update:{transform:_}};this._shapes.push((new n.Path).data(g.filter(function(t){return t.depth>1})).select(r.elem("g.d3plus-Tree-Links",C).node()).config(r.configPrep.bind(this)(this._shapeConfig,"shape","Path")).config({d:function(t){var e=h._shapeConfig.r;if(typeof e==="function"){e=e(t.data,t.i)}var i=t.parent.x-t.x+(h._orient==="vertical"?0:e),r=t.parent.y-t.y+(h._orient==="vertical"?e:0),n=h._orient==="vertical"?0:-e,a=h._orient==="vertical"?-e:0;return h._orient==="vertical"?"M"+n+","+a+"C"+n+","+(a+r)/2+" "+i+","+(a+r)/2+" "+i+","+r:"M"+n+","+a+"C"+(n+i)/2+","+a+" "+(n+i)/2+","+r+" "+i+","+r},id:function(t,e){return h._ids(t,e).join("-")}}).render());this._shapes.push((new n.Circle).data(g).select(r.elem("g.d3plus-Tree-Shapes",C).node()).config(r.configPrep.bind(this)(this._shapeConfig,"shape","Circle")).config({id:function(t,e){return h._ids(t,e).join("-")},label:function(t,e){if(h._label){return h._label(t.data,e)}var i=h._ids(t,e).slice(0,t.depth);return i[i.length-1]},labelConfig:{textAnchor:function(t){return h._orient==="vertical"?"middle":t.data.children&&t.data.depth!==h._groupBy.length?"end":"start"},verticalAlign:function(t){return h._orient==="vertical"?t.data.depth===1?"bottom":"top":"middle"}},hitArea:function(t,e,i){var r=h._labelHeight,n=h._labelWidths[t.depth-1];return{width:h._orient==="vertical"?n:i.r*2+n,height:h._orient==="horizontal"?r:i.r*2+r,x:h._orient==="vertical"?-n/2:t.children&&t.depth!==h._groupBy.length?-(i.r+n):-i.r,y:h._orient==="horizontal"?-r/2:t.children&&t.depth!==h._groupBy.length?-(i.r+h._labelHeight):-i.r}},labelBounds:function(t,e,i){var r=h._labelHeight,n=h._orient==="vertical"?"height":"width",a=h._labelWidths[t.depth-1],o=h._orient==="vertical"?"width":"height",s=h._orient==="vertical"?"x":"y",l=h._orient==="vertical"?"y":"x";return u={},u[o]=a,u[n]=r,u[s]=-a/2,u[l]=t.children&&t.depth!==h._groupBy.length?-(i.r+r):i.r,u}}).render());return this};i.prototype.orient=function t(e){return arguments.length?(this._orient=e,this):this._orient};i.prototype.separation=function t(e){return arguments.length?(this._separation=e,this):this._separation};return i}(a.Viz);var _=function(t){function e(){t.call(this);this._padding=1;this._shapeConfig=r.assign({},this._shapeConfig,{labelConfig:{fontResize:true}});this._sort=function(t,e){return e.value-t.value};this._sum=r.accessor("value");this._tile=o.treemapSquarify;this._treemap=o.treemap().round(true)}if(t)e.__proto__=t;e.prototype=Object.create(t&&t.prototype);e.prototype.constructor=e;e.prototype._draw=function e(i){var a=this;t.prototype._draw.call(this,i);var s=h.nest();for(var u=0;u<=this._drawDepth;u++){s.key(a._groupBy[u])}s=s.entries(this._filteredData);var l=this._treemap.padding(this._padding).size([this._width-this._margin.left-this._margin.right,this._height-this._margin.top-this._margin.bottom]).tile(this._tile)(o.hierarchy({values:s},function(t){return t.values}).sum(this._sum).sort(this._sort));var p=[],c=this;function d(t){for(var e=0;e<t.length;e++){var i=t[e];if(i.depth<=c._drawDepth){d(i.children)}else{i.__d3plus__=true;i.id=i.data.key;i.data=r.merge(i.data.values);i.i=e;i.x=i.x0+(i.x1-i.x0)/2;i.y=i.y0+(i.y1-i.y0)/2;p.push(i)}}}if(l.children){d(l.children)}var _=l.value;var f="translate("+this._margin.left+", "+this._margin.top+")";this._shapes.push((new n.Rect).data(p).label(function(t){return[a._drawLabel(t.data,t.i),Math.round(a._sum(t.data,t.i)/_*100)+"%"]}).select(r.elem("g.d3plus-Treemap",{parent:this._select,enter:{transform:f},update:{transform:f}}).node()).config({height:function(t){return t.y1-t.y0},labelBounds:function(t,e,i){var r=i.height;var n=Math.min(50,r*.25);return[{width:i.width,height:r-n,x:-i.width/2,y:-r/2},{width:i.width,height:n,x:-i.width/2,y:r/2-n}]},labelConfig:{textAnchor:function(t){return t.l?"middle":"start"},verticalAlign:function(t){return t.l?"bottom":"top"}},width:function(t){return t.x1-t.x0}}).config(r.configPrep.bind(this)(this._shapeConfig,"shape","Rect")).render());return this};e.prototype.padding=function t(e){return arguments.length?(this._padding=typeof e==="function"?e:r.constant(e),this):this._padding};e.prototype.sort=function t(e){return arguments.length?(this._sort=e,this):this._sort};e.prototype.sum=function t(e){return arguments.length?(this._sum=typeof e==="function"?e:r.constant(e),this):this._sum};e.prototype.tile=function t(e){return arguments.length?(this._tile=e,this):this._tile};return e}(a.Viz);t.Donut=l;t.Pie=u;t.Tree=d;t.Treemap=_;Object.defineProperty(t,"__esModule",{value:true})});