/*
  d3plus-shape v0.7.0
  Fancy SVG shapes for visualizations
  Copyright (c) 2016 D3plus - https://d3plus.org
  @license MIT
*/
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("d3-selection"),require("d3-transition"),require("d3plus-common"),require("d3plus-text"),require("d3plus-color")):"function"==typeof define&&define.amd?define("d3plus-shape",["exports","d3-selection","d3-transition","d3plus-common","d3plus-text","d3plus-color"],n):n(t.d3plus=t.d3plus||{},t.d3Selection,t.d3Transition,t.d3plusCommon,t.d3plusText,t.d3plusColor)}(this,function(t,n,e,r,o,i){"use strict";function c(t){function n(r){void 0===e&&n.select(l.select("body").append("svg").style("width",window.innerWidth+"px").style("height",window.innerHeight+"px").style("display","block").node());var h=e.selectAll(".d3plus-shape-image").data(t,c),d=h.enter().append("image").attr("class","d3plus-shape-image").attr("opacity",0),g=d.merge(h);return g.attr("xlink:href",a).transition().duration(o).attr("opacity",1).attr("width",function(t,n){return u(t,n)}).attr("height",function(t,n){return i(t,n)}).attr("x",function(t,n){return s(t,n)}).attr("y",function(t,n){return f(t,n)}).each(function(t,n){var e=l.select(this),r=a(t,n),o=0===r.indexOf("http://")||0===r.indexOf("https://");if(!o||0===r.indexOf(window.location.hostname)){var i=new Image;i.src=r,i.crossOrigin="Anonymous",i.onload=function(){var t=document.createElement("canvas");t.width=this.width,t.height=this.height;var n=t.getContext("2d");n.drawImage(this,0,0),e.attr("xlink:href",t.toDataURL("image/png"))}}}),h.exit().transition().duration(o).attr("width",function(t,n){return u(t,n)}).attr("height",function(t,n){return i(t,n)}).attr("x",function(t,n){return s(t,n)}).attr("y",function(t,n){return f(t,n)}).attr("opacity",0).remove(),r&&setTimeout(r,o+100),n}void 0===t&&(t=[]);var e,o=600,i=r.accessor("height"),c=r.accessor("url"),a=r.accessor("url"),u=r.accessor("width"),s=r.accessor("x",0),f=r.accessor("y",0);return n.data=function(e){return arguments.length?(t=e,n):t},n.duration=function(t){return arguments.length?(o=t,n):o},n.height=function(t){return arguments.length?(i="function"==typeof t?t:r.constant(t),n):i},n.id=function(t){return arguments.length?(c=t,n):c},n.select=function(t){return arguments.length?(e=l.select(t),n):e},n.url=function(t){return arguments.length?(a=t,n):a},n.width=function(t){return arguments.length?(u="function"==typeof t?t:r.constant(t),n):u},n.x=function(t){return arguments.length?(s="function"==typeof t?t:r.constant(t),n):s},n.y=function(t){return arguments.length?(f="function"==typeof t?t:r.constant(t),n):f},t.length?n():n}function a(t,n){return void 0!==t.id?t.id:n}function u(t){return{width:t.width,height:t.height,x:-t.width/2,y:-t.height/2}}function s(t){function n(t,n){return i.contrast(m(t,n))}function e(t,n){void 0===n&&(n=!0),t.each(function(t,e){var r=k(t,e),i=T(t,e),a=!!n&&x(t,e);c().data(a?[{url:a}]:[]).duration(w).height(n?r:0).select(this).width(n?i:0).x(n?-i/2:0).y(n?-r/2:0)();var u=[];if(n){var s=H(t,e);if(s!==!1&&void 0!==s){s.constructor!==Array&&(s=[s]);for(var l=C({width:i,height:r},e),f=q(t,e),h=A(t,e),y=d(t,e),v=b(t,e),m=g(t,e),z=p(t,e),F=j(t,e),R=P(t,e),S=0;S<s.length;S++){var I=l.constructor===Array?l[S]:Object.assign({},l),W=f.constructor===Array?f[S]:f;I.height-=2*W,I.width-=2*W,I.x+=W,I.y+=W,I.id=O(t,e)+"_"+S,I.text=s[S],I.fC=h.constructor===Array?h[S]:h,I.fF=y.constructor===Array?y[S]:y,I.fR=v.constructor===Array?v[S]:v,I.fS=m.constructor===Array?m[S]:m,I.lH=z.constructor===Array?z[S]:z,I.tA=F.constructor===Array?F[S]:F,I.vA=R.constructor===Array?R[S]:R,u.push(I)}}}o.textBox().data(u).delay(w/2).duration(w).fontColor(function(t){return t.fC}).fontFamily(function(t){return t.fF}).fontResize(function(t){return t.fR}).fontSize(function(t){return t.fS}).lineHeight(function(t){return t.lH}).textAnchor(function(t){return t.tA}).verticalAlign(function(t){return t.vA}).select(this)()})}function s(t){t.attr("fill",function(t,n){return m(t,n)}).attr("stroke",function(t,n){return R(t,n)}).attr("stroke-width",function(t,n){return S(t,n)})}function l(t){t.attr("width",function(t,n){return T(t,n)}).attr("height",function(t,n){return k(t,n)}).attr("x",function(t,n){return-T(t,n)/2}).attr("y",function(t,n){return-k(t,n)/2})}function h(n){void 0===y&&h.select(f.select("body").append("svg").style("width",window.innerWidth+"px").style("height",window.innerHeight+"px").style("display","block").node()),void 0===p&&(p=function(t,n){return 1.1*g(t,n)});var r=f.transition().duration(w),o=y.selectAll(".d3plus-shape-rect").data(t,O);o.transition(r).attr("transform",function(t,n){return"translate("+I(t,n)+","+W(t,n)+")"}),o.select("rect").transition(r).call(s),o.exit().transition().delay(w).remove(),o.exit().select("rect").transition(r).attr("width",0).attr("height",0).attr("x",0).attr("y",0),o.exit().call(e,!1);var i=o.enter().append("g").attr("class","d3plus-shape-rect").attr("id",function(t,n){return"d3plus-shape-rect-"+O(t,n)}).attr("transform",function(t,n){return"translate("+I(t,n)+","+W(t,n)+")"});i.append("rect").attr("width",0).attr("height",0).attr("x",0).attr("y",0).call(s);var c=i.merge(o);c.select("rect").transition(r).call(l),c.call(e).transition(r).attr("opacity",z);for(var a=Object.keys(v),u=0;u<a.length;u++)c.on(a[u],v[a[u]]);return n&&setTimeout(n,w+100),h}void 0===t&&(t=[]);var d,g,p,y,v={},x=r.constant(!1),w=600,m=r.constant("black"),A=n,b=r.constant(!1),k=r.accessor("height"),O=a,C=u,H=r.constant(!1),q=r.constant(5),z=r.constant(1),F=r.constant(1),R=r.constant("black"),S=r.constant(0),j=r.constant("start"),P=r.constant("top"),T=r.accessor("width"),I=r.accessor("x"),W=r.accessor("y");return h.backgroundImage=function(t){return arguments.length?(x="function"==typeof t?t:r.constant(t),h):x},h.config=function(t){if(arguments.length){for(var n in t)({}).hasOwnProperty.call(t,n)&&h[n](t[n]);return h}var e={};for(var r in h.prototype.constructor)"config"!==r&&{}.hasOwnProperty.call(h,r)&&(e[r]=h[r]());return e},h.data=function(n){return arguments.length?(t=n,h):t},h.duration=function(t){return arguments.length?(w=t,h):w},h.fill=function(t){return arguments.length?(m="function"==typeof t?t:r.constant(t),h):m},h.fontColor=function(t){return arguments.length?(A="function"==typeof t?t:r.constant(t),h):A},h.fontFamily=function(t){return arguments.length?(d="function"==typeof t?t:r.constant(t),h):d},h.fontResize=function(t){return arguments.length?(b="function"==typeof t?t:r.constant(t),h):b},h.fontSize=function(t){return arguments.length?(g="function"==typeof t?t:r.constant(t),h):g},h.height=function(t){return arguments.length?(k="function"==typeof t?t:r.constant(t),h):k},h.id=function(t){return arguments.length?(O=t,h):O},h.innerBounds=function(t){return arguments.length?(C=t,h):C},h.label=function(t){return arguments.length?(H="function"==typeof t?t:r.constant(t),h):H},h.labelPadding=function(t){return arguments.length?(q="function"==typeof t?t:r.constant(t),h):q},h.lineHeight=function(t){return arguments.length?(p="function"==typeof t?t:r.constant(t),h):p},h.on=function(t,n){return 2===arguments.length?(v[t]=n,h):arguments.length?v[t]:v},h.opacity=function(t){return arguments.length?(z="function"==typeof t?t:r.constant(t),h):z},h.scale=function(t){return arguments.length?(F="function"==typeof t?t:r.constant(t),h):F},h.select=function(t){return arguments.length?(y=f.select(t),void 0===d&&(d=r.constant(y.style("font-family"))),void 0===g&&(g=r.constant(parseFloat(y.style("font-size"),10))),h):y},h.stroke=function(t){return arguments.length?(R="function"==typeof t?t:r.constant(t),h):R},h.strokeWidth=function(t){return arguments.length?(S="function"==typeof t?t:r.constant(t),h):S},h.textAnchor=function(t){return arguments.length?(j="function"==typeof t?t:r.constant(t),h):j},h.update=function(t){var n=y.selectAll(t),r=f.transition().duration(w);return n.call(e).transition(r).attr("opacity",z).attr("transform",function(t,n){return"translate("+I(t,n)+","+W(t,n)+")scale("+F(t,n)+")"}),n.select("rect").transition(r).call(s).call(l),h},h.verticalAlign=function(t){return arguments.length?(P="function"==typeof t?t:r.constant(t),h):P},h.width=function(t){return arguments.length?(T="function"==typeof t?t:r.constant(t),h):T},h.x=function(t){return arguments.length?(I="function"==typeof t?t:r.constant(t),h):I},h.y=function(t){return arguments.length?(W="function"==typeof t?t:r.constant(t),h):W},t.length?h():h}var l={select:n.select,transition:e.transition},f={select:n.select,selectAll:n.selectAll,transition:e.transition};t.image=c,t.rect=s,Object.defineProperty(t,"__esModule",{value:!0})});