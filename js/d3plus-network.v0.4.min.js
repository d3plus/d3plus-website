/*
  d3plus-network v0.4.1
  Javascript network visualizations built upon d3 modules.
  Copyright (c) 2018 D3plus - https://d3plus.org
  @license MIT
*/
if(typeof Object.assign!=="function"){Object.defineProperty(Object,"assign",{value:function e(t){"use strict";if(t===null){throw new TypeError("Cannot convert undefined or null to object")}var n=Object(t);for(var r=1;r<arguments.length;r++){var i=arguments[r];if(i!==null){for(var s in i){if(Object.prototype.hasOwnProperty.call(i,s)){n[s]=i[s]}}}}return n},writable:true,configurable:true})}if(!Array.prototype.includes){Object.defineProperty(Array.prototype,"includes",{value:function e(t,n){var r=Object(this);var i=r.length>>>0;if(i===0)return false;var s=n|0;var o=Math.max(s>=0?s:i-Math.abs(s),0);function a(e,t){return e===t||typeof e==="number"&&typeof t==="number"&&isNaN(e)&&isNaN(t)}while(o<i){if(a(r[o],t)){return true}o++}return false}})}(function(e,t){typeof exports==="object"&&typeof module!=="undefined"?t(exports,require("d3-array"),require("d3-collection"),require("d3-scale"),require("d3-zoom"),require("d3plus-common"),require("d3plus-shape"),require("d3plus-viz"),require("d3plus-color"),require("d3-sankey")):typeof define==="function"&&define.amd?define("d3plus-network",["exports","d3-array","d3-collection","d3-scale","d3-zoom","d3plus-common","d3plus-shape","d3plus-viz","d3plus-color","d3-sankey"],t):t(e.d3plus={},e.d3Array,e.d3Collection,e.scales,e.d3Zoom,e.d3plusCommon,e.shapes,e.d3plusViz,e.d3plusColor,e.d3Sankey)})(this,function(e,S,j,D,d,I,R,s,W,t){"use strict";var n=function(A){function e(){var h=this;A.call(this);this._labelCutoff=100;this._links=[];this._noDataMessage=false;this._nodes=[];this._on["click.shape"]=function(e,t){h._tooltipClass.data([]).render();if(h._hover&&h._drawDepth>=h._groupBy.length-1){if(h._focus&&h._focus===e.id){h.active(false);h._on.mouseenter.bind(h)(e,t);h._focus=undefined;h._zoomToBounds(null)}else{h.hover(false);var n=h._nodeGroupBy&&h._nodeGroupBy[h._drawDepth](e,t)?h._nodeGroupBy[h._drawDepth](e,t):h._id(e,t),r=h._linkLookup[n],i=h._nodeLookup[n];var s=[i.id];var o=[i.x-i.r,i.x+i.r],a=[i.y-i.r,i.y+i.r];r.forEach(function(e){s.push(e.id);if(e.x-e.r<o[0]){o[0]=e.x-e.r}if(e.x+e.r>o[1]){o[1]=e.x+e.r}if(e.y-e.r<a[0]){a[0]=e.y-e.r}if(e.y+e.r>a[1]){a[1]=e.y+e.r}});h.active(function(e,t){if(e.source&&e.target){return e.source.id===i.id||e.target.id===i.id}else{return s.includes(h._ids(e,t)[h._drawDepth])}});h._focus=e.id;var u=d.zoomTransform(h._container.node());o=o.map(function(e){return e*u.k+u.x});a=a.map(function(e){return e*u.k+u.y});h._zoomToBounds([[o[0],a[0]],[o[1],a[1]]])}}};this._on["click.legend"]=function(e,t){var n=h._id(e);var r=h._ids(e);r=r[r.length-1];if(h._hover&&h._drawDepth>=h._groupBy.length-1){if(h._focus&&h._focus===n){h.active(false);h._on.mouseenter.bind(h)(e,t);h._focus=undefined;h._zoomToBounds(null)}else{h.hover(false);var i=n.map(function(e){return h._nodeLookup[e]});var s=[r];var o=[i[0].x-i[0].r,i[0].x+i[0].r],a=[i[0].y-i[0].r,i[0].y+i[0].r];i.forEach(function(e){s.push(e.id);if(e.x-e.r<o[0]){o[0]=e.x-e.r}if(e.x+e.r>o[1]){o[1]=e.x+e.r}if(e.y-e.r<a[0]){a[0]=e.y-e.r}if(e.y+e.r>a[1]){a[1]=e.y+e.r}});h.active(function(e,t){if(e.source&&e.target){return s.includes(e.source.id)&&s.includes(e.target.id)}else{var n=h._ids(e,t);return s.includes(n[n.length-1])}});h._focus=n;var u=d.zoomTransform(h._container.node());o=o.map(function(e){return e*u.k+u.x});a=a.map(function(e){return e*u.k+u.y});h._zoomToBounds([[o[0],a[0]],[o[1],a[1]]])}h._on["mousemove.legend"].bind(h)(e,t)}};this._sizeMin=5;this._sizeScale="sqrt";this._shape=I.constant("Circle");this._shapeConfig=I.assign(this._shapeConfig,{ariaLabel:function(e,t){var n=h._size?", "+h._size(e,t):"";return""+h._drawLabel(e,t)+n+"."},labelConfig:{duration:0,fontMin:1,fontResize:true,labelPadding:0,textAnchor:"middle",verticalAlign:"middle"},Path:{fill:"none",label:false,stroke:"#eee",strokeWidth:1}});this._x=I.accessor("x");this._y=I.accessor("y");this._zoom=true}if(A)e.__proto__=A;e.prototype=Object.create(A&&A.prototype);e.prototype.constructor=e;e.prototype._draw=function e(t){var i=this;A.prototype._draw.call(this,t);var n=this._height-this._margin.top-this._margin.bottom,r="translate("+this._margin.left+", "+this._margin.top+")",s=this._transition,o=this._width-this._margin.left-this._margin.right;var a=this._filteredData.reduce(function(e,t,n){e[i._id(t,n)]=t;return e},{});var u=this._nodes.reduce(function(e,t,n){e[i._nodeGroupBy?i._nodeGroupBy[i._drawDepth](t,n):i._id(t,n)]=t;return e},{});u=Array.from(new Set(Object.keys(a).concat(Object.keys(u)))).map(function(e,t){var n=a[e],r=u[e];if(r===undefined){return false}return{__d3plus__:true,data:n||r,i:t,id:e,fx:n!==undefined&&i._x(n)!==undefined?i._x(n):i._x(r),fy:n!==undefined&&i._y(n)!==undefined?i._y(n):i._y(r),node:r,r:i._size?n!==undefined&&i._size(n)!==undefined?i._size(n):i._size(r):i._sizeMin,shape:n!==undefined&&i._shape(n)!==undefined?i._shape(n):i._shape(r)}}).filter(function(e){return e});var h=S.extent(u.map(function(e){return e.fx})),d=S.extent(u.map(function(e){return e.fy}));var c=D.scaleLinear().domain(h).range([0,o]),f=D.scaleLinear().domain(d).range([0,n]);var _=(h[1]-h[0])/(d[1]-d[0]),l=o/n;if(_>l){var p=n*l/_;f.range([(n-p)/2,n-(n-p)/2])}else{var g=o*_/l;c.range([(o-g)/2,o-(o-g)/2])}u.forEach(function(e){e.x=c(e.fx);e.y=f(e.fy)});var v=S.extent(u.map(function(e){return e.r}));var y=this._sizeMax||S.min(S.merge(u.map(function(t){return u.map(function(e){return t===e?null:R.pointDistance([t.x,t.y],[e.x,e.y])})})))/2;var m=D["scale"+this._sizeScale.charAt(0).toUpperCase()+this._sizeScale.slice(1)]().domain(v).range([v[0]===v[1]?y:S.min([y/2,this._sizeMin]),y]),k=c.domain(),x=f.domain();var z=k[1]-k[0],b=x[1]-x[0];u.forEach(function(e){var t=m(e.r);if(k[0]>c.invert(e.x-t)){k[0]=c.invert(e.x-t)}if(k[1]<c.invert(e.x+t)){k[1]=c.invert(e.x+t)}if(x[0]>f.invert(e.y-t)){x[0]=f.invert(e.y-t)}if(x[1]<f.invert(e.y+t)){x[1]=f.invert(e.y+t)}});var M=k[1]-k[0],w=x[1]-x[0];y*=S.min([z/M,b/w]);m.range([v[0]===v[1]?y:S.min([y/2,this._sizeMin]),y]);c.domain(k);f.domain(x);u.forEach(function(e){e.x=c(e.fx);e.fx=e.x;e.y=f(e.fy);e.fy=e.y;e.r=m(e.r);e.width=e.r*2;e.height=e.r*2});var C=this._nodeLookup=u.reduce(function(e,t){e[t.id]=t;return e},{});var B=u.map(function(e){return e.node});var q=this._links.map(function(e){return{source:typeof e.source==="number"?u[B.indexOf(i._nodes[e.source])]:C[e.source.id],target:typeof e.target==="number"?u[B.indexOf(i._nodes[e.target])]:C[e.target.id]}});this._linkLookup=q.reduce(function(e,t){if(!e[t.source.id]){e[t.source.id]=[]}e[t.source.id].push(t.target);if(!e[t.target.id]){e[t.target.id]=[]}e[t.target.id].push(t.source);return e},{});this._container=this._select.selectAll("svg.d3plus-network").data([0]);this._container=this._container.enter().append("svg").attr("class","d3plus-network").attr("opacity",0).attr("width",o).attr("height",n).attr("x",this._margin.left).attr("y",this._margin.top).style("background-color","transparent").merge(this._container);this._container.transition(this._transition).attr("opacity",1).attr("width",o).attr("height",n).attr("x",this._margin.left).attr("y",this._margin.top);var L=this._container.selectAll("rect.d3plus-network-hitArea").data([0]);L.enter().append("rect").attr("class","d3plus-network-hitArea").merge(L).attr("width",o).attr("height",n).attr("fill","transparent").on("click",function(){if(i._focus){i.active(false);i._focus=undefined;i._zoomToBounds(null)}});this._zoomGroup=this._container.selectAll("g.d3plus-network-zoomGroup").data([0]);var P=this._zoomGroup=this._zoomGroup.enter().append("g").attr("class","d3plus-network-zoomGroup").merge(this._zoomGroup);this._shapes.push((new R.Path).config(this._shapeConfig).config(this._shapeConfig.Path).d(function(e){return"M"+e.source.x+","+e.source.y+" "+e.target.x+","+e.target.y}).data(q).select(I.elem("g.d3plus-network-links",{parent:P,transition:s,enter:{transform:r},update:{transform:r}}).node()).render());var O={label:function(e){return u.length<=i._labelCutoff||(i._hover&&i._hover(e)||i._active&&i._active(e))?i._drawLabel(e.data||e.node,e.i):false},select:I.elem("g.d3plus-network-nodes",{parent:P,transition:s,enter:{transform:r},update:{transform:r}}).node()};j.nest().key(function(e){return e.shape}).entries(u).forEach(function(e){i._shapes.push((new R[e.key]).config(I.configPrep.bind(i)(i._shapeConfig,"shape",e.key)).config(O).config(O[e.key]||{}).data(e.values).render())});return this};e.prototype.labelCutoff=function e(t){return arguments.length?(this._labelCutoff=t,this):this._labelCutoff};e.prototype.links=function e(t,n){if(arguments.length){var r=this._queue.find(function(e){return e[3]==="links"});var i=[s.dataLoad.bind(this),t,n,"links"];if(r){this._queue[this._queue.indexOf(r)]=i}else{this._queue.push(i)}return this}return this._links};e.prototype.nodeGroupBy=function e(t){var n=this;if(!arguments.length){return this._nodeGroupBy}if(!(t instanceof Array)){t=[t]}return this._nodeGroupBy=t.map(function(e){if(typeof e==="function"){return e}else{if(!n._aggs[e]){n._aggs[e]=function(e){var t=Array.from(new Set(e));return t.length===1?t[0]:t}}return I.accessor(e)}}),this};e.prototype.nodes=function e(t,n){if(arguments.length){var r=this._queue.find(function(e){return e[3]==="nodes"});var i=[s.dataLoad.bind(this),t,n,"nodes"];if(r){this._queue[this._queue.indexOf(r)]=i}else{this._queue.push(i)}return this}return this._nodes};e.prototype.size=function e(t){return arguments.length?(this._size=typeof t==="function"||!t?t:I.accessor(t),this):this._size};e.prototype.sizeMax=function e(t){return arguments.length?(this._sizeMax=t,this):this._sizeMax};e.prototype.sizeMin=function e(t){return arguments.length?(this._sizeMin=t,this):this._sizeMin};e.prototype.sizeScale=function e(t){return arguments.length?(this._sizeScale=t,this):this._sizeScale};e.prototype.x=function e(t){if(arguments.length){if(typeof t==="function"){this._x=t}else{this._x=I.accessor(t);if(!this._aggs[t]){this._aggs[t]=function(e){return S.mean(e)}}}return this}else{return this._x}};e.prototype.y=function e(t){if(arguments.length){if(typeof t==="function"){this._y=t}else{this._y=I.accessor(t);if(!this._aggs[t]){this._aggs[t]=function(e){return S.mean(e)}}}return this}else{return this._y}};return e}(s.Viz);var r=function(G){function e(){var u=this;G.call(this);this._labelCutoff=100;this._links=[];this._noDataMessage=false;this._nodes=[];this._on.mouseenter=function(){};this._on["mouseleave.shape"]=function(){u.hover(false)};var h=this._on["mousemove.shape"];this._on["mousemove.shape"]=function(e,t){h(e,t);if(u._focus&&u._focus===e.id){u.hover(false);u._on.mouseenter.bind(u)(e,t);u._focus=undefined}else{var n=u._nodeGroupBy&&u._nodeGroupBy[u._drawDepth](e,t)?u._nodeGroupBy[u._drawDepth](e,t):u._id(e,t),r=u._linkLookup[n],i=u._nodeLookup[n];var s=[i.id];var o=[i.x-i.r,i.x+i.r],a=[i.y-i.r,i.y+i.r];r.forEach(function(e){s.push(e.id);if(e.x-e.r<o[0]){o[0]=e.x-e.r}if(e.x+e.r>o[1]){o[1]=e.x+e.r}if(e.y-e.r<a[0]){a[0]=e.y-e.r}if(e.y+e.r>a[1]){a[1]=e.y+e.r}});u.hover(function(e,t){if(e.source&&e.target){return e.source.id===i.id||e.target.id===i.id}else{return s.includes(u._ids(e,t)[u._drawDepth])}})}};this._on["click.shape"]=function(e){u._center=e.id;u._draw()};this._sizeMin=5;this._sizeScale="sqrt";this._shape=I.constant("Circle");this._shapeConfig=I.assign(this._shapeConfig,{ariaLabel:function(e,t){var n=u._size?", "+u._size(e,t):"";return""+u._drawLabel(e,t)+n+"."},labelConfig:{duration:0,fontMin:1,fontResize:true,labelPadding:0,textAnchor:"middle",verticalAlign:"middle"},Path:{fill:"none",label:false,stroke:"#eee",strokeWidth:1}})}if(G)e.__proto__=G;e.prototype=Object.create(G&&G.prototype);e.prototype.constructor=e;e.prototype._draw=function e(t){var h=this;G.prototype._draw.call(this,t);var i=this._filteredData.reduce(function(e,t,n){e[h._id(t,n)]=t;return e},{});var d=this._nodes;if(!this._nodes.length&&this._links.length){var n=Array.from(new Set(this._links.reduce(function(e,t){return e.concat([t.source,t.target])},[])));d=n.map(function(e){return typeof e==="object"?e:{id:e}})}d=d.reduce(function(e,t,n){e[h._nodeGroupBy?h._nodeGroupBy[h._drawDepth](t,n):h._id(t,n)]=t;return e},{});d=Array.from(new Set(Object.keys(i).concat(Object.keys(d)))).map(function(e,t){var n=i[e],r=d[e];if(r===undefined){return false}return{__d3plus__:true,data:n||r,i:t,id:e,node:r,shape:n!==undefined&&h._shape(n)!==undefined?h._shape(n):h._shape(r)}}).filter(function(e){return e});var r=this._nodeLookup=d.reduce(function(e,t){e[t.id]=t;return e},{});var s=this._links.map(function(n){var e=["source","target"];return e.reduce(function(e,t){e[t]=typeof n[t]==="number"?d[n[t]]:r[n[t].id||n[t]];return e},{})});var o=s.reduce(function(e,t){if(!e[t.source.id]){e[t.source.id]=[]}e[t.source.id].push(t);if(!e[t.target.id]){e[t.target.id]=[]}e[t.target.id].push(t);return e},{});var c=this._height-this._margin.top-this._margin.bottom,a="translate("+this._margin.left+", "+this._margin.top+")",u=this._transition,f=this._width-this._margin.left-this._margin.right;var _=[],l=S.min([c,f])/2,p=l/3;var g=p,v=p*2;var y=r[this._center];y.x=f/2;y.y=c/2;y.r=this._sizeMin?S.max([this._sizeMin,g*.65]):this._sizeMax?S.min([this._sizeMax,g*.65]):g*.65;var m=[y],k=[];o[this._center].forEach(function(e){var t=e.source.id===h._center?e.target:e.source;t.edges=o[t.id].filter(function(e){return e.source.id!==h._center||e.target.id!==h._center});t.edge=e;m.push(t);k.push(t)});k.sort(function(e,t){return e.edges.length-t.edges.length});var x=[];var z=0;k.forEach(function(e){var i=e.id;e.edges=e.edges.filter(function(e){return!m.includes(e.source)&&e.target.id===i||!m.includes(e.target)&&e.source.id===i});z+=e.edges.length||1;e.edges.forEach(function(e){var t=e.source;var n=e.target;var r=n.id===i?t:n;m.push(r)})});var b=Math.PI*2;var M=0;k.forEach(function(s,e){var o=s.edges.length||1;var t=b/z*o;if(e===0){M-=t/2}var a=M+t/2-b/4;s.radians=a;s.x=f/2+g*Math.cos(a);s.y=c/2+g*Math.sin(a);M+=t;s.edges.forEach(function(e,t){var n=e.source.id===s.id?e.target:e.source;var r=b/z;var i=a-r*o/2+r/2+r*t;n.radians=i;n.x=f/2+v*Math.cos(i);n.y=c/2+v*Math.sin(i);x.push(n)})});var w=p/2;var C=p/4;var B=w/2-4;if(w/2-4<8){B=S.min([w/2,8])}var q=C/2-4;if(C/2-4<4){q=S.min([C/2,4])}if(q>p/10){q=p/10}if(q>B&&q>10){q=B*.75}if(B>q*1.5){B=q*1.5}B=Math.floor(B);q=Math.floor(q);var L;if(this._size){var P=S.extent(i,function(e){return e.size});if(P[0]===P[1]){P[0]=0}L=D.scaleLinear().domain(P).rangeRound([3,S.min([B,q])]);var O=y.size;y.r=L(O)}else{L=D.scaleLinear().domain([1,2]).rangeRound([B,q])}x.forEach(function(e){e.ring=2;var t=h._size?e.size:2;e.r=h._sizeMin?S.max([h._sizeMin,L(t)]):h._sizeMax?S.min([h._sizeMax,L(t)]):L(t)});k.forEach(function(e){e.ring=1;var t=h._size?e.size:1;e.r=h._sizeMin?S.max([h._sizeMin,L(t)]):h._sizeMax?S.min([h._sizeMax,L(t)]):L(t)});d=[y].concat(k).concat(x);k.forEach(function(u){var e=["source","target"];var n=u.edge;e.forEach(function(t){n[t]=d.find(function(e){return e.id===n[t].id})});_.push(n);o[u.id].forEach(function(r){var t=r.source.id===u.id?r.target:r.source;if(t.id!==y.id){var i=x.find(function(e){return e.id===t.id});if(!i){i=k.find(function(e){return e.id===t.id})}if(i){r.spline=true;var s=f/2;var o=c/2;var a=g+(v-g)*.5;var e=["source","target"];e.forEach(function(t,e){r[t+"X"]=r[t].x+Math.cos(r[t].ring===2?r[t].radians+Math.PI:r[t].radians)*r[t].r;r[t+"Y"]=r[t].y+Math.sin(r[t].ring===2?r[t].radians+Math.PI:r[t].radians)*r[t].r;r[t+"BisectX"]=s+a*Math.cos(r[t].radians);r[t+"BisectY"]=o+a*Math.sin(r[t].radians);r[t]=d.find(function(e){return e.id===r[t].id});if(r[t].edges===undefined){r[t].edges={}}var n=e===0?r.target.id:r.source.id;if(r[t].id===u.id){r[t].edges[n]={angle:u.radians+Math.PI,radius:p/2}}else{r[t].edges[n]={angle:i.radians,radius:p/2}}});_.push(r)}}})});d.forEach(function(e){if(e.id!==h._center){var t=h._shapeConfig.labelConfig.fontSize&&h._shapeConfig.labelConfig.fontSize(e)||11;var n=t*1.4;var r=n*2;var i=5;var s=p-e.r;var o=e.radians*(180/Math.PI);var a=e.r+i;var u="start";if(o<-90||o>90){a=-e.r-s-i;u="end";o+=180}e.labelBounds={x:a,y:-n/2,width:s,height:r};e.rotate=o;e.textAnchor=u}else{e.labelBounds={x:-g/2,y:-g/2,width:g,height:g}}});this._linkLookup=s.reduce(function(e,t){if(!e[t.source.id]){e[t.source.id]=[]}e[t.source.id].push(t.target);if(!e[t.target.id]){e[t.target.id]=[]}e[t.target.id].push(t.source);return e},{});this._shapes.push((new R.Path).config(I.configPrep.bind(this)(this._shapeConfig,"edge","Path")).id(function(e){return e.source.id+"_"+e.target.id}).d(function(e){return e.spline?"M"+e.sourceX+","+e.sourceY+"C"+e.sourceBisectX+","+e.sourceBisectY+" "+e.targetBisectX+","+e.targetBisectY+" "+e.targetX+","+e.targetY:"M"+e.source.x+","+e.source.y+" "+e.target.x+","+e.target.y}).data(_).select(I.elem("g.d3plus-rings-links",{parent:this._select,transition:u,enter:{transform:a},update:{transform:a}}).node()).render());var A=this;var E={label:function(e){return d.length<=h._labelCutoff||(h._hover&&h._hover(e)||h._active&&h._active(e))?h._drawLabel(e.data||e.node,e.i):false},labelBounds:function(e){return e.labelBounds},labelConfig:{fontColor:function(e){return e.data.data.id===h._center?I.configPrep.bind(A)(A._shapeConfig,"shape",e.key).labelConfig.fontColor(e):W.colorLegible(I.configPrep.bind(A)(A._shapeConfig,"shape",e.key).fill(e))},fontResize:function(e){return e.data.data.id===h._center},padding:0,textAnchor:function(e){return r[e.data.data.id].textAnchor||I.configPrep.bind(A)(A._shapeConfig,"shape",e.key).labelConfig.textAnchor},verticalAlign:function(e){return e.data.data.id===h._center?"middle":"top"}},rotate:function(e){return r[e.id].rotate||0},select:I.elem("g.d3plus-rings-nodes",{parent:this._select,transition:u,enter:{transform:a},update:{transform:a}}).node()};j.nest().key(function(e){return e.shape}).entries(d).forEach(function(e){h._shapes.push((new R[e.key]).config(I.configPrep.bind(h)(h._shapeConfig,"shape",e.key)).config(E).data(e.values).render())});return this};e.prototype.center=function e(t){return arguments.length?(this._center=t,this):this._center};e.prototype.hover=function e(t){this._hover=t;this._shapes.forEach(function(e){return e.hover(t)});if(this._legend){this._legendClass.hover(t)}return this};e.prototype.links=function e(t,n){if(arguments.length){var r=this._queue.find(function(e){return e[3]==="links"});var i=[s.dataLoad.bind(this),t,n,"links"];if(r){this._queue[this._queue.indexOf(r)]=i}else{this._queue.push(i)}return this}return this._links};e.prototype.nodeGroupBy=function e(t){var n=this;if(!arguments.length){return this._nodeGroupBy}if(!(t instanceof Array)){t=[t]}return this._nodeGroupBy=t.map(function(e){if(typeof e==="function"){return e}else{if(!n._aggs[e]){n._aggs[e]=function(e){var t=Array.from(new Set(e));return t.length===1?t[0]:t}}return I.accessor(e)}}),this};e.prototype.nodes=function e(t,n){if(arguments.length){var r=this._queue.find(function(e){return e[3]==="nodes"});var i=[s.dataLoad.bind(this),t,n,"nodes"];if(r){this._queue[this._queue.indexOf(r)]=i}else{this._queue.push(i)}return this}return this._nodes};e.prototype.size=function e(t){return arguments.length?(this._size=typeof t==="function"||!t?t:I.accessor(t),this):this._size};e.prototype.sizeMax=function e(t){return arguments.length?(this._sizeMax=t,this):this._sizeMax};e.prototype.sizeMin=function e(t){return arguments.length?(this._sizeMin=t,this):this._sizeMin};e.prototype.sizeScale=function e(t){return arguments.length?(this._sizeScale=t,this):this._sizeScale};return e}(s.Viz);var i=function(h){function e(){var a=this;h.call(this);this._nodeId=I.accessor("id");this._links=I.accessor("links");this._noDataMessage=false;this._nodes=I.accessor("nodes");this._nodeWidth=30;this._on.mouseenter=function(){};this._on["mouseleave.shape"]=function(){a.hover(false)};var u=this._on["mousemove.shape"];this._on["mousemove.shape"]=function(e,t){u(e,t);if(a._focus&&a._focus===e.id){a.hover(false);a._on.mouseenter.bind(a)(e,t);a._focus=undefined}else{var n=a._nodeId(e,t),r=a._nodeLookup[n],i=Object.keys(a._nodeLookup).reduce(function(e,t){e[a._nodeLookup[t]]=!isNaN(t)?parseInt(t,10):t;return e},{});var s=a._linkLookup[r];var o=[n];s.forEach(function(e){o.push(i[e])});a.hover(function(e,t){if(e.source&&e.target){return e.source.id===n||e.target.id===n}else{return o.includes(a._nodeId(e,t))}})}};this._path=t.sankeyLinkHorizontal();this._sankey=t.sankey();this._shape=I.constant("Rect");this._shapeConfig=I.assign(this._shapeConfig,{Path:{fill:"none",hoverStyle:{"stroke-width":function(e,t){return Math.max(1,Math.abs(e.source.y1-e.source.y0)*(a._value(e,t)/e.source.value)-2)}},label:false,stroke:"#DBDBDB",strokeOpacity:.5,strokeWidth:function(e,t){return Math.max(1,Math.abs(e.source.y1-e.source.y0)*(a._value(e,t)/e.source.value)-2)}},Rect:{}});this._value=I.constant(1)}if(h)e.__proto__=h;e.prototype=Object.create(h&&h.prototype);e.prototype.constructor=e;e.prototype._draw=function e(t){var i=this;h.prototype._draw.call(this,t);var n=this._height-this._margin.top-this._margin.bottom,r=this._width-this._margin.left-this._margin.right;var s=this._nodes.map(function(e,t){return{__d3plus__:true,data:e,i:t,id:i._nodeId(e,t),node:e,shape:"Rect"}});var o=this._nodeLookup=s.reduce(function(e,t,n){e[t.id]=n;return e},{});var a=this._links.map(function(n,e){var t=["source","target"];var r=t.reduce(function(e,t){e[t]=typeof n[t]==="number"?o[n[t]]:o[n[t]];return e},{});return{source:r.source,target:r.target,value:i._value(n,e)}});this._linkLookup=a.reduce(function(e,t){if(!e[t.source]){e[t.source]=[]}e[t.source].push(t.target);if(!e[t.target]){e[t.target]=[]}e[t.target].push(t.source);return e},{});var u="translate("+this._margin.left+", "+this._margin.top+")";this._sankey.nodeWidth(this._nodeWidth).nodes(s).links(a).size([r,n])();this._shapes.push((new R.Path).config(this._shapeConfig.Path).data(a).d(this._path).select(I.elem("g.d3plus-Links",{parent:this._select,enter:{transform:u},update:{transform:u}}).node()).render());j.nest().key(function(e){return e.shape}).entries(s).forEach(function(e){i._shapes.push((new R[e.key]).data(e.values).height(function(e){return e.y1-e.y0}).width(function(e){return e.x1-e.x0}).x(function(e){return(e.x1+e.x0)/2}).y(function(e){return(e.y1+e.y0)/2}).select(I.elem("g.d3plus-sankey-nodes",{parent:i._select,enter:{transform:u},update:{transform:u}}).node()).config(I.configPrep.bind(i)(i._shapeConfig,"shape",e.key)).render())});return this};e.prototype.hover=function e(t){this._hover=t;this._shapes.forEach(function(e){return e.hover(t)});if(this._legend){this._legendClass.hover(t)}return this};e.prototype.links=function e(t,n){if(arguments.length){var r=this._queue.find(function(e){return e[3]==="links"});var i=[s.dataLoad.bind(this),t,n,"links"];if(r){this._queue[this._queue.indexOf(r)]=i}else{this._queue.push(i)}return this}return this._links};e.prototype.nodeId=function e(t){return arguments.length?(this._nodeId=typeof t==="function"?t:I.accessor(t),this):this._nodeId};e.prototype.nodes=function e(t,n){if(arguments.length){var r=this._queue.find(function(e){return e[3]==="nodes"});var i=[s.dataLoad.bind(this),t,n,"nodes"];if(r){this._queue[this._queue.indexOf(r)]=i}else{this._queue.push(i)}return this}return this._nodes};e.prototype.nodeWidth=function e(t){return arguments.length?(this._nodeWidth=t,this):this._nodeWidth};e.prototype.value=function e(t){return arguments.length?(this._value=typeof t==="function"?t:I.accessor(t),this):this._value};return e}(s.Viz);e.Network=n;e.Rings=r;e.Sankey=i;Object.defineProperty(e,"__esModule",{value:true})});