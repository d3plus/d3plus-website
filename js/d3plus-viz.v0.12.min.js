/*
  d3plus-viz v0.12.51
  Abstract ES6 class that drives d3plus visualizations.
  Copyright (c) 2020 D3plus - https://d3plus.org
  @license MIT
*/
(function(t){typeof define==="function"&&define.amd?define(t):t()})(function(){"use strict";var t=typeof globalThis!=="undefined"?globalThis:typeof window!=="undefined"?window:typeof global!=="undefined"?global:typeof self!=="undefined"?self:{};function e(t,e){return e={exports:{}},t(e,e.exports),e.exports}var i=function(t){return t&&t.Math==Math&&t};var u=i(typeof globalThis=="object"&&globalThis)||i(typeof window=="object"&&window)||i(typeof self=="object"&&self)||i(typeof t=="object"&&t)||Function("return this")();var n=function(t){try{return!!t()}catch(t){return true}};var f=!n(function(){return Object.defineProperty({},"a",{get:function(){return 7}}).a!=7});var o={}.propertyIsEnumerable;var r=Object.getOwnPropertyDescriptor;var a=r&&!o.call({1:2},1);var s=a?function t(e){var i=r(this,e);return!!i&&i.enumerable}:o;var _={f:s};var l=function(t,e){return{enumerable:!(t&1),configurable:!(t&2),writable:!(t&4),value:e}};var h={}.toString;var c=function(t){return h.call(t).slice(8,-1)};var d="".split;var b=n(function(){return!Object("z").propertyIsEnumerable(0)})?function(t){return c(t)=="String"?d.call(t,""):Object(t)}:Object;var g=function(t){if(t==undefined)throw TypeError("Can't call method on "+t);return t};var v=function(t){return b(g(t))};var p=function(t){return typeof t==="object"?t!==null:typeof t==="function"};var m=function(t,e){if(!p(t))return t;var i,n;if(e&&typeof(i=t.toString)=="function"&&!p(n=i.call(t)))return n;if(typeof(i=t.valueOf)=="function"&&!p(n=i.call(t)))return n;if(!e&&typeof(i=t.toString)=="function"&&!p(n=i.call(t)))return n;throw TypeError("Can't convert object to primitive value")};var y={}.hasOwnProperty;var C=function(t,e){return y.call(t,e)};var w=u.document;var k=p(w)&&p(w.createElement);var z=function(t){return k?w.createElement(t):{}};var S=!f&&!n(function(){return Object.defineProperty(z("div"),"a",{get:function(){return 7}}).a!=7});var x=Object.getOwnPropertyDescriptor;var P=f?x:function t(e,i){e=v(e);i=m(i,true);if(S)try{return x(e,i)}catch(t){}if(C(e,i))return l(!_.f.call(e,i),e[i])};var O={f:P};var T=function(t){if(!p(t)){throw TypeError(String(t)+" is not an object")}return t};var A=Object.defineProperty;var D=f?A:function t(e,i,n){T(e);i=m(i,true);T(n);if(S)try{return A(e,i,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");if("value"in n)e[i]=n.value;return e};var B={f:D};var M=f?function(t,e,i){return B.f(t,e,l(1,i))}:function(t,e,i){t[e]=i;return t};var j=function(e,i){try{M(u,e,i)}catch(t){u[e]=i}return i};var H="__core-js_shared__";var F=u[H]||j(H,{});var E=F;var L=e(function(t){(t.exports=function(t,e){return E[t]||(E[t]=e!==undefined?e:{})})("versions",[]).push({version:"3.3.6",mode:"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})});var q=L("native-function-to-string",Function.toString);var N=u.WeakMap;var R=typeof N==="function"&&/native code/.test(q.call(N));var V=0;var I=Math.random();var G=function(t){return"Symbol("+String(t===undefined?"":t)+")_"+(++V+I).toString(36)};var W=L("keys");var Y=function(t){return W[t]||(W[t]=G(t))};var K={};var X=u.WeakMap;var J,Q,U;var Z=function(t){return U(t)?Q(t):J(t,{})};var $=function(i){return function(t){var e;if(!p(t)||(e=Q(t)).type!==i){throw TypeError("Incompatible receiver, "+i+" required")}return e}};if(R){var tt=new X;var et=tt.get;var it=tt.has;var nt=tt.set;J=function(t,e){nt.call(tt,t,e);return e};Q=function(t){return et.call(tt,t)||{}};U=function(t){return it.call(tt,t)}}else{var ot=Y("state");K[ot]=true;J=function(t,e){M(t,ot,e);return e};Q=function(t){return C(t,ot)?t[ot]:{}};U=function(t){return C(t,ot)}}var rt={set:J,get:Q,has:U,enforce:Z,getterFor:$};var at=e(function(t){var e=rt.get;var s=rt.enforce;var l=String(q).split("toString");L("inspectSource",function(t){return q.call(t)});(t.exports=function(t,e,i,n){var o=n?!!n.unsafe:false;var r=n?!!n.enumerable:false;var a=n?!!n.noTargetGet:false;if(typeof i=="function"){if(typeof e=="string"&&!C(i,"name"))M(i,"name",e);s(i).source=l.join(typeof e=="string"?e:"")}if(t===u){if(r)t[e]=i;else j(e,i);return}else if(!o){delete t[e]}else if(!a&&t[e]){r=true}if(r)t[e]=i;else M(t,e,i)})(Function.prototype,"toString",function t(){return typeof this=="function"&&e(this).source||q.call(this)})});var st=u;var lt=function(t){return typeof t=="function"?t:undefined};var ht=function(t,e){return arguments.length<2?lt(st[t])||lt(u[t]):st[t]&&st[t][e]||u[t]&&u[t][e]};var ct=Math.ceil;var ut=Math.floor;var dt=function(t){return isNaN(t=+t)?0:(t>0?ut:ct)(t)};var ft=Math.min;var _t=function(t){return t>0?ft(dt(t),9007199254740991):0};var gt=Math.max;var vt=Math.min;var pt=function(t,e){var i=dt(t);return i<0?gt(i+e,0):vt(i,e)};var mt=function(s){return function(t,e,i){var n=v(t);var o=_t(n.length);var r=pt(i,o);var a;if(s&&e!=e)while(o>r){a=n[r++];if(a!=a)return true}else for(;o>r;r++){if((s||r in n)&&n[r]===e)return s||r||0}return!s&&-1}};var yt={includes:mt(true),indexOf:mt(false)};var bt=yt.indexOf;var Ct=function(t,e){var i=v(t);var n=0;var o=[];var r;for(r in i)!C(K,r)&&C(i,r)&&o.push(r);while(e.length>n)if(C(i,r=e[n++])){~bt(o,r)||o.push(r)}return o};var wt=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"];var kt=wt.concat("length","prototype");var zt=Object.getOwnPropertyNames||function t(e){return Ct(e,kt)};var St={f:zt};var xt=Object.getOwnPropertySymbols;var Pt={f:xt};var Ot=ht("Reflect","ownKeys")||function t(e){var i=St.f(T(e));var n=Pt.f;return n?i.concat(n(e)):i};var Tt=function(t,e){var i=Ot(e);var n=B.f;var o=O.f;for(var r=0;r<i.length;r++){var a=i[r];if(!C(t,a))n(t,a,o(e,a))}};var At=/#|\.prototype\./;var Dt=function(t,e){var i=Mt[Bt(t)];return i==Ht?true:i==jt?false:typeof e=="function"?n(e):!!e};var Bt=Dt.normalize=function(t){return String(t).replace(At,".").toLowerCase()};var Mt=Dt.data={};var jt=Dt.NATIVE="N";var Ht=Dt.POLYFILL="P";var Ft=Dt;var Et=O.f;var Lt=function(t,e){var i=t.target;var n=t.global;var o=t.stat;var r,a,s,l,h,c;if(n){a=u}else if(o){a=u[i]||j(i,{})}else{a=(u[i]||{}).prototype}if(a)for(s in e){h=e[s];if(t.noTargetGet){c=Et(a,s);l=c&&c.value}else l=a[s];r=Ft(n?s:i+(o?".":"#")+s,t.forced);if(!r&&l!==undefined){if(typeof h===typeof l)continue;Tt(h,l)}if(t.sham||l&&l.sham){M(h,"sham",true)}at(a,s,h,t)}};var qt=function(t){if(typeof t!="function"){throw TypeError(String(t)+" is not a function")}return t};var Nt=function(n,o,t){qt(n);if(o===undefined)return n;switch(t){case 0:return function(){return n.call(o)};case 1:return function(t){return n.call(o,t)};case 2:return function(t,e){return n.call(o,t,e)};case 3:return function(t,e,i){return n.call(o,t,e,i)}}return function(){return n.apply(o,arguments)}};var Rt=function(t){return Object(g(t))};var Vt=Array.isArray||function t(e){return c(e)=="Array"};var It=!!Object.getOwnPropertySymbols&&!n(function(){return!String(Symbol())});var Gt=u.Symbol;var Wt=L("wks");var Yt=function(t){return Wt[t]||(Wt[t]=It&&Gt[t]||(It?Gt:G)("Symbol."+t))};var Kt=Yt("species");var Xt=function(t,e){var i;if(Vt(t)){i=t.constructor;if(typeof i=="function"&&(i===Array||Vt(i.prototype)))i=undefined;else if(p(i)){i=i[Kt];if(i===null)i=undefined}}return new(i===undefined?Array:i)(e===0?0:e)};var Jt=[].push;var Qt=function(f){var _=f==1;var g=f==2;var v=f==3;var p=f==4;var m=f==6;var y=f==5||m;return function(t,e,i,n){var o=Rt(t);var r=b(o);var a=Nt(e,i,3);var s=_t(r.length);var l=0;var h=n||Xt;var c=_?h(t,s):g?h(t,0):undefined;var u,d;for(;s>l;l++)if(y||l in r){u=r[l];d=a(u,l,o);if(f){if(_)c[l]=d;else if(d)switch(f){case 3:return true;case 5:return u;case 6:return l;case 2:Jt.call(c,u)}else if(p)return false}}return m?-1:v||p?p:c}};var Ut={forEach:Qt(0),map:Qt(1),filter:Qt(2),some:Qt(3),every:Qt(4),find:Qt(5),findIndex:Qt(6)};var Zt=Object.keys||function t(e){return Ct(e,wt)};var $t=f?Object.defineProperties:function t(e,i){T(e);var n=Zt(i);var o=n.length;var r=0;var a;while(o>r)B.f(e,a=n[r++],i[a]);return e};var te=ht("document","documentElement");var ee=Y("IE_PROTO");var ie="prototype";var ne=function(){};var oe=function(){var t=z("iframe");var e=wt.length;var i="<";var n="script";var o=">";var r="java"+n+":";var a;t.style.display="none";te.appendChild(t);t.src=String(r);a=t.contentWindow.document;a.open();a.write(i+n+o+"document.F=Object"+i+"/"+n+o);a.close();oe=a.F;while(e--)delete oe[ie][wt[e]];return oe()};var re=Object.create||function t(e,i){var n;if(e!==null){ne[ie]=T(e);n=new ne;ne[ie]=null;n[ee]=e}else n=oe();return i===undefined?n:$t(n,i)};K[ee]=true;var ae=Yt("unscopables");var se=Array.prototype;if(se[ae]==undefined){M(se,ae,re(null))}var le=function(t){se[ae][t]=true};var he=Ut.find;var ce="find";var ue=true;if(ce in[])Array(1)[ce](function(){ue=false});Lt({target:"Array",proto:true,forced:ue},{find:function t(e){return he(this,e,arguments.length>1?arguments[1]:undefined)}});le(ce);var de=yt.includes;Lt({target:"Array",proto:true},{includes:function t(e){return de(this,e,arguments.length>1?arguments[1]:undefined)}});le("includes");var fe=Object.assign;var _e=!fe||n(function(){var t={};var e={};var i=Symbol();var n="abcdefghijklmnopqrst";t[i]=7;n.split("").forEach(function(t){e[t]=t});return fe({},t)[i]!=7||Zt(fe({},e)).join("")!=n})?function t(e,i){var n=Rt(e);var o=arguments.length;var r=1;var a=Pt.f;var s=_.f;while(o>r){var l=b(arguments[r++]);var h=a?Zt(l).concat(a(l)):Zt(l);var c=h.length;var u=0;var d;while(c>u){d=h[u++];if(!f||s.call(l,d))n[d]=l[d]}}return n}:fe;Lt({target:"Object",stat:true,forced:Object.assign!==_e},{assign:_e});var ge=Yt("match");var ve=function(t){var e;return p(t)&&((e=t[ge])!==undefined?!!e:c(t)=="RegExp")};var pe=function(t){if(ve(t)){throw TypeError("The method doesn't accept regular expressions")}return t};var me=Yt("match");var ye=function(e){var i=/./;try{"/./"[e](i)}catch(t){try{i[me]=false;return"/./"[e](i)}catch(t){}}return false};Lt({target:"String",proto:true,forced:!ye("includes")},{includes:function t(e){return!!~String(g(this)).indexOf(pe(e),arguments.length>1?arguments[1]:undefined)}});var be="".startsWith;var Ce=Math.min;Lt({target:"String",proto:true,forced:!ye("startsWith")},{startsWith:function t(e){var i=String(g(this));pe(e);var n=_t(Ce(arguments.length>1?arguments[1]:undefined,i.length));var o=String(e);return be?be.call(i,o,n):i.slice(n,n+o.length)===o}});if(typeof window!=="undefined"){(function(){var n=function(t,e){var i=t.nodeType;if(i===3){e.push(t.textContent.replace(/&/,"&amp;").replace(/</,"&lt;").replace(">","&gt;"))}else if(i===1){e.push("<",t.tagName);if(t.hasAttributes()){[].forEach.call(t.attributes,function(t){e.push(" ",t.item.name,"='",t.item.value,"'")})}if(t.hasChildNodes()){e.push(">");[].forEach.call(t.childNodes,function(t){n(t,e)});e.push("</",t.tagName,">")}else{e.push("/>")}}else if(i==8){e.push("\x3c!--",t.nodeValue,"--\x3e")}};Object.defineProperty(SVGElement.prototype,"innerHTML",{get:function(){var t=[];var e=this.firstChild;while(e){n(e,t);e=e.nextSibling}return t.join("")},set:function(t){while(this.firstChild){this.removeChild(this.firstChild)}try{var e=new DOMParser;e.async=false;var i="<svg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'>"+t+"</svg>";var n=e.parseFromString(i,"text/xml").documentElement;var o=n.firstChild;while(o){this.appendChild(this.ownerDocument.importNode(o,true));o=o.nextSibling}}catch(t){}}});Object.defineProperty(SVGElement.prototype,"innerSVG",{get:function(){return this.innerHTML},set:function(t){this.innerHTML=t}})})()}});(function(t,e){typeof exports==="object"&&typeof module!=="undefined"?e(exports,require("d3-request"),require("d3-array"),require("d3-brush"),require("d3-color"),require("d3-collection"),require("d3-queue"),require("d3-selection"),require("d3-transition"),require("d3-zoom"),require("lrucache"),require("d3plus-axis"),require("d3plus-color"),require("d3plus-common"),require("d3plus-form"),require("d3plus-format"),require("d3plus-legend"),require("d3plus-text"),require("d3plus-timeline"),require("d3plus-tooltip"),require("d3plus-export")):typeof define==="function"&&define.amd?define("d3plus-viz",["exports","d3-request","d3-array","d3-brush","d3-color","d3-collection","d3-queue","d3-selection","d3-transition","d3-zoom","lrucache","d3plus-axis","d3plus-color","d3plus-common","d3plus-form","d3plus-format","d3plus-legend","d3plus-text","d3plus-timeline","d3plus-tooltip","d3plus-export"],e):(t=t||self,e(t.d3plus={},t.d3Request,t.d3Array,t.d3Brush,t.d3Color,t.d3Collection,t.d3Queue,t.d3Selection,t.d3Transition,t.d3Zoom,t.lrucache,t.d3plusAxis,t.d3plusColor,t.d3plusCommon,t.d3plusForm,t.d3plusFormat,t.d3plusLegend,t.d3plusText,t.d3plusTimeline,t.d3plusTooltip,t.d3plusExport))})(this,function(t,o,_,i,l,p,u,g,d,f,n,v,h,m,r,y,a,c,b,C,w){"use strict";n=n&&n.hasOwnProperty("default")?n["default"]:n;var k=function(t){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"data";return t.reduce(function(t,e){var i=[];if(Array.isArray(e)){i=e}else{if(e[n]){i=e[n]}else{console.warn('d3plus-viz: Please implement a "dataFormat" callback to concat the arrays manually (consider using the d3plus.dataConcat method in your callback). Currently unable to concatenate (using key: "'.concat(n,'") the following response:'),e)}}return t.concat(i)},[])};var z=function(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"data";var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"headers";return t[e].map(function(n){return t[i].reduce(function(t,e,i){return t[e]=n[i],t},{})})};function S(t){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){S=function(t){return typeof t}}else{S=function(t){return t&&typeof Symbol==="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t}}return S(t)}function x(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}function s(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(t,n.key,n)}}function P(t,e,i){if(e)s(t.prototype,e);if(i)s(t,i);return t}function O(t,e){if(typeof e!=="function"&&e!==null){throw new TypeError("Super expression must either be null or a function")}t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:true,configurable:true}});if(e)A(t,e)}function T(t){T=Object.setPrototypeOf?Object.getPrototypeOf:function t(e){return e.__proto__||Object.getPrototypeOf(e)};return T(t)}function A(t,e){A=Object.setPrototypeOf||function t(e,i){e.__proto__=i;return e};return A(t,e)}function D(t){if(t===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t}function B(t,e){if(e&&(typeof e==="object"||typeof e==="function")){return e}return D(t)}function M(t,e){return H(t)||E(t,e)||q()}function j(t){return e(t)||F(t)||L()}function e(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}function H(t){if(Array.isArray(t))return t}function F(t){if(Symbol.iterator in Object(t)||Object.prototype.toString.call(t)==="[object Arguments]")return Array.from(t)}function E(t,e){if(!(Symbol.iterator in Object(t)||Object.prototype.toString.call(t)==="[object Arguments]")){return}var i=[];var n=true;var o=false;var r=undefined;try{for(var a=t[Symbol.iterator](),s;!(n=(s=a.next()).done);n=true){i.push(s.value);if(e&&i.length===e)break}}catch(t){o=true;r=t}finally{try{if(!n&&a["return"]!=null)a["return"]()}finally{if(o)throw r}}return i}function L(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function q(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function N(r,a,s,l){var h=this;var c;var u=function t(e){var i=e.slice(e.length-4);switch(i){case".csv":return o.csv;case".tsv":return o.tsv;case".txt":return o.text;default:return o.json}};var d=function t(e,i,n){if(i!==o.json&&!e&&n&&n instanceof Array){n.forEach(function(t){for(var e in t){if(!isNaN(t[e]))t[e]=parseFloat(t[e]);else if(t[e].toLowerCase()==="false")t[e]=false;else if(t[e].toLowerCase()==="true")t[e]=true;else if(t[e].toLowerCase()==="null")t[e]=null;else if(t[e].toLowerCase()==="undefined")t[e]=undefined}})}return n};var f=function t(e){return e.reduce(function(t,e){return e?t+1:t},0)};var _=function t(e,i){return i.indexOf(e)};if(!(r instanceof Array))r=[r];var i=function t(e){return typeof e==="string"||S(e)==="object"&&e.url&&e.headers};var t=r.find(i);var g=new Array(r.length);var v=[];if(t){r.forEach(function(t,e){if(i(t))v.push(t);else g[e]=t})}else{g[0]=r}var p=f(g);v.forEach(function(t){var e={},i=t;if(S(t)==="object"){i=t.url;e=t.headers}c=u(i);var n=c(i);for(var o in e){if({}.hasOwnProperty.call(e,o)){n.header(o,e[o])}}n.get(function(t,e){e=t?[]:e;if(e&&!(e instanceof Array)&&e.data&&e.headers)e=z(e);e=d(t,c,e);g[_(i,r)]=e;if(f(g)-p===v.length){e=f(g)===1?g[0]:g;if(a){e=a(f(g)===1?g[0]:g)}else if(s==="data"){e=k(g,"data")}if(s&&"_".concat(s)in h)h["_".concat(s)]=e;if(h._cache)h._lrucache.set(i,e);if(l)l(t,e)}})});if(v.length===0){g=g.map(function(t){if(t&&!(t instanceof Array)&&t.data&&t.headers)t=z(t);return t});var e=f(g)===1?g[0]:g;if(a){e=a(f(g)===1?g[0]:g)}else if(s==="data"){e=k(g,"data")}if(s&&"_".concat(s)in this)this["_".concat(s)]=e;if(this._cache)this._lrucache.set(s,e);if(l)l(null,e)}}var R=function(){function t(){x(this,t);this._isVisible=false}P(t,[{key:"exit",value:function t(e,i){e.transition().duration(i).style("opacity",0).transition().remove();this._isVisible=false}},{key:"hide",value:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},i=e.duration,n=i===void 0?600:i,o=e.callback;this.mask.call(this.exit.bind(this),n);this.elem.call(this.exit.bind(this),n);if(o)setTimeout(o,n+100);this._isVisible=false;return this}},{key:"render",value:function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},i=e.callback,n=e.container,o=n===void 0?"body":n,r=e.duration,a=r===void 0?600:r,s=e.html,l=s===void 0?"Please Wait":s,h=e.mask,c=h===void 0?"rgba(0, 0, 0, 0.05)":h,u=e.style,d=u===void 0?{}:u;var f=g.select(o).style("position","relative");this.mask=f.selectAll("div.d3plus-Mask").data(c?[c]:[]);this.mask=this.mask.enter().append("div").attr("class","d3plus-Mask").style("opacity",1).merge(this.mask);this.mask.exit().call(this.exit.bind(this),a);m.stylize(this.mask,{"background-color":String,bottom:"0px",left:"0px",position:"absolute",right:"0px",top:"0px"});this.elem=f.selectAll("div.d3plus-Message").data([l]);this.elem=this.elem.enter().append("div").attr("class","d3plus-Message").style("opacity",1).merge(this.elem).html(String);m.stylize(this.elem,d);if(i)setTimeout(i,100);this._isVisible=true;return this}}]);return t}();function V(){var t=this._history.length;var e=m.elem("g.d3plus-viz-back",{parent:this._select,transition:this._transition,update:{transform:"translate(".concat(this._margin.left,", ").concat(this._margin.top,")")}}).node();this._backClass.data(t?[{text:"← ".concat(this._translate("Back")),x:0,y:0}]:[]).select(e).config(this._backConfig).render();this._margin.top+=t?this._backClass.fontSize()()+this._backClass.padding()()*2:0}function I(){var n=this;var t=this._data;var e=this._colorScalePosition||"bottom";var i=["top","bottom"].includes(e);var o=this._colorScalePadding()?this._padding:{top:0,right:0,bottom:0,left:0};var r=this._width-(this._margin.left+this._margin.right+o.left+o.right);var a=i?_.min([this._colorScaleMaxSize,r]):this._width-(this._margin.left+this._margin.right);var s=this._height-(this._margin.bottom+this._margin.top+o.bottom+o.top);var l=!i?_.min([this._colorScaleMaxSize,s]):this._height-(this._margin.bottom+this._margin.top);var h={opacity:this._colorScalePosition?1:0,transform:"translate(".concat(i?this._margin.left+o.left+(r-a)/2:this._margin.left,", ").concat(i?this._margin.top:this._margin.top+o.top+(s-l)/2,")")};var c=this._colorScale&&t&&t.length>1;var u=m.elem("g.d3plus-viz-colorScale",{condition:c&&!this._colorScaleConfig.select,enter:h,parent:this._select,transition:this._transition,update:h}).node();if(c){var d=t.filter(function(t,e){var i=n._colorScale(t,e);return i!==undefined&&i!==null});this._colorScaleClass.align({bottom:"end",left:"start",right:"end",top:"start"}[e]||"bottom").duration(this._duration).data(d).height(l).locale(this._locale).orient(e).select(u).value(this._colorScale).width(a).config(this._colorScaleConfig).render();var f=this._colorScaleClass.outerBounds();if(this._colorScalePosition&&!this._colorScaleConfig.select&&f.height){if(i)this._margin[e]+=f.height+this._legendClass.padding()*2;else this._margin[e]+=f.width+this._legendClass.padding()*2}}else{this._colorScaleClass.config(this._colorScaleConfig)}}var G={Button:r.Button,Radio:r.Radio,Select:r.Select};function W(){var u=this;var d=this;var f=this._controlPadding()?this._padding:{top:0,right:0,bottom:0,left:0};var _=["left","right","top","bottom"];var t=function t(e){var l=_[e];var h=(u._controls||[]).filter(function(t){return!t.position&&l==="bottom"||t.position===l});if(u._downloadButton&&u._downloadPosition===l){h.push({data:[{text:u._translate("Download"),value:1}],label:"downloadButton",on:{click:function t(){var e=u._detectResize;if(e)u.detectResize(false).render();w.saveElement(u._select.node(),Object.assign({title:u._title||undefined},u._downloadConfig),{callback:function t(){setTimeout(function(){if(e)u.detectResize(e).render()},5e3)}})}},type:"Button"})}var i=l==="top"||l==="bottom";var n={height:i?u._height-(u._margin.top+u._margin.bottom):u._height-(u._margin.top+u._margin.bottom+f.top+f.bottom),width:i?u._width-(u._margin.left+u._margin.right+f.left+f.right):u._width-(u._margin.left+u._margin.right)};n.x=(i?u._margin.left+f.left:u._margin.left)+(l==="right"?u._width-u._margin.bottom:0);n.y=(i?u._margin.top:u._margin.top+f.top)+(l==="bottom"?u._height-u._margin.bottom:0);var o=m.elem("foreignObject.d3plus-viz-controls-".concat(l),{condition:h.length,enter:Object.assign({opacity:0},n),exit:Object.assign({opacity:0},n),parent:u._select,transition:u._transition,update:{height:n.height,opacity:1,width:n.width}});var c=o.selectAll("div.d3plus-viz-controls-container").data([null]);c=c.enter().append("xhtml:div").attr("class","d3plus-viz-controls-container").merge(c);if(h.length){var r=function t(e){var i=Object.assign({},h[e]);var n={};if(i.on){var o=function t(e){if({}.hasOwnProperty.call(i.on,e)){n[e]=function(){i.on[e].bind(d)(this.value)}}};for(var r in i.on){o(r)}}var a=i.label||"".concat(l,"-").concat(e);if(!u._controlCache[a]){var s=i.type&&G[i.type]?i.type:"Select";u._controlCache[a]=(new G[s]).container(c.node());if(i.checked)u._controlCache[a].checked(i.checked);if(i.selected)u._controlCache[a].selected(i.selected)}delete i.checked;delete i.selected;u._controlCache[a].config(i).config({on:n}).config(u._controlConfig).render()};for(var a=0;a<h.length;a++){r(a)}c.style("display",["top","bottom"].includes(l)?"block":"inline-block").style("text-align",["top","bottom"].includes(l)?"center":l);var s=c.node().getBoundingClientRect();o.transition(u._transition).attr("x",n.x-(l==="right"?s.width:0)).attr("y",n.y-(l==="bottom"?s.height:0)).attr("height",i?s.height:n.height).attr("width",i?n.width:s.width);u._margin[l]+=["top","bottom"].includes(l)?s.height:s.width}};for(var e=0;e<_.length;e++){t(e)}}function Y(t,e){return this._drawLabel(t,e,this._legendDepth)}function K(){var a=this;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];if(this._legend){var e=this._legendClass.outerBounds();var i=this._legendPosition;var n=["top","bottom"].includes(i);var o=this._legendPadding()?this._padding:{top:0,right:0,bottom:0,left:0};var r={transform:"translate(".concat(n?this._margin.left+o.left:this._margin.left,", ").concat(n?this._margin.top:this._margin.top+o.top,")")};var s=m.elem("g.d3plus-viz-legend",{condition:this._legend&&!this._legendConfig.select,enter:r,parent:this._select,transition:this._transition,update:r}).node();var l=[];var h=function t(e,i){var n=a._shape(e,i);var o=n==="Line"?"stroke":"fill";var r=a._shapeConfig[n]&&a._shapeConfig[n][o]?a._shapeConfig[n][o]:a._shapeConfig[o];return typeof r==="function"?r(e,i):r};var c=function t(e,i){var n=a._shape(e,i);var o=a._shapeConfig[n]&&a._shapeConfig[n].opacity?a._shapeConfig[n].opacity:a._shapeConfig.opacity;return typeof o==="function"?o(e,i):o};var u=function t(e,i){return"".concat(h(e,i),"_").concat(c(e,i))};p.nest().key(u).rollup(function(t){return l.push(m.merge(t,a._aggs))}).entries(this._colorScale?t.filter(function(t,e){return a._colorScale(t,e)===undefined}):t);l.sort(this._legendSort);var d=l.map(function(t,e){return a._ids(t,e).slice(0,a._drawDepth+1)});this._legendDepth=0;var f=function t(e){var i=d.map(function(t){return t[e]});if(!i.some(function(t){return t instanceof Array})&&Array.from(new Set(i)).length===l.length){a._legendDepth=e;return"break"}};for(var _=0;_<=this._drawDepth;_++){var g=f(_);if(g==="break")break}var v=function t(e,i){var n=a._id(e,i);if(n instanceof Array)n=n[0];return a._hidden.includes(n)||a._solo.length&&!a._solo.includes(n)};this._legendClass.id(u).align(n?"center":i).direction(n?"row":"column").duration(this._duration).data(l.length>this._legendCutoff||this._colorScale?l:[]).height(n?this._height-(this._margin.bottom+this._margin.top):this._height-(this._margin.bottom+this._margin.top+o.bottom+o.top)).locale(this._locale).select(s).verticalAlign(!n?"middle":i).width(n?this._width-(this._margin.left+this._margin.right+o.left+o.right):this._width-(this._margin.left+this._margin.right)).shapeConfig(m.configPrep.bind(this)(this._shapeConfig,"legend")).config(this._legendConfig).shapeConfig({fill:function t(e,i){return v(e,i)?a._hiddenColor(e,i):h(e,i)},labelConfig:{fontOpacity:function t(e,i){return v(e,i)?a._hiddenOpacity(e,i):1}},opacity:c}).render();if(!this._legendConfig.select&&e.height){if(n)this._margin[i]+=e.height+this._legendClass.padding()*2;else this._margin[i]+=e.width+this._legendClass.padding()*2}}}function X(i){var n=this;if(!(i instanceof Array))i=[i,i];if(JSON.stringify(i)!==JSON.stringify(this._timelineSelection)){this._timelineSelection=i;i=i.map(Number);this.timeFilter(function(t){var e=v.date(n._time(t)).getTime();return e>=i[0]&&e<=i[1]}).render()}}function J(){var e=this;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var i=this._time&&this._timeline;var n=i?m.unique(this._data.map(this._time)).map(v.date):[];i=i&&n.length>1;var o=this._timelinePadding()?this._padding:{top:0,right:0,bottom:0,left:0};var r={transform:"translate(".concat(this._margin.left+o.left,", 0)")};var a=m.elem("g.d3plus-viz-timeline",{condition:i,enter:r,parent:this._select,transition:this._transition,update:r}).node();if(i){var s=this._timelineClass.domain(_.extent(n)).duration(this._duration).height(this._height-this._margin.bottom).locale(this._locale).select(a).ticks(n.sort(function(t,e){return+t-+e})).width(this._width-(this._margin.left+this._margin.right+o.left+o.right));if(s.selection()===undefined){this._timelineSelection=_.extent(t,this._time).map(v.date);s.selection(this._timelineSelection)}var l=this._timelineConfig;s.config(l).on("end",function(t){X.bind(e)(t);if(l.on&&l.on.end)l.on.end(t)}).render();this._margin.bottom+=s.outerBounds().height+s.padding()*2}}function Q(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var e=this._title?this._title(t):false;var i=this._titlePadding()?this._padding:{top:0,right:0,bottom:0,left:0};var n={transform:"translate(".concat(this._margin.left+i.left,", ").concat(this._margin.top,")")};var o=m.elem("g.d3plus-viz-title",{enter:n,parent:this._select,transition:this._transition,update:n}).node();this._titleClass.data(e?[{text:e}]:[]).locale(this._locale).select(o).width(this._width-(this._margin.left+this._margin.right+i.left+i.right)).config(this._titleConfig).render();this._margin.top+=e?o.getBBox().height:0}function U(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var e=typeof this._total==="function"?_.sum(t.map(this._total)):this._total===true&&this._size?_.sum(t.map(this._size)):false;var i=this._totalPadding()?this._padding:{top:0,right:0,bottom:0,left:0};var n={transform:"translate(".concat(this._margin.left+i.left,", ").concat(this._margin.top,")")};var o=m.elem("g.d3plus-viz-total",{enter:n,parent:this._select,transition:this._transition,update:n}).node();var r=typeof e==="number";this._totalClass.data(r?[{text:this._totalFormat(e)}]:[]).locale(this._locale).select(o).width(this._width-(this._margin.left+this._margin.right+i.left+i.right)).config(this._totalConfig).render();this._margin.top+=r?o.getBBox().height+this._totalConfig.padding*2:0}function Z(t,e){if(!t)return undefined;if(t.tagName===undefined||["BODY","HTML"].indexOf(t.tagName)>=0){var i=window["inner".concat(e.charAt(0).toUpperCase()+e.slice(1))];var n=g.select(t);if(e==="width"){i-=parseFloat(n.style("margin-left"),10);i-=parseFloat(n.style("margin-right"),10);i-=parseFloat(n.style("padding-left"),10);i-=parseFloat(n.style("padding-right"),10)}else{i-=parseFloat(n.style("margin-top"),10);i-=parseFloat(n.style("margin-bottom"),10);i-=parseFloat(n.style("padding-top"),10);i-=parseFloat(n.style("padding-bottom"),10)}return i}else{var o=parseFloat(g.select(t).style(e),10);if(typeof o==="number"&&o>0)return o;else return Z(t.parentNode,e)}}function $(t){return[Z(t,"width"),Z(t,"height")]}function tt(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var i=window.pageXOffset!==undefined?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft;var n=window.pageYOffset!==undefined?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;var o=t.getBoundingClientRect();var r=o.height,a=o.left+i,s=o.top+n,l=o.width;return n+window.innerHeight>s+e&&n+e<s+r&&i+window.innerWidth>a+e&&i+e<a+l}function et(t,e){this._select.style("cursor","auto");if(this._drawDepth<this._groupBy.length-1){var n=this._groupBy[this._drawDepth],o=n(t,e);this.hover(false);if(this._tooltip(t,e))this._tooltipClass.data([]).render();var r=this._filter;this._history.push({depth:this._depth,filter:r});this.config({depth:this._drawDepth+1,filter:function t(e,i){return(!r||r(e,i))&&n(e,i)===o}}).render()}}function it(t,e){var n=this;this._select.style("cursor","auto");if(this._tooltip(t,e))this._tooltipClass.data([]).render();var i=this._id(t,e);if(!(i instanceof Array))i=[i];var o=this._hidden.indexOf(i[0]);var r=this._solo.indexOf(i[0]);var a=_.merge(this._legendClass.data().map(function(t,e){var i=n._id(t,e);if(!(i instanceof Array))i=[i];return i})).length;if(g.event.shiftKey){if(o<0&&!this._solo.length){this._hidden=this._hidden.concat(i);if(this._solo.length===a)this._solo=[];if(this._hidden.length===a)this._hidden=[];this.render()}else if(r>=0){this._solo=[];this._hidden=[];this.render()}}else{if(r<0&&this._hidden.length<a-1){this._solo=i;this._hidden=[]}else{this._solo=[];this._hidden=[]}this.render()}}var nt=function t(e){return e.reduce(function(t,e){if(e instanceof Array){if(t.length){var i=t.slice();t=[];e.forEach(function(e){return t=t.concat(i.map(function(t){return"".concat(t,"_").concat(e)}))})}else{t=e.slice()}}else if(t.length){t=t.map(function(t){return"".concat(t,"_").concat(e)})}else{t.push(e)}return t},[])};function ot(t,e){var n=this;if(this._shapeConfig.hoverOpacity!==1){var o=nt(this._ids(t,e));this.hover(function(t,e){var i=nt(n._ids(t,e));return o.some(function(t){return i.includes(t)})})}}function rt(i,n){var o=this;setTimeout(function(){if(o._shapeConfig.hoverOpacity!==1&&o._hover?o._hover(i,n):true){o.hover(false)}var t=o._tooltipClass.data();if(t.length&&o._tooltip(i,n)){var e=t[0];while(e.__d3plus__&&e.data){e=e.data}if(o._id(e)===o._id(i))o._tooltipClass.data([]).render()}},50);this._select.style("cursor","auto")}function at(t,e,i){var n=this;var o=g.event.touches?[g.event.touches[0].clientX,g.event.touches[0].clientY]:[g.event.clientX,g.event.clientY];var r=_.merge(this._legendClass.data().map(function(t,e){var i=n._id(t,e);if(!(i instanceof Array))i=[i];return i})).length;if(t&&this._tooltip(t,e)){var a=this._id(t,e);if(a instanceof Array)a=a[0];var s=this._translate;this._select.style("cursor","pointer");this._tooltipClass.data([i||t]).footer(this._solo.length&&!this._solo.includes(a)?s("Click to Highlight"):this._solo.length===1&&this._solo.includes(a)||this._hidden.length===r-1?s("Click to Reset"):this._solo.includes(a)?s("Click to Hide"):this._hidden.includes(a)?s("Click to Highlight"):"".concat(s("Click to Highlight"),"<br />").concat(s("Shift+Click to Hide"))).title(this._legendConfig.label?this._legendClass.label():Y.bind(this)).position(o).config(m.configPrep.bind(this)(this._tooltipConfig)).config(m.configPrep.bind(this)(this._legendTooltip)).render()}}function st(t,e,i){if(t&&this._tooltip(t,e)){this._select.style("cursor","pointer");var n=g.event.touches?[g.event.touches[0].clientX,g.event.touches[0].clientY]:[g.event.clientX,g.event.clientY];this._tooltipClass.data([i||t]).footer(this._drawDepth<this._groupBy.length-1?this._translate("Click to Expand"):false).title(this._drawLabel).position(n).config(m.configPrep.bind(this)(this._tooltipConfig)).render()}}function lt(t){g.event.preventDefault();g.event.stopPropagation();if(!t)this._tooltipClass.data([]).render()}var ht=false;function ct(){if(!this._container||!this._zoomGroup)return;var t=this._zoomHeight||this._height-this._margin.top-this._margin.bottom,e=this,i=this._zoomWidth||this._width-this._margin.left-this._margin.right;this._zoomBehavior.extent([[0,0],[i,t]]).scaleExtent([1,this._zoomMax]).translateExtent([[0,0],[i,t]]).on("zoom",dt.bind(this));this._zoomToBounds=_t.bind(this);var n=g.select(this._select.node().parentNode).selectAll("div.d3plus-zoom-control").data(this._zoom?[0]:[]);var o=n.enter().append("div").attr("class","d3plus-zoom-control");n.exit().remove();n=n.merge(o).style("position","absolute").style("top","".concat(this._margin.top,"px")).style("left","".concat(this._margin.left,"px"));o.append("div").attr("class","zoom-control zoom-in");n.select(".zoom-in").on("click",ft.bind(this,this._zoomFactor)).html("&#65291;");o.append("div").attr("class","zoom-control zoom-out");n.select(".zoom-out").on("click",ft.bind(this,1/this._zoomFactor)).html("&#65293;");o.append("div").attr("class","zoom-control zoom-reset");n.select(".zoom-reset").on("click",ft.bind(this,0)).html("&#8634");o.append("div").attr("class","zoom-control zoom-brush");n.select(".zoom-brush").on("click",function(){g.select(this).classed("active",!ht).call(m.stylize,ht?e._zoomControlStyle||{}:e._zoomControlStyleActive||{});ut.bind(e)(!ht)}).html("&#164");n.selectAll(".zoom-control").call(m.stylize,e._zoomControlStyle).on("mouseenter",function(){g.select(this).call(m.stylize,e._zoomControlStyleHover||{})}).on("mouseleave",function(){g.select(this).call(m.stylize,g.select(this).classed("active")?e._zoomControlStyleActive||{}:e._zoomControlStyle||{})});this._zoomBrush.extent([[0,0],[i,t]]).filter(function(){return!g.event.button&&g.event.detail<2}).handleSize(this._zoomBrushHandleSize).on("start",pt.bind(this)).on("brush",gt.bind(this)).on("end",vt.bind(this));var r=this._container.selectAll("g.brush").data([0]);this._brushGroup=r.enter().append("g").attr("class","brush").merge(r).call(this._zoomBrush);ut.bind(this)();if(this._renderTiles)this._renderTiles(f.zoomTransform(this._container.node()),0)}function ut(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;ht=t;if(ht)this._brushGroup.style("display","inline");else this._brushGroup.style("display","none");if(!ht&&this._zoom){this._container.call(this._zoomBehavior);if(!this._zoomScroll){this._container.on("wheel.zoom",null)}if(!this._zoomPan){this._container.on("mousedown.zoom mousemove.zoom",null).on("touchstart.zoom touchmove.zoom touchend.zoom touchcancel.zoom",null)}}else{this._container.on(".zoom",null)}}function dt(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;if(this._zoomGroup){if(!e)this._zoomGroup.attr("transform",t||g.event.transform);else this._zoomGroup.transition().duration(e).attr("transform",t||g.event.transform)}if(this._renderTiles)this._renderTiles(f.zoomTransform(this._container.node()),e)}function ft(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;if(!this._container)return;var e=this._zoomBehavior.extent().bind(document)()[1].map(function(t){return t/2}),i=this._zoomBehavior.scaleExtent(),n=f.zoomTransform(this._container.node());if(!t){n.k=i[0];n.x=0;n.y=0}else{var o=[(e[0]-n.x)/n.k,(e[1]-n.y)/n.k];n.k=Math.min(i[1],n.k*t);if(n.k<=i[0]){n.k=i[0];n.x=0;n.y=0}else{n.x+=e[0]-(o[0]*n.k+n.x);n.y+=e[1]-(o[1]*n.k+n.y)}}dt.bind(this)(n,this._duration)}function _t(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this._duration;var i=this._zoomBehavior.scaleExtent(),n=f.zoomTransform(this._container.node());if(t){var o=M(this._zoomBehavior.translateExtent()[1],2),r=o[0],a=o[1],s=t[1][0]-t[0][0],l=t[1][1]-t[0][1];var h=Math.min(i[1],1/Math.max(s/r,l/a));var c,u;if(s/l<r/a){h*=(a-this._zoomPadding*2)/a;c=(r-s*h)/2/h;u=this._zoomPadding/h}else{h*=(r-this._zoomPadding*2)/r;u=(a-l*h)/2/h;c=this._zoomPadding/h}n.x=(n.x-t[0][0]+c)*(n.k*h/n.k);n.y=(n.y-t[0][1]+u)*(n.k*h/n.k);n.k*=h;if(n.x>0)n.x=0;else if(n.x<r*-n.k+r)n.x=r*-n.k+r;if(n.y>0)n.y=0;else if(n.y<a*-n.k+a)n.y=a*-n.k+a}else{n.k=i[0];n.x=0;n.y=0}dt.bind(this)(n,e)}function gt(){mt.bind(this)()}function vt(){if(!g.event.selection)return;this._brushGroup.call(this._zoomBrush.move,null);_t.bind(this)(g.event.selection)}function pt(){mt.bind(this)()}function mt(){this._brushGroup.selectAll(".selection").call(m.attrize,this._zoomBrushSelectionStyle||{});this._brushGroup.selectAll(".handle").call(m.attrize,this._zoomBrushHandleStyle||{})}function yt(){return typeof window!=="undefined"?window.innerWidth>600:true}function bt(n){return n.reduce(function(t,e,i){if(!i)t+=e;else if(i===n.length-1&&i===1)t+=" and ".concat(e);else if(i===n.length-1)t+=", and ".concat(e);else t+=", ".concat(e);return t},"")}var Ct=function(t){O(e,t);function e(){var s;x(this,e);s=B(this,T(e).call(this));s._aggs={};s._ariaHidden=true;s._backClass=(new c.TextBox).on("click",function(){if(s._history.length)s.config(s._history.pop()).render();else s.depth(s._drawDepth-1).filter(false).render()}).on("mousemove",function(){return s._backClass.select().style("cursor","pointer")});s._backConfig={fontSize:10,padding:5,resize:false};s._cache=true;s._color=function(t,e){return s._groupBy[0](t,e)};s._colorScaleClass=new a.ColorScale;s._colorScaleConfig={};s._colorScalePadding=yt;s._colorScalePosition="bottom";s._colorScaleMaxSize=600;var t=new r.Select;s._controlCache={};s._controlConfig={selectStyle:Object.assign({margin:"5px"},t.selectStyle())};s._controlPadding=yt;s._data=[];s._dataCutoff=100;s._detectResize=true;s._detectResizeDelay=400;s._detectVisible=true;s._detectVisibleInterval=1e3;s._downloadButton=false;s._downloadConfig={type:"png"};s._downloadPosition="top";s._duration=600;s._hidden=[];s._hiddenColor=m.constant("#aaa");s._hiddenOpacity=m.constant(.5);s._history=[];s._groupBy=[m.accessor("id")];s._legend=true;s._legendClass=new a.Legend;s._legendConfig={label:Y.bind(D(s)),shapeConfig:{ariaLabel:Y.bind(D(s)),labelConfig:{fontColor:undefined,fontResize:false,padding:0}}};s._legendCutoff=1;s._legendPadding=yt;s._legendPosition="bottom";s._legendSort=function(t,e){return s._drawLabel(t).localeCompare(s._drawLabel(e))};s._legendTooltip={};s._loadingHTML=function(){return"\n    <div style=\"left: 50%; top: 50%; position: absolute; transform: translate(-50%, -50%); font-family: 'Roboto', 'Helvetica Neue', Helvetica, Arial, sans-serif;\">\n      <strong>".concat(s._translate("Loading Visualization"),'</strong>\n      <sub style="bottom: 0; display: block; line-height: 1; margin-top: 5px;"><a href="https://d3plus.org" target="_blank">').concat(s._translate("Powered by D3plus"),"</a></sub>\n    </div>")};s._loadingMessage=true;s._lrucache=n(10);s._messageClass=new R;s._messageMask="rgba(0, 0, 0, 0.05)";s._messageStyle={bottom:"0",left:"0",position:"absolute",right:"0","text-align":"center",top:"0"};s._noDataHTML=function(){return"\n    <div style=\"left: 50%; top: 50%; position: absolute; transform: translate(-50%, -50%); font-family: 'Roboto', 'Helvetica Neue', Helvetica, Arial, sans-serif;\">\n      <strong>".concat(s._translate("No Data Available"),"</strong>\n    </div>")};s._noDataMessage=true;s._on={"click.shape":et.bind(D(s)),"click.legend":it.bind(D(s)),mouseenter:ot.bind(D(s)),mouseleave:rt.bind(D(s)),"mousemove.shape":st.bind(D(s)),"mousemove.legend":at.bind(D(s))};s._queue=[];s._scrollContainer=(typeof window==="undefined"?"undefined":S(window))===undefined?"":window;s._shape=m.constant("Rect");s._shapes=[];s._shapeConfig={ariaLabel:function t(e,i){return s._drawLabel(e,i)},fill:function t(e,i){while(e.__d3plus__&&e.data){e=e.data;i=e.i}if(s._colorScale){var n=s._colorScale(e,i);if(n!==undefined&&n!==null){var o=s._colorScaleClass._colorScale;var r=s._colorScaleClass.color();if(!o)return r instanceof Array?r[r.length-1]:r;else if(!o.domain().length)return o.range()[o.range().length-1];return o(n)}}var a=s._color(e,i);if(l.color(a))return a;return h.colorAssign(a)},labelConfig:{fontColor:function t(e,i){var n=typeof s._shapeConfig.fill==="function"?s._shapeConfig.fill(e,i):s._shapeConfig.fill;return h.colorContrast(n)}},opacity:m.constant(1),stroke:function t(e,i){var n=typeof s._shapeConfig.fill==="function"?s._shapeConfig.fill(e,i):s._shapeConfig.fill;return l.color(n).darker()},role:"presentation",strokeWidth:m.constant(0)};s._solo=[];s._svgDesc="";s._svgTitle="";s._timeline=true;s._timelineClass=(new b.Timeline).align("end");s._timelineConfig={brushing:false,padding:5};s._timelinePadding=yt;s._threshold=m.constant(1e-4);s._thresholdKey=undefined;s._thresholdName=function(){return s._translate("Values")};s._titleClass=new c.TextBox;s._titleConfig={ariaHidden:true,fontSize:12,padding:5,resize:false,textAnchor:"middle"};s._titlePadding=yt;s._tooltip=m.constant(true);s._tooltipClass=new C.Tooltip;s._tooltipConfig={pointerEvents:"none",titleStyle:{"max-width":"200px"}};s._totalClass=new c.TextBox;s._totalConfig={fontSize:10,padding:5,resize:false,textAnchor:"middle"};s._totalFormat=function(t){return"".concat(s._translate("Total"),": ").concat(y.formatAbbreviate(t,s._locale))};s._totalPadding=yt;s._zoom=false;s._zoomBehavior=f.zoom();s._zoomBrush=i.brush();s._zoomBrushHandleSize=1;s._zoomBrushHandleStyle={fill:"#444"};s._zoomBrushSelectionStyle={fill:"#777","stroke-width":0};s._zoomControlStyle={background:"rgba(255, 255, 255, 0.75)",border:"1px solid rgba(0, 0, 0, 0.75)",color:"rgba(0, 0, 0, 0.75)",display:"block",font:"900 15px/21px 'Roboto', 'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",height:"20px",margin:"5px",opacity:.75,padding:0,"text-align":"center",width:"20px"};s._zoomControlStyleActive={background:"rgba(0, 0, 0, 0.75)",color:"rgba(255, 255, 255, 0.75)",opacity:1};s._zoomControlStyleHover={cursor:"pointer",opacity:1};s._zoomFactor=2;s._zoomMax=16;s._zoomPadding=20;s._zoomPan=true;s._zoomScroll=true;return s}P(e,[{key:"_preDraw",value:function t(){var r=this;var a=this;this._drawDepth=this._depth!==void 0?this._depth:this._groupBy.length-1;this._id=this._groupBy[this._drawDepth];this._ids=function(e,i){return r._groupBy.map(function(t){return!e||e.__d3plus__&&!e.data?undefined:t(e.__d3plus__?e.data:e,e.__d3plus__?e.i:i)}).filter(function(t){return t!==undefined&&t!==null})};this._drawLabel=function(t,e){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:r._drawDepth;if(!t)return"";if(t._isAggregation){return"".concat(r._thresholdName(t,e)," < ").concat(y.formatAbbreviate(t._threshold*100,r._locale),"%")}while(t.__d3plus__&&t.data){t=t.data;e=t.i}if(r._label)return"".concat(r._label(t,e));var n=a._ids(t,e).slice(0,i+1);var o=n.reverse().find(function(t){return!(t instanceof Array)})||n[n.length-1];return o instanceof Array?bt(o):"".concat(o)};if(this._time&&!this._timeFilter&&this._data.length){var e=this._data.map(this._time).map(v.date);var i=this._data[0],n=0;if(this._discrete&&"_".concat(this._discrete)in this&&this["_".concat(this._discrete)](i,n)===this._time(i,n)){this._timeFilter=function(){return true}}else{var o=+_.max(e);this._timeFilter=function(t,e){return+v.date(r._time(t,e))===o}}}this._filteredData=[];this._legendData=[];var s=[];if(this._data.length){s=this._timeFilter?this._data.filter(this._timeFilter):this._data;if(this._filter)s=s.filter(this._filter);var l=p.nest();for(var h=0;h<=this._drawDepth;h++){l.key(this._groupBy[h])}if(this._discrete&&"_".concat(this._discrete)in this)l.key(this["_".concat(this._discrete)]);if(this._discrete&&"_".concat(this._discrete,"2")in this)l.key(this["_".concat(this._discrete,"2")]);var c=l.rollup(function(t){var e=r._data.indexOf(t[0]);var i=r._shape(t[0],e);var n=r._id(t[0],e);var o=m.merge(t,r._aggs);if(!r._hidden.includes(n)&&(!r._solo.length||r._solo.includes(n))){if(!r._discrete&&i==="Line")r._filteredData=r._filteredData.concat(t);else r._filteredData.push(o)}r._legendData.push(o)}).entries(s);this._filteredData=this._thresholdFunction(this._filteredData,c)}var u=p.nest().key(this._id).entries(this._filteredData).length;if(u>this._dataCutoff){if(this._userHover===undefined)this._userHover=this._shapeConfig.hoverOpacity||.5;if(this._userDuration===undefined)this._userDuration=this._shapeConfig.duration||600;this._shapeConfig.hoverOpacity=1;this._shapeConfig.duration=0}else if(this._userHover!==undefined){this._shapeConfig.hoverOpacity=this._userHover;this._shapeConfig.duration=this._userDuration}if(this._noDataMessage&&!this._filteredData.length){this._messageClass.render({container:this._select.node().parentNode,html:this._noDataHTML(this),mask:false,style:this._messageStyle})}}},{key:"_draw",value:function t(){if(this._legendPosition==="left"||this._legendPosition==="right")K.bind(this)(this._filteredData);if(this._colorScalePosition==="left"||this._colorScalePosition==="right"||this._colorScalePosition===false)I.bind(this)(this._filteredData);V.bind(this)();Q.bind(this)(this._filteredData);U.bind(this)(this._filteredData);J.bind(this)(this._filteredData);W.bind(this)(this._filteredData);if(this._legendPosition==="top"||this._legendPosition==="bottom")K.bind(this)(this._legendData);if(this._colorScalePosition==="top"||this._colorScalePosition==="bottom")I.bind(this)(this._filteredData);this._shapes=[]}},{key:"_thresholdFunction",value:function t(e){return e}},{key:"render",value:function t(r){var a=this;this._margin={bottom:0,left:0,right:0,top:0};this._padding={bottom:0,left:0,right:0,top:0};this._transition=d.transition().duration(this._duration);if(this._select===void 0||this._select.node().tagName.toLowerCase()!=="svg"){var e=this._select===void 0?g.select("body").append("div"):this._select;var i=e.append("svg");this.select(i.node())}function s(){var t=this._select.style("display");this._select.style("display","none");var e=$(this._select.node().parentNode),i=M(e,2),n=i[0],o=i[1];n-=parseFloat(this._select.style("border-left-width"),10);n-=parseFloat(this._select.style("border-right-width"),10);o-=parseFloat(this._select.style("border-top-width"),10);o-=parseFloat(this._select.style("border-bottom-width"),10);this._select.style("display",t);if(this._autoWidth){this.width(n);this._select.style("width","".concat(this._width,"px")).attr("width","".concat(this._width,"px"))}if(this._autoHeight){this.height(o);this._select.style("height","".concat(this._height,"px")).attr("height","".concat(this._height,"px"))}}if((!this._width||!this._height)&&(!this._detectVisible||tt(this._select.node()))){this._autoWidth=this._width===undefined;this._autoHeight=this._height===undefined;s.bind(this)()}this._select.attr("class","d3plus-viz").attr("aria-hidden",this._ariaHidden).attr("aria-labelledby","".concat(this._uuid,"-title ").concat(this._uuid,"-desc")).attr("role","img").attr("xmlns","http://www.w3.org/2000/svg").attr("xmlns:xlink","http://www.w3.org/1999/xlink").transition(d.transition).style("width",this._width!==undefined?"".concat(this._width,"px"):undefined).style("height",this._height!==undefined?"".concat(this._height,"px"):undefined).attr("width",this._width!==undefined?"".concat(this._width,"px"):undefined).attr("height",this._height!==undefined?"".concat(this._height,"px"):undefined);var n=this._select.selectAll("title").data([0]);var o=n.enter().append("title").attr("id","".concat(this._uuid,"-title"));n.merge(o).text(this._svgTitle);var l=this._select.selectAll("desc").data([0]);var h=l.enter().append("desc").attr("id","".concat(this._uuid,"-desc"));l.merge(h).text(this._svgDesc);this._visiblePoll=clearInterval(this._visiblePoll);this._resizePoll=clearTimeout(this._resizePoll);this._scrollPoll=clearTimeout(this._scrollPoll);g.select(this._scrollContainer).on("scroll.".concat(this._uuid),null);g.select(this._scrollContainer).on("resize.".concat(this._uuid),null);if(this._detectVisible&&this._select.style("visibility")==="hidden"){this._visiblePoll=setInterval(function(){if(a._select.style("visibility")!=="hidden"){a._visiblePoll=clearInterval(a._visiblePoll);a.render(r)}},this._detectVisibleInterval)}else if(this._detectVisible&&this._select.style("display")==="none"){this._visiblePoll=setInterval(function(){if(a._select.style("display")!=="none"){a._visiblePoll=clearInterval(a._visiblePoll);a.render(r)}},this._detectVisibleInterval)}else if(this._detectVisible&&!tt(this._select.node())){g.select(this._scrollContainer).on("scroll.".concat(this._uuid),function(){if(!a._scrollPoll){a._scrollPoll=setTimeout(function(){if(tt(a._select.node())){g.select(a._scrollContainer).on("scroll.".concat(a._uuid),null);a.render(r)}a._scrollPoll=clearTimeout(a._scrollPoll)},a._detectVisibleInterval)}})}else{var c=u.queue();if(this._loadingMessage){this._messageClass.render({container:this._select.node().parentNode,html:this._loadingHTML(this),mask:this._filteredData?this._messageMask:false,style:this._messageStyle})}this._queue.forEach(function(t){var e=a._cache?a._lrucache.get(t[1]):undefined;if(!e)c.defer.apply(c,j(t));else a["_".concat(t[3])]=e});this._queue=[];c.awaitAll(function(){var i=a._data instanceof Array&&a._data.length>0?Object.keys(a._data[0]):[];var t=a._select.selectAll("g.data-table").data(!a._ariaHidden&&a._data instanceof Array&&a._data.length?[0]:[]);var e=t.enter().append("g").attr("class","data-table").attr("role","table");t.exit().remove();var n=t.merge(e).selectAll("text").data(a._data instanceof Array?_.range(0,a._data.length+1):[]);n.exit().remove();var o=n.merge(n.enter().append("text").attr("role","row")).selectAll("tspan").data(function(t,e){return i.map(function(t){return{role:e?"cell":"columnheader",text:e?a._data[e-1][t]:t}})});o.exit().remove();o.merge(o.enter().append("tspan")).attr("role",function(t){return t.role}).attr("dy","-1000px").html(function(t){return t.text});a._preDraw();a._draw(r);ct.bind(a)();if(a._messageClass._isVisible&&(!a._noDataMessage||a._filteredData.length))a._messageClass.hide();if(a._detectResize&&(a._autoWidth||a._autoHeight)){g.select(a._scrollContainer).on("resize.".concat(a._uuid),function(){a._resizePoll=clearTimeout(a._resizePoll);a._resizePoll=setTimeout(function(){a._resizePoll=clearTimeout(a._resizePoll);s.bind(a)();a.render(r)},a._detectResizeDelay)})}if(r)setTimeout(r,a._duration+100)})}g.select("body").on("touchstart.".concat(this._uuid),lt.bind(this));return this}},{key:"active",value:function t(e){this._active=e;if(this._shapeConfig.activeOpacity!==1){this._shapes.forEach(function(t){return t.active(e)});if(this._legend)this._legendClass.active(e)}return this}},{key:"aggs",value:function t(e){return arguments.length?(this._aggs=m.assign(this._aggs,e),this):this._aggs}},{key:"ariaHidden",value:function t(e){return arguments.length?(this._ariaHidden=e,this):this._ariaHidden}},{key:"backConfig",value:function t(e){return arguments.length?(this._backConfig=m.assign(this._backConfig,e),this):this._backConfig}},{key:"cache",value:function t(e){return arguments.length?(this._cache=e,this):this._cache}},{key:"color",value:function t(e){return arguments.length?(this._color=!e||typeof e==="function"?e:m.accessor(e),this):this._color}},{key:"colorScale",value:function t(e){return arguments.length?(this._colorScale=!e||typeof e==="function"?e:m.accessor(e),this):this._colorScale}},{key:"colorScaleConfig",value:function t(e){return arguments.length?(this._colorScaleConfig=m.assign(this._colorScaleConfig,e),this):this._colorScaleConfig}},{key:"colorScalePadding",value:function t(e){return arguments.length?(this._colorScalePadding=typeof e==="function"?e:m.constant(e),this):this._colorScalePadding}},{key:"colorScalePosition",value:function t(e){return arguments.length?(this._colorScalePosition=e,this):this._colorScalePosition}},{key:"colorScaleMaxSize",value:function t(e){return arguments.length?(this._colorScaleMaxSize=e,this):this._colorScaleMaxSize}},{key:"controls",value:function t(e){return arguments.length?(this._controls=e,this):this._controls}},{key:"controlConfig",value:function t(e){return arguments.length?(this._controlConfig=m.assign(this._controlConfig,e),this):this._controlConfig}},{key:"controlPadding",value:function t(e){return arguments.length?(this._controlPadding=typeof e==="function"?e:m.constant(e),this):this._controlPadding}},{key:"data",value:function t(e,i){if(arguments.length){var n=this._queue.find(function(t){return t[3]==="data"});var o=[N.bind(this),e,i,"data"];if(n)this._queue[this._queue.indexOf(n)]=o;else this._queue.push(o);this._hidden=[];this._solo=[];return this}return this._data}},{key:"dataCutoff",value:function t(e){return arguments.length?(this._dataCutoff=e,this):this._dataCutoff}},{key:"depth",value:function t(e){return arguments.length?(this._depth=e,this):this._depth}},{key:"detectResize",value:function t(e){return arguments.length?(this._detectResize=e,this):this._detectResize}},{key:"detectResizeDelay",value:function t(e){return arguments.length?(this._detectResizeDelay=e,this):this._detectResizeDelay}},{key:"detectVisible",value:function t(e){return arguments.length?(this._detectVisible=e,this):this._detectVisible}},{key:"detectVisibleInterval",value:function t(e){return arguments.length?(this._detectVisibleInterval=e,this):this._detectVisibleInterval}},{key:"discrete",value:function t(e){return arguments.length?(this._discrete=e,this):this._discrete}},{key:"downloadButton",value:function t(e){return arguments.length?(this._downloadButton=e,this):this._downloadButton}},{key:"downloadConfig",value:function t(e){return arguments.length?(this._downloadConfig=m.assign(this._downloadConfig,e),this):this._downloadConfig}},{key:"downloadPosition",value:function t(e){return arguments.length?(this._downloadPosition=e,this):this._downloadPosition}},{key:"duration",value:function t(e){return arguments.length?(this._duration=e,this):this._duration}},{key:"filter",value:function t(e){return arguments.length?(this._filter=e,this):this._filter}},{key:"groupBy",value:function t(e){var i=this;if(!arguments.length)return this._groupBy;if(!(e instanceof Array))e=[e];return this._groupBy=e.map(function(t){if(typeof t==="function")return t;else{if(!i._aggs[t]){i._aggs[t]=function(t){var e=m.unique(t);return e.length===1?e[0]:e}}return m.accessor(t)}}),this}},{key:"height",value:function t(e){return arguments.length?(this._height=e,this):this._height}},{key:"hiddenColor",value:function t(e){return arguments.length?(this._hiddenColor=typeof e==="function"?e:m.constant(e),this):this._hiddenColor}},{key:"hiddenOpacity",value:function t(e){return arguments.length?(this._hiddenOpacity=typeof e==="function"?e:m.constant(e),this):this._hiddenOpacity}},{key:"hover",value:function t(e){var n=this;var i=this._hover=e;if(this._shapeConfig.hoverOpacity!==1){if(typeof e==="function"){var o=_.merge(this._shapes.map(function(t){return t.data()}));o=o.concat(this._legendClass.data());var r=e?o.filter(e):[];var a=[];r.map(this._ids).forEach(function(t){for(var e=1;e<=t.length;e++){a.push(JSON.stringify(t.slice(0,e)))}});a=a.filter(function(t,e){return a.indexOf(t)===e});if(a.length)i=function t(e,i){return a.includes(JSON.stringify(n._ids(e,i)))}}this._shapes.forEach(function(t){return t.hover(i)});if(this._legend)this._legendClass.hover(i)}return this}},{key:"label",value:function t(e){return arguments.length?(this._label=typeof e==="function"?e:m.constant(e),this):this._label}},{key:"legend",value:function t(e){return arguments.length?(this._legend=e,this):this._legend}},{key:"legendConfig",value:function t(e){return arguments.length?(this._legendConfig=m.assign(this._legendConfig,e),this):this._legendConfig}},{key:"legendCutoff",value:function t(e){return arguments.length?(this._legendCutoff=e,this):this._legendCutoff}},{key:"legendTooltip",value:function t(e){return arguments.length?(this._legendTooltip=m.assign(this._legendTooltip,e),this):this._legendTooltip}},{key:"legendPadding",value:function t(e){return arguments.length?(this._legendPadding=typeof e==="function"?e:m.constant(e),this):this._legendPadding}},{key:"legendPosition",value:function t(e){return arguments.length?(this._legendPosition=e,this):this._legendPosition}},{key:"legendSort",value:function t(e){return arguments.length?(this._legendSort=e,this):this._legendSort}},{key:"loadingHTML",value:function t(e){return arguments.length?(this._loadingHTML=typeof e==="function"?e:m.constant(e),this):this._loadingHTML}},{key:"loadingMessage",value:function t(e){return arguments.length?(this._loadingMessage=e,this):this._loadingMessage}},{key:"messageMask",value:function t(e){return arguments.length?(this._messageMask=e,this):this._messageMask}},{key:"messageStyle",value:function t(e){return arguments.length?(this._messageStyle=m.assign(this._messageStyle,e),this):this._messageStyle}},{key:"noDataHTML",value:function t(e){return arguments.length?(this._noDataHTML=typeof e==="function"?e:m.constant(e),this):this._noDataHTML}},{key:"noDataMessage",value:function t(e){return arguments.length?(this._noDataMessage=e,this):this._noDataMessage}},{key:"scrollContainer",value:function t(e){return arguments.length?(this._scrollContainer=e,this):this._scrollContainer}},{key:"select",value:function t(e){return arguments.length?(this._select=g.select(e),this):this._select}},{key:"shape",value:function t(e){return arguments.length?(this._shape=typeof e==="function"?e:m.constant(e),this):this._shape}},{key:"shapeConfig",value:function t(e){return arguments.length?(this._shapeConfig=m.assign(this._shapeConfig,e),this):this._shapeConfig}},{key:"svgDesc",value:function t(e){return arguments.length?(this._svgDesc=e,this):this._svgDesc}},{key:"svgTitle",value:function t(e){return arguments.length?(this._svgTitle=e,this):this._svgTitle}},{key:"threshold",value:function t(e){if(arguments.length){if(typeof e==="function"){this._threshold=e}else if(isFinite(e)&&!isNaN(e)){this._threshold=m.constant(e*1)}return this}else return this._threshold}},{key:"thresholdKey",value:function t(e){if(arguments.length){if(typeof e==="function"){this._thresholdKey=e}else{this._thresholdKey=m.accessor(e)}return this}else return this._thresholdKey}},{key:"thresholdName",value:function t(e){return arguments.length?(this._thresholdName=typeof e==="function"?e:m.constant(e),this):this._thresholdName}},{key:"time",value:function t(e){if(arguments.length){if(typeof e==="function"){this._time=e}else{this._time=m.accessor(e);if(!this._aggs[e]){this._aggs[e]=function(t){var e=m.unique(t);return e.length===1?e[0]:e}}}this._timeFilter=false;return this}else return this._time}},{key:"timeFilter",value:function t(e){return arguments.length?(this._timeFilter=e,this):this._timeFilter}},{key:"timeline",value:function t(e){return arguments.length?(this._timeline=e,this):this._timeline}},{key:"timelineConfig",value:function t(e){return arguments.length?(this._timelineConfig=m.assign(this._timelineConfig,e),this):this._timelineConfig}},{key:"timelinePadding",value:function t(e){return arguments.length?(this._timelinePadding=typeof e==="function"?e:m.constant(e),this):this._timelinePadding}},{key:"title",value:function t(e){return arguments.length?(this._title=typeof e==="function"?e:m.constant(e),this):this._title}},{key:"titleConfig",value:function t(e){return arguments.length?(this._titleConfig=m.assign(this._titleConfig,e),this):this._titleConfig}},{key:"titlePadding",value:function t(e){return arguments.length?(this._titlePadding=typeof e==="function"?e:m.constant(e),this):this._titlePadding}},{key:"tooltip",value:function t(e){return arguments.length?(this._tooltip=typeof e==="function"?e:m.constant(e),this):this._tooltip}},{key:"tooltipConfig",value:function t(e){return arguments.length?(this._tooltipConfig=m.assign(this._tooltipConfig,e),this):this._tooltipConfig}},{key:"total",value:function t(e){if(arguments.length){if(typeof e==="function")this._total=e;else if(e)this._total=m.accessor(e);else this._total=false;return this}else return this._total}},{key:"totalConfig",value:function t(e){return arguments.length?(this._totalConfig=m.assign(this._totalConfig,e),this):this._totalConfig}},{key:"totalFormat",value:function t(e){return arguments.length?(this._totalFormat=e,this):this._totalFormat}},{key:"totalPadding",value:function t(e){return arguments.length?(this._totalPadding=typeof e==="function"?e:m.constant(e),this):this._totalPadding}},{key:"width",value:function t(e){return arguments.length?(this._width=e,this):this._width}},{key:"zoom",value:function t(e){return arguments.length?(this._zoom=e,this):this._zoom}},{key:"zoomBrushHandleSize",value:function t(e){return arguments.length?(this._zoomBrushHandleSize=e,this):this._zoomBrushHandleSize}},{key:"zoomBrushHandleStyle",value:function t(e){return arguments.length?(this._zoomBrushHandleStyle=e,this):this._zoomBrushHandleStyle}},{key:"zoomBrushSelectionStyle",value:function t(e){return arguments.length?(this._zoomBrushSelectionStyle=e,this):this._zoomBrushSelectionStyle}},{key:"zoomControlStyle",value:function t(e){return arguments.length?(this._zoomControlStyle=e,this):this._zoomControlStyle}},{key:"zoomControlStyleActive",value:function t(e){return arguments.length?(this._zoomControlStyleActive=e,this):this._zoomControlStyleActive}},{key:"zoomControlStyleHover",value:function t(e){return arguments.length?(this._zoomControlStyleHover=e,this):this._zoomControlStyleHover}},{key:"zoomFactor",value:function t(e){return arguments.length?(this._zoomFactor=e,this):this._zoomFactor}},{key:"zoomMax",value:function t(e){return arguments.length?(this._zoomMax=e,this):this._zoomMax}},{key:"zoomPan",value:function t(e){return arguments.length?(this._zoomPan=e,this):this._zoomPan}},{key:"zoomPadding",value:function t(e){return arguments.length?(this._zoomPadding=e,this):this._zoomPadding}},{key:"zoomScroll",value:function t(e){return arguments.length?(this._zoomScroll=e,this):this._zoomScroll}}]);return e}(m.BaseClass);t.Viz=Ct;t.dataConcat=k;t.dataFold=z;t.dataLoad=N;Object.defineProperty(t,"__esModule",{value:true})});