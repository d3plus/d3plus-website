/*
  d3plus-geomap v0.7.0
  A reusable geo map built on D3 and Topojson
  Copyright (c) 2020 D3plus - https://d3plus.org
  @license MIT
*/
(function(t){typeof define==="function"&&define.amd?define(t):t()})(function(){"use strict";var t=typeof globalThis!=="undefined"?globalThis:typeof window!=="undefined"?window:typeof global!=="undefined"?global:typeof self!=="undefined"?self:{};function e(t,e){return e={exports:{}},t(e,e.exports),e.exports}var r=function(t){return t&&t.Math==Math&&t};var l=r(typeof globalThis=="object"&&globalThis)||r(typeof window=="object"&&window)||r(typeof self=="object"&&self)||r(typeof t=="object"&&t)||Function("return this")();var a=function(t){try{return!!t()}catch(t){return true}};var h=!a(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7});var n={}.propertyIsEnumerable;var i=Object.getOwnPropertyDescriptor;var o=i&&!n.call({1:2},1);var u=o?function t(e){var r=i(this,e);return!!r&&r.enumerable}:n;var d={f:u};var s=function(t,e){return{enumerable:!(t&1),configurable:!(t&2),writable:!(t&4),value:e}};var c={}.toString;var f=function(t){return c.call(t).slice(8,-1)};var p="".split;var b=a(function(){return!Object("z").propertyIsEnumerable(0)})?function(t){return f(t)=="String"?p.call(t,""):Object(t)}:Object;var v=function(t){if(t==undefined)throw TypeError("Can't call method on "+t);return t};var g=function(t){return b(v(t))};var y=function(t){return typeof t==="object"?t!==null:typeof t==="function"};var _=function(t,e){if(!y(t))return t;var r,n;if(e&&typeof(r=t.toString)=="function"&&!y(n=r.call(t)))return n;if(typeof(r=t.valueOf)=="function"&&!y(n=r.call(t)))return n;if(!e&&typeof(r=t.toString)=="function"&&!y(n=r.call(t)))return n;throw TypeError("Can't convert object to primitive value")};var m={}.hasOwnProperty;var j=function(t,e){return m.call(t,e)};var S=l.document;var w=y(S)&&y(S.createElement);var O=function(t){return w?S.createElement(t):{}};var x=!h&&!a(function(){return Object.defineProperty(O("div"),"a",{get:function(){return 7}}).a!=7});var k=Object.getOwnPropertyDescriptor;var z=h?k:function t(e,r){e=g(e);r=_(r,true);if(x)try{return k(e,r)}catch(t){}if(j(e,r))return s(!d.f.call(e,r),e[r])};var P={f:z};var C=function(t){if(!y(t)){throw TypeError(String(t)+" is not an object")}return t};var E=Object.defineProperty;var M=h?E:function t(e,r,n){C(e);r=_(r,true);C(n);if(x)try{return E(e,r,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");if("value"in n)e[r]=n.value;return e};var A={f:M};var F=h?function(t,e,r){return A.f(t,e,s(1,r))}:function(t,e,r){t[e]=r;return t};var G=function(e,r){try{F(l,e,r)}catch(t){l[e]=r}return r};var T="__core-js_shared__";var q=l[T]||G(T,{});var D=q;var R=Function.toString;if(typeof D.inspectSource!="function"){D.inspectSource=function(t){return R.call(t)}}var I=D.inspectSource;var L=l.WeakMap;var B=typeof L==="function"&&/native code/.test(I(L));var N=e(function(t){(t.exports=function(t,e){return D[t]||(D[t]=e!==undefined?e:{})})("versions",[]).push({version:"3.6.5",mode:"global",copyright:"© 2020 Denis Pushkarev (zloirock.ru)"})});var K=0;var V=Math.random();var W=function(t){return"Symbol("+String(t===undefined?"":t)+")_"+(++K+V).toString(36)};var U=N("keys");var H=function(t){return U[t]||(U[t]=W(t))};var Y={};var X=l.WeakMap;var Z,$,J;var Q=function(t){return J(t)?$(t):Z(t,{})};var tt=function(r){return function(t){var e;if(!y(t)||(e=$(t)).type!==r){throw TypeError("Incompatible receiver, "+r+" required")}return e}};if(B){var et=new X;var rt=et.get;var nt=et.has;var it=et.set;Z=function(t,e){it.call(et,t,e);return e};$=function(t){return rt.call(et,t)||{}};J=function(t){return nt.call(et,t)}}else{var ot=H("state");Y[ot]=true;Z=function(t,e){F(t,ot,e);return e};$=function(t){return j(t,ot)?t[ot]:{}};J=function(t){return j(t,ot)}}var at={set:Z,get:$,has:J,enforce:Q,getterFor:tt};var ut=e(function(t){var e=at.get;var u=at.enforce;var s=String(String).split("String");(t.exports=function(t,e,r,n){var i=n?!!n.unsafe:false;var o=n?!!n.enumerable:false;var a=n?!!n.noTargetGet:false;if(typeof r=="function"){if(typeof e=="string"&&!j(r,"name"))F(r,"name",e);u(r).source=s.join(typeof e=="string"?e:"")}if(t===l){if(o)t[e]=r;else G(e,r);return}else if(!i){delete t[e]}else if(!a&&t[e]){o=true}if(o)t[e]=r;else F(t,e,r)})(Function.prototype,"toString",function t(){return typeof this=="function"&&e(this).source||I(this)})});var st=l;var ct=function(t){return typeof t=="function"?t:undefined};var ft=function(t,e){return arguments.length<2?ct(st[t])||ct(l[t]):st[t]&&st[t][e]||l[t]&&l[t][e]};var lt=Math.ceil;var pt=Math.floor;var ht=function(t){return isNaN(t=+t)?0:(t>0?pt:lt)(t)};var dt=Math.min;var vt=function(t){return t>0?dt(ht(t),9007199254740991):0};var gt=Math.max;var yt=Math.min;var _t=function(t,e){var r=ht(t);return r<0?gt(r+e,0):yt(r,e)};var mt=function(u){return function(t,e,r){var n=g(t);var i=vt(n.length);var o=_t(r,i);var a;if(u&&e!=e)while(i>o){a=n[o++];if(a!=a)return true}else for(;i>o;o++){if((u||o in n)&&n[o]===e)return u||o||0}return!u&&-1}};var bt={includes:mt(true),indexOf:mt(false)};var jt=bt.indexOf;var St=function(t,e){var r=g(t);var n=0;var i=[];var o;for(o in r)!j(Y,o)&&j(r,o)&&i.push(o);while(e.length>n)if(j(r,o=e[n++])){~jt(i,o)||i.push(o)}return i};var wt=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"];var Ot=wt.concat("length","prototype");var xt=Object.getOwnPropertyNames||function t(e){return St(e,Ot)};var kt={f:xt};var zt=Object.getOwnPropertySymbols;var Pt={f:zt};var Ct=ft("Reflect","ownKeys")||function t(e){var r=kt.f(C(e));var n=Pt.f;return n?r.concat(n(e)):r};var Et=function(t,e){var r=Ct(e);var n=A.f;var i=P.f;for(var o=0;o<r.length;o++){var a=r[o];if(!j(t,a))n(t,a,i(e,a))}};var Mt=/#|\.prototype\./;var At=function(t,e){var r=Gt[Ft(t)];return r==qt?true:r==Tt?false:typeof e=="function"?a(e):!!e};var Ft=At.normalize=function(t){return String(t).replace(Mt,".").toLowerCase()};var Gt=At.data={};var Tt=At.NATIVE="N";var qt=At.POLYFILL="P";var Dt=At;var Rt=P.f;var It=function(t,e){var r=t.target;var n=t.global;var i=t.stat;var o,a,u,s,c,f;if(n){a=l}else if(i){a=l[r]||G(r,{})}else{a=(l[r]||{}).prototype}if(a)for(u in e){c=e[u];if(t.noTargetGet){f=Rt(a,u);s=f&&f.value}else s=a[u];o=Dt(n?u:r+(i?".":"#")+u,t.forced);if(!o&&s!==undefined){if(typeof c===typeof s)continue;Et(c,s)}if(t.sham||s&&s.sham){F(c,"sham",true)}ut(a,u,c,t)}};var Lt=function(t){if(typeof t!="function"){throw TypeError(String(t)+" is not a function")}return t};var Bt=function(n,i,t){Lt(n);if(i===undefined)return n;switch(t){case 0:return function(){return n.call(i)};case 1:return function(t){return n.call(i,t)};case 2:return function(t,e){return n.call(i,t,e)};case 3:return function(t,e,r){return n.call(i,t,e,r)}}return function(){return n.apply(i,arguments)}};var Nt=function(t){return Object(v(t))};var Kt=Array.isArray||function t(e){return f(e)=="Array"};var Vt=!!Object.getOwnPropertySymbols&&!a(function(){return!String(Symbol())});var Wt=Vt&&!Symbol.sham&&typeof Symbol.iterator=="symbol";var Ut=N("wks");var Ht=l.Symbol;var Yt=Wt?Ht:Ht&&Ht.withoutSetter||W;var Xt=function(t){if(!j(Ut,t)){if(Vt&&j(Ht,t))Ut[t]=Ht[t];else Ut[t]=Yt("Symbol."+t)}return Ut[t]};var Zt=Xt("species");var $t=function(t,e){var r;if(Kt(t)){r=t.constructor;if(typeof r=="function"&&(r===Array||Kt(r.prototype)))r=undefined;else if(y(r)){r=r[Zt];if(r===null)r=undefined}}return new(r===undefined?Array:r)(e===0?0:e)};var Jt=[].push;var Qt=function(h){var d=h==1;var v=h==2;var g=h==3;var y=h==4;var _=h==6;var m=h==5||_;return function(t,e,r,n){var i=Nt(t);var o=b(i);var a=Bt(e,r,3);var u=vt(o.length);var s=0;var c=n||$t;var f=d?c(t,u):v?c(t,0):undefined;var l,p;for(;u>s;s++)if(m||s in o){l=o[s];p=a(l,s,i);if(h){if(d)f[s]=p;else if(p)switch(h){case 3:return true;case 5:return l;case 6:return s;case 2:Jt.call(f,l)}else if(y)return false}}return _?-1:g||y?y:f}};var te={forEach:Qt(0),map:Qt(1),filter:Qt(2),some:Qt(3),every:Qt(4),find:Qt(5),findIndex:Qt(6)};var ee=Object.keys||function t(e){return St(e,wt)};var re=h?Object.defineProperties:function t(e,r){C(e);var n=ee(r);var i=n.length;var o=0;var a;while(i>o)A.f(e,a=n[o++],r[a]);return e};var ne=ft("document","documentElement");var ie=">";var oe="<";var ae="prototype";var ue="script";var se=H("IE_PROTO");var ce=function(){};var fe=function(t){return oe+ue+ie+t+oe+"/"+ue+ie};var le=function(t){t.write(fe(""));t.close();var e=t.parentWindow.Object;t=null;return e};var pe=function(){var t=O("iframe");var e="java"+ue+":";var r;t.style.display="none";ne.appendChild(t);t.src=String(e);r=t.contentWindow.document;r.open();r.write(fe("document.F=Object"));r.close();return r.F};var he;var de=function(){try{he=document.domain&&new ActiveXObject("htmlfile")}catch(t){}de=he?le(he):pe();var t=wt.length;while(t--)delete de[ae][wt[t]];return de()};Y[se]=true;var ve=Object.create||function t(e,r){var n;if(e!==null){ce[ae]=C(e);n=new ce;ce[ae]=null;n[se]=e}else n=de();return r===undefined?n:re(n,r)};var ge=Xt("unscopables");var ye=Array.prototype;if(ye[ge]==undefined){A.f(ye,ge,{configurable:true,value:ve(null)})}var _e=function(t){ye[ge][t]=true};var me=Object.defineProperty;var be={};var je=function(t){throw t};var Se=function(t,e){if(j(be,t))return be[t];if(!e)e={};var r=[][t];var n=j(e,"ACCESSORS")?e.ACCESSORS:false;var i=j(e,0)?e[0]:je;var o=j(e,1)?e[1]:undefined;return be[t]=!!r&&!a(function(){if(n&&!h)return true;var t={length:-1};if(n)me(t,1,{enumerable:true,get:je});else t[1]=1;r.call(t,i,o)})};var we=te.find;var Oe="find";var xe=true;var ke=Se(Oe);if(Oe in[])Array(1)[Oe](function(){xe=false});It({target:"Array",proto:true,forced:xe||!ke},{find:function t(e){return we(this,e,arguments.length>1?arguments[1]:undefined)}});_e(Oe);var ze=bt.includes;var Pe=Se("indexOf",{ACCESSORS:true,1:0});It({target:"Array",proto:true,forced:!Pe},{includes:function t(e){return ze(this,e,arguments.length>1?arguments[1]:undefined)}});_e("includes");var Ce=Object.assign;var Ee=Object.defineProperty;var Me=!Ce||a(function(){if(h&&Ce({b:1},Ce(Ee({},"a",{enumerable:true,get:function(){Ee(this,"b",{value:3,enumerable:false})}}),{b:2})).b!==1)return true;var t={};var e={};var r=Symbol();var n="abcdefghijklmnopqrst";t[r]=7;n.split("").forEach(function(t){e[t]=t});return Ce({},t)[r]!=7||ee(Ce({},e)).join("")!=n})?function t(e,r){var n=Nt(e);var i=arguments.length;var o=1;var a=Pt.f;var u=d.f;while(i>o){var s=b(arguments[o++]);var c=a?ee(s).concat(a(s)):ee(s);var f=c.length;var l=0;var p;while(f>l){p=c[l++];if(!h||u.call(s,p))n[p]=s[p]}}return n}:Ce;It({target:"Object",stat:true,forced:Object.assign!==Me},{assign:Me});var Ae=Xt("match");var Fe=function(t){var e;return y(t)&&((e=t[Ae])!==undefined?!!e:f(t)=="RegExp")};var Ge=function(t){if(Fe(t)){throw TypeError("The method doesn't accept regular expressions")}return t};var Te=Xt("match");var qe=function(e){var r=/./;try{"/./"[e](r)}catch(t){try{r[Te]=false;return"/./"[e](r)}catch(t){}}return false};It({target:"String",proto:true,forced:!qe("includes")},{includes:function t(e){return!!~String(v(this)).indexOf(Ge(e),arguments.length>1?arguments[1]:undefined)}});var De=P.f;var Re="".startsWith;var Ie=Math.min;var Le=qe("startsWith");var Be=!Le&&!!function(){var t=De(String.prototype,"startsWith");return t&&!t.writable}();It({target:"String",proto:true,forced:!Be&&!Le},{startsWith:function t(e){var r=String(v(this));Ge(e);var n=vt(Ie(arguments.length>1?arguments[1]:undefined,r.length));var i=String(e);return Re?Re.call(r,i,n):r.slice(n,n+i.length)===i}});if(typeof window!=="undefined"){(function(){try{if(typeof SVGElement==="undefined"||Boolean(SVGElement.prototype.innerHTML)){return}}catch(t){return}function r(t){switch(t.nodeType){case 1:return i(t);case 3:return e(t);case 8:return n(t)}}function e(t){return t.textContent.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function n(t){return"\x3c!--"+t.nodeValue+"--\x3e"}function i(t){var e="";e+="<"+t.tagName;if(t.hasAttributes()){[].forEach.call(t.attributes,function(t){e+=" "+t.name+'="'+t.value+'"'})}e+=">";if(t.hasChildNodes()){[].forEach.call(t.childNodes,function(t){e+=r(t)})}e+="</"+t.tagName+">";return e}Object.defineProperty(SVGElement.prototype,"innerHTML",{get:function(){var e="";[].forEach.call(this.childNodes,function(t){e+=r(t)});return e},set:function(t){while(this.firstChild){this.removeChild(this.firstChild)}try{var e=new DOMParser;e.async=false;var r="<svg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'>"+t+"</svg>";var n=e.parseFromString(r,"text/xml").documentElement;[].forEach.call(n.childNodes,function(t){this.appendChild(this.ownerDocument.importNode(t,true))}.bind(this))}catch(t){throw new Error("Error parsing markup string")}}});Object.defineProperty(SVGElement.prototype,"innerSVG",{get:function(){return this.innerHTML},set:function(t){this.innerHTML=t}})})()}});(function(t,e){typeof exports==="object"&&typeof module!=="undefined"?e(exports,require("d3-array"),require("d3-color"),require("d3-zoom"),require("d3-geo"),require("d3-geo-projection"),require("d3-composite-projections"),require("d3-scale"),require("d3-tile"),require("topojson-client"),require("d3plus-common"),require("d3plus-shape"),require("d3plus-viz")):typeof define==="function"&&define.amd?define("d3plus-geomap",["exports","d3-array","d3-color","d3-zoom","d3-geo","d3-geo-projection","d3-composite-projections","d3-scale","d3-tile","topojson-client","d3plus-common","d3plus-shape","d3plus-viz"],e):(t=t||self,e(t.d3plus={},t.d3Array,t.d3Color,t.d3Zoom,t.d3GeoCore,t.d3GeoProjection,t.d3CompositeProjections,t.scales,t.d3Tile,t.topojsonClient,t.d3plusCommon,t.d3plusShape,t.d3plusViz))})(this,function(t,k,i,s,e,r,n,z,a,o,P,C,u){"use strict";function c(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}function f(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(t,n.key,n)}}function l(t,e,r){if(e)f(t.prototype,e);if(r)f(t,r);return t}function p(t,e){if(typeof e!=="function"&&e!==null){throw new TypeError("Super expression must either be null or a function")}t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:true,configurable:true}});if(e)h(t,e)}function E(t){E=Object.setPrototypeOf?Object.getPrototypeOf:function t(e){return e.__proto__||Object.getPrototypeOf(e)};return E(t)}function h(t,e){h=Object.setPrototypeOf||function t(e,r){e.__proto__=r;return e};return h(t,e)}function d(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true}catch(t){return false}}function v(t){if(t===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t}function g(t,e){if(e&&(typeof e==="object"||typeof e==="function")){return e}return v(t)}function y(i){var o=d();return function t(){var e=E(i),r;if(o){var n=E(this).constructor;r=Reflect.construct(e,arguments,n)}else{r=e.apply(this,arguments)}return g(this,r)}}function _(t,e){while(!Object.prototype.hasOwnProperty.call(t,e)){t=E(t);if(t===null)break}return t}function M(t,e,r){if(typeof Reflect!=="undefined"&&Reflect.get){M=Reflect.get}else{M=function t(e,r,n){var i=_(e,r);if(!i)return;var o=Object.getOwnPropertyDescriptor(i,r);if(o.get){return o.get.call(n)}return o.value}}return M(t,e,r||t)}function m(t,e){return b(t)||j(t,e)||S(t,e)||O()}function b(t){if(Array.isArray(t))return t}function j(t,e){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(t)))return;var r=[];var n=true;var i=false;var o=undefined;try{for(var a=t[Symbol.iterator](),u;!(n=(u=a.next()).done);n=true){r.push(u.value);if(e&&r.length===e)break}}catch(t){i=true;o=t}finally{try{if(!n&&a["return"]!=null)a["return"]()}finally{if(i)throw o}}return r}function S(t,e){if(!t)return;if(typeof t==="string")return w(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor)r=t.constructor.name;if(r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return w(t,e)}function w(t,e){if(e==null||e>t.length)e=t.length;for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function O(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var x=[{matches:["cartodb","cartocdn"],text:"© <a href='http://www.openstreetmap.org/copyright' target='_blank'>OpenStreetMap</a> contributors, © <a href='https://carto.com/attribution' target='_blank'>CARTO</a>"},{matches:["opentopomap.org"],text:"© <a href='http://www.openstreetmap.org/copyright' target='_blank'>OpenStreetMap</a> contributors"},{matches:["arcgisonline.com"],text:"Powered by <a href='https://developers.arcgis.com/terms/attribution/' target='_blank'>Esri</a>"},{matches:["/watercolor/"],text:"Map tiles by <a href='http://stamen.com' target='_blank'>Stamen Design</a>, under <a href='http://creativecommons.org/licenses/by/3.0' target='_blank'>CC BY 3.0</a>. Data by <a href='http://openstreetmap.org' target='_blank'>OpenStreetMap</a>, under <a href='http://www.openstreetmap.org/copyright' target='_blank'>ODbL</a>."},{matches:["stamen-tiles","stamen.com"],text:"Map tiles by <a href='http://stamen.com' target='_blank'>Stamen Design</a>, under <a href='http://creativecommons.org/licenses/by/3.0' target='_blank'>CC BY 3.0</a>. Data by <a href='http://openstreetmap.org' target='_blank'>OpenStreetMap</a>, under <a href='http://creativecommons.org/licenses/by-sa/3.0' target='_blank'>CC BY SA</a>."}];var A=Object.assign({},e,r,n);function F(e){var t=x.find(function(t){return t.matches.some(function(t){return e.includes(t)})});return t?t.text:false}function G(t,e){var r=e&&t.objects[e]?e:Object.keys(t.objects)[0];return o.feature(t,r)}var T=function(t){p(x,t);var e=y(x);function x(){var o;c(this,x);o=e.call(this);o._fitObject=false;o._noDataMessage=false;o._ocean="#d4dadc";o._point=P.accessor("point");o._pointSize=P.constant(1);o._pointSizeMax=10;o._pointSizeMin=5;o._pointSizeScale="linear";o._projection=A.geoMercator();o._projectionPadding=P.parseSides(20);o._shape=P.constant("Circle");o._shapeConfig=P.assign(o._shapeConfig,{ariaLabel:function t(e,r){return"".concat(o._drawLabel(e,r),", ").concat(o._pointSize(e,r))},hoverOpacity:1,Path:{ariaLabel:function t(e,r){var n=o._colorScale?", ".concat(o._colorScale(e,r)):"";return"".concat(o._drawLabel(e,r)).concat(n,".")},fill:function t(e,r){if(o._colorScale&&!o._coordData.features.includes(e)){var n=o._colorScale(e);if(n!==undefined&&n!==null){if(o._colorScaleClass._colorScale){return o._colorScaleClass._colorScale(n)}else{var i=o._colorScaleClass.color();if(i instanceof Array)i=i[i.length-1];return i}}}return o._topojsonFill(e,r)},on:{mouseenter:function t(e){return!o._coordData.features.includes(e)?o._on.mouseenter.bind(v(o))(e):null},"mousemove.shape":function t(e){return!o._coordData.features.includes(e)?o._on["mousemove.shape"].bind(v(o))(e):null},mouseleave:function t(e){return!o._coordData.features.includes(e)?o._on.mouseleave.bind(v(o))(e):null}},stroke:function t(e,r){var n=typeof o._shapeConfig.Path.fill==="function"?o._shapeConfig.Path.fill(e,r):o._shapeConfig.Path.fill;return i.color(n).darker()},strokeWidth:1}});o._tiles=true;o._tileGen=a.tile();o.tileUrl("https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}@2x.png");o._topojson=false;o._topojsonFill=P.constant("#f5f5f3");o._topojsonFilter=function(t){return!["010"].includes(t.id)};o._topojsonId=P.accessor("id");o._zoom=true;o._zoomSet=false;return o}l(x,[{key:"_renderTiles",value:function t(){var o=this;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:s.zoomTransform(this._container.node());var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var i=[];if(this._tiles){i=this._tileGen.extent(this._zoomBehavior.translateExtent()).scale(this._projection.scale()*(2*Math.PI)*n.k).translate(n.apply(this._projection.translate()))();this._tileGroup.transition().duration(e).attr("transform",n)}var r=this._tileGroup.selectAll("image.d3plus-geomap-tile").data(i,function(t){var e=m(t,3),r=e[0],n=e[1],i=e[2];return"".concat(r,"-").concat(n,"-").concat(i)});r.exit().transition().duration(e).attr("opacity",0).remove();var a=i.scale/n.k;var u=r.enter().append("image").attr("class","d3plus-geomap-tile");u.attr("opacity",0).transition().duration(e).attr("opacity",1);r.merge(u).attr("width",a).attr("height",a).attr("xlink:href",function(t){var e=m(t,3),r=e[0],n=e[1],i=e[2];return o._tileUrl.replace("{s}",["a","b","c"][Math.random()*3|0]).replace("{z}",i).replace("{x}",r).replace("{y}",n)}).attr("x",function(t){var e=m(t,1),r=e[0];return r*a+i.translate[0]*a-n.x/n.k}).attr("y",function(t){var e=m(t,2),r=e[1];return r*a+i.translate[1]*a-n.y/n.k})}},{key:"_draw",value:function t(e){var n=this;M(E(x.prototype),"_draw",this).call(this,e);var r=this._height-this._margin.top-this._margin.bottom,i=this._width-this._margin.left-this._margin.right;this._container=this._select.selectAll("svg.d3plus-geomap").data([0]);this._container=this._container.enter().append("svg").attr("class","d3plus-geomap").attr("opacity",0).attr("width",i).attr("height",r).attr("x",this._margin.left).attr("y",this._margin.top).style("background-color",this._ocean||"transparent").merge(this._container);this._container.transition(this._transition).attr("opacity",1).attr("width",i).attr("height",r).attr("x",this._margin.left).attr("y",this._margin.top);var o=this._container.selectAll("rect.d3plus-geomap-ocean").data([0]);o.enter().append("rect").attr("class","d3plus-geomap-ocean").merge(o).attr("width",i).attr("height",r).attr("fill",this._ocean||"transparent");this._tileGroup=this._container.selectAll("g.d3plus-geomap-tileGroup").data([0]);this._tileGroup=this._tileGroup.enter().append("g").attr("class","d3plus-geomap-tileGroup").merge(this._tileGroup);this._zoomGroup=this._container.selectAll("g.d3plus-geomap-zoomGroup").data([0]);this._zoomGroup=this._zoomGroup.enter().append("g").attr("class","d3plus-geomap-zoomGroup").merge(this._zoomGroup);var a=this._zoomGroup.selectAll("g.d3plus-geomap-paths").data([0]);a=a.enter().append("g").attr("class","d3plus-geomap-paths").merge(a);var u=this._coordData=this._topojson?G(this._topojson,this._topojsonKey):{type:"FeatureCollection",features:[]};if(this._topojsonFilter)u.features=u.features.filter(this._topojsonFilter);var s=this._path=A.geoPath().projection(this._projection);var c=this._filteredData.filter(function(t,e){return n._point(t,e)instanceof Array});var f=this._filteredData.filter(function(t,e){return!(n._point(t,e)instanceof Array)}).reduce(function(t,e){t[n._id(e)]=e;return t},{});var l=u.features.reduce(function(t,e){var r=n._topojsonId(e);t.push({__d3plus__:true,data:f[r],feature:e,id:r});return t},[]);var p=z["scale".concat(this._pointSizeScale.charAt(0).toUpperCase()).concat(this._pointSizeScale.slice(1))]().domain(k.extent(c,function(t,e){return n._pointSize(t,e)})).range([this._pointSizeMin,this._pointSizeMax]);if(!this._zoomSet){var h=this._fitObject?G(this._fitObject,this._fitKey):u;this._extentBounds={type:"FeatureCollection",features:this._fitFilter?h.features.filter(this._fitFilter):h.features.slice()};this._extentBounds.features=this._extentBounds.features.reduce(function(t,e){if(e.geometry){var r={type:e.type,id:e.id,geometry:{coordinates:e.geometry.coordinates,type:e.geometry.type}};if(e.geometry.type==="MultiPolygon"&&e.geometry.coordinates.length>1){var n=[],i=[];e.geometry.coordinates.forEach(function(t){r.geometry.coordinates=[t];n.push(s.area(r))});r.geometry.coordinates=[e.geometry.coordinates[n.indexOf(k.max(n))]];var o=s.centroid(r);e.geometry.coordinates.forEach(function(t){r.geometry.coordinates=[t];i.push(C.pointDistance(s.centroid(r),o))});var a=k.quantile(n.reduce(function(t,e,r){if(e)t.push(n[r]/e);return t},[]),.9);r.geometry.coordinates=e.geometry.coordinates.filter(function(t,e){var r=i[e];return r===0||n[e]/r>=a})}t.push(r)}return t},[]);if(!this._extentBounds.features.length&&c.length){var d=[[undefined,undefined],[undefined,undefined]];c.forEach(function(t,e){var r=n._projection(n._point(t,e));if(d[0][0]===void 0||r[0]<d[0][0])d[0][0]=r[0];if(d[1][0]===void 0||r[0]>d[1][0])d[1][0]=r[0];if(d[0][1]===void 0||r[1]<d[0][1])d[0][1]=r[1];if(d[1][1]===void 0||r[1]>d[1][1])d[1][1]=r[1]});this._extentBounds={type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"MultiPoint",coordinates:d.map(function(t){return n._projection.invert(t)})}}]};var v=k.max(c,function(t,e){return p(n._pointSize(t,e))});this._projectionPadding.top+=v;this._projectionPadding.right+=v;this._projectionPadding.bottom+=v;this._projectionPadding.left+=v}this._zoomBehavior.extent([[0,0],[i,r]]).scaleExtent([1,this._zoomMax]).translateExtent([[0,0],[i,r]]);this._zoomSet=true}this._projection=this._projection.fitExtent(this._extentBounds.features.length?[[this._projectionPadding.left,this._projectionPadding.top],[i-this._projectionPadding.right,r-this._projectionPadding.bottom]]:[[0,0],[i,r]],this._extentBounds.features.length?this._extentBounds:{type:"Sphere"});this._shapes.push((new C.Path).data(l).d(function(t){return s(t.feature)}).select(a.node()).x(0).y(0).config(P.configPrep.bind(this)(this._shapeConfig,"shape","Path")).render());var g=this._zoomGroup.selectAll("g.d3plus-geomap-pins").data([0]);g=g.enter().append("g").attr("class","d3plus-geomap-pins").merge(g);var y=(new C.Circle).config(P.configPrep.bind(this)(this._shapeConfig,"shape","Circle")).data(c).r(function(t,e){return p(n._pointSize(t,e))}).select(g.node()).sort(function(t,e){return n._pointSize(e)-n._pointSize(t)}).x(function(t,e){return n._projection(n._point(t,e))[0]}).y(function(t,e){return n._projection(n._point(t,e))[1]});var _=Object.keys(this._on);var m=_.filter(function(t){return t.includes(".Circle")}),b=_.filter(function(t){return!t.includes(".")}),j=_.filter(function(t){return t.includes(".shape")});for(var S=0;S<b.length;S++){y.on(b[S],this._on[b[S]])}for(var w=0;w<j.length;w++){y.on(j[w],this._on[j[w]])}for(var O=0;O<m.length;O++){y.on(m[O],this._on[m[O]])}this._shapes.push(y.render());return this}},{key:"fitFilter",value:function t(e){if(arguments.length){this._zoomSet=false;if(typeof e==="function")return this._fitFilter=e,this;if(!(e instanceof Array))e=[e];return this._fitFilter=function(t){return e.includes(t.id)},this}return this._fitFilter}},{key:"fitKey",value:function t(e){if(arguments.length){this._fitKey=e;this._zoomSet=false;return this}return this._fitKey}},{key:"fitObject",value:function t(e,r){if(arguments.length){if(typeof e==="string"){var n=this._queue.find(function(t){return t[3]==="fitObject"});var i=[u.dataLoad.bind(this),e,r,"fitObject"];if(n)this._queue[this._queue.indexOf(n)]=i;else this._queue.push(i)}else{this._fitObject=e}this._zoomSet=false;return this}return this._fitObject}},{key:"ocean",value:function t(e){return arguments.length?(this._ocean=e,this):this._ocean}},{key:"point",value:function t(e){return arguments.length?(this._point=typeof e==="function"?e:P.constant(e),this):this._point}},{key:"pointSize",value:function t(e){return arguments.length?(this._pointSize=typeof e==="function"?e:P.constant(e),this):this._pointSize}},{key:"pointSizeMax",value:function t(e){return arguments.length?(this._pointSizeMax=e,this):this._pointSizeMax}},{key:"pointSizeMin",value:function t(e){return arguments.length?(this._pointSizeMin=e,this):this._pointSizeMin}},{key:"projection",value:function t(e){if(arguments.length&&e!=="geoMercator")this.tiles(false);return arguments.length?(this._projection=typeof e==="string"?A[e]?A[e]():A.geoMercator():e,this):this._projection}},{key:"projectionPadding",value:function t(e){return arguments.length?(this._projectionPadding=P.parseSides(e),this):this._projectionPadding}},{key:"projectionRotate",value:function t(e){if(arguments.length){this._projection.rotate(e);this.tiles(false);this._zoomSet=false;return this}else{return this._projectionRotate}}},{key:"tiles",value:function t(e){if(arguments.length){this._tiles=e;var r=F(this._tileUrl);if(e&&this._attribution==="")this._attribution=r;else if(!e&&this._attribution===r)this._attribution="";return this}return this._tiles}},{key:"tileUrl",value:function t(e){if(arguments.length){this._tileUrl=e;if(this._tiles)this._attribution=F(e);if(this._tileGroup)this._renderTiles.bind(this)();return this}return this._tileUrl}},{key:"topojson",value:function t(e,r){if(arguments.length){if(typeof e==="string"){var n=this._queue.find(function(t){return t[3]==="topojson"});var i=[u.dataLoad.bind(this),e,r,"topojson"];if(n)this._queue[this._queue.indexOf(n)]=i;else this._queue.push(i)}else{this._topojson=e}this._zoomSet=false;return this}return this._topojson}},{key:"topojsonFill",value:function t(e){return arguments.length?(this._topojsonFill=typeof e==="function"?e:P.constant(e),this):this._topojsonFill}},{key:"topojsonFilter",value:function t(e){if(arguments.length){this._zoomSet=false;if(typeof e==="function")return this._topojsonFilter=e,this;if(!(e instanceof Array))e=[e];return this._topojsonFilter=function(t){return e.includes(t.id)},this}return this._topojsonFilter}},{key:"topojsonKey",value:function t(e){if(arguments.length){this._topojsonKey=e;this._zoomSet=false;return this}return this._topojsonKey}},{key:"topojsonId",value:function t(e){return arguments.length?(this._topojsonId=typeof e==="function"?e:P.accessor(e),this):this._topojsonId}}]);return x}(u.Viz);t.Geomap=T;Object.defineProperty(t,"__esModule",{value:true})});