function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||_unsupportedIterableToArray(t,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){if(!t)return;if(typeof t==="string")return _arrayLikeToArray(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor)r=t.constructor.name;if(r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _arrayLikeToArray(t,e)}function _arrayLikeToArray(t,e){if(e==null||e>t.length)e=t.length;for(var r=0,n=new Array(e);r<e;r++){n[r]=t[r]}return n}function _iterableToArrayLimit(t,e){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(t)))return;var r=[];var n=true;var i=false;var o=undefined;try{for(var a=t[Symbol.iterator](),u;!(n=(u=a.next()).done);n=true){r.push(u.value);if(e&&r.length===e)break}}catch(t){i=true;o=t}finally{try{if(!n&&a["return"]!=null)a["return"]()}finally{if(i)throw o}}return r}function _arrayWithHoles(t){if(Array.isArray(t))return t}function _classCallCheck(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(t,n.key,n)}}function _createClass(t,e,r){if(e)_defineProperties(t.prototype,e);if(r)_defineProperties(t,r);return t}function _get(t,e,r){if(typeof Reflect!=="undefined"&&Reflect.get){_get=Reflect.get}else{_get=function t(e,r,n){var i=_superPropBase(e,r);if(!i)return;var o=Object.getOwnPropertyDescriptor(i,r);if(o.get){return o.get.call(n)}return o.value}}return _get(t,e,r||t)}function _superPropBase(t,e){while(!Object.prototype.hasOwnProperty.call(t,e)){t=_getPrototypeOf(t);if(t===null)break}return t}function _inherits(t,e){if(typeof e!=="function"&&e!==null){throw new TypeError("Super expression must either be null or a function")}t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:true,configurable:true}});if(e)_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){_setPrototypeOf=Object.setPrototypeOf||function t(e,r){e.__proto__=r;return e};return _setPrototypeOf(t,e)}function _createSuper(i){var o=_isNativeReflectConstruct();return function t(){var e=_getPrototypeOf(i),r;if(o){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(e,arguments,n)}else{r=e.apply(this,arguments)}return _possibleConstructorReturn(this,r)}}function _possibleConstructorReturn(t,e){if(e&&(_typeof(e)==="object"||typeof e==="function")){return e}return _assertThisInitialized(t)}function _assertThisInitialized(t){if(t===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true}catch(t){return false}}function _getPrototypeOf(t){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function t(e){return e.__proto__||Object.getPrototypeOf(e)};return _getPrototypeOf(t)}function _typeof(t){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function t(e){return typeof e}}else{_typeof=function t(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e}}return _typeof(t)}
/*
  d3plus-geomap v0.7.2
  A reusable geo map built on D3 and Topojson
  Copyright (c) 2020 D3plus - https://d3plus.org
  @license MIT
*/
(function(t){typeof define==="function"&&define.amd?define(t):t()})(function(){"use strict";var t=typeof globalThis!=="undefined"?globalThis:typeof window!=="undefined"?window:typeof global!=="undefined"?global:typeof self!=="undefined"?self:{};function e(t,e,n){return n={path:e,exports:{},require:function t(e,r){return i(e,r===undefined||r===null?n.path:r)}},t(n,n.exports),n.exports}function i(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}var r=function t(e){return e&&e.Math==Math&&e};var p=r((typeof globalThis==="undefined"?"undefined":_typeof(globalThis))=="object"&&globalThis)||r((typeof window==="undefined"?"undefined":_typeof(window))=="object"&&window)||r((typeof self==="undefined"?"undefined":_typeof(self))=="object"&&self)||r(_typeof(t)=="object"&&t)||Function("return this")();var u=function t(e){try{return!!e()}catch(t){return true}};var h=!u(function(){return Object.defineProperty({},1,{get:function t(){return 7}})[1]!=7});var n={}.propertyIsEnumerable;var o=Object.getOwnPropertyDescriptor;var a=o&&!n.call({1:2},1);var s=a?function t(e){var r=o(this,e);return!!r&&r.enumerable}:n;var d={f:s};var c=function t(e,r){return{enumerable:!(e&1),configurable:!(e&2),writable:!(e&4),value:r}};var f={}.toString;var l=function t(e){return f.call(e).slice(8,-1)};var v="".split;var b=u(function(){return!Object("z").propertyIsEnumerable(0)})?function(t){return l(t)=="String"?v.call(t,""):Object(t)}:Object;var _=function t(e){if(e==undefined)throw TypeError("Can't call method on "+e);return e};var y=function t(e){return b(_(e))};var g=function t(e){return _typeof(e)==="object"?e!==null:typeof e==="function"};var m=function t(e,r){if(!g(e))return e;var n,i;if(r&&typeof(n=e.toString)=="function"&&!g(i=n.call(e)))return i;if(typeof(n=e.valueOf)=="function"&&!g(i=n.call(e)))return i;if(!r&&typeof(n=e.toString)=="function"&&!g(i=n.call(e)))return i;throw TypeError("Can't convert object to primitive value")};var j={}.hasOwnProperty;var S=function t(e,r){return j.call(e,r)};var w=p.document;var O=g(w)&&g(w.createElement);var P=function t(e){return O?w.createElement(e):{}};var x=!h&&!u(function(){return Object.defineProperty(P("div"),"a",{get:function t(){return 7}}).a!=7});var k=Object.getOwnPropertyDescriptor;var z=h?k:function t(e,r){e=y(e);r=m(r,true);if(x)try{return k(e,r)}catch(t){}if(S(e,r))return c(!d.f.call(e,r),e[r])};var C={f:z};var A=function t(e){if(!g(e)){throw TypeError(String(e)+" is not an object")}return e};var T=Object.defineProperty;var E=h?T:function t(e,r,n){A(e);r=m(r,true);A(n);if(x)try{return T(e,r,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");if("value"in n)e[r]=n.value;return e};var M={f:E};var F=h?function(t,e,r){return M.f(t,e,c(1,r))}:function(t,e,r){t[e]=r;return t};var G=function t(e,r){try{F(p,e,r)}catch(t){p[e]=r}return r};var I="__core-js_shared__";var q=p[I]||G(I,{});var D=q;var R=Function.toString;if(typeof D.inspectSource!="function"){D.inspectSource=function(t){return R.call(t)}}var L=D.inspectSource;var B=p.WeakMap;var N=typeof B==="function"&&/native code/.test(L(B));var W=e(function(t){(t.exports=function(t,e){return D[t]||(D[t]=e!==undefined?e:{})})("versions",[]).push({version:"3.6.5",mode:"global",copyright:"Â© 2020 Denis Pushkarev (zloirock.ru)"})});var K=0;var V=Math.random();var U=function t(e){return"Symbol("+String(e===undefined?"":e)+")_"+(++K+V).toString(36)};var H=W("keys");var Y=function t(e){return H[e]||(H[e]=U(e))};var X={};var Z=p.WeakMap;var $,J,Q;var tt=function t(e){return Q(e)?J(e):$(e,{})};var et=function t(r){return function(t){var e;if(!g(t)||(e=J(t)).type!==r){throw TypeError("Incompatible receiver, "+r+" required")}return e}};if(N){var rt=new Z;var nt=rt.get;var it=rt.has;var ot=rt.set;$=function t(e,r){ot.call(rt,e,r);return r};J=function t(e){return nt.call(rt,e)||{}};Q=function t(e){return it.call(rt,e)}}else{var at=Y("state");X[at]=true;$=function t(e,r){F(e,at,r);return r};J=function t(e){return S(e,at)?e[at]:{}};Q=function t(e){return S(e,at)}}var ut={set:$,get:J,has:Q,enforce:tt,getterFor:et};var st=e(function(t){var e=ut.get;var u=ut.enforce;var s=String(String).split("String");(t.exports=function(t,e,r,n){var i=n?!!n.unsafe:false;var o=n?!!n.enumerable:false;var a=n?!!n.noTargetGet:false;if(typeof r=="function"){if(typeof e=="string"&&!S(r,"name"))F(r,"name",e);u(r).source=s.join(typeof e=="string"?e:"")}if(t===p){if(o)t[e]=r;else G(e,r);return}else if(!i){delete t[e]}else if(!a&&t[e]){o=true}if(o)t[e]=r;else F(t,e,r)})(Function.prototype,"toString",function t(){return typeof this=="function"&&e(this).source||L(this)})});var ct=p;var ft=function t(e){return typeof e=="function"?e:undefined};var lt=function t(e,r){return arguments.length<2?ft(ct[e])||ft(p[e]):ct[e]&&ct[e][r]||p[e]&&p[e][r]};var pt=Math.ceil;var ht=Math.floor;var dt=function t(e){return isNaN(e=+e)?0:(e>0?ht:pt)(e)};var vt=Math.min;var _t=function t(e){return e>0?vt(dt(e),9007199254740991):0};var yt=Math.max;var gt=Math.min;var mt=function t(e,r){var n=dt(e);return n<0?yt(n+r,0):gt(n,r)};var bt=function t(u){return function(t,e,r){var n=y(t);var i=_t(n.length);var o=mt(r,i);var a;if(u&&e!=e)while(i>o){a=n[o++];if(a!=a)return true}else for(;i>o;o++){if((u||o in n)&&n[o]===e)return u||o||0}return!u&&-1}};var jt={includes:bt(true),indexOf:bt(false)};var St=jt.indexOf;var wt=function t(e,r){var n=y(e);var i=0;var o=[];var a;for(a in n){!S(X,a)&&S(n,a)&&o.push(a)}while(r.length>i){if(S(n,a=r[i++])){~St(o,a)||o.push(a)}}return o};var Ot=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"];var Pt=Ot.concat("length","prototype");var xt=Object.getOwnPropertyNames||function t(e){return wt(e,Pt)};var kt={f:xt};var zt=Object.getOwnPropertySymbols;var Ct={f:zt};var At=lt("Reflect","ownKeys")||function t(e){var r=kt.f(A(e));var n=Ct.f;return n?r.concat(n(e)):r};var Tt=function t(e,r){var n=At(r);var i=M.f;var o=C.f;for(var a=0;a<n.length;a++){var u=n[a];if(!S(e,u))i(e,u,o(r,u))}};var Et=/#|\.prototype\./;var Mt=function t(e,r){var n=Gt[Ft(e)];return n==qt?true:n==It?false:typeof r=="function"?u(r):!!r};var Ft=Mt.normalize=function(t){return String(t).replace(Et,".").toLowerCase()};var Gt=Mt.data={};var It=Mt.NATIVE="N";var qt=Mt.POLYFILL="P";var Dt=Mt;var Rt=C.f;var Lt=function t(e,r){var n=e.target;var i=e.global;var o=e.stat;var a,u,s,c,f,l;if(i){u=p}else if(o){u=p[n]||G(n,{})}else{u=(p[n]||{}).prototype}if(u)for(s in r){f=r[s];if(e.noTargetGet){l=Rt(u,s);c=l&&l.value}else c=u[s];a=Dt(i?s:n+(o?".":"#")+s,e.forced);if(!a&&c!==undefined){if(_typeof(f)===_typeof(c))continue;Tt(f,c)}if(e.sham||c&&c.sham){F(f,"sham",true)}st(u,s,f,e)}};var Bt=function t(e){if(typeof e!="function"){throw TypeError(String(e)+" is not a function")}return e};var Nt=function t(n,i,e){Bt(n);if(i===undefined)return n;switch(e){case 0:return function(){return n.call(i)};case 1:return function(t){return n.call(i,t)};case 2:return function(t,e){return n.call(i,t,e)};case 3:return function(t,e,r){return n.call(i,t,e,r)}}return function(){return n.apply(i,arguments)}};var Wt=function t(e){return Object(_(e))};var Kt=Array.isArray||function t(e){return l(e)=="Array"};var Vt=!!Object.getOwnPropertySymbols&&!u(function(){return!String(Symbol())});var Ut=Vt&&!Symbol.sham&&_typeof(Symbol.iterator)=="symbol";var Ht=W("wks");var Yt=p.Symbol;var Xt=Ut?Yt:Yt&&Yt.withoutSetter||U;var Zt=function t(e){if(!S(Ht,e)){if(Vt&&S(Yt,e))Ht[e]=Yt[e];else Ht[e]=Xt("Symbol."+e)}return Ht[e]};var $t=Zt("species");var Jt=function t(e,r){var n;if(Kt(e)){n=e.constructor;if(typeof n=="function"&&(n===Array||Kt(n.prototype)))n=undefined;else if(g(n)){n=n[$t];if(n===null)n=undefined}}return new(n===undefined?Array:n)(r===0?0:r)};var Qt=[].push;var te=function t(h){var d=h==1;var v=h==2;var _=h==3;var y=h==4;var g=h==6;var m=h==5||g;return function(t,e,r,n){var i=Wt(t);var o=b(i);var a=Nt(e,r,3);var u=_t(o.length);var s=0;var c=n||Jt;var f=d?c(t,u):v?c(t,0):undefined;var l,p;for(;u>s;s++){if(m||s in o){l=o[s];p=a(l,s,i);if(h){if(d)f[s]=p;else if(p)switch(h){case 3:return true;case 5:return l;case 6:return s;case 2:Qt.call(f,l)}else if(y)return false}}}return g?-1:_||y?y:f}};var ee={forEach:te(0),map:te(1),filter:te(2),some:te(3),every:te(4),find:te(5),findIndex:te(6)};var re=Object.keys||function t(e){return wt(e,Ot)};var ne=h?Object.defineProperties:function t(e,r){A(e);var n=re(r);var i=n.length;var o=0;var a;while(i>o){M.f(e,a=n[o++],r[a])}return e};var ie=lt("document","documentElement");var oe=">";var ae="<";var ue="prototype";var se="script";var ce=Y("IE_PROTO");var fe=function t(){};var le=function t(e){return ae+se+oe+e+ae+"/"+se+oe};var pe=function t(e){e.write(le(""));e.close();var r=e.parentWindow.Object;e=null;return r};var he=function t(){var e=P("iframe");var r="java"+se+":";var n;e.style.display="none";ie.appendChild(e);e.src=String(r);n=e.contentWindow.document;n.open();n.write(le("document.F=Object"));n.close();return n.F};var de;var ve=function t(){try{de=document.domain&&new ActiveXObject("htmlfile")}catch(t){}ve=de?pe(de):he();var e=Ot.length;while(e--){delete ve[ue][Ot[e]]}return ve()};X[ce]=true;var _e=Object.create||function t(e,r){var n;if(e!==null){fe[ue]=A(e);n=new fe;fe[ue]=null;n[ce]=e}else n=ve();return r===undefined?n:ne(n,r)};var ye=Zt("unscopables");var ge=Array.prototype;if(ge[ye]==undefined){M.f(ge,ye,{configurable:true,value:_e(null)})}var me=function t(e){ge[ye][e]=true};var be=Object.defineProperty;var je={};var Se=function t(e){throw e};var we=function t(e,r){if(S(je,e))return je[e];if(!r)r={};var n=[][e];var i=S(r,"ACCESSORS")?r.ACCESSORS:false;var o=S(r,0)?r[0]:Se;var a=S(r,1)?r[1]:undefined;return je[e]=!!n&&!u(function(){if(i&&!h)return true;var t={length:-1};if(i)be(t,1,{enumerable:true,get:Se});else t[1]=1;n.call(t,o,a)})};var Oe=ee.find;var Pe="find";var xe=true;var ke=we(Pe);if(Pe in[])Array(1)[Pe](function(){xe=false});Lt({target:"Array",proto:true,forced:xe||!ke},{find:function t(e){return Oe(this,e,arguments.length>1?arguments[1]:undefined)}});me(Pe);var ze=jt.includes;var Ce=we("indexOf",{ACCESSORS:true,1:0});Lt({target:"Array",proto:true,forced:!Ce},{includes:function t(e){return ze(this,e,arguments.length>1?arguments[1]:undefined)}});me("includes");var Ae=Object.assign;var Te=Object.defineProperty;var Ee=!Ae||u(function(){if(h&&Ae({b:1},Ae(Te({},"a",{enumerable:true,get:function t(){Te(this,"b",{value:3,enumerable:false})}}),{b:2})).b!==1)return true;var t={};var e={};var r=Symbol();var n="abcdefghijklmnopqrst";t[r]=7;n.split("").forEach(function(t){e[t]=t});return Ae({},t)[r]!=7||re(Ae({},e)).join("")!=n})?function t(e,r){var n=Wt(e);var i=arguments.length;var o=1;var a=Ct.f;var u=d.f;while(i>o){var s=b(arguments[o++]);var c=a?re(s).concat(a(s)):re(s);var f=c.length;var l=0;var p;while(f>l){p=c[l++];if(!h||u.call(s,p))n[p]=s[p]}}return n}:Ae;Lt({target:"Object",stat:true,forced:Object.assign!==Ee},{assign:Ee});var Me=Zt("match");var Fe=function t(e){var r;return g(e)&&((r=e[Me])!==undefined?!!r:l(e)=="RegExp")};var Ge=function t(e){if(Fe(e)){throw TypeError("The method doesn't accept regular expressions")}return e};var Ie=Zt("match");var qe=function t(e){var r=/./;try{"/./"[e](r)}catch(t){try{r[Ie]=false;return"/./"[e](r)}catch(t){}}return false};Lt({target:"String",proto:true,forced:!qe("includes")},{includes:function t(e){return!!~String(_(this)).indexOf(Ge(e),arguments.length>1?arguments[1]:undefined)}});var De=C.f;var Re="".startsWith;var Le=Math.min;var Be=qe("startsWith");var Ne=!Be&&!!function(){var t=De(String.prototype,"startsWith");return t&&!t.writable}();Lt({target:"String",proto:true,forced:!Ne&&!Be},{startsWith:function t(e){var r=String(_(this));Ge(e);var n=_t(Le(arguments.length>1?arguments[1]:undefined,r.length));var i=String(e);return Re?Re.call(r,i,n):r.slice(n,n+i.length)===i}});if(typeof window!=="undefined"){(function(){try{if(typeof SVGElement==="undefined"||Boolean(SVGElement.prototype.innerHTML)){return}}catch(t){return}function r(t){switch(t.nodeType){case 1:return i(t);case 3:return e(t);case 8:return n(t)}}function e(t){return t.textContent.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function n(t){return"\x3c!--"+t.nodeValue+"--\x3e"}function i(t){var e="";e+="<"+t.tagName;if(t.hasAttributes()){[].forEach.call(t.attributes,function(t){e+=" "+t.name+'="'+t.value+'"'})}e+=">";if(t.hasChildNodes()){[].forEach.call(t.childNodes,function(t){e+=r(t)})}e+="</"+t.tagName+">";return e}Object.defineProperty(SVGElement.prototype,"innerHTML",{get:function t(){var e="";[].forEach.call(this.childNodes,function(t){e+=r(t)});return e},set:function t(e){while(this.firstChild){this.removeChild(this.firstChild)}try{var r=new DOMParser;r.async=false;var n="<svg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'>"+e+"</svg>";var i=r.parseFromString(n,"text/xml").documentElement;[].forEach.call(i.childNodes,function(t){this.appendChild(this.ownerDocument.importNode(t,true))}.bind(this))}catch(t){throw new Error("Error parsing markup string")}}});Object.defineProperty(SVGElement.prototype,"innerSVG",{get:function t(){return this.innerHTML},set:function t(e){this.innerHTML=e}})})()}});(function(t,e){(typeof exports==="undefined"?"undefined":_typeof(exports))==="object"&&typeof module!=="undefined"?e(exports,require("d3-array"),require("d3-color"),require("d3-zoom"),require("d3-geo"),require("d3-geo-projection"),require("d3-composite-projections"),require("d3-scale"),require("d3-tile"),require("topojson-client"),require("d3plus-common"),require("d3plus-shape"),require("d3plus-viz")):typeof define==="function"&&define.amd?define("d3plus-geomap",["exports","d3-array","d3-color","d3-zoom","d3-geo","d3-geo-projection","d3-composite-projections","d3-scale","d3-tile","topojson-client","d3plus-common","d3plus-shape","d3plus-viz"],e):(t=typeof globalThis!=="undefined"?globalThis:t||self,e(t.d3plus={},t.d3Array,t.d3Color,t.d3Zoom,t.d3GeoCore,t.d3GeoProjection,t.d3CompositeProjections,t.scales,t.d3Tile,t.topojsonClient,t.d3plusCommon,t.d3plusShape,t.d3plusViz))})(this,function(t,x,i,s,e,r,n,o,a,u,k,z,c){"use strict";function f(r){if(r&&r.__esModule){return r}else{var n=Object.create(null);if(r){Object.keys(r).forEach(function(e){if(e!=="default"){var t=Object.getOwnPropertyDescriptor(r,e);Object.defineProperty(n,e,t.get?t:{enumerable:true,get:function t(){return r[e]}})}})}n["default"]=r;return Object.freeze(n)}}var l=f(e);var p=f(r);var h=f(n);var C=f(o);var d=[{matches:["cartodb","cartocdn"],text:"Â© <a href='http://www.openstreetmap.org/copyright' target='_blank'>OpenStreetMap</a> contributors, Â© <a href='https://carto.com/attribution' target='_blank'>CARTO</a>"},{matches:["opentopomap.org"],text:"Â© <a href='http://www.openstreetmap.org/copyright' target='_blank'>OpenStreetMap</a> contributors"},{matches:["arcgisonline.com"],text:"Powered by <a href='https://developers.arcgis.com/terms/attribution/' target='_blank'>Esri</a>"},{matches:["/watercolor/"],text:"Map tiles by <a href='http://stamen.com' target='_blank'>Stamen Design</a>, under <a href='http://creativecommons.org/licenses/by/3.0' target='_blank'>CC BY 3.0</a>. Data by <a href='http://openstreetmap.org' target='_blank'>OpenStreetMap</a>, under <a href='http://www.openstreetmap.org/copyright' target='_blank'>ODbL</a>."},{matches:["stamen-tiles","stamen.com"],text:"Map tiles by <a href='http://stamen.com' target='_blank'>Stamen Design</a>, under <a href='http://creativecommons.org/licenses/by/3.0' target='_blank'>CC BY 3.0</a>. Data by <a href='http://openstreetmap.org' target='_blank'>OpenStreetMap</a>, under <a href='http://creativecommons.org/licenses/by-sa/3.0' target='_blank'>CC BY SA</a>."}];var A=Object.assign({},l,p,h);function v(e){var t=d.find(function(t){return t.matches.some(function(t){return e.includes(t)})});return t?t.text:false}function T(t,e){var r=e&&t.objects[e]?e:Object.keys(t.objects)[0];return u.feature(t,r)}var _=function(t){_inherits(P,t);var e=_createSuper(P);function P(){var o;_classCallCheck(this,P);o=e.call(this);o._fitObject=false;o._noDataMessage=false;o._ocean="#d4dadc";o._point=k.accessor("point");o._pointSize=k.constant(1);o._pointSizeMax=10;o._pointSizeMin=5;o._pointSizeScale="linear";o._projection=A.geoMercator();o._projectionPadding=k.parseSides(20);o._shape=k.constant("Circle");o._shapeConfig=k.assign(o._shapeConfig,{ariaLabel:function t(e,r){return"".concat(o._drawLabel(e,r),", ").concat(o._pointSize(e,r))},hoverOpacity:1,Path:{ariaLabel:function t(e,r){var n=o._colorScale?", ".concat(o._colorScale(e,r)):"";return"".concat(o._drawLabel(e,r)).concat(n,".")},fill:function t(e,r){if(o._colorScale&&!o._coordData.features.includes(e)){var n=o._colorScale(e);if(n!==undefined&&n!==null){if(o._colorScaleClass._colorScale){return o._colorScaleClass._colorScale(n)}else{var i=o._colorScaleClass.color();if(i instanceof Array)i=i[i.length-1];return i}}}return o._topojsonFill(e,r)},on:{mouseenter:function t(e){return!o._coordData.features.includes(e)?o._on.mouseenter.bind(_assertThisInitialized(o))(e):null},"mousemove.shape":function t(e){return!o._coordData.features.includes(e)?o._on["mousemove.shape"].bind(_assertThisInitialized(o))(e):null},mouseleave:function t(e){return!o._coordData.features.includes(e)?o._on.mouseleave.bind(_assertThisInitialized(o))(e):null}},stroke:function t(e,r){var n=typeof o._shapeConfig.Path.fill==="function"?o._shapeConfig.Path.fill(e,r):o._shapeConfig.Path.fill;return i.color(n).darker()},strokeWidth:1}});o._tiles=true;o._tileGen=a.tile();o.tileUrl("https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}@2x.png");o._topojson=false;o._topojsonFill=k.constant("#f5f5f3");o._topojsonFilter=function(t){return!["010"].includes(t.id)};o._topojsonId=k.accessor("id");o._zoom=true;o._zoomSet=false;return o}_createClass(P,[{key:"_renderTiles",value:function t(){var o=this;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:s.zoomTransform(this._container.node());var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var i=[];if(this._tiles){i=this._tileGen.extent(this._zoomBehavior.translateExtent()).scale(this._projection.scale()*(2*Math.PI)*n.k).translate(n.apply(this._projection.translate()))();this._tileGroup.transition().duration(e).attr("transform",n)}var r=this._tileGroup.selectAll("image.d3plus-geomap-tile").data(i,function(t){var e=_slicedToArray(t,3),r=e[0],n=e[1],i=e[2];return"".concat(r,"-").concat(n,"-").concat(i)});r.exit().transition().duration(e).attr("opacity",0).remove();var a=i.scale/n.k;var u=r.enter().append("image").attr("class","d3plus-geomap-tile");u.attr("opacity",0).transition().duration(e).attr("opacity",1);r.merge(u).attr("width",a).attr("height",a).attr("xlink:href",function(t){var e=_slicedToArray(t,3),r=e[0],n=e[1],i=e[2];return o._tileUrl.replace("{s}",["a","b","c"][Math.random()*3|0]).replace("{z}",i).replace("{x}",r).replace("{y}",n)}).attr("x",function(t){var e=_slicedToArray(t,1),r=e[0];return r*a+i.translate[0]*a-n.x/n.k}).attr("y",function(t){var e=_slicedToArray(t,2),r=e[1];return r*a+i.translate[1]*a-n.y/n.k})}},{key:"_draw",value:function t(e){var n=this;_get(_getPrototypeOf(P.prototype),"_draw",this).call(this,e);var r=this._height-this._margin.top-this._margin.bottom,i=this._width-this._margin.left-this._margin.right;this._container=this._select.selectAll("svg.d3plus-geomap").data([0]);this._container=this._container.enter().append("svg").attr("class","d3plus-geomap").attr("opacity",0).attr("width",i).attr("height",r).attr("x",this._margin.left).attr("y",this._margin.top).style("background-color",this._ocean||"transparent").merge(this._container);this._container.transition(this._transition).attr("opacity",1).attr("width",i).attr("height",r).attr("x",this._margin.left).attr("y",this._margin.top);var o=this._container.selectAll("rect.d3plus-geomap-ocean").data([0]);o.enter().append("rect").attr("class","d3plus-geomap-ocean").merge(o).attr("width",i).attr("height",r).attr("fill",this._ocean||"transparent");this._tileGroup=this._container.selectAll("g.d3plus-geomap-tileGroup").data([0]);this._tileGroup=this._tileGroup.enter().append("g").attr("class","d3plus-geomap-tileGroup").merge(this._tileGroup);this._zoomGroup=this._container.selectAll("g.d3plus-geomap-zoomGroup").data([0]);this._zoomGroup=this._zoomGroup.enter().append("g").attr("class","d3plus-geomap-zoomGroup").merge(this._zoomGroup);var a=this._zoomGroup.selectAll("g.d3plus-geomap-paths").data([0]);a=a.enter().append("g").attr("class","d3plus-geomap-paths").merge(a);var u=this._coordData=this._topojson?T(this._topojson,this._topojsonKey):{type:"FeatureCollection",features:[]};if(this._topojsonFilter)u.features=u.features.filter(this._topojsonFilter);var s=this._path=A.geoPath().projection(this._projection);var c=this._filteredData.filter(function(t,e){return n._point(t,e)instanceof Array});var f=this._filteredData.filter(function(t,e){return!(n._point(t,e)instanceof Array)}).reduce(function(t,e){t[n._id(e)]=e;return t},{});var l=u.features.reduce(function(t,e){var r=n._topojsonId(e);t.push({__d3plus__:true,data:f[r],feature:e,id:r});return t},[]);var p=C["scale".concat(this._pointSizeScale.charAt(0).toUpperCase()).concat(this._pointSizeScale.slice(1))]().domain(x.extent(c,function(t,e){return n._pointSize(t,e)})).range([this._pointSizeMin,this._pointSizeMax]);if(!this._zoomSet){var h=this._fitObject?T(this._fitObject,this._fitKey):u;this._extentBounds={type:"FeatureCollection",features:this._fitFilter?h.features.filter(this._fitFilter):h.features.slice()};this._extentBounds.features=this._extentBounds.features.reduce(function(t,e){if(e.geometry){var r={type:e.type,id:e.id,geometry:{coordinates:e.geometry.coordinates,type:e.geometry.type}};if(e.geometry.type==="MultiPolygon"&&e.geometry.coordinates.length>1){var n=[],i=[];e.geometry.coordinates.forEach(function(t){r.geometry.coordinates=[t];n.push(s.area(r))});r.geometry.coordinates=[e.geometry.coordinates[n.indexOf(x.max(n))]];var o=s.centroid(r);e.geometry.coordinates.forEach(function(t){r.geometry.coordinates=[t];i.push(z.pointDistance(s.centroid(r),o))});var a=x.quantile(n.reduce(function(t,e,r){if(e)t.push(n[r]/e);return t},[]),.9);r.geometry.coordinates=e.geometry.coordinates.filter(function(t,e){var r=i[e];return r===0||n[e]/r>=a})}t.push(r)}return t},[]);if(!this._extentBounds.features.length&&c.length){var d=[[undefined,undefined],[undefined,undefined]];c.forEach(function(t,e){var r=n._projection(n._point(t,e));if(d[0][0]===void 0||r[0]<d[0][0])d[0][0]=r[0];if(d[1][0]===void 0||r[0]>d[1][0])d[1][0]=r[0];if(d[0][1]===void 0||r[1]<d[0][1])d[0][1]=r[1];if(d[1][1]===void 0||r[1]>d[1][1])d[1][1]=r[1]});this._extentBounds={type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"MultiPoint",coordinates:d.map(function(t){return n._projection.invert(t)})}}]};var v=x.max(c,function(t,e){return p(n._pointSize(t,e))});this._projectionPadding.top+=v;this._projectionPadding.right+=v;this._projectionPadding.bottom+=v;this._projectionPadding.left+=v}this._zoomBehavior.extent([[0,0],[i,r]]).scaleExtent([1,this._zoomMax]).translateExtent([[0,0],[i,r]]);this._zoomSet=true}this._projection=this._projection.fitExtent(this._extentBounds.features.length?[[this._projectionPadding.left,this._projectionPadding.top],[i-this._projectionPadding.right,r-this._projectionPadding.bottom]]:[[0,0],[i,r]],this._extentBounds.features.length?this._extentBounds:{type:"Sphere"});this._shapes.push((new z.Path).data(l).d(function(t){return s(t.feature)}).select(a.node()).x(0).y(0).config(k.configPrep.bind(this)(this._shapeConfig,"shape","Path")).render());var _=this._zoomGroup.selectAll("g.d3plus-geomap-pins").data([0]);_=_.enter().append("g").attr("class","d3plus-geomap-pins").merge(_);var y=(new z.Circle).config(k.configPrep.bind(this)(this._shapeConfig,"shape","Circle")).data(c).r(function(t,e){return p(n._pointSize(t,e))}).select(_.node()).sort(function(t,e){return n._pointSize(e)-n._pointSize(t)}).x(function(t,e){return n._projection(n._point(t,e))[0]}).y(function(t,e){return n._projection(n._point(t,e))[1]});var g=Object.keys(this._on);var m=g.filter(function(t){return t.includes(".Circle")}),b=g.filter(function(t){return!t.includes(".")}),j=g.filter(function(t){return t.includes(".shape")});for(var S=0;S<b.length;S++){y.on(b[S],this._on[b[S]])}for(var w=0;w<j.length;w++){y.on(j[w],this._on[j[w]])}for(var O=0;O<m.length;O++){y.on(m[O],this._on[m[O]])}this._shapes.push(y.render());return this}},{key:"fitFilter",value:function t(e){if(arguments.length){this._zoomSet=false;if(typeof e==="function")return this._fitFilter=e,this;if(!(e instanceof Array))e=[e];return this._fitFilter=function(t){return e.includes(t.id)},this}return this._fitFilter}},{key:"fitKey",value:function t(e){if(arguments.length){this._fitKey=e;this._zoomSet=false;return this}return this._fitKey}},{key:"fitObject",value:function t(e,r){if(arguments.length){if(typeof e==="string"){var n=this._queue.find(function(t){return t[3]==="fitObject"});var i=[c.dataLoad.bind(this),e,r,"fitObject"];if(n)this._queue[this._queue.indexOf(n)]=i;else this._queue.push(i)}else{this._fitObject=e}this._zoomSet=false;return this}return this._fitObject}},{key:"ocean",value:function t(e){return arguments.length?(this._ocean=e,this):this._ocean}},{key:"point",value:function t(e){return arguments.length?(this._point=typeof e==="function"?e:k.constant(e),this):this._point}},{key:"pointSize",value:function t(e){return arguments.length?(this._pointSize=typeof e==="function"?e:k.constant(e),this):this._pointSize}},{key:"pointSizeMax",value:function t(e){return arguments.length?(this._pointSizeMax=e,this):this._pointSizeMax}},{key:"pointSizeMin",value:function t(e){return arguments.length?(this._pointSizeMin=e,this):this._pointSizeMin}},{key:"projection",value:function t(e){if(arguments.length&&e!=="geoMercator")this.tiles(false);return arguments.length?(this._projection=typeof e==="string"?A[e]?A[e]():A.geoMercator():e,this):this._projection}},{key:"projectionPadding",value:function t(e){return arguments.length?(this._projectionPadding=k.parseSides(e),this):this._projectionPadding}},{key:"projectionRotate",value:function t(e){if(arguments.length){this._projection.rotate(e);this.tiles(false);this._zoomSet=false;return this}else{return this._projectionRotate}}},{key:"tiles",value:function t(e){if(arguments.length){this._tiles=e;var r=v(this._tileUrl);if(e&&this._attribution==="")this._attribution=r;else if(!e&&this._attribution===r)this._attribution="";return this}return this._tiles}},{key:"tileUrl",value:function t(e){if(arguments.length){this._tileUrl=e;if(this._tiles)this._attribution=v(e);if(this._tileGroup)this._renderTiles.bind(this)();return this}return this._tileUrl}},{key:"topojson",value:function t(e,r){if(arguments.length){if(typeof e==="string"){var n=this._queue.find(function(t){return t[3]==="topojson"});var i=[c.dataLoad.bind(this),e,r,"topojson"];if(n)this._queue[this._queue.indexOf(n)]=i;else this._queue.push(i)}else{this._topojson=e}this._zoomSet=false;return this}return this._topojson}},{key:"topojsonFill",value:function t(e){return arguments.length?(this._topojsonFill=typeof e==="function"?e:k.constant(e),this):this._topojsonFill}},{key:"topojsonFilter",value:function t(e){if(arguments.length){this._zoomSet=false;if(typeof e==="function")return this._topojsonFilter=e,this;if(!(e instanceof Array))e=[e];return this._topojsonFilter=function(t){return e.includes(t.id)},this}return this._topojsonFilter}},{key:"topojsonKey",value:function t(e){if(arguments.length){this._topojsonKey=e;this._zoomSet=false;return this}return this._topojsonKey}},{key:"topojsonId",value:function t(e){return arguments.length?(this._topojsonId=typeof e==="function"?e:k.accessor(e),this):this._topojsonId}}]);return P}(c.Viz);t.Geomap=_;Object.defineProperty(t,"__esModule",{value:true})});