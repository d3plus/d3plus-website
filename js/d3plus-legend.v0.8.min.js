/*
  d3plus-legend v0.8.15
  An easy to use javascript chart legend.
  Copyright (c) 2017 D3plus - https://d3plus.org
  @license MIT
*/
if(typeof Object.assign!=="function"){Object.defineProperty(Object,"assign",{value:function t(i){"use strict";if(i===null){throw new TypeError("Cannot convert undefined or null to object")}var e=Object(i);for(var n=1;n<arguments.length;n++){var r=arguments[n];if(r!==null){for(var h in r){if(Object.prototype.hasOwnProperty.call(r,h)){e[h]=r[h]}}}}return e},writable:true,configurable:true})}if(!Array.prototype.includes){Object.defineProperty(Array.prototype,"includes",{value:function t(i,e){var n=Object(this);var r=n.length>>>0;if(r===0)return false;var h=e|0;var s=Math.max(h>=0?h:r-Math.abs(h),0);function o(t,i){return t===i||typeof t==="number"&&typeof i==="number"&&isNaN(t)&&isNaN(i)}while(s<r){if(o(n[s],i)){return true}s++}return false}})}(function(t,i){typeof exports==="object"&&typeof module!=="undefined"?i(exports,require("d3-array"),require("d3-interpolate"),require("d3-scale"),require("d3-selection"),require("d3plus-axis"),require("d3plus-color"),require("d3plus-common"),require("d3plus-shape"),require("d3plus-text")):typeof define==="function"&&define.amd?define("d3plus-legend",["exports","d3-array","d3-interpolate","d3-scale","d3-selection","d3plus-axis","d3plus-color","d3plus-common","d3plus-shape","d3plus-text"],i):i(t.d3plus={},t.d3Array,t.d3Interpolate,t.d3Scale,t.d3Selection,t.d3plusAxis,t.d3plusColor,t.d3plusCommon,t.shapes,t.d3plusText)})(this,function(t,i,e,n,r,h,s,o,a,l){"use strict";function u(t){return t.slice().sort(function(t,i){return t-i})}function d(t){var i,e=0;for(var n=0;n<t.length;n++){if(n===0||t[n]!==i){i=t[n];e++}}return e}function _(t,i){var e=[];for(var n=0;n<t;n++){var r=[];for(var h=0;h<i;h++){r.push(0)}e.push(r)}return e}function c(t,i,e,n){var r;if(t>0){var h=(e[i]-e[t-1])/(i-t+1);r=n[i]-n[t-1]-(i-t+1)*h*h}else{r=n[i]-e[i]*e[i]/(i+1)}if(r<0){return 0}return r}function f(t,i,e,n,r,h,s){if(t>i){return}var o=Math.floor((t+i)/2);n[e][o]=n[e-1][o-1];r[e][o]=o;var a=e;if(t>e){a=Math.max(a,r[e][t-1]||0)}a=Math.max(a,r[e-1][o]||0);var l=o-1;if(i<n.length-1){l=Math.min(l,r[e][i+1]||0)}for(var u=l;u>=a;--u){var d=c(u,o,h,s);if(d+n[e-1][a-1]>=n[e][o]){break}var _=c(a,o,h,s);var g=_+n[e-1][a-1];if(g<n[e][o]){n[e][o]=g;r[e][o]=a}a++;var p=d+n[e-1][u-1];if(p<n[e][o]){n[e][o]=p;r[e][o]=u}}f(t,o-1,e,n,r,h,s);f(o+1,i,e,n,r,h,s)}function g(t,i,e){var n=i[0].length;var r=t[Math.floor(n/2)];var h=[];var s=[];for(var o=0,a=void 0;o<n;++o){a=t[o]-r;if(o===0){h.push(a);s.push(a*a)}else{h.push(h[o-1]+a);s.push(s[o-1]+a*a)}i[0][o]=c(0,o,h,s);e[0][o]=0}for(var l=1;l<i.length;++l){var u=n-1;if(l<i.length-1){u=l}f(u,n-1,l,i,e,h,s)}}function p(t,i){if(i>t.length){throw new Error("Cannot generate more classes than there are data values")}var e=u(t);var n=d(e);if(n===1){return[e]}var r=_(i,e.length),h=_(i,e.length);g(e,h,r);var s=r[0].length-1;var o=[];for(var a=r.length-1;a>=0;a--){var l=r[a][s];o[a]=e.slice(l,s+1);if(a>0){s=l-1}}return o}var v=function(t){function l(){t.call(this);this._axisClass=new h.Axis;this._axisConfig={gridSize:0};this._axisTest=new h.Axis;this._align="middle";this._color="#0C8040";this._data=[];this._duration=600;this._height=200;this._orient="bottom";this._outerBounds={width:0,height:0,x:0,y:0};this._padding=5;this._rectClass=new a.Rect;this._rectConfig={stroke:"#000",strokeWidth:1};this._scale="linear";this._size=10;this._value=o.accessor("value");this._width=400}if(t)l.__proto__=t;l.prototype=Object.create(t&&t.prototype);l.prototype.constructor=l;l.prototype.render=function t(h){var a=this;var l;if(this._select===void 0){this.select(r.select("body").append("svg").attr("width",this._width+"px").attr("height",this._height+"px").node())}var u=["bottom","top"].includes(this._orient);var d=u?"height":"width",_=u?"width":"height",c=u?"x":"y",f=u?"y":"x";this._group=o.elem("g.d3plus-ColorScale",{parent:this._select});var g=i.extent(this._data,this._value);var v=this._color,y;if(!(v instanceof Array)){v=[s.colorLighter(v,.9),s.colorLighter(v,.75),s.colorLighter(v,.5),s.colorLighter(v,.25),v]}if(this._scale==="jenks"){var w=this._data.map(this._value).filter(function(t){return t!==null&&typeof t==="number"});if(w.length<=v.length){var m=n.scaleLinear().domain(i.range(0,w.length-1)).interpolate(e.interpolateHsl).range(v);v=w.slice(0,w.length-1).map(function(t,i){return m(i)})}var x=p(w,v.length);y=i.merge(x.map(function(t,i){return i===x.length-1?[t[0],t[t.length-1]]:[t[0]]}));this._colorScale=n.scaleThreshold().domain(y).range(["black"].concat(v).concat(v[v.length-1]))}else{var C=(g[1]-g[0])/(v.length-1);var b=i.range(g[0],g[1]+C/2,C);if(this._scale==="buckets"){y=b}this._colorScale=n.scaleLinear().domain(b).range(v)}var B=Object.assign({domain:u?g:g.reverse(),duration:this._duration,height:this._height,labels:y,orient:this._orient,padding:this._padding,ticks:y,width:this._width},this._axisConfig);this._axisTest.select(o.elem("g.d3plus-ColorScale-axisTest",{enter:{opacity:0},parent:this._group}).node()).config(B).render();var H=this._axisTest.outerBounds();this._outerBounds[_]=this["_"+_]-this._padding*2;this._outerBounds[d]=H[d]+this._size;this._outerBounds[c]=this._padding;this._outerBounds[f]=this._padding;if(this._align==="middle"){this._outerBounds[f]=(this["_"+d]-this._outerBounds[d])/2}else if(this._align==="end"){this._outerBounds[f]=this["_"+d]-this._padding-this._outerBounds[d]}var D=this._outerBounds[f]+(["bottom","right"].includes(this._orient)?this._size:0)-(B.padding||this._axisClass.padding());this._axisClass.select(o.elem("g.d3plus-ColorScale-axis",{parent:this._group,update:{transform:"translate("+(u?0:D)+", "+(u?D:0)+")"}}).node()).config(B).align("start").render();var z=this._axisTest._getPosition.bind(this._axisTest);var S=this._axisTest._getRange();var W=this._group.selectAll("defs").data([0]);var A=W.enter().append("defs");A.append("linearGradient").attr("id","gradient-"+this._uuid);W=A.merge(W);W.select("linearGradient").attr(c+"1",u?"0%":"100%").attr(c+"2",u?"100%":"0%").attr(f+"1","0%").attr(f+"2","0%");var j=W.select("linearGradient").selectAll("stop").data(v);j.enter().append("stop").merge(j).attr("offset",function(t,i){return i/(v.length-1)*100+"%"}).attr("stop-color",String);function O(t,i){var e=Math.abs(z(y[i+1])-z(t));return e||2}this._rectClass.data(y?y.slice(0,y.length-1):[0]).id(function(t,i){return i}).select(o.elem("g.d3plus-ColorScale-Rect",{parent:this._group}).node()).config((l={fill:y?function(t){return a._colorScale(t)}:"url(#gradient-"+this._uuid+")"},l[c]=y?function(t,i){return z(t)+O(t,i)/2-(["left","right"].includes(a._orient)?O(t,i):0)}:S[0]+(S[1]-S[0])/2,l[f]=this._outerBounds[f]+(["top","left"].includes(this._orient)?H[d]:0)+this._size/2,l[_]=y?O:S[1]-S[0],l[d]=this._size,l)).config(this._rectConfig).render();if(h){setTimeout(h,this._duration+100)}return this};l.prototype.axisConfig=function t(i){return arguments.length?(this._axisConfig=Object.assign(this._axisConfig,i),this):this._axisConfig};l.prototype.align=function t(i){return arguments.length?(this._align=i,this):this._align};l.prototype.color=function t(i){return arguments.length?(this._color=i,this):this._color};l.prototype.data=function t(i){return arguments.length?(this._data=i,this):this._data};l.prototype.duration=function t(i){return arguments.length?(this._duration=i,this):this._duration};l.prototype.height=function t(i){return arguments.length?(this._height=i,this):this._height};l.prototype.orient=function t(i){return arguments.length?(this._orient=i,this):this._orient};l.prototype.outerBounds=function t(){return this._outerBounds};l.prototype.padding=function t(i){return arguments.length?(this._padding=i,this):this._padding};l.prototype.rectConfig=function t(i){return arguments.length?(this._rectConfig=Object.assign(this._rectConfig,i),this):this._rectConfig};l.prototype.scale=function t(i){return arguments.length?(this._scale=i,this):this._scale};l.prototype.select=function t(i){return arguments.length?(this._select=r.select(i),this):this._select};l.prototype.size=function t(i){return arguments.length?(this._size=i,this):this._size};l.prototype.value=function t(i){return arguments.length?(this._value=typeof i==="function"?i:o.constant(i),this):this._value};l.prototype.width=function t(i){return arguments.length?(this._width=i,this):this._width};return l}(o.BaseClass);var y=function(t){function e(){var e=this;t.call(this);this._align="center";this._data=[];this._direction="row";this._duration=600;this._height=200;this._id=o.accessor("id");this._label=o.accessor("id");this._lineData=[];this._outerBounds={width:0,height:0,x:0,y:0};this._padding=5;this._shape=o.constant("Rect");this._shapes=[];this._shapeConfig={duration:this._duration,fill:o.accessor("color"),height:o.constant(10),hitArea:function(t,n){var r=e._lineData[n],h=i.max([r.height,r.shapeHeight]);return{width:r.width+r.shapeWidth,height:h,x:-r.shapeWidth/2,y:-h/2}},labelBounds:function(t,i,n){var r=e._lineData[i],h=n.r!==void 0?n.r:n.width/2;return{width:r.width,height:r.height,x:h+e._padding,y:-r.height/2+(r.lh-r.s)/2+1}},labelConfig:{fontColor:o.constant("#444"),fontFamily:(new l.TextBox).fontFamily(),fontResize:false,fontSize:o.constant(10)},opacity:1,r:o.constant(5),width:o.constant(10),x:function(t,i){var n=e._lineData[i];var r=n.y;var h=e._align==="left"||e._align==="right"&&e._direction==="column"?0:e._align==="center"?(e._outerBounds.width-e._rowWidth(e._lineData.filter(function(t){return r===t.y})))/2:e._outerBounds.width-e._rowWidth(e._lineData.filter(function(t){return r===t.y}));var s=e._lineData.slice(0,i).filter(function(t){return r===t.y});return e._rowWidth(s)+e._padding*(s.length?n.sentence?2:1:0)+e._outerBounds.x+n.shapeWidth/2+h},y:function(t,n){var r=e._lineData[n];return r.y+e._titleHeight+e._outerBounds.y+i.max(e._lineData.filter(function(t){return r.y===t.y}).map(function(t){return t.height}).concat(e._data.map(function(t,i){return e._fetchConfig("height",t,i)})))/2}};this._titleClass=new l.TextBox;this._titleConfig={};this._verticalAlign="middle";this._width=400}if(t)e.__proto__=t;e.prototype=Object.create(t&&t.prototype);e.prototype.constructor=e;e.prototype._fetchConfig=function t(i,e,n){var r=this._shapeConfig[i]||this._shapeConfig.labelConfig[i];if(!r&&i==="lineHeight"){return this._fetchConfig("fontSize",e,n)*1.4}return typeof r==="function"?r(e,n):r};e.prototype._rowHeight=function t(e){return i.max(e.map(function(t){return t.height}).concat(e.map(function(t){return t.shapeHeight})))+this._padding};e.prototype._rowWidth=function t(e){var n=this;return i.sum(e.map(function(t,i){var r=n._padding*(i===e.length-1?0:t.width?2:1);return t.shapeWidth+t.width+r}))};e.prototype.render=function t(e){var n=this;if(this._select===void 0){this.select(r.select("body").append("svg").attr("width",this._width+"px").attr("height",this._height+"px").node())}this._group=o.elem("g.d3plus-Legend",{parent:this._select});var h=this._height;this._titleHeight=0;if(this._title){var s=this._titleConfig.fontFamily||this._titleClass.fontFamily()(),u=this._titleConfig.fontSize||this._titleClass.fontSize()();var d=d=this._titleConfig.lineHeight||this._titleClass.lineHeight();d=d?d():u*1.4;var _=l.textWrap().fontFamily(s).fontSize(u).lineHeight(d).width(this._width).height(this._height)(this._title);this._titleHeight=d+_.lines.length+this._padding;h-=this._titleHeight}this._lineData=this._data.map(function(t,e){var r=n._label(t,e);var s={data:t,i:e,id:n._id(t,e),shapeWidth:n._fetchConfig("width",t,e),shapeHeight:n._fetchConfig("height",t,e),y:0};if(!r){s.sentence=false;s.words=[];s.height=0;s.width=0;return s}var o=n._fetchConfig("fontFamily",t,e),a=n._fetchConfig("lineHeight",t,e),u=n._fetchConfig("fontSize",t,e);var d=h-(n._data.length+1)*n._padding,_=n._width;s=Object.assign(s,l.textWrap().fontFamily(o).fontSize(u).lineHeight(a).width(_).height(d)(r));s.width=Math.ceil(i.max(s.lines.map(function(t){return l.textWidth(t,{"font-family":o,"font-size":u})})))+u*.75;s.height=Math.ceil(s.lines.length*(a+1));s.og={height:s.height,width:s.width};s.f=o;s.s=u;s.lh=a;return s});var c;var f=this._width-this._padding*2;c=this._rowWidth(this._lineData);if(this._direction==="column"||c>f){var g=1,p=[];var v=i.max(this._lineData.map(function(t){return t.words.length}));this._wrapLines=function(){var t=this;g++;if(g>v){return}var e=g===1?this._lineData.slice():this._lineData.filter(function(i){return i.width+i.shapeWidth+t._padding*(i.width?2:1)>f&&i.words.length>=g}).sort(function(t,i){return i.sentence.length-t.sentence.length});if(e.length&&h>e[0].height*g){var n=false;var r=function(t){var r=e[t];var h=r.og.height*g,s=r.og.width*(1.5*(1/g));var o=l.textWrap().fontFamily(r.f).fontSize(r.s).lineHeight(r.lh).width(s).height(h)(r.sentence);if(!o.truncated){r.width=Math.ceil(i.max(o.lines.map(function(t){return l.textWidth(t,{"font-family":r.f,"font-size":r.s})})))+r.s;r.height=o.lines.length*(r.lh+1)}else{n=true;return"break"}};for(var s=0;s<e.length;s++){var o=r(s);if(o==="break")break}if(!n){this._wrapRows()}}else{p=[];return}};this._wrapRows=function(){var t=this;p=[];var e=1,n=0;for(var r=0;r<this._lineData.length;r++){var s=t._lineData[r],o=s.width+t._padding*(s.width?2:1)+s.shapeWidth;if(i.sum(p.map(function(t){return i.max(t,function(t){return i.max([t.height,t.shapeHeight])})}))>h){p=[];break}if(o>f){p=[];t._wrapLines();break}else if(n+o<f){n+=o}else if(t._direction!=="column"){n=o;e++}if(!p[e-1]){p[e-1]=[]}p[e-1].push(s);if(t._direction==="column"){n=0;e++}}};this._wrapRows();if(!p.length||i.sum(p,this._rowHeight.bind(this))+this._padding>h){c=i.sum(this._lineData.map(function(t){return t.shapeWidth+n._padding}))-this._padding;for(var y=0;y<this._lineData.length;y++){n._lineData[y].width=0;n._lineData[y].height=0}this._wrapRows()}if(p.length&&i.sum(p,this._rowHeight.bind(this))+this._padding<h){p.forEach(function(t,e){t.forEach(function(t){if(e){t.y=i.sum(p.slice(0,e),n._rowHeight.bind(n))}})});c=i.max(p,this._rowWidth.bind(this))}}var w=i.max(this._lineData,function(t,e){return i.max([t.height,n._fetchConfig("height",t.data,e)])+t.y})+this._titleHeight,m=c;this._outerBounds.width=m;this._outerBounds.height=w;var x=this._padding,C=this._padding;if(this._align==="center"){x=(this._width-m)/2}else if(this._align==="right"){x=this._width-this._padding-m}if(this._verticalAlign==="middle"){C=(this._height-w)/2}else if(this._verticalAlign==="bottom"){C=this._height-this._padding-w}this._outerBounds.x=x;this._outerBounds.y=C;this._titleClass.data(this._title?[{text:this._title}]:[]).duration(this._duration).select(this._group.node()).textAnchor({left:"start",center:"middle",right:"end"}[this._align]).width(this._width-this._padding*2).x(this._padding).y(this._outerBounds.y).config(this._titleConfig).render();this._shapes=[];var b=o.configPrep.bind(this)(this._shapeConfig,"legend"),B={id:function(t){return t.id},label:function(t){return t.label},lineHeight:function(t){return t.lH}};var H=this._data.map(function(t,i){var e={__d3plus__:true,data:t,i:i,id:n._id(t,i),label:n._lineData[i].width?n._label(t,i):false,lH:n._fetchConfig("lineHeight",t,i),shape:n._shape(t,i)};return e});this._shapes=[];["Circle","Rect"].forEach(function(t){n._shapes.push((new a[t]).data(H.filter(function(i){return i.shape===t})).duration(n._duration).labelPadding(0).select(n._group.node()).verticalAlign("top").config(o.assign({},b,B)).render())});if(e){setTimeout(e,this._duration+100)}return this};e.prototype.active=function t(i){this._shapes.forEach(function(t){return t.active(i)});return this};e.prototype.align=function t(i){return arguments.length?(this._align=i,this):this._align};e.prototype.data=function t(i){return arguments.length?(this._data=i,this):this._data};e.prototype.direction=function t(i){return arguments.length?(this._direction=i,this):this._direction};e.prototype.duration=function t(i){return arguments.length?(this._duration=i,this):this._duration};e.prototype.height=function t(i){return arguments.length?(this._height=i,this):this._height};e.prototype.hover=function t(i){this._shapes.forEach(function(t){return t.hover(i)});return this};e.prototype.id=function t(i){return arguments.length?(this._id=i,this):this._id};e.prototype.label=function t(i){return arguments.length?(this._label=typeof i==="function"?i:o.constant(i),this):this._label};e.prototype.outerBounds=function t(){return this._outerBounds};e.prototype.padding=function t(i){return arguments.length?(this._padding=i,this):this._padding};e.prototype.select=function t(i){return arguments.length?(this._select=r.select(i),this):this._select};e.prototype.shape=function t(i){return arguments.length?(this._shape=typeof i==="function"?i:o.constant(i),this):this._shape};e.prototype.shapeConfig=function t(i){return arguments.length?(this._shapeConfig=o.assign(this._shapeConfig,i),this):this._shapeConfig};e.prototype.title=function t(i){return arguments.length?(this._title=i,this):this._title};e.prototype.titleConfig=function t(i){return arguments.length?(this._titleConfig=o.assign(this._titleConfig,i),this):this._titleConfig};e.prototype.verticalAlign=function t(i){return arguments.length?(this._verticalAlign=i,this):this._verticalAlign};e.prototype.width=function t(i){return arguments.length?(this._width=i,this):this._width};return e}(o.BaseClass);t.ckmeans=p;t.ColorScale=v;t.Legend=y;Object.defineProperty(t,"__esModule",{value:true})});