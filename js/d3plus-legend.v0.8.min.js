/*
  d3plus-legend v0.8.18
  An easy to use javascript chart legend.
  Copyright (c) 2018 D3plus - https://d3plus.org
  @license MIT
*/
if(typeof Object.assign!=="function"){Object.defineProperty(Object,"assign",{value:function t(i){"use strict";if(i===null){throw new TypeError("Cannot convert undefined or null to object")}var e=Object(i);for(var n=1;n<arguments.length;n++){var r=arguments[n];if(r!==null){for(var h in r){if(Object.prototype.hasOwnProperty.call(r,h)){e[h]=r[h]}}}}return e},writable:true,configurable:true})}if(!Array.prototype.includes){Object.defineProperty(Array.prototype,"includes",{value:function t(i,e){var n=Object(this);var r=n.length>>>0;if(r===0)return false;var h=e|0;var s=Math.max(h>=0?h:r-Math.abs(h),0);function o(t,i){return t===i||typeof t==="number"&&typeof i==="number"&&isNaN(t)&&isNaN(i)}while(s<r){if(o(n[s],i)){return true}s++}return false}})}(function(t,i){typeof exports==="object"&&typeof module!=="undefined"?i(exports,require("d3-array"),require("d3-interpolate"),require("d3-scale"),require("d3-selection"),require("d3plus-axis"),require("d3plus-color"),require("d3plus-common"),require("d3plus-shape"),require("d3plus-text")):typeof define==="function"&&define.amd?define("d3plus-legend",["exports","d3-array","d3-interpolate","d3-scale","d3-selection","d3plus-axis","d3plus-color","d3plus-common","d3plus-shape","d3plus-text"],i):i(t.d3plus={},t.d3Array,t.d3Interpolate,t.d3Scale,t.d3Selection,t.d3plusAxis,t.d3plusColor,t.d3plusCommon,t.shapes,t.d3plusText)})(this,function(t,S,W,A,j,e,O,T,x,C){"use strict";function u(t){return t.slice().sort(function(t,i){return t-i})}function d(t){var i,e=0;for(var n=0;n<t.length;n++){if(n===0||t[n]!==i){i=t[n];e++}}return e}function _(t,i){var e=[];for(var n=0;n<t;n++){var r=[];for(var h=0;h<i;h++){r.push(0)}e.push(r)}return e}function g(t,i,e,n){var r;if(t>0){var h=(e[i]-e[t-1])/(i-t+1);r=n[i]-n[t-1]-(i-t+1)*h*h}else{r=n[i]-e[i]*e[i]/(i+1)}if(r<0){return 0}return r}function p(t,i,e,n,r,h,s){if(t>i){return}var o=Math.floor((t+i)/2);n[e][o]=n[e-1][o-1];r[e][o]=o;var a=e;if(t>e){a=Math.max(a,r[e][t-1]||0)}a=Math.max(a,r[e-1][o]||0);var l=o-1;if(i<n.length-1){l=Math.min(l,r[e][i+1]||0)}for(var u=l;u>=a;--u){var d=g(u,o,h,s);if(d+n[e-1][a-1]>=n[e][o]){break}var _=g(a,o,h,s);var c=_+n[e-1][a-1];if(c<n[e][o]){n[e][o]=c;r[e][o]=a}a++;var f=d+n[e-1][u-1];if(f<n[e][o]){n[e][o]=f;r[e][o]=u}}p(t,o-1,e,n,r,h,s);p(o+1,i,e,n,r,h,s)}function c(t,i,e){var n=i[0]?i[0].length:0;var r=t[Math.floor(n/2)];var h=[];var s=[];for(var o=0,a=void 0;o<n;++o){a=t[o]-r;if(o===0){h.push(a);s.push(a*a)}else{h.push(h[o-1]+a);s.push(s[o-1]+a*a)}i[0][o]=g(0,o,h,s);e[0][o]=0}for(var l=1;l<i.length;++l){var u=n-1;if(l<i.length-1){u=l}p(u,n-1,l,i,e,h,s)}}function k(t,i){if(i>t.length){throw new Error("Cannot generate more classes than there are data values")}var e=u(t);var n=d(e);if(n===1){return[e]}var r=_(i,e.length),h=_(i,e.length);c(e,h,r);var s=r[0]?r[0].length-1:0;var o=[];for(var a=r.length-1;a>=0;a--){var l=r[a][s];o[a]=e.slice(l,s+1);if(a>0){s=l-1}}return o}var i=function(t){function i(){t.call(this);this._axisClass=new e.Axis;this._axisConfig={gridSize:0};this._axisTest=new e.Axis;this._align="middle";this._color="#0C8040";this._data=[];this._duration=600;this._height=200;this._orient="bottom";this._outerBounds={width:0,height:0,x:0,y:0};this._padding=5;this._rectClass=new x.Rect;this._rectConfig={stroke:"#000",strokeWidth:1};this._scale="linear";this._size=10;this._value=T.accessor("value");this._width=400}if(t)i.__proto__=t;i.prototype=Object.create(t&&t.prototype);i.prototype.constructor=i;i.prototype.render=function t(i){var e=this;var n;if(this._select===void 0){this.select(j.select("body").append("svg").attr("width",this._width+"px").attr("height",this._height+"px").node())}var r=["bottom","top"].includes(this._orient);var h=r?"height":"width",s=r?"width":"height",o=r?"x":"y",a=r?"y":"x";this._group=T.elem("g.d3plus-ColorScale",{parent:this._select});var l=S.extent(this._data,this._value);var u=this._color,d,_;if(!(u instanceof Array)){u=[O.colorLighter(u,.9),O.colorLighter(u,.75),O.colorLighter(u,.5),O.colorLighter(u,.25),u]}if(this._scale==="jenks"){var c=this._data.map(this._value).filter(function(t){return t!==null&&typeof t==="number"});if(c.length<=u.length){var f=A.scaleLinear().domain(S.range(0,c.length-1)).interpolate(W.interpolateHsl).range(u);u=c.slice(0,c.length-1).map(function(t,i){return f(i)})}var g=k(c,u.length);_=S.merge(g.map(function(t,i){return i===g.length-1?[t[0],t[t.length-1]]:[t[0]]}));var p=new Set(_);if(_.length!==p.size){d=Array.from(p)}this._colorScale=A.scaleThreshold().domain(_).range(["black"].concat(u).concat(u[u.length-1]))}else{var v=(l[1]-l[0])/(u.length-1);var y=S.range(l[0],l[1]+v/2,v);if(this._scale==="buckets"){_=y}this._colorScale=A.scaleLinear().domain(y).range(u)}var w=Object.assign({domain:r?l:l.reverse(),duration:this._duration,height:this._height,labels:d||_,orient:this._orient,padding:this._padding,ticks:_,width:this._width},this._axisConfig);this._axisTest.select(T.elem("g.d3plus-ColorScale-axisTest",{enter:{opacity:0},parent:this._group}).node()).config(w).render();var m=this._axisTest.outerBounds();this._outerBounds[s]=this["_"+s]-this._padding*2;this._outerBounds[h]=m[h]+this._size;this._outerBounds[o]=this._padding;this._outerBounds[a]=this._padding;if(this._align==="middle"){this._outerBounds[a]=(this["_"+h]-this._outerBounds[h])/2}else if(this._align==="end"){this._outerBounds[a]=this["_"+h]-this._padding-this._outerBounds[h]}var x=this._outerBounds[a]+(["bottom","right"].includes(this._orient)?this._size:0)-(w.padding||this._axisClass.padding());this._axisClass.select(T.elem("g.d3plus-ColorScale-axis",{parent:this._group,update:{transform:"translate("+(r?0:x)+", "+(r?x:0)+")"}}).node()).config(w).align("start").render();var C=this._axisTest._getPosition.bind(this._axisTest);var b=this._axisTest._getRange();var B=this._group.selectAll("defs").data([0]);var H=B.enter().append("defs");H.append("linearGradient").attr("id","gradient-"+this._uuid);B=H.merge(B);B.select("linearGradient").attr(o+"1",r?"0%":"100%").attr(o+"2",r?"100%":"0%").attr(a+"1","0%").attr(a+"2","0%");var D=B.select("linearGradient").selectAll("stop").data(u);D.enter().append("stop").merge(D).attr("offset",function(t,i){return i/(u.length-1)*100+"%"}).attr("stop-color",String);function z(t,i){var e=Math.abs(C(_[i+1])-C(t));return e||2}this._rectClass.data(_?_.slice(0,_.length-1):[0]).id(function(t,i){return i}).select(T.elem("g.d3plus-ColorScale-Rect",{parent:this._group}).node()).config((n={fill:_?function(t){return e._colorScale(t)}:"url(#gradient-"+this._uuid+")"},n[o]=_?function(t,i){return C(t)+z(t,i)/2-(["left","right"].includes(e._orient)?z(t,i):0)}:b[0]+(b[1]-b[0])/2,n[a]=this._outerBounds[a]+(["top","left"].includes(this._orient)?m[h]:0)+this._size/2,n[s]=_?z:b[1]-b[0],n[h]=this._size,n)).config(this._rectConfig).render();if(i){setTimeout(i,this._duration+100)}return this};i.prototype.axisConfig=function t(i){return arguments.length?(this._axisConfig=Object.assign(this._axisConfig,i),this):this._axisConfig};i.prototype.align=function t(i){return arguments.length?(this._align=i,this):this._align};i.prototype.color=function t(i){return arguments.length?(this._color=i,this):this._color};i.prototype.data=function t(i){return arguments.length?(this._data=i,this):this._data};i.prototype.duration=function t(i){return arguments.length?(this._duration=i,this):this._duration};i.prototype.height=function t(i){return arguments.length?(this._height=i,this):this._height};i.prototype.orient=function t(i){return arguments.length?(this._orient=i,this):this._orient};i.prototype.outerBounds=function t(){return this._outerBounds};i.prototype.padding=function t(i){return arguments.length?(this._padding=i,this):this._padding};i.prototype.rectConfig=function t(i){return arguments.length?(this._rectConfig=Object.assign(this._rectConfig,i),this):this._rectConfig};i.prototype.scale=function t(i){return arguments.length?(this._scale=i,this):this._scale};i.prototype.select=function t(i){return arguments.length?(this._select=j.select(i),this):this._select};i.prototype.size=function t(i){return arguments.length?(this._size=i,this):this._size};i.prototype.value=function t(i){return arguments.length?(this._value=typeof i==="function"?i:T.constant(i),this):this._value};i.prototype.width=function t(i){return arguments.length?(this._width=i,this):this._width};return i}(T.BaseClass);var n=function(t){function i(){var s=this;t.call(this);this._align="center";this._data=[];this._direction="row";this._duration=600;this._height=200;this._id=T.accessor("id");this._label=T.accessor("id");this._lineData=[];this._outerBounds={width:0,height:0,x:0,y:0};this._padding=5;this._shape=T.constant("Rect");this._shapes=[];this._shapeConfig={duration:this._duration,fill:T.accessor("color"),height:T.constant(10),hitArea:function(t,i){var e=s._lineData[i],n=S.max([e.height,e.shapeHeight]);return{width:e.width+e.shapeWidth,height:n,x:-e.shapeWidth/2,y:-n/2}},labelBounds:function(t,i,e){var n=s._lineData[i],r=e.r!==void 0?e.r:e.width/2;return{width:n.width,height:n.height,x:r+s._padding,y:-n.height/2+(n.lh-n.s)/2+1}},labelConfig:{fontColor:T.constant("#444"),fontFamily:(new C.TextBox).fontFamily(),fontResize:false,fontSize:T.constant(10)},opacity:1,r:T.constant(5),width:T.constant(10),x:function(t,i){var e=s._lineData[i];var n=e.y;var r=s._align==="left"||s._align==="right"&&s._direction==="column"?0:s._align==="center"?(s._outerBounds.width-s._rowWidth(s._lineData.filter(function(t){return n===t.y})))/2:s._outerBounds.width-s._rowWidth(s._lineData.filter(function(t){return n===t.y}));var h=s._lineData.slice(0,i).filter(function(t){return n===t.y});return s._rowWidth(h)+s._padding*(h.length?e.sentence?2:1:0)+s._outerBounds.x+e.shapeWidth/2+r},y:function(t,i){var e=s._lineData[i];return e.y+s._titleHeight+s._outerBounds.y+S.max(s._lineData.filter(function(t){return e.y===t.y}).map(function(t){return t.height}).concat(s._data.map(function(t,i){return s._fetchConfig("height",t,i)})))/2}};this._titleClass=new C.TextBox;this._titleConfig={};this._verticalAlign="middle";this._width=400}if(t)i.__proto__=t;i.prototype=Object.create(t&&t.prototype);i.prototype.constructor=i;i.prototype._fetchConfig=function t(i,e,n){var r=this._shapeConfig[i]||this._shapeConfig.labelConfig[i];if(!r&&i==="lineHeight"){return this._fetchConfig("fontSize",e,n)*1.4}return typeof r==="function"?r(e,n):r};i.prototype._rowHeight=function t(i){return S.max(i.map(function(t){return t.height}).concat(i.map(function(t){return t.shapeHeight})))+this._padding};i.prototype._rowWidth=function t(n){var r=this;return S.sum(n.map(function(t,i){var e=r._padding*(i===n.length-1?0:t.width?2:1);return t.shapeWidth+t.width+e}))};i.prototype.render=function t(i){var l=this;if(this._select===void 0){this.select(j.select("body").append("svg").attr("width",this._width+"px").attr("height",this._height+"px").node())}this._group=T.elem("g.d3plus-Legend",{parent:this._select});var u=this._height;this._titleHeight=0;if(this._title){var e=this._titleConfig.fontFamily||this._titleClass.fontFamily()(),n=this._titleConfig.fontSize||this._titleClass.fontSize()();var r=r=this._titleConfig.lineHeight||this._titleClass.lineHeight();r=r?r():n*1.4;var h=C.textWrap().fontFamily(e).fontSize(n).lineHeight(r).width(this._width).height(this._height)(this._title);this._titleHeight=r+h.lines.length+this._padding;u-=this._titleHeight}this._lineData=this._data.map(function(t,i){var e=l._label(t,i);var n={data:t,i:i,id:l._id(t,i),shapeWidth:l._fetchConfig("width",t,i),shapeHeight:l._fetchConfig("height",t,i),y:0};if(!e){n.sentence=false;n.words=[];n.height=0;n.width=0;return n}var r=l._fetchConfig("fontFamily",t,i),h=l._fetchConfig("lineHeight",t,i),s=l._fetchConfig("fontSize",t,i);var o=u-(l._data.length+1)*l._padding,a=l._width;n=Object.assign(n,C.textWrap().fontFamily(r).fontSize(s).lineHeight(h).width(a).height(o)(e));n.width=Math.ceil(S.max(n.lines.map(function(t){return C.textWidth(t,{"font-family":r,"font-size":s})})))+s*.75;n.height=Math.ceil(n.lines.length*(h+1));n.og={height:n.height,width:n.width};n.f=r;n.s=s;n.lh=h;return n});var s;var o=this._width-this._padding*2;s=this._rowWidth(this._lineData);if(this._direction==="column"||s>o){var a=1,d=[];var _=S.max(this._lineData.map(function(t){return t.words.length}));this._wrapLines=function(){var i=this;a++;if(a>_){return}var h=a===1?this._lineData.slice():this._lineData.filter(function(t){return t.width+t.shapeWidth+i._padding*(t.width?2:1)>o&&t.words.length>=a}).sort(function(t,i){return i.sentence.length-t.sentence.length});if(h.length&&u>h[0].height*a){var s=false;var t=function(t){var i=h[t];var e=i.og.height*a,n=i.og.width*(1.5*(1/a));var r=C.textWrap().fontFamily(i.f).fontSize(i.s).lineHeight(i.lh).width(n).height(e)(i.sentence);if(!r.truncated){i.width=Math.ceil(S.max(r.lines.map(function(t){return C.textWidth(t,{"font-family":i.f,"font-size":i.s})})))+i.s;i.height=r.lines.length*(i.lh+1)}else{s=true;return"break"}};for(var e=0;e<h.length;e++){var n=t(e);if(n==="break")break}if(!s){this._wrapRows()}}else{d=[];return}};this._wrapRows=function(){var t=this;d=[];var i=1,e=0;for(var n=0;n<this._lineData.length;n++){var r=t._lineData[n],h=r.width+t._padding*(r.width?2:1)+r.shapeWidth;if(S.sum(d.map(function(t){return S.max(t,function(t){return S.max([t.height,t.shapeHeight])})}))>u){d=[];break}if(h>o){d=[];t._wrapLines();break}else if(e+h<o){e+=h}else if(t._direction!=="column"){e=h;i++}if(!d[i-1]){d[i-1]=[]}d[i-1].push(r);if(t._direction==="column"){e=0;i++}}};this._wrapRows();if(!d.length||S.sum(d,this._rowHeight.bind(this))+this._padding>u){s=S.sum(this._lineData.map(function(t){return t.shapeWidth+l._padding}))-this._padding;for(var c=0;c<this._lineData.length;c++){l._lineData[c].width=0;l._lineData[c].height=0}this._wrapRows()}if(d.length&&S.sum(d,this._rowHeight.bind(this))+this._padding<u){d.forEach(function(t,i){t.forEach(function(t){if(i){t.y=S.sum(d.slice(0,i),l._rowHeight.bind(l))}})});s=S.max(d,this._rowWidth.bind(this))}}var f=S.max(this._lineData,function(t,i){return S.max([t.height,l._fetchConfig("height",t.data,i)])+t.y})+this._titleHeight,g=s;this._outerBounds.width=g;this._outerBounds.height=f;var p=this._padding,v=this._padding;if(this._align==="center"){p=(this._width-g)/2}else if(this._align==="right"){p=this._width-this._padding-g}if(this._verticalAlign==="middle"){v=(this._height-f)/2}else if(this._verticalAlign==="bottom"){v=this._height-this._padding-f}this._outerBounds.x=p;this._outerBounds.y=v;this._titleClass.data(this._title?[{text:this._title}]:[]).duration(this._duration).select(this._group.node()).textAnchor({left:"start",center:"middle",right:"end"}[this._align]).width(this._width-this._padding*2).x(this._padding).y(this._outerBounds.y).config(this._titleConfig).render();this._shapes=[];var y=T.configPrep.bind(this)(this._shapeConfig,"legend"),w={id:function(t){return t.id},label:function(t){return t.label},lineHeight:function(t){return t.lH}};var m=this._data.map(function(t,i){var e={__d3plus__:true,data:t,i:i,id:l._id(t,i),label:l._lineData[i].width?l._label(t,i):false,lH:l._fetchConfig("lineHeight",t,i),shape:l._shape(t,i)};return e});this._shapes=[];["Circle","Rect"].forEach(function(i){l._shapes.push((new x[i]).data(m.filter(function(t){return t.shape===i})).duration(l._duration).labelConfig({padding:0}).select(l._group.node()).verticalAlign("top").config(T.assign({},y,w)).render())});if(i){setTimeout(i,this._duration+100)}return this};i.prototype.active=function t(i){this._shapes.forEach(function(t){return t.active(i)});return this};i.prototype.align=function t(i){return arguments.length?(this._align=i,this):this._align};i.prototype.data=function t(i){return arguments.length?(this._data=i,this):this._data};i.prototype.direction=function t(i){return arguments.length?(this._direction=i,this):this._direction};i.prototype.duration=function t(i){return arguments.length?(this._duration=i,this):this._duration};i.prototype.height=function t(i){return arguments.length?(this._height=i,this):this._height};i.prototype.hover=function t(i){this._shapes.forEach(function(t){return t.hover(i)});return this};i.prototype.id=function t(i){return arguments.length?(this._id=i,this):this._id};i.prototype.label=function t(i){return arguments.length?(this._label=typeof i==="function"?i:T.constant(i),this):this._label};i.prototype.outerBounds=function t(){return this._outerBounds};i.prototype.padding=function t(i){return arguments.length?(this._padding=i,this):this._padding};i.prototype.select=function t(i){return arguments.length?(this._select=j.select(i),this):this._select};i.prototype.shape=function t(i){return arguments.length?(this._shape=typeof i==="function"?i:T.constant(i),this):this._shape};i.prototype.shapeConfig=function t(i){return arguments.length?(this._shapeConfig=T.assign(this._shapeConfig,i),this):this._shapeConfig};i.prototype.title=function t(i){return arguments.length?(this._title=i,this):this._title};i.prototype.titleConfig=function t(i){return arguments.length?(this._titleConfig=T.assign(this._titleConfig,i),this):this._titleConfig};i.prototype.verticalAlign=function t(i){return arguments.length?(this._verticalAlign=i,this):this._verticalAlign};i.prototype.width=function t(i){return arguments.length?(this._width=i,this):this._width};return i}(T.BaseClass);t.ckmeans=k;t.ColorScale=i;t.Legend=n;Object.defineProperty(t,"__esModule",{value:true})});