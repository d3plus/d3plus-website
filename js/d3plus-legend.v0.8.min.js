/*
  d3plus-legend v0.8.21
  An easy to use javascript chart legend.
  Copyright (c) 2019 D3plus - https://d3plus.org
  @license MIT
*/
if(typeof Object.assign!=="function"){Object.defineProperty(Object,"assign",{value:function t(i){"use strict";if(i===null){throw new TypeError("Cannot convert undefined or null to object")}var e=Object(i);for(var n=1;n<arguments.length;n++){var r=arguments[n];if(r!==null){for(var s in r){if(Object.prototype.hasOwnProperty.call(r,s)){e[s]=r[s]}}}}return e},writable:true,configurable:true})}if(!Array.prototype.includes){Object.defineProperty(Array.prototype,"includes",{value:function t(i,e){var n=Object(this);var r=n.length>>>0;if(r===0)return false;var s=e|0;var h=Math.max(s>=0?s:r-Math.abs(s),0);function o(t,i){return t===i||typeof t==="number"&&typeof i==="number"&&isNaN(t)&&isNaN(i)}while(h<r){if(o(n[h],i)){return true}h++}return false}})}if(!String.prototype.includes){Object.defineProperty(String.prototype,"includes",{value:function(t,i){if(typeof i!=="number"){i=0}if(i+t.length>this.length){return false}else{return this.indexOf(t,i)!==-1}}})}if(!Array.prototype.find){Object.defineProperty(Array.prototype,"find",{value:function(t){if(this==null){throw new TypeError('"this" is null or not defined')}var i=Object(this);var e=i.length>>>0;if(typeof t!=="function"){throw new TypeError("predicate must be a function")}var n=arguments[1];var r=0;while(r<e){var s=i[r];if(t.call(n,s,r,i)){return s}r++}return undefined},configurable:true,writable:true})}if(!String.prototype.startsWith){Object.defineProperty(String.prototype,"startsWith",{value:function(t,i){i=!i||i<0?0:+i;return this.substring(i,i+t.length)===t}})}if(typeof window!=="undefined"){(function(){var n=function(t,i){var e=t.nodeType;if(e===3){i.push(t.textContent.replace(/&/,"&amp;").replace(/</,"&lt;").replace(">","&gt;"))}else if(e===1){i.push("<",t.tagName);if(t.hasAttributes()){[].forEach.call(t.attributes,function(t){i.push(" ",t.item.name,"='",t.item.value,"'")})}if(t.hasChildNodes()){i.push(">");[].forEach.call(t.childNodes,function(t){n(t,i)});i.push("</",t.tagName,">")}else{i.push("/>")}}else if(e==8){i.push("\x3c!--",t.nodeValue,"--\x3e")}};Object.defineProperty(SVGElement.prototype,"innerHTML",{get:function(){var t=[];var i=this.firstChild;while(i){n(i,t);i=i.nextSibling}return t.join("")},set:function(t){while(this.firstChild){this.removeChild(this.firstChild)}try{var i=new DOMParser;i.async=false;var e="<svg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'>"+t+"</svg>";var n=i.parseFromString(e,"text/xml").documentElement;var r=n.firstChild;while(r){this.appendChild(this.ownerDocument.importNode(r,true));r=r.nextSibling}}catch(t){}}});Object.defineProperty(SVGElement.prototype,"innerSVG",{get:function(){return this.innerHTML},set:function(t){this.innerHTML=t}})})()}(function(t,i){typeof exports==="object"&&typeof module!=="undefined"?i(exports,require("d3-array"),require("d3-selection"),require("d3plus-common"),require("d3plus-shape"),require("d3plus-text"),require("d3-scale"),require("d3plus-axis"),require("d3plus-color")):typeof define==="function"&&define.amd?define("d3plus-legend",["exports","d3-array","d3-selection","d3plus-common","d3plus-shape","d3plus-text","d3-scale","d3plus-axis","d3plus-color"],i):i(t.d3plus={},t.d3Array,t.d3Selection,t.d3plusCommon,t.shapes,t.d3plusText,t.d3Scale,t.d3plusAxis,t.d3plusColor)})(this,function(t,W,j,z,C,x,O,e,T){"use strict";function u(t){return t.slice().sort(function(t,i){return t-i})}function d(t){var i,e=0;for(var n=0;n<t.length;n++){if(n===0||t[n]!==i){i=t[n];e++}}return e}function f(t,i){var e=[];for(var n=0;n<t;n++){var r=[];for(var s=0;s<i;s++){r.push(0)}e.push(r)}return e}function _(t,i,e,n){var r;if(t>0){var s=(e[i]-e[t-1])/(i-t+1);r=n[i]-n[t-1]-(i-t+1)*s*s}else{r=n[i]-e[i]*e[i]/(i+1)}if(r<0){return 0}return r}function p(t,i,e,n,r,s,h){if(t>i){return}var o=Math.floor((t+i)/2);n[e][o]=n[e-1][o-1];r[e][o]=o;var a=e;if(t>e){a=Math.max(a,r[e][t-1]||0)}a=Math.max(a,r[e-1][o]||0);var l=o-1;if(i<n.length-1){l=Math.min(l,r[e][i+1]||0)}for(var u=l;u>=a;--u){var d=_(u,o,s,h);if(d+n[e-1][a-1]>=n[e][o]){break}var f=_(a,o,s,h);var c=f+n[e-1][a-1];if(c<n[e][o]){n[e][o]=c;r[e][o]=a}a++;var g=d+n[e-1][u-1];if(g<n[e][o]){n[e][o]=g;r[e][o]=u}}p(t,o-1,e,n,r,s,h);p(o+1,i,e,n,r,s,h)}function c(t,i,e){var n=i[0]?i[0].length:0;var r=t[Math.floor(n/2)];var s=[];var h=[];for(var o=0,a=void 0;o<n;++o){a=t[o]-r;if(o===0){s.push(a);h.push(a*a)}else{s.push(s[o-1]+a);h.push(h[o-1]+a*a)}i[0][o]=_(0,o,s,h);e[0][o]=0}for(var l=1;l<i.length;++l){var u=n-1;if(l<i.length-1){u=l}p(u,n-1,l,i,e,s,h)}}function M(t,i){if(i>t.length){throw new Error("Cannot generate more classes than there are data values")}var e=u(t);var n=d(e);if(n===1){return[e]}var r=f(i,e.length),s=f(i,e.length);c(e,s,r);var h=r[0]?r[0].length-1:0;var o=[];for(var a=r.length-1;a>=0;a--){var l=r[a][h];o[a]=e.slice(l,h+1);if(a>0){h=l-1}}return o}var n=function(t){function i(){var h=this;t.call(this);this._align="center";this._data=[];this._direction="row";this._duration=600;this._height=200;this._id=z.accessor("id");this._label=z.accessor("id");this._lineData=[];this._outerBounds={width:0,height:0,x:0,y:0};this._padding=5;this._shape=z.constant("Rect");this._shapes=[];this._shapeConfig={duration:this._duration,fill:z.accessor("color"),height:z.constant(10),hitArea:function(t,i){var e=h._lineData[i],n=W.max([e.height,e.shapeHeight]);return{width:e.width+e.shapeWidth,height:n,x:-e.shapeWidth/2,y:-n/2}},labelBounds:function(t,i,e){var n=h._lineData[i],r=e.r!==void 0?e.r:e.width/2;return{width:n.width,height:n.height,x:r+h._padding,y:-n.height/2+(n.lh-n.s)/2+1}},labelConfig:{fontColor:z.constant("#444"),fontFamily:(new x.TextBox).fontFamily(),fontResize:false,fontSize:z.constant(10)},opacity:1,r:z.constant(5),width:z.constant(10),x:function(t,i){var e=h._lineData[i];var n=e.y;var r=h._align==="left"||h._align==="right"&&h._direction==="column"?0:h._align==="center"?(h._outerBounds.width-h._rowWidth(h._lineData.filter(function(t){return n===t.y})))/2:h._outerBounds.width-h._rowWidth(h._lineData.filter(function(t){return n===t.y}));var s=h._lineData.slice(0,i).filter(function(t){return n===t.y});return h._rowWidth(s)+h._padding*(s.length?e.sentence?2:1:0)+h._outerBounds.x+e.shapeWidth/2+r},y:function(t,i){var e=h._lineData[i];return e.y+h._titleHeight+h._outerBounds.y+W.max(h._lineData.filter(function(t){return e.y===t.y}).map(function(t){return t.height}).concat(h._data.map(function(t,i){return h._fetchConfig("height",t,i)})))/2}};this._titleClass=new x.TextBox;this._titleConfig={};this._verticalAlign="middle";this._width=400}if(t)i.__proto__=t;i.prototype=Object.create(t&&t.prototype);i.prototype.constructor=i;i.prototype._fetchConfig=function t(i,e,n){var r=this._shapeConfig[i]||this._shapeConfig.labelConfig[i];if(!r&&i==="lineHeight"){return this._fetchConfig("fontSize",e,n)*1.4}return typeof r==="function"?r(e,n):r};i.prototype._rowHeight=function t(i){return W.max(i.map(function(t){return t.height}).concat(i.map(function(t){return t.shapeHeight})))+this._padding};i.prototype._rowWidth=function t(n){var r=this;return W.sum(n.map(function(t,i){var e=r._padding*(i===n.length-1?0:t.width?2:1);return t.shapeWidth+t.width+e}))};i.prototype.render=function t(i){var l=this;if(this._select===void 0){this.select(j.select("body").append("svg").attr("width",this._width+"px").attr("height",this._height+"px").node())}this._group=z.elem("g.d3plus-Legend",{parent:this._select});var u=this._height;this._titleHeight=0;if(this._title){var e=this._titleConfig.fontFamily||this._titleClass.fontFamily()(),n=this._titleConfig.fontSize||this._titleClass.fontSize()();var r=r=this._titleConfig.lineHeight||this._titleClass.lineHeight();r=r?r():n*1.4;var s=x.textWrap().fontFamily(e).fontSize(n).lineHeight(r).width(this._width).height(this._height)(this._title);this._titleHeight=r+s.lines.length+this._padding;u-=this._titleHeight}this._lineData=this._data.map(function(t,i){var e=l._label(t,i);var n={data:t,i:i,id:l._id(t,i),shapeWidth:l._fetchConfig("width",t,i),shapeHeight:l._fetchConfig("height",t,i),y:0};if(!e){n.sentence=false;n.words=[];n.height=0;n.width=0;return n}var r=l._fetchConfig("fontFamily",t,i),s=l._fetchConfig("lineHeight",t,i),h=l._fetchConfig("fontSize",t,i);var o=u-(l._data.length+1)*l._padding,a=l._width;n=Object.assign(n,x.textWrap().fontFamily(r).fontSize(h).lineHeight(s).width(a).height(o)(e));n.width=Math.ceil(W.max(n.lines.map(function(t){return x.textWidth(t,{"font-family":r,"font-size":h})})))+h*.75;n.height=Math.ceil(n.lines.length*(s+1));n.og={height:n.height,width:n.width};n.f=r;n.s=h;n.lh=s;return n});var h;var o=this._width-this._padding*2;h=this._rowWidth(this._lineData);if(this._direction==="column"||h>o){var a=1,d=[];var f=W.max(this._lineData.map(function(t){return t.words.length}));this._wrapLines=function(){var i=this;a++;if(a>f){return}var s=a===1?this._lineData.slice():this._lineData.filter(function(t){return t.width+t.shapeWidth+i._padding*(t.width?2:1)>o&&t.words.length>=a}).sort(function(t,i){return i.sentence.length-t.sentence.length});if(s.length&&u>s[0].height*a){var h=false;var t=function(t){var i=s[t];var e=i.og.height*a,n=i.og.width*(1.5*(1/a));var r=x.textWrap().fontFamily(i.f).fontSize(i.s).lineHeight(i.lh).width(n).height(e)(i.sentence);if(!r.truncated){i.width=Math.ceil(W.max(r.lines.map(function(t){return x.textWidth(t,{"font-family":i.f,"font-size":i.s})})))+i.s;i.height=r.lines.length*(i.lh+1)}else{h=true;return"break"}};for(var e=0;e<s.length;e++){var n=t(e);if(n==="break")break}if(!h){this._wrapRows()}}else{d=[];return}};this._wrapRows=function(){d=[];var t=1,i=0;for(var e=0;e<this._lineData.length;e++){var n=this._lineData[e],r=n.width+this._padding*(n.width?2:1)+n.shapeWidth;if(W.sum(d.map(function(t){return W.max(t,function(t){return W.max([t.height,t.shapeHeight])})}))>u){d=[];break}if(r>o){d=[];this._wrapLines();break}else if(i+r<o){i+=r}else if(this._direction!=="column"){i=r;t++}if(!d[t-1]){d[t-1]=[]}d[t-1].push(n);if(this._direction==="column"){i=0;t++}}};this._wrapRows();if(!d.length||W.sum(d,this._rowHeight.bind(this))+this._padding>u){h=W.sum(this._lineData.map(function(t){return t.shapeWidth+l._padding}))-this._padding;for(var c=0;c<this._lineData.length;c++){this._lineData[c].width=0;this._lineData[c].height=0}this._wrapRows()}if(d.length&&W.sum(d,this._rowHeight.bind(this))+this._padding<u){d.forEach(function(t,i){t.forEach(function(t){if(i){t.y=W.sum(d.slice(0,i),l._rowHeight.bind(l))}})});h=W.max(d,this._rowWidth.bind(this))}}var g=W.max(this._lineData,function(t,i){return W.max([t.height,l._fetchConfig("height",t.data,i)])+t.y})+this._titleHeight,_=h;this._outerBounds.width=_;this._outerBounds.height=g;var p=this._padding,v=this._padding;if(this._align==="center"){p=(this._width-_)/2}else if(this._align==="right"){p=this._width-this._padding-_}if(this._verticalAlign==="middle"){v=(this._height-g)/2}else if(this._verticalAlign==="bottom"){v=this._height-this._padding-g}this._outerBounds.x=p;this._outerBounds.y=v;this._titleClass.data(this._title?[{text:this._title}]:[]).duration(this._duration).select(this._group.node()).textAnchor({left:"start",center:"middle",right:"end"}[this._align]).width(this._width-this._padding*2).x(this._padding).y(this._outerBounds.y).config(this._titleConfig).render();this._shapes=[];var y=z.configPrep.bind(this)(this._shapeConfig,"legend"),w={id:function(t){return t.id},label:function(t){return t.label},lineHeight:function(t){return t.lH}};var m=this._data.map(function(t,i){var e={__d3plus__:true,data:t,i:i,id:l._id(t,i),label:l._lineData[i].width?l._label(t,i):false,lH:l._fetchConfig("lineHeight",t,i),shape:l._shape(t,i)};return e});this._shapes=[];["Circle","Rect"].forEach(function(i){l._shapes.push((new C[i]).data(m.filter(function(t){return t.shape===i})).duration(l._duration).labelConfig({padding:0}).select(l._group.node()).verticalAlign("top").config(z.assign({},y,w)).render())});if(i){setTimeout(i,this._duration+100)}return this};i.prototype.active=function t(i){this._shapes.forEach(function(t){return t.active(i)});return this};i.prototype.align=function t(i){return arguments.length?(this._align=i,this):this._align};i.prototype.data=function t(i){return arguments.length?(this._data=i,this):this._data};i.prototype.direction=function t(i){return arguments.length?(this._direction=i,this):this._direction};i.prototype.duration=function t(i){return arguments.length?(this._duration=i,this):this._duration};i.prototype.height=function t(i){return arguments.length?(this._height=i,this):this._height};i.prototype.hover=function t(i){this._shapes.forEach(function(t){return t.hover(i)});return this};i.prototype.id=function t(i){return arguments.length?(this._id=i,this):this._id};i.prototype.label=function t(i){return arguments.length?(this._label=typeof i==="function"?i:z.constant(i),this):this._label};i.prototype.outerBounds=function t(){return this._outerBounds};i.prototype.padding=function t(i){return arguments.length?(this._padding=i,this):this._padding};i.prototype.select=function t(i){return arguments.length?(this._select=j.select(i),this):this._select};i.prototype.shape=function t(i){return arguments.length?(this._shape=typeof i==="function"?i:z.constant(i),this):this._shape};i.prototype.shapeConfig=function t(i){return arguments.length?(this._shapeConfig=z.assign(this._shapeConfig,i),this):this._shapeConfig};i.prototype.title=function t(i){return arguments.length?(this._title=i,this):this._title};i.prototype.titleConfig=function t(i){return arguments.length?(this._titleConfig=z.assign(this._titleConfig,i),this):this._titleConfig};i.prototype.verticalAlign=function t(i){return arguments.length?(this._verticalAlign=i,this):this._verticalAlign};i.prototype.width=function t(i){return arguments.length?(this._width=i,this):this._width};return i}(z.BaseClass);var i=function(t){function i(){t.call(this);this._axisClass=new e.Axis;this._axisConfig={gridSize:0,shapeConfig:{labelConfig:{fontColor:"#222"}}};this._axisTest=new e.Axis;this._align="middle";this._bucketAxis=false;this._color="#0C8040";this._data=[];this._duration=600;this._height=200;this._legendClass=new n;this._legendConfig={shapeConfig:{labelConfig:{fontColor:"#222"},stroke:"#444",strokeWidth:1}};this._orient="bottom";this._outerBounds={width:0,height:0,x:0,y:0};this._padding=5;this._rectClass=new C.Rect;this._rectConfig={stroke:"#444",strokeWidth:1};this._scale="linear";this._size=10;this._value=z.accessor("value");this._width=400}if(t)i.__proto__=t;i.prototype=Object.create(t&&t.prototype);i.prototype.constructor=i;i.prototype.render=function t(i){var e=this;var n;if(this._select===void 0){this.select(j.select("body").append("svg").attr("width",this._width+"px").attr("height",this._height+"px").node())}var r=["bottom","top"].includes(this._orient);var s=r?"height":"width",h=r?"width":"height",o=r?"x":"y",a=r?"y":"x";this._group=z.elem("g.d3plus-ColorScale",{parent:this._select});var l=W.extent(this._data,this._value);var u=this._color,d,f;if(!(u instanceof Array)){u=[T.colorLighter(u,.9),T.colorLighter(u,.75),T.colorLighter(u,.5),T.colorLighter(u,.25),u]}if(this._scale==="jenks"){var c=this._data.map(this._value).filter(function(t){return t!==null&&typeof t==="number"});if(c.length<=u.length){u=u.slice(u.length-c.length)}var g=M(c,u.length);f=W.merge(g.map(function(t,i){return i===g.length-1?[t[0],t[t.length-1]]:[t[0]]}));var _=new Set(f);if(f.length!==_.size){d=Array.from(_)}this._colorScale=O.scaleThreshold().domain(f).range(["black"].concat(u).concat(u[u.length-1]))}else{var p=(l[1]-l[0])/(u.length-1);var v=W.range(l[0],l[1]+p/2,p);if(this._scale==="buckets"){f=v}this._colorScale=O.scaleLinear().domain(v).range(u)}if(this._bucketAxis||!["buckets","jenks"].includes(this._scale)){var y=z.assign({domain:r?l:l.reverse(),duration:this._duration,height:this._height,labels:d||f,orient:this._orient,padding:this._padding,ticks:f,width:this._width},this._axisConfig);this._axisTest.select(z.elem("g.d3plus-ColorScale-axisTest",{enter:{opacity:0},parent:this._group}).node()).config(y).duration(0).render();var w=this._axisTest.outerBounds();this._outerBounds[h]=this["_"+h]-this._padding*2;this._outerBounds[s]=w[s]+this._size;this._outerBounds[o]=this._padding;this._outerBounds[a]=this._padding;if(this._align==="middle"){this._outerBounds[a]=(this["_"+s]-this._outerBounds[s])/2}else if(this._align==="end"){this._outerBounds[a]=this["_"+s]-this._padding-this._outerBounds[s]}var m=this._outerBounds[a]+(["bottom","right"].includes(this._orient)?this._size:0)-(y.padding||this._axisClass.padding());this._axisClass.select(z.elem("g.d3plus-ColorScale-axis",{parent:this._group,update:{transform:"translate("+(r?0:m)+", "+(r?m:0)+")"}}).node()).config(y).align("start").render();var C=this._axisTest._getPosition.bind(this._axisTest);var x=this._axisTest._getRange();var b=this._group.selectAll("defs").data([0]);var B=b.enter().append("defs");B.append("linearGradient").attr("id","gradient-"+this._uuid);b=B.merge(b);b.select("linearGradient").attr(o+"1",r?"0%":"100%").attr(o+"2",r?"100%":"0%").attr(a+"1","0%").attr(a+"2","0%");var S=b.select("linearGradient").selectAll("stop").data(u);S.enter().append("stop").merge(S).attr("offset",function(t,i){return i/(u.length-1)*100+"%"}).attr("stop-color",String);var A=function(t,i){var e=Math.abs(C(f[i+1])-C(t));return e||2};this._rectClass.data(f?f.slice(0,f.length-1):[0]).id(function(t,i){return i}).select(z.elem("g.d3plus-ColorScale-Rect",{parent:this._group}).node()).config((n={duration:this._duration,fill:f?function(t){return e._colorScale(t)}:"url(#gradient-"+this._uuid+")"},n[o]=f?function(t,i){return C(t)+A(t,i)/2-(["left","right"].includes(e._orient)?A(t,i):0)}:x[0]+(x[1]-x[0])/2,n[a]=this._outerBounds[a]+(["top","left"].includes(this._orient)?w[s]:0)+this._size/2,n[h]=f?A:x[1]-x[0],n[s]=this._size,n)).config(this._rectConfig).render()}else{var H=this._axisConfig.tickFormat?this._axisConfig.tickFormat:function(t){return t};var k=f.reduce(function(t,i,e){if(e!==f.length-1){var n=f[e+1];t.push({color:u[e],id:i===n?H(i)+"+":H(i)+" - "+H(n)})}return t},[]);var D=z.assign({align:r?"center":{start:"left",middle:"center",end:"right"}[this._align],direction:r?"row":"column",duration:this._duration,height:this._height,padding:this._padding,shapeConfig:{duration:this._duration},width:this._width,verticalAlign:r?{start:"top",middle:"middle",end:"bottom"}[this._align]:"middle"},this._legendConfig);this._legendClass.data(k).select(z.elem("g.d3plus-ColorScale-legend",{parent:this._group}).node()).config(D).render();this._outerBounds=this._legendClass.outerBounds()}if(i){setTimeout(i,this._duration+100)}return this};i.prototype.axisConfig=function t(i){return arguments.length?(this._axisConfig=z.assign(this._axisConfig,i),this):this._axisConfig};i.prototype.align=function t(i){return arguments.length?(this._align=i,this):this._align};i.prototype.bucketAxis=function t(i){return arguments.length?(this._bucketAxis=i,this):this._bucketAxis};i.prototype.color=function t(i){return arguments.length?(this._color=i,this):this._color};i.prototype.data=function t(i){return arguments.length?(this._data=i,this):this._data};i.prototype.duration=function t(i){return arguments.length?(this._duration=i,this):this._duration};i.prototype.height=function t(i){return arguments.length?(this._height=i,this):this._height};i.prototype.legendConfig=function t(i){return arguments.length?(this._legendConfig=z.assign(this._legendConfig,i),this):this._legendConfig};i.prototype.orient=function t(i){return arguments.length?(this._orient=i,this):this._orient};i.prototype.outerBounds=function t(){return this._outerBounds};i.prototype.padding=function t(i){return arguments.length?(this._padding=i,this):this._padding};i.prototype.rectConfig=function t(i){return arguments.length?(this._rectConfig=z.assign(this._rectConfig,i),this):this._rectConfig};i.prototype.scale=function t(i){return arguments.length?(this._scale=i,this):this._scale};i.prototype.select=function t(i){return arguments.length?(this._select=j.select(i),this):this._select};i.prototype.size=function t(i){return arguments.length?(this._size=i,this):this._size};i.prototype.value=function t(i){return arguments.length?(this._value=typeof i==="function"?i:z.constant(i),this):this._value};i.prototype.width=function t(i){return arguments.length?(this._width=i,this):this._width};return i}(z.BaseClass);t.ckmeans=M;t.ColorScale=i;t.Legend=n;Object.defineProperty(t,"__esModule",{value:true})});