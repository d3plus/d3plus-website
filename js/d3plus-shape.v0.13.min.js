/*
  d3plus-shape v0.13.16
  Fancy SVG shapes for visualizations
  Copyright (c) 2018 D3plus - https://d3plus.org
  @license MIT
*/
if(typeof Object.assign!=="function"){Object.defineProperty(Object,"assign",{value:function t(e){"use strict";if(e===null){throw new TypeError("Cannot convert undefined or null to object")}var i=Object(e);for(var n=1;n<arguments.length;n++){var r=arguments[n];if(r!==null){for(var a in r){if(Object.prototype.hasOwnProperty.call(r,a)){i[a]=r[a]}}}}return i},writable:true,configurable:true})}if(!Array.prototype.includes){Object.defineProperty(Array.prototype,"includes",{value:function t(e,i){var n=Object(this);var r=n.length>>>0;if(r===0)return false;var a=i|0;var s=Math.max(a>=0?a:r-Math.abs(a),0);function o(t,e){return t===e||typeof t==="number"&&typeof e==="number"&&isNaN(t)&&isNaN(e)}while(s<r){if(o(n[s],e)){return true}s++}return false}})}(function(t,e){typeof exports==="object"&&typeof module!=="undefined"?e(exports,require("d3-selection"),require("d3-transition"),require("d3plus-common"),require("d3-array"),require("d3-color"),require("d3plus-color"),require("d3plus-text"),require("d3-collection"),require("d3-interpolate-path"),require("d3-shape"),require("d3-polygon")):typeof define==="function"&&define.amd?define("d3plus-shape",["exports","d3-selection","d3-transition","d3plus-common","d3-array","d3-color","d3plus-color","d3plus-text","d3-collection","d3-interpolate-path","d3-shape","d3-polygon"],e):e(t.d3plus={},t.d3Selection,t.d3Transition,t.d3plusCommon,t.d3Array,t.d3Color,t.d3plusColor,t.d3plusText,t.d3Collection,t.d3InterpolatePath,t.paths,t.d3Polygon)})(this,function(t,e,i,n,r,a,s,o,h,l,u,c){"use strict";var p=function t(){this._duration=600;this._height=n.accessor("height");this._id=n.accessor("id");this._pointerEvents=n.constant("auto");this._select;this._url=n.accessor("url");this._width=n.accessor("width");this._x=n.accessor("x",0);this._y=n.accessor("y",0)};p.prototype.render=function t(n){var r=this;if(this._select===void 0){this.select(e.select("body").append("svg").style("width",window.innerWidth+"px").style("height",window.innerHeight+"px").style("display","block").node())}var a=this._select.selectAll(".d3plus-Image").data(this._data,this._id);var s=a.enter().append("image").attr("class","d3plus-Image").attr("opacity",0).attr("width",0).attr("height",0).attr("x",function(t,e){return r._x(t,e)+r._width(t,e)/2}).attr("y",function(t,e){return r._y(t,e)+r._height(t,e)/2});var o=i.transition().duration(this._duration),h=this,l=s.merge(a);l.attr("xlink:href",this._url).style("pointer-events",this._pointerEvents).transition(o).attr("opacity",1).attr("width",function(t,e){return r._width(t,e)}).attr("height",function(t,e){return r._height(t,e)}).attr("x",function(t,e){return r._x(t,e)}).attr("y",function(t,e){return r._y(t,e)}).each(function(t,i){var n=e.select(this),r=h._url(t,i);var a=r.indexOf("http://")===0||r.indexOf("https://")===0;if(!a||r.indexOf(window.location.hostname)===0){var s=new p;s.src=r;s.crossOrigin="Anonymous";s.onload=function(){var t=document.createElement("canvas");t.width=this.width;t.height=this.height;var e=t.getContext("2d");e.drawImage(this,0,0);n.attr("xlink:href",t.toDataURL("image/png"))}}});a.exit().transition(o).attr("width",function(t,e){return r._width(t,e)}).attr("height",function(t,e){return r._height(t,e)}).attr("x",function(t,e){return r._x(t,e)}).attr("y",function(t,e){return r._y(t,e)}).attr("opacity",0).remove();if(n){setTimeout(n,this._duration+100)}return this};p.prototype.data=function t(e){return arguments.length?(this._data=e,this):this._data};p.prototype.duration=function t(e){return arguments.length?(this._duration=e,this):this._duration};p.prototype.height=function t(e){return arguments.length?(this._height=typeof e==="function"?e:n.constant(e),this):this._height};p.prototype.id=function t(e){return arguments.length?(this._id=e,this):this._id};p.prototype.pointerEvents=function t(e){return arguments.length?(this._pointerEvents=typeof e==="function"?e:n.constant(e),this):this._pointerEvents};p.prototype.select=function t(i){return arguments.length?(this._select=e.select(i),this):this._select};p.prototype.url=function t(e){return arguments.length?(this._url=e,this):this._url};p.prototype.width=function t(e){return arguments.length?(this._width=typeof e==="function"?e:n.constant(e),this):this._width};p.prototype.x=function t(e){return arguments.length?(this._x=typeof e==="function"?e:n.constant(e),this):this._x};p.prototype.y=function t(e){return arguments.length?(this._y=typeof e==="function"?e:n.constant(e),this):this._y};function _(t,e){var i=e[0]-t[0],n=e[1]-t[1];return i*i+n*n}function f(t,e){return Math.sqrt(_(t,e))}var d=function(t){function h(e){var i=this;if(e===void 0)e="g";t.call(this);this._activeOpacity=.25;this._activeStyle={stroke:"#444444","stroke-width":function(t,e){var n=i._strokeWidth(t,e)||1;return n*3}};this._backgroundImage=n.constant(false);this._backgroundImageClass=new p;this._data=[];this._duration=600;this._fill=n.constant("black");this._fillOpacity=n.constant(1);this._hoverOpacity=.5;this._id=function(t,e){return t.id!==void 0?t.id:e};this._label=n.constant(false);this._labelClass=new o.TextBox;this._labelConfig={fontColor:function(t,e){return s.colorContrast(i._fill(t,e))},fontSize:12};this._labelPadding=n.constant(5);this._name="Shape";this._opacity=n.constant(1);this._rx=n.constant(0);this._ry=n.constant(0);this._scale=n.constant(1);this._shapeRendering=n.constant("geometricPrecision");this._stroke=function(t,e){return a.color(i._fill(t,e)).darker(1)};this._strokeDasharray=n.constant("0");this._strokeLinecap=n.constant("butt");this._strokeOpacity=n.constant(1);this._strokeWidth=n.constant(0);this._tagName=e;this._textAnchor=n.constant("start");this._vectorEffect=n.constant("non-scaling-stroke");this._verticalAlign=n.constant("top");this._x=n.accessor("x",0);this._y=n.accessor("y",0)}if(t)h.__proto__=t;h.prototype=Object.create(t&&t.prototype);h.prototype.constructor=h;h.prototype._aes=function t(){return{}};h.prototype._applyEvents=function t(i){var n=this;var a=Object.keys(this._on);var s=function(t){i.on(a[t],function(i,s){if(!n._on[a[t]]){return}if(i.i!==void 0){s=i.i}if(i.nested&&i.values){var o=e.mouse(n._select.node()),h=i.values.map(function(t){return f(o,[n._x(t,s),n._y(t,s)])});i=i.values[h.indexOf(r.min(h))]}n._on[a[t]].bind(n)(i,s)})};for(var o=0;o<a.length;o++)s(o)};h.prototype._applyActive=function t(e){var i=this;var r=this;if(e.size()&&e.node().tagName==="g"){e=e.selectAll("*")}function a(t,e){return typeof this!=="function"?this:t.nested&&t.key&&t.values?this(t.values[0],r._data.indexOf(t.values[0])):this(t,e)}var s={};for(var o in i._activeStyle){if({}.hasOwnProperty.call(i._activeStyle,o)){s[o]=a.bind(i._activeStyle[o])}}e.transition().duration(0).call(n.attrize,s)};h.prototype._applyStyle=function t(e){var i=this;if(e.size()&&e.node().tagName==="g"){e=e.selectAll("*")}function n(t,e){return typeof this!=="function"?this:t.nested&&t.key&&t.values?this(t.values[0],i._data.indexOf(t.values[0])):this(t,e)}e.attr("fill",n.bind(this._fill)).attr("fill-opacity",n.bind(this._fillOpacity)).attr("rx",n.bind(this._rx)).attr("ry",n.bind(this._ry)).attr("stroke",n.bind(this._stroke)).attr("stroke-dasharray",n.bind(this._strokeDasharray)).attr("stroke-linecap",n.bind(this._strokeLinecap)).attr("stroke-opacity",n.bind(this._strokeOpacity)).attr("stroke-width",n.bind(this._strokeWidth)).attr("vector-effect",n.bind(this._vectorEffect))};h.prototype._applyTransform=function t(e){var i=this;e.attr("transform",function(t,e){return"\n        translate("+(t.__d3plusShape__?t.translate?t.translate:i._x(t.data,t.i)+","+i._y(t.data,t.i):i._x(t,e)+","+i._y(t,e))+")\n        scale("+(t.__d3plusShape__?t.scale||i._scale(t.data,t.i):i._scale(t,e))+")"})};h.prototype._nestWrapper=function t(e){return function(t,i){return e(t.__d3plusShape__?t.data:t,t.__d3plusShape__?t.i:i)}};h.prototype._renderActive=function t(){var i=this;this._group.selectAll(".d3plus-Shape, .d3plus-Image, .d3plus-textBox").each(function(t,n){if(!t){t={}}if(!t.parentNode){t.parentNode=this.parentNode}var r=t.parentNode;if(e.select(this).classed("d3plus-textBox")){t=t.data}if(t.__d3plusShape__||t.__d3plus__){while(t&&(t.__d3plusShape__||t.__d3plus__)){n=t.i;t=t.data}}else{n=i._data.indexOf(t)}var a=!i._active||typeof i._active!=="function"||!i._active(t,n)?r:i._activeGroup.node();if(a!==this.parentNode){a.appendChild(this);if(this.className.baseVal.includes("d3plus-Shape")){if(r===a){e.select(this).call(i._applyStyle.bind(i))}else{e.select(this).call(i._applyActive.bind(i))}}}});this._renderImage();this._renderLabels();this._group.selectAll("g.d3plus-"+this._name+"-shape, g.d3plus-"+this._name+"-image, g.d3plus-"+this._name+"-text").attr("opacity",this._hover?this._hoverOpacity:this._active?this._activeOpacity:1)};h.prototype._renderHover=function t(){var i=this;this._group.selectAll("g.d3plus-"+this._name+"-shape, g.d3plus-"+this._name+"-image, g.d3plus-"+this._name+"-text, g.d3plus-"+this._name+"-hover").selectAll(".d3plus-Shape, .d3plus-Image, .d3plus-textBox").each(function(t,n){if(!t){t={}}if(!t.parentNode){t.parentNode=this.parentNode}var r=t.parentNode;if(e.select(this).classed("d3plus-textBox")){t=t.data}if(t.__d3plusShape__||t.__d3plus__){while(t&&(t.__d3plusShape__||t.__d3plus__)){n=t.i;t=t.data}}else{n=i._data.indexOf(t)}var a=!i._hover||typeof i._hover!=="function"||!i._hover(t,n)?r:i._hoverGroup.node();if(a!==this.parentNode){a.appendChild(this)}});this._renderImage();this._renderLabels();this._group.selectAll("g.d3plus-"+this._name+"-shape, g.d3plus-"+this._name+"-image, g.d3plus-"+this._name+"-text").attr("opacity",this._hover?this._hoverOpacity:this._active?this._activeOpacity:1)};h.prototype._renderImage=function t(){var e=this;var i=[];this._update.merge(this._enter).data().forEach(function(t,n){var r=e._aes(t,n);if(r.r||r.width&&r.height){var a=t;if(t.nested&&t.key&&t.values){a=t.values[0];n=e._data.indexOf(a)}var s=r.r?r.r*2:r.height,o=e._backgroundImage(a,n),h=r.r?r.r*2:r.width;if(o){var l=a.__d3plusShape__?a.translate?a.translate[0]:e._x(a.data,a.i):e._x(a,n),u=a.__d3plusShape__?a.translate?a.translate[1]:e._y(a.data,a.i):e._y(a,n);if(r.x){l+=r.x}if(r.y){u+=r.y}if(a.__d3plusShape__){a=a.data;n=a.i}i.push({__d3plus__:true,data:a,height:s,i:n,id:e._id(a,n),url:o,width:h,x:l+-h/2,y:u+-s/2})}}});this._backgroundImageClass.data(i).duration(this._duration).pointerEvents("none").select(n.elem("g.d3plus-"+this._name+"-image",{parent:this._group,update:{opacity:this._active?this._activeOpacity:1}}).node()).render()};h.prototype._renderLabels=function t(){var e=this;var i=[];this._update.merge(this._enter).data().forEach(function(t,n){var r=t;if(t.nested&&t.key&&t.values){r=t.values[0];n=e._data.indexOf(r)}var a=e._label(r,n);if(e._labelBounds&&a!==false&&a!==undefined&&a!==null){var s=e._labelBounds(r,n,e._aes(t,n));if(s){if(a.constructor!==Array){a=[a]}var o=r.__d3plusShape__?r.translate?r.translate[0]:e._x(r.data,r.i):e._x(r,n),h=r.__d3plusShape__?r.translate?r.translate[1]:e._y(r.data,r.i):e._y(r,n);if(r.__d3plusShape__){r=r.data;n=r.i}var l=e._labelPadding(r,n);for(var u=0;u<a.length;u++){var c=s.constructor===Array?s[u]:Object.assign({},s),p=l.constructor===Array?l[u]:l;i.push({__d3plus__:true,data:r,height:c.height-p*2,l:u,id:e._id(r,n)+"_"+u,r:s.angle!==undefined?s.angle:0,text:a[u],width:c.width-p*2,x:o+c.x+p,y:h+c.y+p})}}}});this._labelClass.data(i).duration(this._duration).pointerEvents("none").rotate(function(t){return t.data.r}).select(n.elem("g.d3plus-"+this._name+"-text",{parent:this._group,update:{opacity:this._active?this._activeOpacity:1}}).node()).config(this._labelConfig).render()};h.prototype.render=function t(r){var a=this;if(this._select===void 0){this.select(e.select("body").append("svg").style("width",window.innerWidth+"px").style("height",window.innerHeight+"px").style("display","block").node())}this._transition=i.transition().duration(this._duration);var s=this._data,h=this._id;if(this._dataFilter){s=this._dataFilter(s);if(s.key){h=s.key}}if(this._sort){s=s.sort(function(t,e){return a._sort(t.__d3plusShape__?t.data:t,e.__d3plusShape__?e.data:e)})}e.selectAll("g.d3plus-"+this._name+"-hover > *, g.d3plus-"+this._name+"-active > *").each(function(t){if(t&&t.parentNode){t.parentNode.appendChild(this)}else{this.parentNode.removeChild(this)}});this._group=n.elem("g.d3plus-"+this._name+"-group",{parent:this._select});var l=this._update=n.elem("g.d3plus-"+this._name+"-shape",{parent:this._group,update:{opacity:this._active?this._activeOpacity:1}}).selectAll(".d3plus-"+this._name).data(s,h);l.order().transition(this._transition).call(this._applyTransform.bind(this));var u=this._enter=l.enter().append(this._tagName).attr("class",function(t,e){return"d3plus-Shape d3plus-"+a._name+" d3plus-id-"+o.strip(a._nestWrapper(a._id)(t,e))}).call(this._applyTransform.bind(this)).attr("opacity",this._nestWrapper(this._opacity));var c=u.merge(l);c.attr("shape-rendering",this._nestWrapper(this._shapeRendering)).attr("pointer-events","none").transition(this._transition).attr("opacity",this._nestWrapper(this._opacity)).transition().attr("pointer-events","all");var p=this._exit=l.exit();p.transition().delay(this._duration).remove();this._renderImage();this._renderLabels();this._hoverGroup=n.elem("g.d3plus-"+this._name+"-hover",{parent:this._group});this._activeGroup=n.elem("g.d3plus-"+this._name+"-active",{parent:this._group});var _=this;var f=this._group.selectAll(".d3plus-HitArea").data(this._hitArea?s:[],h);f.order().transition(this._transition).call(this._applyTransform.bind(this));var d=f.enter().append("rect").attr("class",function(t,e){return"d3plus-HitArea d3plus-id-"+o.strip(a._nestWrapper(a._id)(t,e))}).attr("fill","transparent").call(this._applyTransform.bind(this));var y=f.merge(d).each(function(t){var i=_._hitArea(t,_._data.indexOf(t),_._aes(t,_._data.indexOf(t)));return i?e.select(this).call(n.attrize,i):e.select(this).remove()});f.exit().remove();this._applyEvents(this._hitArea?y:c);setTimeout(function(){if(a._active){a._renderActive()}else if(a._hover){a._renderHover()}if(r){r()}},this._duration+100);return this};h.prototype.active=function t(e){if(!arguments.length||e===undefined){return this._active}this._active=e;if(this._group){this._renderImage();this._renderLabels();this._renderActive()}return this};h.prototype.activeOpacity=function t(e){return arguments.length?(this._activeOpacity=e,this):this._activeOpacity};h.prototype.activeStyle=function t(e){return arguments.length?(this._activeStyle=n.assign({},this._activeStyle,e),this):this._activeStyle};h.prototype.backgroundImage=function t(e){return arguments.length?(this._backgroundImage=typeof e==="function"?e:n.constant(e),this):this._backgroundImage};h.prototype.data=function t(e){return arguments.length?(this._data=e,this):this._data};h.prototype.duration=function t(e){return arguments.length?(this._duration=e,this):this._duration};h.prototype.fill=function t(e){return arguments.length?(this._fill=typeof e==="function"?e:n.constant(e),this):this._fill};h.prototype.fillOpacity=function t(e){return arguments.length?(this._fillOpacity=typeof e==="function"?e:n.constant(e),this):this._fillOpacity};h.prototype.hover=function t(e){if(!arguments.length||e===void 0){return this._hover}this._hover=e;if(this._group){this._renderImage();this._renderLabels();this._renderHover()}return this};h.prototype.hoverOpacity=function t(e){return arguments.length?(this._hoverOpacity=e,this):this._hoverOpacity};h.prototype.hitArea=function t(e){return arguments.length?(this._hitArea=typeof e==="function"?e:n.constant(e),this):this._hitArea};h.prototype.id=function t(e){return arguments.length?(this._id=e,this):this._id};h.prototype.label=function t(e){return arguments.length?(this._label=typeof e==="function"?e:n.constant(e),this):this._label};h.prototype.labelBounds=function t(e){return arguments.length?(this._labelBounds=typeof e==="function"?e:n.constant(e),this):this._labelBounds};h.prototype.labelConfig=function t(e){return arguments.length?(this._labelConfig=n.assign(this._labelConfig,e),this):this._labelConfig};h.prototype.labelPadding=function t(e){return arguments.length?(this._labelPadding=typeof e==="function"?e:n.constant(e),this):this._labelPadding};h.prototype.opacity=function t(e){return arguments.length?(this._opacity=typeof e==="function"?e:n.constant(e),this):this._opacity};h.prototype.rx=function t(e){return arguments.length?(this._rx=typeof e==="function"?e:n.constant(e),this):this._rx};h.prototype.ry=function t(e){return arguments.length?(this._ry=typeof e==="function"?e:n.constant(e),this):this._ry};h.prototype.scale=function t(e){return arguments.length?(this._scale=typeof e==="function"?e:n.constant(e),this):this._scale};h.prototype.select=function t(i){return arguments.length?(this._select=e.select(i),this):this._select};h.prototype.shapeRendering=function t(e){return arguments.length?(this._shapeRendering=typeof e==="function"?e:n.constant(e),this):this._shapeRendering};h.prototype.sort=function t(e){return arguments.length?(this._sort=e,this):this._sort};h.prototype.stroke=function t(e){return arguments.length?(this._stroke=typeof e==="function"?e:n.constant(e),this):this._stroke};h.prototype.strokeDasharray=function t(e){return arguments.length?(this._strokeDasharray=typeof e==="function"?e:n.constant(e),this):this._strokeDasharray};h.prototype.strokeLinecap=function t(e){return arguments.length?(this._strokeLinecap=typeof e==="function"?e:n.constant(e),this):this._strokeLinecap};h.prototype.strokeOpacity=function t(e){return arguments.length?(this._strokeOpacity=typeof e==="function"?e:n.constant(e),this):this._strokeOpacity};h.prototype.strokeWidth=function t(e){return arguments.length?(this._strokeWidth=typeof e==="function"?e:n.constant(e),this):this._strokeWidth};h.prototype.textAnchor=function t(e){return arguments.length?(this._textAnchor=typeof e==="function"?e:n.constant(e),this):this._textAnchor};h.prototype.vectorEffect=function t(e){return arguments.length?(this._vectorEffect=typeof e==="function"?e:n.constant(e),this):this._vectorEffect};h.prototype.verticalAlign=function t(e){return arguments.length?(this._verticalAlign=typeof e==="function"?e:n.constant(e),this):this._verticalAlign};h.prototype.x=function t(e){return arguments.length?(this._x=typeof e==="function"?e:n.constant(e),this):this._x};h.prototype.y=function t(e){return arguments.length?(this._y=typeof e==="function"?e:n.constant(e),this):this._y};return h}(n.BaseClass);function y(t,e,i,n){var r=1e-9;var a=t[0]-e[0],s=i[0]-n[0],o=t[1]-e[1],h=i[1]-n[1];var l=a*h-o*s;if(Math.abs(l)<r){return null}var u=t[0]*e[1]-t[1]*e[0],c=i[0]*n[1]-i[1]*n[0];var p=(u*s-c*a)/l,_=(u*h-c*o)/l;return[p,_]}function v(t,e,i){var n=1e-9;var r=i[0];var a=i[1];return!(r<Math.min(t[0],e[0])-n||r>Math.max(t[0],e[0])+n||a<Math.min(t[1],e[1])-n||a>Math.max(t[1],e[1])+n)}function g(t,e,i,n){var r=y(t,e,i,n);if(!r){return false}return v(t,e,r)&&v(i,n,r)}function x(t,e){var i=-1;var n=t.length;var r=e.length;var a=t[n-1];while(++i<n){var s=a;a=t[i];var o=-1;var h=e[r-1];while(++o<r){var l=h;h=e[o];if(g(s,a,l,h)){return false}}}return c.polygonContains(e,t[0])}function m(t,e,i){if(i===void 0)i=0;var n=1e-9;e=[e[0]+n*Math.cos(i),e[1]+n*Math.sin(i)];var r=e[0];var a=e[1];var s=[r+Math.cos(i),a+Math.sin(i)];var o=0;if(Math.abs(s[0]-r)<n){o=1}var h=-1;var l=t.length;var u=t[l-1];var c=Number.MAX_VALUE;var p=Number.MAX_VALUE;var f=null;var d=null;while(++h<l){var g=u;u=t[h];var x=y(e,s,g,u);if(x&&v(g,u,x)){var m=_(e,x);if(x[o]<e[o]){if(m<c){c=m;f=x}}else if(x[o]>e[o]){if(m<p){p=m;d=x}}}}return[f,d]}function b(t,e,i){if(i===void 0)i=[0,0];var n=Math.cos(e),r=Math.sin(e),a=t[0]-i[0],s=t[1]-i[1];return[n*a-r*s+i[0],r*a+n*s+i[1]]}function w(t,e,i){if(i===void 0)i=[0,0];return t.map(function(t){return b(t,e,i)})}function A(t,e,i){var n=e[0],r=e[1];var a=i[0]-n,s=i[1]-r;if(a!==0||s!==0){var o=((t[0]-n)*a+(t[1]-r)*s)/(a*a+s*s);if(o>1){n=i[0];r=i[1]}else if(o>0){n+=a*o;r+=s*o}}a=t[0]-n;s=t[1]-r;return a*a+s*s}function O(t,e){var i,n=t[0];var r=[n];for(var a=1,s=t.length;a<s;a++){i=t[a];if(_(i,n)>e){r.push(i);n=i}}if(n!==i){r.push(i)}return r}function k(t,e,i,n,r){var a,s=n;for(var o=e+1;o<i;o++){var h=A(t[o],t[e],t[i]);if(h>s){a=o;s=h}}if(s>n){if(a-e>1){k(t,e,a,n,r)}r.push(t[a]);if(i-a>1){k(t,a,i,n,r)}}}function M(t,e){var i=t.length-1;var n=[t[0]];k(t,0,i,e,n);n.push(t[i]);return n}function S(t,e,i){if(e===void 0)e=1;if(i===void 0)i=false;if(t.length<=2){return t}var n=e*e;t=i?t:O(t,n);t=M(t,n);return t}var C=.5;var R=5;var N={};function P(t,e){if(e===void 0)e={};if(t.length<3){if(e.verbose){console.error("polygon has to have at least 3 points",t)}return null}var i=[];e=Object.assign({angle:r.range(-90,90+R,R),cache:true,maxAspectRatio:15,minAspectRatio:1,minHeight:0,minWidth:0,nTries:20,tolerance:.02,verbose:false},e);var n=e.angle instanceof Array?e.angle:typeof e.angle==="number"?[e.angle]:typeof e.angle==="string"&&!isNaN(e.angle)?[Number(e.angle)]:[];var a=e.aspectRatio instanceof Array?e.aspectRatio:typeof e.aspectRatio==="number"?[e.aspectRatio]:typeof e.aspectRatio==="string"&&!isNaN(e.aspectRatio)?[Number(e.aspectRatio)]:[];var s=e.origin&&e.origin instanceof Array?e.origin[0]instanceof Array?e.origin:[e.origin]:[];var o;if(e.cache){o=r.merge(t).join(",");o+="-"+e.minAspectRatio;o+="-"+e.maxAspectRatio;o+="-"+e.minHeight;o+="-"+e.minWidth;o+="-"+n.join(",");o+="-"+s.join(",");if(N[o]){return N[o]}}var h=Math.abs(c.polygonArea(t));if(h===0){if(e.verbose){console.error("polygon has 0 area",t)}return null}var l=r.extent(t,function(t){return t[0]});var u=l[0];var p=l[1];var f=r.extent(t,function(t){return t[1]});var d=f[0];var y=f[1];var v=Math.min(p-u,y-d)*e.tolerance;if(v>0){t=S(t,v)}if(e.events){i.push({type:"simplify",poly:t})}var g;g=r.extent(t,function(t){return t[0]}),u=g[0],p=g[1];var b;b=r.extent(t,function(t){return t[1]}),d=b[0],y=b[1];var A=[p-u,y-d];var O=A[0];var k=A[1];var M=Math.min(O,k)/50;if(!s.length){var P=c.polygonCentroid(t);if(isNaN(P[0])){if(e.verbose){console.error("cannot find centroid",t)}return null}if(c.polygonContains(t,P)){s.push(P)}while(s.length<e.nTries){var W=Math.random()*O+u;var I=Math.random()*k+d;var j=[W,I];if(c.polygonContains(t,j)){s.push(j)}}}if(e.events){i.push({type:"origins",points:s})}var E=0;var H=null;for(var B=0;B<n.length;B++){var L=n[B];var q=-L*Math.PI/180;if(e.events){i.push({type:"angle",angle:L})}for(var T=0;T<s.length;T++){var D=s[T];var U=m(t,D,q);var z=U[0];var F=U[1];var X=m(t,D,q+Math.PI/2);var G=X[0];var V=X[1];var Y=[];if(z&&F){Y.push([(z[0]+F[0])/2,(z[1]+F[1])/2])}if(G&&V){Y.push([(G[0]+V[0])/2,(G[1]+V[1])/2])}if(e.events){i.push({type:"modifOrigin",idx:T,p1W:z,p2W:F,p1H:G,p2H:V,modifOrigins:Y})}for(var Z=0;Z<Y.length;Z++){var J=Y[Z];if(e.events){i.push({type:"origin",cx:J[0],cy:J[1]})}var K=m(t,J,q);var Q=K[0];var $=K[1];if(Q===null||$===null){continue}var tt=Math.min(_(J,Q),_(J,$));var et=2*Math.sqrt(tt);var it=m(t,J,q+Math.PI/2);var nt=it[0];var rt=it[1];if(nt===null||rt===null){continue}var at=Math.min(_(J,nt),_(J,rt));var st=2*Math.sqrt(at);if(et*st<E){continue}var ot=a;if(!ot.length){var ht=Math.max(e.minAspectRatio,e.minWidth/st,E/(st*st));var lt=Math.min(e.maxAspectRatio,et/e.minHeight,et*et/E);ot=r.range(ht,lt+C,C)}for(var ut=0;ut<ot.length;ut++){var ct=ot[ut];var pt=Math.max(e.minWidth,Math.sqrt(E*ct));var _t=Math.min(et,st*ct);if(_t*st<E){continue}if(e.events&&_t-pt>=M){i.push({type:"aRatio",aRatio:ct})}while(_t-pt>=M){var ft=(pt+_t)/2;var dt=ft/ct;var yt=J[0];var vt=J[1];var gt=[[yt-ft/2,vt-dt/2],[yt+ft/2,vt-dt/2],[yt+ft/2,vt+dt/2],[yt-ft/2,vt+dt/2]];gt=w(gt,q,J);var xt=x(gt,t);if(xt){E=ft*dt;gt.push(gt[0]);H={area:E,cx:yt,cy:vt,width:ft,height:dt,angle:-L,points:gt};pt=ft}else{_t=ft}if(e.events){i.push({type:"rectangle",areaFraction:ft*dt/h,cx:yt,cy:vt,width:ft,height:dt,angle:L,insidePoly:xt})}}}}}}if(e.cache){N[o]=H}return e.events?Object.assign(H||{},{events:i}):H}var W=function(t){function i(){var e=this;t.call(this);this._curve="linear";this._defined=function(){return true};this._labelBounds=function(t,i,n){var r=P(n.points);if(!r){return null}return{angle:r.angle,width:r.width,height:r.height,x:r.cx-r.width/2-e._x(t,i),y:r.cy-r.height/2-e._y(t,i)}};this._labelConfig=Object.assign(this._labelConfig,{textAnchor:"middle",verticalAlign:"middle"});this._name="Area";this._x=n.accessor("x");this._x0=n.accessor("x");this._x1=null;this._y=n.constant(0);this._y0=n.constant(0);this._y1=n.accessor("y")}if(t)i.__proto__=t;i.prototype=Object.create(t&&t.prototype);i.prototype.constructor=i;i.prototype._aes=function t(e){var i=this;var n=e.values.slice().sort(function(t,e){return i._y1?i._x(t)-i._x(e):i._y(t)-i._y(e)});var r=n.map(function(t,e){return[i._x0(t,e),i._y0(t,e)]});var a=n.reverse().map(function(t,e){return i._y1?[i._x(t,e),i._y1(t,e)]:[i._x1(t,e),i._y(t,e)]});var s=r.concat(a);if(r[0][1]>a[0][1]){s=s.reverse()}s.push(s[0]);return{points:s}};i.prototype._dataFilter=function t(e){var i=this;var a=h.nest().key(this._id).entries(e).map(function(t){t.data=n.merge(t.values);t.i=e.indexOf(t.values[0]);var a=r.extent(t.values.map(i._x).concat(t.values.map(i._x0)).concat(i._x1?t.values.map(i._x1):[]));t.xR=a;t.width=a[1]-a[0];t.x=a[0]+t.width/2;var s=r.extent(t.values.map(i._y).concat(t.values.map(i._y0)).concat(i._y1?t.values.map(i._y1):[]));t.yR=s;t.height=s[1]-s[0];t.y=s[0]+t.height/2;t.nested=true;t.translate=[t.x,t.y];t.__d3plusShape__=true;return t});a.key=function(t){return t.key};return a};i.prototype.render=function i(n){t.prototype.render.call(this,n);var r=this._path=u.area().defined(this._defined).curve(u["curve"+this._curve.charAt(0).toUpperCase()+this._curve.slice(1)]).x(this._x).x0(this._x0).x1(this._x1).y(this._y).y0(this._y0).y1(this._y1);var a=u.area().defined(function(t){return t}).curve(u["curve"+this._curve.charAt(0).toUpperCase()+this._curve.slice(1)]).x(this._x).x0(this._x0).x1(this._x1).y(this._y).y0(this._y0).y1(this._y1);this._enter.append("path").attr("transform",function(t){return"translate("+(-t.xR[0]-t.width/2)+", "+(-t.yR[0]-t.height/2)+")"}).attr("d",function(t){return r(t.values)}).call(this._applyStyle.bind(this));this._update.select("path").transition(this._transition).attr("transform",function(t){return"translate("+(-t.xR[0]-t.width/2)+", "+(-t.yR[0]-t.height/2)+")"}).attrTween("d",function(t){return l.interpolatePath(e.select(this).attr("d"),r(t.values))}).call(this._applyStyle.bind(this));this._exit.select("path").transition(this._transition).attrTween("d",function(t){return l.interpolatePath(e.select(this).attr("d"),a(t.values))});return this};i.prototype.curve=function t(e){return arguments.length?(this._curve=e,this):this._curve};i.prototype.defined=function t(e){return arguments.length?(this._defined=e,this):this._defined};i.prototype.x=function t(e){if(!arguments.length){return this._x}this._x=typeof e==="function"?e:n.constant(e);this._x0=this._x;return this};i.prototype.x0=function t(e){if(!arguments.length){return this._x0}this._x0=typeof e==="function"?e:n.constant(e);this._x=this._x0;return this};i.prototype.x1=function t(e){return arguments.length?(this._x1=typeof e==="function"||e===null?e:n.constant(e),this):this._x1};i.prototype.y=function t(e){if(!arguments.length){return this._y}this._y=typeof e==="function"?e:n.constant(e);this._y0=this._y;return this};i.prototype.y0=function t(e){if(!arguments.length){return this._y0}this._y0=typeof e==="function"?e:n.constant(e);this._y=this._y0;return this};i.prototype.y1=function t(e){return arguments.length?(this._y1=typeof e==="function"||e===null?e:n.constant(e),this):this._y1};return i}(d);var I=function(t){function e(){var e=this;t.call(this,"rect");this._name="Bar";this._height=n.constant(10);this._labelBounds=function(t,i,n){return{width:n.width,height:n.height,x:e._x1!==null?e._getX(t,i):-n.width/2,y:e._x1===null?e._getY(t,i):-n.height/2}};this._width=n.constant(10);this._x=n.accessor("x");this._x0=n.accessor("x");this._x1=null;this._y=n.constant(0);this._y0=n.constant(0);this._y1=n.accessor("y")}if(t)e.__proto__=t;e.prototype=Object.create(t&&t.prototype);e.prototype.constructor=e;e.prototype.render=function e(i){var n=this;t.prototype.render.call(this,i);this._enter.attr("width",function(t,e){return n._x1===null?n._getWidth(t,e):0}).attr("height",function(t,e){return n._x1!==null?n._getHeight(t,e):0}).attr("x",function(t,e){return n._x1===null?-n._getWidth(t,e)/2:0}).attr("y",function(t,e){return n._x1!==null?-n._getHeight(t,e)/2:0}).call(this._applyStyle.bind(this)).transition(this._transition).call(this._applyPosition.bind(this));this._update.transition(this._transition).call(this._applyStyle.bind(this)).call(this._applyPosition.bind(this));this._exit.transition(this._transition).attr("width",function(t,e){return n._x1===null?n._getWidth(t,e):0}).attr("height",function(t,e){return n._x1!==null?n._getHeight(t,e):0}).attr("x",function(t,e){return n._x1===null?-n._getWidth(t,e)/2:0}).attr("y",function(t,e){return n._x1!==null?-n._getHeight(t,e)/2:0});return this};e.prototype._aes=function t(e,i){return{height:this._getHeight(e,i),width:this._getWidth(e,i)}};e.prototype._applyPosition=function t(e){var i=this;e.attr("width",function(t,e){return i._getWidth(t,e)}).attr("height",function(t,e){return i._getHeight(t,e)}).attr("x",function(t,e){return i._x1!==null?i._getX(t,e):-i._getWidth(t,e)/2}).attr("y",function(t,e){return i._x1===null?i._getY(t,e):-i._getHeight(t,e)/2})};e.prototype._getHeight=function t(e,i){if(this._x1!==null){return this._height(e,i)}return Math.abs(this._y1(e,i)-this._y(e,i))};e.prototype._getWidth=function t(e,i){if(this._x1===null){return this._width(e,i)}return Math.abs(this._x1(e,i)-this._x(e,i))};e.prototype._getX=function t(e,i){var n=this._x1===null?this._x(e,i):this._x1(e,i)-this._x(e,i);if(n<0){return n}else{return 0}};e.prototype._getY=function t(e,i){var n=this._x1!==null?this._y(e,i):this._y1(e,i)-this._y(e,i);if(n<0){return n}else{return 0}};e.prototype.height=function t(e){return arguments.length?(this._height=typeof e==="function"?e:n.constant(e),this):this._height};e.prototype.width=function t(e){return arguments.length?(this._width=typeof e==="function"?e:n.constant(e),this):this._width};e.prototype.x0=function t(e){if(!arguments.length){return this._x0}this._x0=typeof e==="function"?e:n.constant(e);this._x=this._x0;return this};e.prototype.x1=function t(e){return arguments.length?(this._x1=typeof e==="function"||e===null?e:n.constant(e),this):this._x1};e.prototype.y0=function t(e){if(!arguments.length){return this._y0}this._y0=typeof e==="function"?e:n.constant(e);this._y=this._y0;return this};e.prototype.y1=function t(e){return arguments.length?(this._y1=typeof e==="function"||e===null?e:n.constant(e),this):this._y1};return e}(d);var j=function(t){function e(){t.call(this,"circle");this._labelBounds=function(t,e,i){return{width:i.r*1.5,height:i.r*1.5,x:-i.r*.75,y:-i.r*.75}};this._labelConfig=n.assign(this._labelConfig,{textAnchor:"middle",verticalAlign:"middle"});this._name="Circle";this._r=n.accessor("r")}if(t)e.__proto__=t;e.prototype=Object.create(t&&t.prototype);e.prototype.constructor=e;e.prototype._applyPosition=function t(e){var i=this;e.attr("r",function(t,e){return i._r(t,e)}).attr("x",function(t,e){return-i._r(t,e)/2}).attr("y",function(t,e){return-i._r(t,e)/2})};e.prototype.render=function e(i){t.prototype.render.call(this,i);this._enter.attr("r",0).attr("x",0).attr("y",0).call(this._applyStyle.bind(this)).transition(this._transition).call(this._applyPosition.bind(this));this._update.transition(this._transition).call(this._applyStyle.bind(this)).call(this._applyPosition.bind(this));this._exit.transition(this._transition).attr("r",0).attr("x",0).attr("y",0);return this};e.prototype._aes=function t(e,i){return{r:this._r(e,i)}};e.prototype.r=function t(e){return arguments.length?(this._r=typeof e==="function"?e:n.constant(e),this):this._r};return e}(d);var E=function(t){function i(){t.call(this);this._curve="linear";this._defined=function(t){return t};this._fill=n.constant("none");this._name="Line";this._path=u.line();this._stroke=n.constant("black");this._strokeWidth=n.constant(1)}if(t)i.__proto__=t;i.prototype=Object.create(t&&t.prototype);i.prototype.constructor=i;i.prototype._dataFilter=function t(e){var i=this;var a=h.nest().key(this._id).entries(e).map(function(t){t.data=n.merge(t.values);t.i=e.indexOf(t.values[0]);var a=r.extent(t.values,i._x);t.xR=a;t.width=a[1]-a[0];t.x=a[0]+t.width/2;var s=r.extent(t.values,i._y);t.yR=s;t.height=s[1]-s[0];t.y=s[0]+t.height/2;t.nested=true;t.translate=[t.x,t.y];t.__d3plusShape__=true;return t});a.key=function(t){return t.key};return a};i.prototype.render=function i(n){var r=this;t.prototype.render.call(this,n);var a=this;this._path.curve(u["curve"+this._curve.charAt(0).toUpperCase()+this._curve.slice(1)]).defined(this._defined).x(this._x).y(this._y);this._enter.append("path").attr("transform",function(t){return"translate("+(-t.xR[0]-t.width/2)+", "+(-t.yR[0]-t.height/2)+")"}).attr("d",function(t){return r._path(t.values)}).call(this._applyStyle.bind(this));this._update.select("path").transition(this._transition).attr("transform",function(t){return"translate("+(-t.xR[0]-t.width/2)+", "+(-t.yR[0]-t.height/2)+")"}).attrTween("d",function(t){return l.interpolatePath(e.select(this).attr("d"),a._path(t.values))}).call(this._applyStyle.bind(this));return this};i.prototype._aes=function t(e,i){var n=this;return{points:e.values.map(function(t){return[n._x(t,i),n._y(t,i)]})}};i.prototype.curve=function t(e){return arguments.length?(this._curve=e,this):this._curve};i.prototype.defined=function t(e){return arguments.length?(this._defined=e,this):this._defined};return i}(d);var H=Math.PI;function B(t,e,i){if(i===void 0)i="circle";if(t<0){t=H*2+t}if(i==="square"){var n=45*(H/180);var r=0,a=0;if(t<H/2){var s=Math.tan(t);r+=t<n?e:e/s;a+=t<n?s*e:e}else if(t<=H){var o=Math.tan(H-t);r-=t<H-n?e/o:e;a+=t<H-n?e:o*e}else if(t<n+H){r-=e;a-=Math.tan(t-H)*e}else if(t<3*H/2){r-=e/Math.tan(t-H);a-=e}else if(t<2*H-n){r+=e/Math.tan(2*H-t);a-=e}else{r+=e;a-=Math.tan(2*H-t)*e}return[r,a]}else if(i==="circle"){return[e*Math.cos(t),e*Math.sin(t)]}else{return null}}var L=Math.PI;function q(t,e){if(e===void 0)e=20;var i=[],n=/([MLA])([^MLAZ]+)/gi;var r=n.exec(t);while(r!==null){if(["M","L"].includes(r[1])){i.push(r[2].split(",").map(Number))}else if(r[1]==="A"){var a=r[2].split(",").map(Number);var s=a.slice(a.length-2,a.length),o=i[i.length-1],h=a[0],l=f(o,s);var u=Math.acos((h*h+h*h-l*l)/(2*h*h));if(a[2]){u=L*2-u}var c=u/(u/(L*2)*(h*L*2)/e);var p=Math.atan2(-o[1],-o[0])-L;var _=c;while(_<u){i.push(B(a[4]?p+_:p-_,h));_+=c}i.push(s)}r=n.exec(t)}return i}var T=function(t){function e(){var e=this;t.call(this,"path");this._d=n.accessor("path");this._labelBounds=function(t,i,n){var r=P(n.points,{angle:e._labelConfig.rotate?e._labelConfig.rotate(t,i):0});return{angle:r.angle,width:r.width,height:r.height,x:r.cx-r.width/2,y:r.cy-r.height/2}};this._name="Path";this._labelConfig=Object.assign(this._labelConfig,{textAnchor:"middle",verticalAlign:"middle"})}if(t)e.__proto__=t;e.prototype=Object.create(t&&t.prototype);e.prototype.constructor=e;e.prototype._aes=function t(e,i){return{points:q(this._d(e,i))}};e.prototype.render=function e(i){t.prototype.render.call(this,i);this._enter.attr("opacity",0).attr("d",this._d).call(this._applyStyle.bind(this)).transition(this._transition).attr("opacity",1);this._update.transition(this._transition).call(this._applyStyle.bind(this)).attr("opacity",1).attr("d",this._d);this._exit.transition(this._transition).attr("opacity",0);return this};e.prototype.d=function t(e){return arguments.length?(this._d=typeof e==="function"?e:n.constant(e),this):this._d};return e}(d);var D=function(t){function e(){t.call(this,"rect");this._height=n.accessor("height");this._labelBounds=function(t,e,i){return{width:i.width,height:i.height,x:-i.width/2,y:-i.height/2}};this._name="Rect";this._width=n.accessor("width")}if(t)e.__proto__=t;e.prototype=Object.create(t&&t.prototype);e.prototype.constructor=e;e.prototype.render=function e(i){t.prototype.render.call(this,i);this._enter.attr("width",0).attr("height",0).attr("x",0).attr("y",0).call(this._applyStyle.bind(this)).transition(this._transition).call(this._applyPosition.bind(this));this._update.transition(this._transition).call(this._applyStyle.bind(this)).call(this._applyPosition.bind(this));this._exit.transition(this._transition).attr("width",0).attr("height",0).attr("x",0).attr("y",0);return this};e.prototype._aes=function t(e,i){return{width:this._width(e,i),height:this._height(e,i)}};e.prototype._applyPosition=function t(e){var i=this;e.attr("width",function(t,e){return i._width(t,e)}).attr("height",function(t,e){return i._height(t,e)}).attr("x",function(t,e){return-i._width(t,e)/2}).attr("y",function(t,e){return-i._height(t,e)/2})};e.prototype.height=function t(e){return arguments.length?(this._height=typeof e==="function"?e:n.constant(e),this):this._height};e.prototype.width=function t(e){return arguments.length?(this._width=typeof e==="function"?e:n.constant(e),this):this._width};return e}(d);t.Image=p;t.Shape=d;t.Area=W;t.Bar=I;t.Circle=j;t.Line=E;t.Path=T;t.Rect=D;t.largestRect=P;t.lineIntersection=y;t.path2polygon=q;t.pointDistance=f;t.pointDistanceSquared=_;t.pointRotate=b;t.polygonInside=x;t.polygonRayCast=m;t.polygonRotate=w;t.segmentBoxContains=v;t.segmentsIntersect=g;t.shapeEdgePoint=B;t.simplify=S;Object.defineProperty(t,"__esModule",{value:true})});