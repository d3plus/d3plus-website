/*
  d3plus-shape v0.13.10
  Fancy SVG shapes for visualizations
  Copyright (c) 2017 D3plus - https://d3plus.org
  @license MIT
*/
if(typeof Object.assign!=="function"){Object.defineProperty(Object,"assign",{value:function t(i){"use strict";if(i===null){throw new TypeError("Cannot convert undefined or null to object")}var e=Object(i);for(var n=1;n<arguments.length;n++){var r=arguments[n];if(r!==null){for(var a in r){if(Object.prototype.hasOwnProperty.call(r,a)){e[a]=r[a]}}}}return e},writable:true,configurable:true})}if(!Array.prototype.includes){Object.defineProperty(Array.prototype,"includes",{value:function t(i,e){var n=Object(this);var r=n.length>>>0;if(r===0)return false;var a=e|0;var s=Math.max(a>=0?a:r-Math.abs(a),0);function o(t,i){return t===i||typeof t==="number"&&typeof i==="number"&&isNaN(t)&&isNaN(i)}while(s<r){if(o(n[s],i)){return true}s++}return false}})}(function(t,i){typeof exports==="object"&&typeof module!=="undefined"?i(exports,require("d3-selection"),require("d3-transition"),require("d3plus-common"),require("d3-array"),require("d3-color"),require("d3plus-color"),require("d3plus-text"),require("d3-collection"),require("d3-interpolate-path"),require("d3-shape"),require("d3-polygon")):typeof define==="function"&&define.amd?define("d3plus-shape",["exports","d3-selection","d3-transition","d3plus-common","d3-array","d3-color","d3plus-color","d3plus-text","d3-collection","d3-interpolate-path","d3-shape","d3-polygon"],i):i(t.d3plus={},t.d3Selection,t.d3Transition,t.d3plusCommon,t.d3Array,t.d3Color,t.d3plusColor,t.d3plusText,t.d3Collection,t.d3InterpolatePath,t.paths,t.d3Polygon)})(this,function(t,i,e,n,r,a,s,o,h,u,l,c){"use strict";var p=function t(){this._duration=600;this._height=n.accessor("height");this._id=n.accessor("id");this._pointerEvents=n.constant("auto");this._select;this._url=n.accessor("url");this._width=n.accessor("width");this._x=n.accessor("x",0);this._y=n.accessor("y",0)};p.prototype.render=function t(n){var r=this;if(this._select===void 0){this.select(i.select("body").append("svg").style("width",window.innerWidth+"px").style("height",window.innerHeight+"px").style("display","block").node())}var a=this._select.selectAll(".d3plus-Image").data(this._data,this._id);var s=a.enter().append("image").attr("class","d3plus-Image").attr("opacity",0).attr("width",0).attr("height",0).attr("x",function(t,i){return r._x(t,i)+r._width(t,i)/2}).attr("y",function(t,i){return r._y(t,i)+r._height(t,i)/2});var o=e.transition().duration(this._duration),h=this,u=s.merge(a);u.attr("xlink:href",this._url).style("pointer-events",this._pointerEvents).transition(o).attr("opacity",1).attr("width",function(t,i){return r._width(t,i)}).attr("height",function(t,i){return r._height(t,i)}).attr("x",function(t,i){return r._x(t,i)}).attr("y",function(t,i){return r._y(t,i)}).each(function(t,e){var n=i.select(this),r=h._url(t,e);var a=r.indexOf("http://")===0||r.indexOf("https://")===0;if(!a||r.indexOf(window.location.hostname)===0){var s=new p;s.src=r;s.crossOrigin="Anonymous";s.onload=function(){var t=document.createElement("canvas");t.width=this.width;t.height=this.height;var i=t.getContext("2d");i.drawImage(this,0,0);n.attr("xlink:href",t.toDataURL("image/png"))}}});a.exit().transition(o).attr("width",function(t,i){return r._width(t,i)}).attr("height",function(t,i){return r._height(t,i)}).attr("x",function(t,i){return r._x(t,i)}).attr("y",function(t,i){return r._y(t,i)}).attr("opacity",0).remove();if(n){setTimeout(n,this._duration+100)}return this};p.prototype.data=function t(i){return arguments.length?(this._data=i,this):this._data};p.prototype.duration=function t(i){return arguments.length?(this._duration=i,this):this._duration};p.prototype.height=function t(i){return arguments.length?(this._height=typeof i==="function"?i:n.constant(i),this):this._height};p.prototype.id=function t(i){return arguments.length?(this._id=i,this):this._id};p.prototype.pointerEvents=function t(i){return arguments.length?(this._pointerEvents=typeof i==="function"?i:n.constant(i),this):this._pointerEvents};p.prototype.select=function t(e){return arguments.length?(this._select=i.select(e),this):this._select};p.prototype.url=function t(i){return arguments.length?(this._url=i,this):this._url};p.prototype.width=function t(i){return arguments.length?(this._width=typeof i==="function"?i:n.constant(i),this):this._width};p.prototype.x=function t(i){return arguments.length?(this._x=typeof i==="function"?i:n.constant(i),this):this._x};p.prototype.y=function t(i){return arguments.length?(this._y=typeof i==="function"?i:n.constant(i),this):this._y};var _=function(t,i){var e=i[0]-t[0],n=i[1]-t[1];return e*e+n*n};var f=function(t,i){return Math.sqrt(_(t,i))};var d=function(t){function h(i){var e=this;if(i===void 0)i="g";t.call(this);this._activeOpacity=.75;this._activeStyle={stroke:function(t,i){return a.color(e._stroke(t,i)).darker(2)},"stroke-width":function(t,i){var n=e._strokeWidth(t,i);return n?n*2:1}};this._backgroundImage=n.constant(false);this._data=[];this._duration=600;this._fill=n.constant("black");this._fillOpacity=n.constant(1);this._hoverOpacity=.5;this._id=function(t,i){return t.id!==void 0?t.id:i};this._label=n.constant(false);this._labelConfig={fontColor:function(t,i){return s.colorContrast(e._fill(t,i))},fontSize:12};this._labelPadding=n.constant(5);this._name="Shape";this._opacity=n.constant(1);this._rx=n.constant(0);this._ry=n.constant(0);this._scale=n.constant(1);this._shapeRendering=n.constant("geometricPrecision");this._stroke=function(t,i){return a.color(e._fill(t,i)).darker(1)};this._strokeDasharray=n.constant("0");this._strokeLinecap=n.constant("butt");this._strokeOpacity=n.constant(1);this._strokeWidth=n.constant(0);this._tagName=i;this._textAnchor=n.constant("start");this._vectorEffect=n.constant("non-scaling-stroke");this._verticalAlign=n.constant("top");this._x=n.accessor("x",0);this._y=n.accessor("y",0)}if(t)h.__proto__=t;h.prototype=Object.create(t&&t.prototype);h.prototype.constructor=h;h.prototype._aes=function t(){return{}};h.prototype._applyEvents=function t(e){var n=this;var a=Object.keys(this._on);var s=function(t){e.on(a[t],function(e,s){if(!n._on[a[t]]){return}if(e.i!==void 0){s=e.i}if(e.nested&&e.values){var o=i.mouse(n._select.node()),h=e.values.map(function(t){return f(o,[n._x(t,s),n._y(t,s)])});e=e.values[h.indexOf(r.min(h))]}n._on[a[t]].bind(n)(e,s)})};for(var o=0;o<a.length;o++)s(o)};h.prototype._applyActive=function t(i){var e=this;var r=this;if(i.size()&&i.node().tagName==="g"){i=i.selectAll("*")}function a(t,i){return typeof this!=="function"?this:t.nested&&t.key&&t.values?this(t.values[0],r._data.indexOf(t.values[0])):this(t,i)}var s={};for(var o in e._activeStyle){if({}.hasOwnProperty.call(e._activeStyle,o)){s[o]=a.bind(e._activeStyle[o])}}i.transition().duration(0).call(n.attrize,s)};h.prototype._applyStyle=function t(i){var e=this;if(i.size()&&i.node().tagName==="g"){i=i.selectAll("*")}function n(t,i){return typeof this!=="function"?this:t.nested&&t.key&&t.values?this(t.values[0],e._data.indexOf(t.values[0])):this(t,i)}i.attr("fill",n.bind(this._fill)).attr("fill-opacity",n.bind(this._fillOpacity)).attr("rx",n.bind(this._rx)).attr("ry",n.bind(this._ry)).attr("stroke",n.bind(this._stroke)).attr("stroke-dasharray",n.bind(this._strokeDasharray)).attr("stroke-linecap",n.bind(this._strokeLinecap)).attr("stroke-opacity",n.bind(this._strokeOpacity)).attr("stroke-width",n.bind(this._strokeWidth)).attr("vector-effect",n.bind(this._vectorEffect))};h.prototype._applyTransform=function t(i){var e=this;i.attr("transform",function(t,i){return"\n        translate("+(t.__d3plusShape__?t.translate?t.translate:e._x(t.data,t.i)+","+e._y(t.data,t.i):e._x(t,i)+","+e._y(t,i))+")\n        scale("+(t.__d3plusShape__?t.scale||e._scale(t.data,t.i):e._scale(t,i))+")"})};h.prototype._nestWrapper=function t(i){return function(t,e){return i(t.__d3plusShape__?t.data:t,t.__d3plusShape__?t.i:e)}};h.prototype._renderImage=function t(){var i=this;var e=[];this._update.merge(this._enter).data().forEach(function(t,n){var r=i._aes(t,n);if(r.r||r.width&&r.height){var a=t;if(t.nested&&t.key&&t.values){a=t.values[0];n=i._data.indexOf(a)}var s=r.r?r.r*2:r.height,o=i._backgroundImage(a,n),h=r.r?r.r*2:r.width;if(o){var u=a.__d3plusShape__?a.translate?a.translate[0]:i._x(a.data,a.i):i._x(a,n),l=a.__d3plusShape__?a.translate?a.translate[1]:i._y(a.data,a.i):i._y(a,n);if(r.x){u+=r.x}if(r.y){l+=r.y}if(a.__d3plusShape__){a=a.data;n=a.i}e.push({__d3plus__:true,data:a,height:s,i:n,id:i._id(a,n),url:o,width:h,x:u+-h/2,y:l+-s/2})}}});return(new p).data(e).duration(this._duration).pointerEvents("none").select(n.elem("g.d3plus-"+this._name+"-image",{parent:this._group,update:{opacity:this._active?this._activeOpacity:1}}).node()).render()};h.prototype._renderLabels=function t(){var i=this;var e=[];this._update.merge(this._enter).data().forEach(function(t,n){var r=t;if(t.nested&&t.key&&t.values){r=t.values[0];n=i._data.indexOf(r)}var a=i._label(r,n);if(i._labelBounds&&a!==false&&a!==undefined){var s=i._labelBounds(r,n,i._aes(t,n));if(s){if(a.constructor!==Array){a=[a]}var o=r.__d3plusShape__?r.translate?r.translate[0]:i._x(r.data,r.i):i._x(r,n),h=r.__d3plusShape__?r.translate?r.translate[1]:i._y(r.data,r.i):i._y(r,n);if(r.__d3plusShape__){r=r.data;n=r.i}var u=i._labelPadding(r,n);for(var l=0;l<a.length;l++){var c=s.constructor===Array?s[l]:Object.assign({},s),p=u.constructor===Array?u[l]:u;e.push({__d3plus__:true,data:r,height:c.height-p*2,l:l,id:i._id(r,n)+"_"+l,r:s.angle!==undefined?s.angle:0,text:a[l],width:c.width-p*2,x:o+c.x+p,y:h+c.y+p})}}}});return(new o.TextBox).data(e).duration(this._duration).pointerEvents("none").rotate(function(t){return t.data.r}).select(n.elem("g.d3plus-"+this._name+"-text",{parent:this._group,update:{opacity:this._active?this._activeOpacity:1}}).node()).config(this._labelConfig).render()};h.prototype.render=function t(r){var a=this;if(this._select===void 0){this.select(i.select("body").append("svg").style("width",window.innerWidth+"px").style("height",window.innerHeight+"px").style("display","block").node())}this._transition=e.transition().duration(this._duration);var s=this._data,h=this._id;if(this._dataFilter){s=this._dataFilter(s);if(s.key){h=s.key}}if(this._sort){s=s.sort(function(t,i){return a._sort(t.__d3plusShape__?t.data:t,i.__d3plusShape__?i.data:i)})}i.selectAll("g.d3plus-"+this._name+"-hover > *, g.d3plus-"+this._name+"-active > *").each(function(t){if(t&&t.parentNode){t.parentNode.appendChild(this)}else{this.parentNode.removeChild(this)}});this._group=n.elem("g.d3plus-"+this._name+"-group",{parent:this._select});var u=this._update=n.elem("g.d3plus-"+this._name+"-shape",{parent:this._group,update:{opacity:this._active?this._activeOpacity:1}}).selectAll(".d3plus-"+this._name).data(s,h);u.order().transition(this._transition).call(this._applyTransform.bind(this));var l=this._enter=u.enter().append(this._tagName).attr("class",function(t,i){return"d3plus-Shape d3plus-"+a._name+" d3plus-id-"+o.strip(a._nestWrapper(a._id)(t,i))}).call(this._applyTransform.bind(this)).attr("opacity",this._nestWrapper(this._opacity));var c=l.merge(u);c.attr("shape-rendering",this._nestWrapper(this._shapeRendering)).attr("pointer-events","none").transition(this._transition).attr("opacity",this._nestWrapper(this._opacity)).transition().attr("pointer-events","all");var p=this._exit=u.exit();p.transition().delay(this._duration).remove();this._renderImage();this._renderLabels();this._hoverGroup=n.elem("g.d3plus-"+this._name+"-hover",{parent:this._group});this._activeGroup=n.elem("g.d3plus-"+this._name+"-active",{parent:this._group});var _=this;var f=this._group.selectAll(".d3plus-HitArea").data(this._hitArea?s:[],h);f.order().transition(this._transition).call(this._applyTransform.bind(this));var d=f.enter().append("rect").attr("class",function(t,i){return"d3plus-HitArea d3plus-id-"+o.strip(a._nestWrapper(a._id)(t,i))}).attr("fill","transparent").call(this._applyTransform.bind(this));var y=f.merge(d).each(function(t){var e=_._hitArea(t,_._data.indexOf(t),_._aes(t,_._data.indexOf(t)));return e?i.select(this).call(n.attrize,e):i.select(this).remove()});f.exit().remove();this._applyEvents(this._hitArea?y:c);this.active(this._active);if(r){setTimeout(r,this._duration+100)}return this};h.prototype.active=function t(e){if(!arguments.length||e===void 0){return this._active}this._active=e;var n=this;this._group.selectAll(".d3plus-Shape, .d3plus-Image, .d3plus-textBox").each(function(t,r){if(!t){t={}}if(!t.parentNode){t.parentNode=this.parentNode}var a=t.parentNode;if(i.select(this).classed("d3plus-textBox")){t=t.data}if(t.__d3plusShape__||t.__d3plus__){while(t&&(t.__d3plusShape__||t.__d3plus__)){r=t.i;t=t.data}}else{r=n._data.indexOf(t)}var s=!e||typeof e!=="function"||!e(t,r)?a:n._activeGroup.node();if(s!==this.parentNode){s.appendChild(this);if(this.className.baseVal.includes("d3plus-Shape")){if(a===s){i.select(this).call(n._applyStyle.bind(n))}else{i.select(this).call(n._applyActive.bind(n))}}}});this._group.selectAll("g.d3plus-"+this._name+"-shape, g.d3plus-"+this._name+"-image, g.d3plus-"+this._name+"-text").attr("opacity",this._hover?this._hoverOpacity:this._active?this._activeOpacity:1);return this};h.prototype.activeOpacity=function t(i){return arguments.length?(this._activeOpacity=i,this):this._activeOpacity};h.prototype.backgroundImage=function t(i){return arguments.length?(this._backgroundImage=typeof i==="function"?i:n.constant(i),this):this._backgroundImage};h.prototype.data=function t(i){return arguments.length?(this._data=i,this):this._data};h.prototype.duration=function t(i){return arguments.length?(this._duration=i,this):this._duration};h.prototype.fill=function t(i){return arguments.length?(this._fill=typeof i==="function"?i:n.constant(i),this):this._fill};h.prototype.fillOpacity=function t(i){return arguments.length?(this._fillOpacity=typeof i==="function"?i:n.constant(i),this):this._fillOpacity};h.prototype.hover=function t(e){if(!arguments.length||e===void 0){return this._hover}this._hover=e;var n=this;this._group.selectAll("g.d3plus-"+this._name+"-shape, g.d3plus-"+this._name+"-image, g.d3plus-"+this._name+"-text, g.d3plus-"+this._name+"-hover").selectAll(".d3plus-Shape, .d3plus-Image, .d3plus-textBox").each(function(t,r){if(!t){t={}}if(!t.parentNode){t.parentNode=this.parentNode}var a=t.parentNode;if(i.select(this).classed("d3plus-textBox")){t=t.data}if(t.__d3plusShape__||t.__d3plus__){while(t&&(t.__d3plusShape__||t.__d3plus__)){r=t.i;t=t.data}}else{r=n._data.indexOf(t)}var s=!e||typeof e!=="function"||!e(t,r)?a:n._hoverGroup.node();if(s!==this.parentNode){s.appendChild(this)}});this._group.selectAll("g.d3plus-"+this._name+"-shape, g.d3plus-"+this._name+"-image, g.d3plus-"+this._name+"-text").attr("opacity",this._hover?this._hoverOpacity:this._active?this._activeOpacity:1);return this};h.prototype.hoverOpacity=function t(i){return arguments.length?(this._hoverOpacity=i,this):this._hoverOpacity};h.prototype.hitArea=function t(i){return arguments.length?(this._hitArea=typeof i==="function"?i:n.constant(i),this):this._hitArea};h.prototype.id=function t(i){return arguments.length?(this._id=i,this):this._id};h.prototype.label=function t(i){return arguments.length?(this._label=typeof i==="function"?i:n.constant(i),this):this._label};h.prototype.labelBounds=function t(i){return arguments.length?(this._labelBounds=typeof i==="function"?i:n.constant(i),this):this._labelBounds};h.prototype.labelConfig=function t(i){return arguments.length?(this._labelConfig=n.assign(this._labelConfig,i),this):this._labelConfig};h.prototype.labelPadding=function t(i){return arguments.length?(this._labelPadding=typeof i==="function"?i:n.constant(i),this):this._labelPadding};h.prototype.opacity=function t(i){return arguments.length?(this._opacity=typeof i==="function"?i:n.constant(i),this):this._opacity};h.prototype.rx=function t(i){return arguments.length?(this._rx=typeof i==="function"?i:n.constant(i),this):this._rx};h.prototype.ry=function t(i){return arguments.length?(this._ry=typeof i==="function"?i:n.constant(i),this):this._ry};h.prototype.scale=function t(i){return arguments.length?(this._scale=typeof i==="function"?i:n.constant(i),this):this._scale};h.prototype.select=function t(e){return arguments.length?(this._select=i.select(e),this):this._select};h.prototype.shapeRendering=function t(i){return arguments.length?(this._shapeRendering=typeof i==="function"?i:n.constant(i),this):this._shapeRendering};h.prototype.sort=function t(i){return arguments.length?(this._sort=i,this):this._sort};h.prototype.stroke=function t(i){return arguments.length?(this._stroke=typeof i==="function"?i:n.constant(i),this):this._stroke};h.prototype.strokeDasharray=function t(i){return arguments.length?(this._strokeDasharray=typeof i==="function"?i:n.constant(i),this):this._strokeDasharray};h.prototype.strokeLinecap=function t(i){return arguments.length?(this._strokeLinecap=typeof i==="function"?i:n.constant(i),this):this._strokeLinecap};h.prototype.strokeOpacity=function t(i){return arguments.length?(this._strokeOpacity=typeof i==="function"?i:n.constant(i),this):this._strokeOpacity};h.prototype.strokeWidth=function t(i){return arguments.length?(this._strokeWidth=typeof i==="function"?i:n.constant(i),this):this._strokeWidth};h.prototype.textAnchor=function t(i){return arguments.length?(this._textAnchor=typeof i==="function"?i:n.constant(i),this):this._textAnchor};h.prototype.vectorEffect=function t(i){return arguments.length?(this._vectorEffect=typeof i==="function"?i:n.constant(i),this):this._vectorEffect};h.prototype.verticalAlign=function t(i){return arguments.length?(this._verticalAlign=typeof i==="function"?i:n.constant(i),this):this._verticalAlign};h.prototype.x=function t(i){return arguments.length?(this._x=typeof i==="function"?i:n.constant(i),this):this._x};h.prototype.y=function t(i){return arguments.length?(this._y=typeof i==="function"?i:n.constant(i),this):this._y};return h}(n.BaseClass);var y=function(t,i,e,n){var r=1e-9;var a=t[0]-i[0],s=e[0]-n[0],o=t[1]-i[1],h=e[1]-n[1];var u=a*h-o*s;if(Math.abs(u)<r){return null}var l=t[0]*i[1]-t[1]*i[0],c=e[0]*n[1]-e[1]*n[0];var p=(l*s-c*a)/u,_=(l*h-c*o)/u;return[p,_]};var v=function(t,i,e){var n=1e-9;var r=e[0];var a=e[1];return!(r<Math.min(t[0],i[0])-n||r>Math.max(t[0],i[0])+n||a<Math.min(t[1],i[1])-n||a>Math.max(t[1],i[1])+n)};var g=function(t,i,e,n){var r=y(t,i,e,n);if(!r){return false}return v(t,i,r)&&v(e,n,r)};var x=function(t,i){var e=-1;var n=t.length;var r=i.length;var a=t[n-1];while(++e<n){var s=a;a=t[e];var o=-1;var h=i[r-1];while(++o<r){var u=h;h=i[o];if(g(s,a,u,h)){return false}}}return c.polygonContains(i,t[0])};var m=function(t,i,e){if(e===void 0)e=0;var n=1e-9;i=[i[0]+n*Math.cos(e),i[1]+n*Math.sin(e)];var r=i[0];var a=i[1];var s=[r+Math.cos(e),a+Math.sin(e)];var o=0;if(Math.abs(s[0]-r)<n){o=1}var h=-1;var u=t.length;var l=t[u-1];var c=Number.MAX_VALUE;var p=Number.MAX_VALUE;var f=null;var d=null;while(++h<u){var g=l;l=t[h];var x=y(i,s,g,l);if(x&&v(g,l,x)){var m=_(i,x);if(x[o]<i[o]){if(m<c){c=m;f=x}}else if(x[o]>i[o]){if(m<p){p=m;d=x}}}}return[f,d]};var b=function(t,i,e){if(e===void 0)e=[0,0];var n=Math.cos(i),r=Math.sin(i),a=t[0]-e[0],s=t[1]-e[1];return[n*a-r*s+e[0],r*a+n*s+e[1]]};var w=function(t,i,e){if(e===void 0)e=[0,0];return t.map(function(t){return b(t,i,e)})};function O(t,i,e){var n=i[0],r=i[1];var a=e[0]-n,s=e[1]-r;if(a!==0||s!==0){var o=((t[0]-n)*a+(t[1]-r)*s)/(a*a+s*s);if(o>1){n=e[0];r=e[1]}else if(o>0){n+=a*o;r+=s*o}}a=t[0]-n;s=t[1]-r;return a*a+s*s}function k(t,i){var e,n=t[0];var r=[n];for(var a=1,s=t.length;a<s;a++){e=t[a];if(_(e,n)>i){r.push(e);n=e}}if(n!==e){r.push(e)}return r}function A(t,i,e,n,r){var a,s=n;for(var o=i+1;o<e;o++){var h=O(t[o],t[i],t[e]);if(h>s){a=o;s=h}}if(s>n){if(a-i>1){A(t,i,a,n,r)}r.push(t[a]);if(e-a>1){A(t,a,e,n,r)}}}function M(t,i){var e=t.length-1;var n=[t[0]];A(t,0,e,i,n);n.push(t[e]);return n}var S=function(t,i,e){if(i===void 0)i=1;if(e===void 0)e=false;if(t.length<=2){return t}var n=i*i;t=e?t:k(t,n);t=M(t,n);return t};var R=.5;var C=5;var N=function(t,i){if(i===void 0)i={};if(t.length<3){if(i.verbose){console.error("polygon has to have at least 3 points",t)}return null}var e=[];i=Object.assign({angle:r.range(-90,90+C,C),maxAspectRatio:15,minAspectRatio:1,minHeight:0,minWidth:0,nTries:20,tolerance:.02,verbose:false},i);var n=i.angle instanceof Array?i.angle:typeof i.angle==="number"?[i.angle]:typeof i.angle==="string"&&!isNaN(i.angle)?[Number(i.angle)]:[];var a=i.aspectRatio instanceof Array?i.aspectRatio:typeof i.aspectRatio==="number"?[i.aspectRatio]:typeof i.aspectRatio==="string"&&!isNaN(i.aspectRatio)?[Number(i.aspectRatio)]:[];var s=i.origin&&i.origin instanceof Array?i.origin[0]instanceof Array?i.origin:[i.origin]:[];var o=Math.abs(c.polygonArea(t));if(o===0){if(i.verbose){console.error("polygon has 0 area",t)}return null}var h=r.extent(t,function(t){return t[0]});var u=h[0];var l=h[1];var p=r.extent(t,function(t){return t[1]});var f=p[0];var d=p[1];var y=Math.min(l-u,d-f)*i.tolerance;if(y>0){t=S(t,y)}if(i.events){e.push({type:"simplify",poly:t})}var v;v=r.extent(t,function(t){return t[0]}),u=v[0],l=v[1];var g;g=r.extent(t,function(t){return t[1]}),f=g[0],d=g[1];var b=[l-u,d-f];var O=b[0];var k=b[1];var A=Math.min(O,k)/50;if(!s.length){var M=c.polygonCentroid(t);if(isNaN(M[0])){if(i.verbose){console.error("cannot find centroid",t)}return null}if(c.polygonContains(t,M)){s.push(M)}while(s.length<i.nTries){var N=Math.random()*O+u;var P=Math.random()*k+f;var W=[N,P];if(c.polygonContains(t,W)){s.push(W)}}}if(i.events){e.push({type:"origins",points:s})}var j=0;var I=null;for(var E=0;E<n.length;E++){var B=n[E];var q=-B*Math.PI/180;if(i.events){e.push({type:"angle",angle:B})}for(var H=0;H<s.length;H++){var T=s[H];var L=m(t,T,q);var D=L[0];var U=L[1];var z=m(t,T,q+Math.PI/2);var F=z[0];var X=z[1];var G=[];if(D&&U){G.push([(D[0]+U[0])/2,(D[1]+U[1])/2])}if(F&&X){G.push([(F[0]+X[0])/2,(F[1]+X[1])/2])}if(i.events){e.push({type:"modifOrigin",idx:H,p1W:D,p2W:U,p1H:F,p2H:X,modifOrigins:G})}for(var V=0;V<G.length;V++){var Y=G[V];if(i.events){e.push({type:"origin",cx:Y[0],cy:Y[1]})}var Z=m(t,Y,q);var J=Z[0];var K=Z[1];if(J===null||K===null){continue}var Q=Math.min(_(Y,J),_(Y,K));var $=2*Math.sqrt(Q);var tt=m(t,Y,q+Math.PI/2);var it=tt[0];var et=tt[1];if(it===null||et===null){continue}var nt=Math.min(_(Y,it),_(Y,et));var rt=2*Math.sqrt(nt);if($*rt<j){continue}var at=a;if(!at.length){var st=Math.max(i.minAspectRatio,i.minWidth/rt,j/(rt*rt));var ot=Math.min(i.maxAspectRatio,$/i.minHeight,$*$/j);at=r.range(st,ot+R,R)}for(var ht=0;ht<at.length;ht++){var ut=at[ht];var lt=Math.max(i.minWidth,Math.sqrt(j*ut));var ct=Math.min($,rt*ut);if(ct*rt<j){continue}if(i.events&&ct-lt>=A){e.push({type:"aRatio",aRatio:ut})}while(ct-lt>=A){var pt=(lt+ct)/2;var _t=pt/ut;var ft=Y[0];var dt=Y[1];var yt=[[ft-pt/2,dt-_t/2],[ft+pt/2,dt-_t/2],[ft+pt/2,dt+_t/2],[ft-pt/2,dt+_t/2]];yt=w(yt,q,Y);var vt=x(yt,t);if(vt){j=pt*_t;yt.push(yt[0]);I={area:j,cx:ft,cy:dt,width:pt,height:_t,angle:-B,points:yt};lt=pt}else{ct=pt}if(i.events){e.push({type:"rectangle",areaFraction:pt*_t/o,cx:ft,cy:dt,width:pt,height:_t,angle:B,insidePoly:vt})}}}}}}return i.events?Object.assign(I||{},{events:e}):I};var P=function(t){function e(){var i=this;t.call(this);this._curve="linear";this._defined=function(){return true};this._labelBounds=function(t,e,n){var r=N(n.points);if(!r){return null}return{angle:r.angle,width:r.width,height:r.height,x:r.cx-r.width/2-i._x(t,e),y:r.cy-r.height/2-i._y(t,e)}};this._labelConfig=Object.assign(this._labelConfig,{textAnchor:"middle",verticalAlign:"middle"});this._name="Area";this._x=n.accessor("x");this._x0=n.accessor("x");this._x1=null;this._y=n.constant(0);this._y0=n.constant(0);this._y1=n.accessor("y")}if(t)e.__proto__=t;e.prototype=Object.create(t&&t.prototype);e.prototype.constructor=e;e.prototype._aes=function t(i){var e=this;var n=i.values.slice().sort(function(t,i){return e._y1?e._x(t)-e._x(i):e._y(t)-e._y(i)});var r=n.map(function(t,i){return[e._x0(t,i),e._y0(t,i)]});var a=n.reverse().map(function(t,i){return e._y1?[e._x(t,i),e._y1(t,i)]:[e._x1(t,i),e._y(t,i)]});var s=r.concat(a);if(r[0][1]>a[0][1]){s=s.reverse()}s.push(s[0]);return{points:s}};e.prototype._dataFilter=function t(i){var e=this;var a=h.nest().key(this._id).entries(i).map(function(t){t.data=n.merge(t.values);t.i=i.indexOf(t.values[0]);var a=r.extent(t.values.map(e._x).concat(t.values.map(e._x0)).concat(e._x1?t.values.map(e._x1):[]));t.xR=a;t.width=a[1]-a[0];t.x=a[0]+t.width/2;var s=r.extent(t.values.map(e._y).concat(t.values.map(e._y0)).concat(e._y1?t.values.map(e._y1):[]));t.yR=s;t.height=s[1]-s[0];t.y=s[0]+t.height/2;t.nested=true;t.translate=[t.x,t.y];t.__d3plusShape__=true;return t});a.key=function(t){return t.key};return a};e.prototype.render=function e(n){t.prototype.render.call(this,n);var r=this._path=l.area().defined(this._defined).curve(l["curve"+this._curve.charAt(0).toUpperCase()+this._curve.slice(1)]).x(this._x).x0(this._x0).x1(this._x1).y(this._y).y0(this._y0).y1(this._y1);var a=l.area().defined(function(t){return t}).curve(l["curve"+this._curve.charAt(0).toUpperCase()+this._curve.slice(1)]).x(this._x).x0(this._x0).x1(this._x1).y(this._y).y0(this._y0).y1(this._y1);this._enter.append("path").attr("transform",function(t){return"translate("+(-t.xR[0]-t.width/2)+", "+(-t.yR[0]-t.height/2)+")"}).attr("d",function(t){return r(t.values)}).call(this._applyStyle.bind(this));this._update.select("path").transition(this._transition).attr("transform",function(t){return"translate("+(-t.xR[0]-t.width/2)+", "+(-t.yR[0]-t.height/2)+")"}).attrTween("d",function(t){return u.interpolatePath(i.select(this).attr("d"),r(t.values))}).call(this._applyStyle.bind(this));this._exit.select("path").transition(this._transition).attrTween("d",function(t){return u.interpolatePath(i.select(this).attr("d"),a(t.values))});return this};e.prototype.curve=function t(i){return arguments.length?(this._curve=i,this):this._curve};e.prototype.defined=function t(i){return arguments.length?(this._defined=i,this):this._defined};e.prototype.x=function t(i){if(!arguments.length){return this._x}this._x=typeof i==="function"?i:n.constant(i);this._x0=this._x;return this};e.prototype.x0=function t(i){if(!arguments.length){return this._x0}this._x0=typeof i==="function"?i:n.constant(i);this._x=this._x0;return this};e.prototype.x1=function t(i){return arguments.length?(this._x1=typeof i==="function"||i===null?i:n.constant(i),this):this._x1};e.prototype.y=function t(i){if(!arguments.length){return this._y}this._y=typeof i==="function"?i:n.constant(i);this._y0=this._y;return this};e.prototype.y0=function t(i){if(!arguments.length){return this._y0}this._y0=typeof i==="function"?i:n.constant(i);this._y=this._y0;return this};e.prototype.y1=function t(i){return arguments.length?(this._y1=typeof i==="function"||i===null?i:n.constant(i),this):this._y1};return e}(d);var W=function(t){function i(){var i=this;t.call(this,"rect");this._name="Bar";this._height=n.constant(10);this._labelBounds=function(t,e,n){return{width:n.width,height:n.height,x:i._x1!==null?i._getX(t,e):-n.width/2,y:i._x1===null?i._getY(t,e):-n.height/2}};this._width=n.constant(10);this._x=n.accessor("x");this._x0=n.accessor("x");this._x1=null;this._y=n.constant(0);this._y0=n.constant(0);this._y1=n.accessor("y")}if(t)i.__proto__=t;i.prototype=Object.create(t&&t.prototype);i.prototype.constructor=i;i.prototype.render=function i(e){var n=this;t.prototype.render.call(this,e);this._enter.attr("width",function(t,i){return n._x1===null?n._getWidth(t,i):0}).attr("height",function(t,i){return n._x1!==null?n._getHeight(t,i):0}).attr("x",function(t,i){return n._x1===null?-n._getWidth(t,i)/2:0}).attr("y",function(t,i){return n._x1!==null?-n._getHeight(t,i)/2:0}).call(this._applyStyle.bind(this)).transition(this._transition).call(this._applyPosition.bind(this));this._update.transition(this._transition).call(this._applyStyle.bind(this)).call(this._applyPosition.bind(this));this._exit.transition(this._transition).attr("width",function(t,i){return n._x1===null?n._getWidth(t,i):0}).attr("height",function(t,i){return n._x1!==null?n._getHeight(t,i):0}).attr("x",function(t,i){return n._x1===null?-n._getWidth(t,i)/2:0}).attr("y",function(t,i){return n._x1!==null?-n._getHeight(t,i)/2:0});return this};i.prototype._aes=function t(i,e){return{height:this._getHeight(i,e),width:this._getWidth(i,e)}};i.prototype._applyPosition=function t(i){var e=this;i.attr("width",function(t,i){return e._getWidth(t,i)}).attr("height",function(t,i){return e._getHeight(t,i)}).attr("x",function(t,i){return e._x1!==null?e._getX(t,i):-e._getWidth(t,i)/2}).attr("y",function(t,i){return e._x1===null?e._getY(t,i):-e._getHeight(t,i)/2})};i.prototype._getHeight=function t(i,e){if(this._x1!==null){return this._height(i,e)}return Math.abs(this._y1(i,e)-this._y(i,e))};i.prototype._getWidth=function t(i,e){if(this._x1===null){return this._width(i,e)}return Math.abs(this._x1(i,e)-this._x(i,e))};i.prototype._getX=function t(i,e){var n=this._x1===null?this._x(i,e):this._x1(i,e)-this._x(i,e);if(n<0){return n}else{return 0}};i.prototype._getY=function t(i,e){var n=this._x1!==null?this._y(i,e):this._y1(i,e)-this._y(i,e);if(n<0){return n}else{return 0}};i.prototype.height=function t(i){return arguments.length?(this._height=typeof i==="function"?i:n.constant(i),this):this._height};i.prototype.width=function t(i){return arguments.length?(this._width=typeof i==="function"?i:n.constant(i),this):this._width};i.prototype.x0=function t(i){if(!arguments.length){return this._x0}this._x0=typeof i==="function"?i:n.constant(i);this._x=this._x0;return this};i.prototype.x1=function t(i){return arguments.length?(this._x1=typeof i==="function"||i===null?i:n.constant(i),this):this._x1};i.prototype.y0=function t(i){if(!arguments.length){return this._y0}this._y0=typeof i==="function"?i:n.constant(i);this._y=this._y0;return this};i.prototype.y1=function t(i){return arguments.length?(this._y1=typeof i==="function"||i===null?i:n.constant(i),this):this._y1};return i}(d);var j=function(t){function i(){t.call(this,"circle");this._name="Circle";this._r=n.accessor("r")}if(t)i.__proto__=t;i.prototype=Object.create(t&&t.prototype);i.prototype.constructor=i;i.prototype._applyPosition=function t(i){var e=this;i.attr("r",function(t,i){return e._r(t,i)}).attr("x",function(t,i){return-e._r(t,i)/2}).attr("y",function(t,i){return-e._r(t,i)/2})};i.prototype.render=function i(e){t.prototype.render.call(this,e);this._enter.attr("r",0).attr("x",0).attr("y",0).call(this._applyStyle.bind(this)).transition(this._transition).call(this._applyPosition.bind(this));this._update.transition(this._transition).call(this._applyStyle.bind(this)).call(this._applyPosition.bind(this));this._exit.transition(this._transition).attr("r",0).attr("x",0).attr("y",0);return this};i.prototype._aes=function t(i,e){return{r:this._r(i,e)}};i.prototype.r=function t(i){return arguments.length?(this._r=typeof i==="function"?i:n.constant(i),this):this._r};return i}(d);var I=function(t){function e(){t.call(this);this._curve="linear";this._defined=function(t){return t};this._fill=n.constant("none");this._name="Line";this._path=l.line();this._stroke=n.constant("black");this._strokeWidth=n.constant(1)}if(t)e.__proto__=t;e.prototype=Object.create(t&&t.prototype);e.prototype.constructor=e;e.prototype._dataFilter=function t(i){var e=this;var a=h.nest().key(this._id).entries(i).map(function(t){t.data=n.merge(t.values);t.i=i.indexOf(t.values[0]);var a=r.extent(t.values,e._x);t.xR=a;t.width=a[1]-a[0];t.x=a[0]+t.width/2;var s=r.extent(t.values,e._y);t.yR=s;t.height=s[1]-s[0];t.y=s[0]+t.height/2;t.nested=true;t.translate=[t.x,t.y];t.__d3plusShape__=true;return t});a.key=function(t){return t.key};return a};e.prototype.render=function e(n){var r=this;t.prototype.render.call(this,n);var a=this;this._path.curve(l["curve"+this._curve.charAt(0).toUpperCase()+this._curve.slice(1)]).defined(this._defined).x(this._x).y(this._y);this._enter.append("path").attr("transform",function(t){return"translate("+(-t.xR[0]-t.width/2)+", "+(-t.yR[0]-t.height/2)+")"}).attr("d",function(t){return r._path(t.values)}).call(this._applyStyle.bind(this));this._update.select("path").transition(this._transition).attr("transform",function(t){return"translate("+(-t.xR[0]-t.width/2)+", "+(-t.yR[0]-t.height/2)+")"}).attrTween("d",function(t){return u.interpolatePath(i.select(this).attr("d"),a._path(t.values))}).call(this._applyStyle.bind(this));return this};e.prototype._aes=function t(i,e){var n=this;return{points:i.values.map(function(t){return[n._x(t,e),n._y(t,e)]})}};e.prototype.curve=function t(i){return arguments.length?(this._curve=i,this):this._curve};e.prototype.defined=function t(i){return arguments.length?(this._defined=i,this):this._defined};return e}(d);var E=Math.PI;var B=function(t,i,e){if(e===void 0)e="circle";if(t<0){t=E*2+t}if(e==="square"){var n=45*(E/180);var r=0,a=0;if(t<E/2){var s=Math.tan(t);r+=t<n?i:i/s;a+=t<n?s*i:i}else if(t<=E){var o=Math.tan(E-t);r-=t<E-n?i/o:i;a+=t<E-n?i:o*i}else if(t<n+E){r-=i;a-=Math.tan(t-E)*i}else if(t<3*E/2){r-=i/Math.tan(t-E);a-=i}else if(t<2*E-n){r+=i/Math.tan(2*E-t);a-=i}else{r+=i;a-=Math.tan(2*E-t)*i}return[r,a]}else if(e==="circle"){return[i*Math.cos(t),i*Math.sin(t)]}else{return null}};var q=Math.PI;var H=function(t,i){if(i===void 0)i=20;var e=[],n=/([MLA])([^MLAZ]+)/gi;var r=n.exec(t);while(r!==null){if(["M","L"].includes(r[1])){e.push(r[2].split(",").map(Number))}else if(r[1]==="A"){var a=r[2].split(",").map(Number);var s=a.slice(a.length-2,a.length),o=e[e.length-1],h=a[0],u=f(o,s);var l=Math.acos((h*h+h*h-u*u)/(2*h*h));if(a[2]){l=q*2-l}var c=l/(l/(q*2)*(h*q*2)/i);var p=Math.atan2(-o[1],-o[0])-q;var _=c;while(_<l){e.push(B(a[4]?p+_:p-_,h));_+=c}e.push(s)}r=n.exec(t)}return e};var T=function(t){function i(){var i=this;t.call(this,"path");this._d=n.accessor("path");this._labelBounds=function(t,e,n){var r=N(n.points,{angle:i._labelConfig.rotate?i._labelConfig.rotate(t,e):0});return{angle:r.angle,width:r.width,height:r.height,x:r.cx-r.width/2,y:r.cy-r.height/2}};this._name="Path";this._labelConfig=Object.assign(this._labelConfig,{textAnchor:"middle",verticalAlign:"middle"})}if(t)i.__proto__=t;i.prototype=Object.create(t&&t.prototype);i.prototype.constructor=i;i.prototype._aes=function t(i,e){return{points:H(this._d(i,e))}};i.prototype.render=function i(e){t.prototype.render.call(this,e);this._enter.attr("opacity",0).attr("d",this._d).call(this._applyStyle.bind(this)).transition(this._transition).attr("opacity",1);this._update.transition(this._transition).call(this._applyStyle.bind(this)).attr("opacity",1).attr("d",this._d);this._exit.transition(this._transition).attr("opacity",0);return this};i.prototype.d=function t(i){return arguments.length?(this._d=typeof i==="function"?i:n.constant(i),this):this._d};return i}(d);var L=function(t){function i(){t.call(this,"rect");this._height=n.accessor("height");this._labelBounds=function(t,i,e){return{width:e.width,height:e.height,x:-e.width/2,y:-e.height/2}};this._name="Rect";this._width=n.accessor("width")}if(t)i.__proto__=t;i.prototype=Object.create(t&&t.prototype);i.prototype.constructor=i;i.prototype.render=function i(e){t.prototype.render.call(this,e);this._enter.attr("width",0).attr("height",0).attr("x",0).attr("y",0).call(this._applyStyle.bind(this)).transition(this._transition).call(this._applyPosition.bind(this));this._update.transition(this._transition).call(this._applyStyle.bind(this)).call(this._applyPosition.bind(this));this._exit.transition(this._transition).attr("width",0).attr("height",0).attr("x",0).attr("y",0);return this};i.prototype._aes=function t(i,e){return{width:this._width(i,e),height:this._height(i,e)}};i.prototype._applyPosition=function t(i){var e=this;i.attr("width",function(t,i){return e._width(t,i)}).attr("height",function(t,i){return e._height(t,i)}).attr("x",function(t,i){return-e._width(t,i)/2}).attr("y",function(t,i){return-e._height(t,i)/2})};i.prototype.height=function t(i){return arguments.length?(this._height=typeof i==="function"?i:n.constant(i),this):this._height};i.prototype.width=function t(i){return arguments.length?(this._width=typeof i==="function"?i:n.constant(i),this):this._width};return i}(d);t.Image=p;t.Shape=d;t.Area=P;t.Bar=W;t.Circle=j;t.Line=I;t.Path=T;t.Rect=L;t.largestRect=N;t.lineIntersection=y;t.path2polygon=H;t.pointDistance=f;t.pointDistanceSquared=_;t.pointRotate=b;t.polygonInside=x;t.polygonRayCast=m;t.polygonRotate=w;t.segmentBoxContains=v;t.segmentsIntersect=g;t.shapeEdgePoint=B;t.simplify=S;Object.defineProperty(t,"__esModule",{value:true})});