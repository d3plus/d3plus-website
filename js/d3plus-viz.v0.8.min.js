/*
  d3plus-viz v0.8.0
  Abstract ES6 class that drives d3plus visualizations.
  Copyright (c) 2017 D3plus - https://d3plus.org
  @license MIT
*/
(function(t,i){typeof exports==="object"&&typeof module!=="undefined"?i(exports,require("d3-request"),require("d3-array"),require("d3-color"),require("d3-collection"),require("d3-queue"),require("d3-selection"),require("d3-transition"),require("lrucache"),require("d3plus-axis"),require("d3plus-color"),require("d3plus-common"),require("d3plus-form"),require("d3plus-legend"),require("d3plus-text"),require("d3plus-timeline"),require("d3plus-tooltip"),require("d3plus-export")):typeof define==="function"&&define.amd?define("d3plus-viz",["exports","d3-request","d3-array","d3-color","d3-collection","d3-queue","d3-selection","d3-transition","lrucache","d3plus-axis","d3plus-color","d3plus-common","d3plus-form","d3plus-legend","d3plus-text","d3plus-timeline","d3plus-tooltip","d3plus-export"],i):i(t.d3plus=t.d3plus||{},t.d3Request,t.d3Array,t.d3Color,t.d3Collection,t.d3Queue,t.d3Selection,t.d3Transition,t.lrucache,t.d3plusAxis,t.d3plusColor,t.d3plusCommon,t.d3plusForm,t.d3plusLegend,t.d3plusText,t.d3plusTimeline,t.d3plusTooltip,t.d3plusExport)})(this,function(t,i,e,n,o,s,r,l,h,a,c,d,_,u,f,g,p,v){"use strict";h="default"in h?h["default"]:h;var m=function(t,i,e){if(i===void 0)i="data";if(e===void 0)e="headers";return t[i].map(function(i){return t[e].reduce(function(t,e,n){return t[e]=i[n],t},{})})};var y=function(t,e,n,o){var s=this;if(typeof t!=="string"){var r=e?e(t):t;if(n&&"_"+n in this){this["_"+n]=r}if(o){o(null,r)}}else{var l=t.slice(t.length-4)===".csv"?i.csv:t.slice(t.length-4)===".tsv"?i.tsv:t.slice(t.length-4)===".txt"?i.text:i.json;l(t,function(r,h){if(l!==i.json&&!r&&h&&h instanceof Array){h.forEach(function(t){for(var i in t){if(!isNaN(t[i])){t[i]=parseFloat(t[i])}else if(t[i].toLowerCase()==="false"){t[i]=false}else if(t[i].toLowerCase()==="true"){t[i]=true}else if(t[i].toLowerCase()==="null"){t[i]=null}else if(t[i].toLowerCase()==="undefined"){t[i]=undefined}}})}h=r?[]:e?e(h):h;if(h&&!(h instanceof Array)&&h.data&&h.headers){h=m(h)}if(n&&"_"+n in s){s["_"+n]=h}if(s._cache){s._lrucache.set(t,h)}if(o){o(r,h)}})}};var C=function(){var t=this._history.length;var i=d.elem("g.d3plus-viz-back",{parent:this._select,transition:this._transition,update:{transform:"translate("+this._margin.left+", "+this._margin.top+")"}}).node();this._backClass.data(t?[{text:d.locale.t("Back",{lng:this._locale}),x:this._padding*2,y:0}]:[]).select(i).config(this._backConfig).render();this._margin.top+=t?this._backClass.fontSize()()+this._padding:0};var w=function(t){var i=this;if(t===void 0)t=[];var e={opacity:this._colorScalePosition?1:0,transform:"translate("+this._margin.left+", "+this._margin.top+")"};var n=d.elem("g.d3plus-viz-colorScale",{condition:this._colorScale&&!this._colorScaleConfig.select,enter:e,parent:this._select,transition:this._transition,update:e}).node();if(this._colorScale){var o=t.filter(function(t,e){var n=i._colorScale(t,e);return n!==undefined&&n!==null});var s=this._colorScalePosition||"bottom";var r=["top","bottom"].includes(s);this._colorScaleClass.align({bottom:"end",left:"start",right:"end",top:"start"}[s]).duration(this._duration).data(o).height(this._height-this._margin.bottom-this._margin.top).orient(s).select(n).value(this._colorScale).width(this._width-this._margin.left-this._margin.right).config(this._colorScaleConfig).render();var l=this._colorScaleClass.outerBounds();if(this._colorScalePosition&&!this._colorScaleConfig.select&&l.height){if(r){this._margin[s]+=l.height+this._legendClass.padding()*2}else{this._margin[s]+=l.width+this._legendClass.padding()*2}}}};var b={Button:_.Button,Radio:_.Radio,Select:_.Select};var S=function(){var t=this;var i=this;var e=["left","right","top","bottom"];var n=function(n){var o=e[n];var s=(t._controls||[]).filter(function(t){return!t.position&&o==="bottom"||t.position===o});if(t._downloadButton&&t._downloadPosition===o){s.push({data:[{text:"Download",value:1}],label:"downloadButton",on:{click:function(){v.saveElement(t._select.node(),Object.assign({title:t._title||undefined},t._downloadConfig))}},type:"Button"})}var r={height:t._height-t._margin.top-t._margin.bottom,width:t._width-t._margin.left-t._margin.right,x:t._margin.left,y:t._margin.top};var l=d.elem("foreignObject.d3plus-viz-controls-"+o,{condition:s.length,enter:Object.assign({opacity:0},r),exit:Object.assign({opacity:0},r),parent:t._select,transition:t._transition,update:Object.assign({opacity:1},r)});var h=l.selectAll("div.d3plus-viz-controls-container").data([null]);h=h.enter().append("xhtml:div").attr("class","d3plus-viz-controls-container").style("margin-top",o==="bottom"?r.height+"px":0).style("margin-left",o==="right"?r.width+"px":0).merge(h);if(s.length){var a=function(e){var n=s[e];var r={};if(n.on){var l=function(t){if({}.hasOwnProperty.call(n.on,t)){r[t]=function(){n.on[t].bind(i)(this.value)}}};for(var a in n.on)l(a)}var c=n.label||o+"-"+e;if(!t._controlCache[c]){var d=n.type&&b[n.type]?n.type:"Select";t._controlCache[c]=(new b[d]).container(h.node());if(n.checked){t._controlCache[c].checked(n.checked);delete n.checked}if(n.selected){t._controlCache[c].selected(n.selected);delete n.selected}}t._controlCache[c].config(n).config({on:r}).config(t._controlConfig).render()};for(var c=0;c<s.length;c++)a(c);h.style("display",["top","bottom"].includes(o)?"block":"inline-block").style("text-align",["top","bottom"].includes(o)?"center":o);var _=h.node().getBoundingClientRect();h.transition(t._transition).style("margin-top",o==="bottom"?r.height-_.height+"px":0).style("margin-left",o==="right"?r.width-_.width+"px":0);t._margin[o]+=["top","bottom"].includes(o)?_.height:_.width}};for(var o=0;o<e.length;o++)n(o)};var x=function(t){var i=this;if(t===void 0)t=[];var e={transform:"translate("+this._margin.left+", "+this._margin.top+")"};var n=d.elem("g.d3plus-viz-legend",{condition:this._legend&&!this._legendConfig.select,enter:e,parent:this._select,transition:this._transition,update:e}).node();if(this._legend){var s=this._legendPosition;var r=["top","bottom"].includes(s);var l=[];var h=function(t,e){return i._shapeConfig.fill(t,e)+"_"+i._shapeConfig.opacity(t,e)};o.nest().key(h).rollup(function(t){return l.push(d.merge(t,i._aggs))}).entries(this._colorScale?t.filter(function(t,e){return i._colorScale(t,e)===undefined}):t);this._legendClass.id(h).align(r?"center":s).direction(r?"row":"column").duration(this._duration).data(l.length>1||this._colorScale?l:[]).height(this._height-this._margin.bottom-this._margin.top).label(function(t,e){var n=i._drawLabel(t,e);return n instanceof Array?n.join(", "):n}).select(n).verticalAlign(!r?"middle":s).width(this._width-this._margin.left-this._margin.right).shapeConfig(this._shapeConfig).shapeConfig({on:Object.keys(this._on).filter(function(t){return!t.includes(".")||t.includes(".legend")}).reduce(function(t,e){t[e]=i._on[e];return t},{})}).config(this._legendConfig).render();var a=this._legendClass.outerBounds();if(!this._legendConfig.select&&a.height){if(r){this._margin[s]+=a.height+this._legendClass.padding()*2}else{this._margin[s]+=a.width+this._legendClass.padding()*2}}}};var B=function(t){if(t===void 0)t=[];var i=this._time&&this._timeline;var n=i?Array.from(new Set(this._data.map(this._time))).map(a.date):[];i=i&&n.length>1;var o=d.elem("g.d3plus-viz-timeline",{condition:i,parent:this._select,transition:this._transition}).node();if(i){var s=this._timelineClass.domain(e.extent(n)).duration(this._duration).height(this._height-this._margin.bottom).select(o).ticks(n.sort(function(t,i){return+t-+i})).width(this._width);if(this._timelineSelection===void 0){var r=e.extent(t.map(this._time).map(a.date));this._timelineSelection=r[0]===r[1]?r[0]:r;s.selection(this._timelineSelection)}s.config(this._timelineConfig).render();this._margin.bottom+=s.outerBounds().height+s.padding()*2}};var k=function(t){if(t===void 0)t=[];var i=this._title?this._title(t):false;var e=d.elem("g.d3plus-viz-title",{enter:{transform:"translate("+this._margin.left+", "+this._margin.top+")"},parent:this._select,transition:this._transition,update:{transform:"translate("+this._margin.left+", "+this._margin.top+")"}}).node();this._titleClass.data(i?[{text:i}]:[]).select(e).width(this._width-this._margin.left-this._margin.right).config(this._titleConfig).render();this._margin.top+=i?e.getBBox().height+this._padding:0};var z=function(t){if(t===void 0)t=[];var i=typeof this._total==="function"?e.sum(t.map(this._total)):this._total===true&&this._size?e.sum(t.map(this._size)):false;var n=d.elem("g.d3plus-viz-total",{enter:{transform:"translate("+this._margin.left+", "+this._margin.top+")"},parent:this._select,transition:this._transition,update:{transform:"translate("+this._margin.left+", "+this._margin.top+")"}}).node();var o=typeof i==="number";this._totalClass.data(o?[{text:d.locale.t("Total",{lng:this._locale})+": "+i}]:[]).select(n).width(this._width-this._margin.left-this._margin.right).config(this._totalConfig).render();this._margin.top+=o?n.getBBox().height+this._padding:0};function P(t,i){if(t.tagName===undefined||["BODY","HTML"].indexOf(t.tagName)>=0){var e=window["inner"+(i.charAt(0).toUpperCase()+i.slice(1))];var n=r.select(t);if(i==="width"){e-=parseFloat(n.style("margin-left"),10);e-=parseFloat(n.style("margin-right"),10);e-=parseFloat(n.style("padding-left"),10);e-=parseFloat(n.style("padding-right"),10)}else{e-=parseFloat(n.style("margin-top"),10);e-=parseFloat(n.style("margin-bottom"),10);e-=parseFloat(n.style("padding-top"),10);e-=parseFloat(n.style("padding-bottom"),10)}return e}else{var o=parseFloat(r.select(t).style(i),10);if(typeof o==="number"&&o>0){return o}else{return P(t.parentNode,i)}}}var F=function(t){return[P(t,"width"),P(t,"height")]};var q=function(t,i){if(i===void 0)i=0;var e=window.pageXOffset!==undefined?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,n=window.pageYOffset!==undefined?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;var o=t.offsetHeight,s=t.offsetLeft,r=t.offsetTop,l=t.offsetWidth;if(o===void 0){var h=t.getBoundingClientRect();o=h.height;s=h.left+e;r=h.top+n;l=h.width}return n+window.innerHeight>r+i&&n+i<r+o&&e+window.innerWidth>s+i&&e+i<s+l};var D=function(t,i){this._select.style("cursor","auto");if(this._drawDepth<this._groupBy.length-1){var e=this._groupBy[this._drawDepth],n=e(t,i);this.hover(false);if(this._tooltip){this._tooltipClass.data([]).render()}this._history.push({depth:this._depth,filter:this._filter});this.config({depth:this._drawDepth+1,filter:function(t,i){return e(t,i)===n}}).render()}};var O=function(t,i){var n=this;var o=this._ids(t,i);this.hover(function(t,i){var s=n._ids(t,i);var r=e.min([s.length-1,o.length-1,n._drawDepth]);return o.slice(0,r+1).join("_")===s.slice(0,r+1).join("_")})};var j=function(t,i,e){if(e===void 0)e={};if(this._tooltip){this._select.style("cursor","pointer");this._tooltipClass.data([t]).footer(this._drawDepth<this._groupBy.length-1?d.locale.t("Click to Expand",{lng:this._locale}):this._active&&this._active(t,i)?!this._focus||this._focus===this._id(t,i)?d.locale.t("Click to Remove Highlight",{lng:this._locale}):d.locale.t("Click to Highlight",{lng:this._locale}):d.locale.t("Click to Highlight",{lng:this._locale})).title(this._drawLabel).translate(r.mouse(r.select("html").node())).config(e).config(this._tooltipConfig).render()}};var A=function(t,i){var n=this;if(this._hover&&this._drawDepth>=this._groupBy.length-1){if(this._active&&this._active(t,i)){this.active(false);O.bind(this)(t,i)}else{var o=this._ids(t,i);this.active(function(t,i){var s=n._ids(t,i);var r=e.min([s.length-1,o.length-1,n._drawDepth]);return o.slice(0,r+1).join("_")===s.slice(0,r+1).join("_")})}j.bind(this)(t,i,{title:this._legendClass.label()})}};var T=function(t,i){var n=this;if(this._hover&&this._drawDepth>=this._groupBy.length-1){if(this._active&&this._active(t,i)){this.active(false);O.bind(this)(t,i)}else{var o=this._ids(t,i);this.active(function(t,i){var s=n._ids(t,i);var r=e.min([s.length-1,o.length-1,n._drawDepth]);return o.slice(0,r+1).join("_")===s.slice(0,r+1).join("_")})}j.bind(this)(t,i)}};var L=function(){this.hover(false);this._select.style("cursor","auto");if(this._tooltip){this._tooltipClass.data([]).render()}};var N=function(t,i){j.bind(this)(t,i,{title:this._legendClass.label()})};var R=function(t,i){j.bind(this)(t,i)};var E=function(t){function i(){var i=this;t.call(this);this._aggs={};this._backClass=(new f.TextBox).on("click",function(){if(i._history.length){i.config(i._history.pop()).render()}else{i.depth(i._drawDepth-1).filter(false).render()}}).on("mousemove",function(){return i._backClass.select().style("cursor","pointer")});this._backConfig={fontSize:10,resize:false};this._cache=false;this._color=function(t,e){return i._groupBy[0](t,e)};this._colorScaleClass=new u.ColorScale;this._colorScaleConfig={};this._colorScalePosition="bottom";var e=new _.Select;this._controlCache={};this._controlConfig={selectStyle:Object.assign({margin:"5px"},e.selectStyle())};this._data=[];this._detectResize=true;this._detectVisible=true;this._downloadButton=false;this._downloadConfig={type:"png"};this._downloadPosition="top";this._duration=600;this._history=[];this._groupBy=[d.accessor("id")];this._legend=true;this._legendConfig={shapeConfig:{fontResize:false}};this._legendClass=new u.Legend;this._legendPosition="bottom";this._locale="en-US";this._lrucache=h(5);this._on={click:D.bind(this),"click.legend":A.bind(this),"click.shape":T.bind(this),mouseenter:O.bind(this),"mousemove.legend":N.bind(this),"mousemove.shape":R.bind(this),mouseleave:L.bind(this)};this._padding=5;this._queue=[];this._shapeConfig={fill:function(t,e){if(i._colorScale){var o=i._colorScale(t,e);if(o!==undefined&&o!==null){return i._colorScaleClass._colorScale(o)}}var s=i._color(t,e);if(n.color(s)){return s}return c.colorAssign(s)},opacity:d.constant(1),stroke:function(t,e){return n.color(i._shapeConfig.fill(t,e)).darker()},strokeWidth:d.constant(0)};this._timeline=true;this._timelineClass=(new g.Timeline).align("end").on("brush",function(t){if(JSON.stringify(t)!==JSON.stringify(i._timelineSelection)){i._timelineSelection=t;if(!(t instanceof Array)){t=[t,t]}t=t.map(Number);i.timeFilter(function(e){var n=a.date(i._time(e)).getTime();return n>=t[0]&&n<=t[1]}).render()}});this._timelineConfig={};this._titleClass=new f.TextBox;this._titleConfig={fontSize:12,resize:false,textAnchor:"middle"};this._tooltip=true;this._tooltipClass=new p.Tooltip;this._tooltipConfig={duration:50,pointerEvents:"none",titleStyle:{"max-width":"200px"}};this._totalClass=new f.TextBox;this._totalConfig={fontSize:10,resize:false,textAnchor:"middle"}}if(t)i.__proto__=t;i.prototype=Object.create(t&&t.prototype);i.prototype.constructor=i;i.prototype._shapeConfigPrep=function t(i){var e=this;if(i===void 0)i=false;var n={duration:this._duration};var o=function(t){if({}.hasOwnProperty.call(e._shapeConfig,t)){if(typeof e._shapeConfig[t]==="function"){n[t]=function(i,n,o){return e._shapeConfig[t](i.__d3plus__?i.data:i,i.__d3plus__?i.i:n,o)}}else{n[t]=e._shapeConfig[t]}}};for(var s in e._shapeConfig)o(s);n.on=Object.keys(this._on).filter(function(t){return!t.includes(".")||t.includes(".shape")}).reduce(function(t,i){t[i]=function(t,n){return e._on[i]?e._on[i](t.__d3plus__?t.data:t,t.__d3plus__?t.i:n):null};return t},{});if(i&&this._shapeConfig[i]){n=d.assign(n,this._shapeConfig[i])}return n};i.prototype._draw=function t(){var i=this;var n=this;this._drawDepth=this._depth!==void 0?this._depth:this._groupBy.length-1;this._id=this._groupBy[this._drawDepth];this._ids=function(t,e){return i._groupBy.map(function(i){return i(t.__d3plus__?t.data:t,t.__d3plus__?t.i:e)}).filter(function(t){return t!==void 0&&t!==null&&t.constructor!==Array})};this._drawLabel=function(t,e){if(t.__d3plus__){t=t.data;e=t.i}if(i._label){return i._label(t,e)}var o=n._ids(t,e).slice(0,n._drawDepth+1).filter(function(t){return t&&t.constructor!==Array});return o[o.length-1]};if(this._time&&this._timeFilter===void 0){var s=this._data.map(this._time).map(a.date);var r=this._data[0],l=0;if(this._discrete&&"_"+this._discrete in this&&this["_"+this._discrete](r,l)===this._time(r,l)){this._timeFilter=function(){return true}}else{var h=+e.max(s);this._timeFilter=function(t,e){return+a.date(i._time(t,e))===h}}}this._filteredData=[];var c=[];if(this._data.length){c=this._timeFilter?this._data.filter(this._timeFilter):this._data;if(this._filter){c=c.filter(this._filter)}var _=o.nest();for(var u=0;u<=this._drawDepth;u++){_.key(i._groupBy[u])}if(this._discrete&&"_"+this._discrete in this){_.key(this["_"+this._discrete])}_.rollup(function(t){return i._filteredData.push(d.merge(t,i._aggs))}).entries(c)}k.bind(this)(this._filteredData);S.bind(this)(this._filteredData);B.bind(this)(this._filteredData);x.bind(this)(this._filteredData);w.bind(this)(this._filteredData);C.bind(this)();z.bind(this)(this._filteredData);this._shapes=[]};i.prototype.render=function t(i){var e=this;this._margin={bottom:0,left:0,right:0,top:0};this._transition=l.transition().duration(this._duration);if(this._select===void 0||this._select.node().tagName.toLowerCase()!=="svg"){var n=this._select===void 0?r.select("body"):this._select;var o=F(n.node());var h=o[0];var a=o[1];var c=n.append("svg");h-=parseFloat(c.style("border-left-width"),10);h-=parseFloat(c.style("border-right-width"),10);a-=parseFloat(c.style("border-top-width"),10);a-=parseFloat(c.style("border-bottom-width"),10);if(!this._width){this._autoWidth=true;this.width(h)}if(!this._height){this._autoHeight=true;this.height(a)}c.style("width",this._width+"px").style("height",this._height+"px");this.select(c.node())}if(!this._width||!this._height){var d=F(this._select.node());var _=d[0];var u=d[1];if(!this._width){this.width(_)}if(!this._height){this.height(u)}}this._select.transition(this._transition).style("width",this._width+"px").style("height",this._height+"px");clearInterval(this._visiblePoll);clearTimeout(this._resizePoll);r.select(window).on("scroll."+this._uuid,null);r.select(window).on("resize."+this._uuid,null);if(this._detectVisible&&this._select.style("visibility")==="hidden"){this._visiblePoll=setInterval(function(){if(e._select.style("visibility")!=="hidden"){clearInterval(e._visiblePoll);e.render(i)}},1e3)}else if(this._detectVisible&&this._select.style("display")==="none"){this._visiblePoll=setInterval(function(){if(e._select.style("display")!=="none"){clearInterval(e._visiblePoll);e.render(i)}},1e3)}else if(this._detectVisible&&!q(this._select.node())){r.select(window).on("scroll."+this._uuid,function(){if(q(e._select.node())){r.select(window).on("scroll."+e._uuid,null);e.render(i)}})}else{var f=s.queue();this._queue.forEach(function(t){var i=e._cache?e._lrucache.get(t[1]):undefined;if(!i){f.defer.apply(f,t)}});this._queue=[];f.awaitAll(function(){e._draw(i);if(e._detectResize&&(e._autoWidth||e._autoHeight)){r.select(window).on("resize."+e._uuid,function(){clearTimeout(e._resizePoll);e._resizePoll=setTimeout(function(){clearTimeout(e._resizePoll);var t=e._select.style("display");e._select.style("display","none");var n=F(e._select.node().parentNode);var o=n[0];var s=n[1];o-=parseFloat(e._select.style("border-left-width"),10);o-=parseFloat(e._select.style("border-right-width"),10);s-=parseFloat(e._select.style("border-top-width"),10);s-=parseFloat(e._select.style("border-bottom-width"),10);e._select.style("display",t);if(e._autoWidth){e.width(o)}if(e._autoHeight){e.height(s)}e.render(i)},200)})}if(i){setTimeout(i,e._duration+100)}})}return this};i.prototype.active=function t(i){this._active=i;this._shapes.forEach(function(t){return t.active(i)});if(this._legend){this._legendClass.active(i)}return this};i.prototype.aggs=function t(i){return arguments.length?(this._aggs=d.assign(this._aggs,i),this):this._aggs};i.prototype.backConfig=function t(i){return arguments.length?(this._backConfig=d.assign(this._backConfig,i),this):this._backConfig};i.prototype.cache=function t(i){return arguments.length?(this._cache=i,this):this._cache};i.prototype.color=function t(i){return arguments.length?(this._color=typeof i==="function"?i:d.accessor(i),this):this._color};i.prototype.colorScale=function t(i){return arguments.length?(this._colorScale=typeof i==="function"?i:d.accessor(i),this):this._colorScale};i.prototype.colorScaleConfig=function t(i){return arguments.length?(this._colorScaleConfig=d.assign(this._colorScaleConfig,i),this):this._colorScaleConfig};i.prototype.colorScalePosition=function t(i){return arguments.length?(this._colorScalePosition=i,this):this._colorScalePosition};i.prototype.controls=function t(i){return arguments.length?(this._controls=i,this):this._controls};i.prototype.controlConfig=function t(i){return arguments.length?(this._controlConfig=d.assign(this._controlConfig,i),this):this._controlConfig};i.prototype.data=function t(i,e){return arguments.length?(this._queue.push([y.bind(this),i,e,"data"]),this):this._data};i.prototype.depth=function t(i){return arguments.length?(this._depth=i,this):this._depth};i.prototype.detectResize=function t(i){return arguments.length?(this._detectResize=i,this):this._detectResize};i.prototype.detectVisible=function t(i){return arguments.length?(this._detectVisible=i,this):this._detectVisible};i.prototype.discrete=function t(i){return arguments.length?(this._discrete=i,this):this._discrete};i.prototype.downloadButton=function t(i){return arguments.length?(this._downloadButton=i,this):this._downloadButton};i.prototype.downloadConfig=function t(i){return arguments.length?(this._downloadConfig=i,this):this._downloadConfig};i.prototype.downloadPosition=function t(i){return arguments.length?(this._downloadPosition=i,this):this._downloadPosition};i.prototype.duration=function t(i){return arguments.length?(this._duration=i,this):this._duration};i.prototype.filter=function t(i){return arguments.length?(this._filter=i,this):this._filter};i.prototype.groupBy=function t(i){var e=this;if(!arguments.length){return this._groupBy}if(!(i instanceof Array)){i=[i]}return this._groupBy=i.map(function(t){if(typeof t==="function"){return t}else{if(!e._aggs[t]){e._aggs[t]=function(t){var i=Array.from(new Set(t));return i.length===1?i[0]:i}}return d.accessor(t)}}),this};i.prototype.height=function t(i){return arguments.length?(this._height=i,this):this._height};i.prototype.hover=function t(i){var n=this;var o=this._hover=i;if(typeof i==="function"){var s=e.merge(this._shapes.map(function(t){return t.data()}));s=s.concat(this._legendClass.data());var r=i?s.filter(i):[];var l=[];r.map(this._ids).forEach(function(t){for(var i=1;i<=t.length;i++){l.push(JSON.stringify(t.slice(0,i)))}});l=l.filter(function(t,i){return l.indexOf(t)===i});if(l.length){o=function(t,i){return l.includes(JSON.stringify(n._ids(t,i)))}}}this._shapes.forEach(function(t){return t.hover(o)});if(this._legend){this._legendClass.hover(o)}return this};i.prototype.label=function t(i){return arguments.length?(this._label=typeof i==="function"?i:d.constant(i),this):this._label};i.prototype.legend=function t(i){return arguments.length?(this._legend=i,this):this._legend};i.prototype.legendConfig=function t(i){return arguments.length?(this._legendConfig=i,this):this._legendConfig};i.prototype.legendPosition=function t(i){return arguments.length?(this._legendPosition=i,this):this._legendPosition};i.prototype.locale=function t(i){return arguments.length?(this._locale=i,this):this._locale};i.prototype.select=function t(i){return arguments.length?(this._select=r.select(i),this):this._select};i.prototype.shape=function t(i){return arguments.length?(this._shape=typeof i==="function"?i:d.constant(i),this):this._shape};i.prototype.shapeConfig=function t(i){return arguments.length?(this._shapeConfig=d.assign(this._shapeConfig,i),this):this._shapeConfig};i.prototype.time=function t(i){if(arguments.length){if(typeof i==="function"){this._time=i}else{this._time=d.accessor(i);if(!this._aggs[i]){this._aggs[i]=function(t){var i=Array.from(new Set(t));return i.length===1?i[0]:i}}}return this}else{return this._time}};i.prototype.timeFilter=function t(i){return arguments.length?(this._timeFilter=i,this):this._timeFilter};i.prototype.timeline=function t(i){return arguments.length?(this._timeline=i,this):this._timeline};i.prototype.timelineConfig=function t(i){return arguments.length?(this._timelineConfig=d.assign(this._timelineConfig,i),this):this._timelineConfig};i.prototype.title=function t(i){return arguments.length?(this._title=typeof i==="function"?i:d.constant(i),this):this._title};i.prototype.titleConfig=function t(i){return arguments.length?(this._titleConfig=d.assign(this._titleConfig,i),this):this._titleConfig};i.prototype.tooltip=function t(i){return arguments.length?(this._tooltip=i,this):this._tooltip};i.prototype.tooltipConfig=function t(i){return arguments.length?(this._tooltipConfig=d.assign(this._tooltipConfig,i),this):this._tooltipConfig};i.prototype.total=function t(i){return arguments.length?(this._total=typeof i==="function"?i:d.accessor(i),this):this._total};i.prototype.totalConfig=function t(i){return arguments.length?(this._totalConfig=d.assign(this._totalConfig,i),this):this._totalConfig};i.prototype.width=function t(i){return arguments.length?(this._width=i,this):this._width};return i}(d.BaseClass);t.dataFold=m;t.dataLoad=y;t.Viz=E;Object.defineProperty(t,"__esModule",{value:true})});