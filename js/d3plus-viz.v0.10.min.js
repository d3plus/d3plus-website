/*
  d3plus-viz v0.10.16
  Abstract ES6 class that drives d3plus visualizations.
  Copyright (c) 2018 D3plus - https://d3plus.org
  @license MIT
*/
if(typeof Object.assign!=="function"){Object.defineProperty(Object,"assign",{value:function t(e){"use strict";if(e===null){throw new TypeError("Cannot convert undefined or null to object")}var i=Object(e);for(var o=1;o<arguments.length;o++){var n=arguments[o];if(n!==null){for(var s in n){if(Object.prototype.hasOwnProperty.call(n,s)){i[s]=n[s]}}}}return i},writable:true,configurable:true})}if(!Array.prototype.includes){Object.defineProperty(Array.prototype,"includes",{value:function t(e,i){var o=Object(this);var n=o.length>>>0;if(n===0)return false;var s=i|0;var r=Math.max(s>=0?s:n-Math.abs(s),0);function l(t,e){return t===e||typeof t==="number"&&typeof e==="number"&&isNaN(t)&&isNaN(e)}while(r<n){if(l(o[r],e)){return true}r++}return false}})}(function(t,e){typeof exports==="object"&&typeof module!=="undefined"?e(exports,require("d3-request"),require("d3-selection"),require("d3plus-common"),require("d3plus-export"),require("d3plus-form"),require("d3-collection"),require("d3-array"),require("d3plus-axis"),require("d3-zoom"),require("d3-brush"),require("d3-color"),require("d3-queue"),require("d3-transition"),require("lrucache"),require("d3plus-color"),require("d3plus-legend"),require("d3plus-text"),require("d3plus-timeline"),require("d3plus-tooltip")):typeof define==="function"&&define.amd?define("d3plus-viz",["exports","d3-request","d3-selection","d3plus-common","d3plus-export","d3plus-form","d3-collection","d3-array","d3plus-axis","d3-zoom","d3-brush","d3-color","d3-queue","d3-transition","lrucache","d3plus-color","d3plus-legend","d3plus-text","d3plus-timeline","d3plus-tooltip"],e):e(t.d3plus={},t.d3Request,t.d3Selection,t.d3plusCommon,t.d3plusExport,t.d3plusForm,t.d3Collection,t.d3Array,t.d3plusAxis,t.d3Zoom,t.d3Brush,t.d3Color,t.d3Queue,t.d3Transition,t.lrucache,t.d3plusColor,t.d3plusLegend,t.d3plusText,t.d3plusTimeline,t.d3plusTooltip)})(this,function(t,e,i,o,n,s,r,l,a,h,c,d,u,_,f,p,g,m,y,v){"use strict";f=f&&f.hasOwnProperty("default")?f["default"]:f;function b(t,e,i){if(e===void 0)e="data";if(i===void 0)i="headers";return t[e].map(function(e){return t[i].reduce(function(t,i,o){return t[i]=e[o],t},{})})}function z(t,i,o,n){var s=this;if(typeof t!=="string"){var r=i?i(t):t;if(o&&"_"+o in this){this["_"+o]=r}if(n){n(null,r)}}else{var l=t.slice(t.length-4)===".csv"?e.csv:t.slice(t.length-4)===".tsv"?e.tsv:t.slice(t.length-4)===".txt"?e.text:e.json;l(t,function(r,a){if(l!==e.json&&!r&&a&&a instanceof Array){a.forEach(function(t){for(var e in t){if(!isNaN(t[e])){t[e]=parseFloat(t[e])}else if(t[e].toLowerCase()==="false"){t[e]=false}else if(t[e].toLowerCase()==="true"){t[e]=true}else if(t[e].toLowerCase()==="null"){t[e]=null}else if(t[e].toLowerCase()==="undefined"){t[e]=undefined}}})}a=r?[]:i?i(a):a;if(a&&!(a instanceof Array)&&a.data&&a.headers){a=b(a)}if(o&&"_"+o in s){s["_"+o]=a}if(s._cache){s._lrucache.set(t,a)}if(n){n(r,a)}})}}var C=function t(){};C.prototype.exit=function t(e,i){e.transition().duration(i).style("opacity",0).transition().remove()};C.prototype.hide=function t(e){if(e===void 0)e={};var i=e.duration;if(i===void 0)i=600;var o=e.callback;this.mask.call(this.exit,i);this.elem.call(this.exit,i);if(o){setTimeout(o,i+100)}return this};C.prototype.render=function t(e){if(e===void 0)e={};var n=e.callback;var s=e.container;if(s===void 0)s="body";var r=e.duration;if(r===void 0)r=600;var l=e.html;if(l===void 0)l="Please Wait";var a=e.mask;if(a===void 0)a="rgba(0, 0, 0, 0.1)";var h=e.style;if(h===void 0)h={};var c=i.select(s).style("position","relative");this.mask=c.selectAll("div.d3plus-Mask").data(a?[a]:[]);this.mask=this.mask.enter().append("div").attr("class","d3plus-Mask").style("opacity",1).merge(this.mask);this.mask.exit().call(this.exit,r);o.stylize(this.mask,{"background-color":String,bottom:"0px",left:"0px",position:"absolute",right:"0px",top:"0px"});this.elem=c.selectAll("div.d3plus-Message").data([l]);this.elem=this.elem.enter().append("div").attr("class","d3plus-Message").style("opacity",1).merge(this.elem).html(String);o.stylize(this.elem,h);if(n){setTimeout(n,100)}return this};function w(){var t=this._history.length;var e=o.elem("g.d3plus-viz-back",{parent:this._select,transition:this._transition,update:{transform:"translate("+this._margin.left+", "+this._margin.top+")"}}).node();this._backClass.data(t?[{text:"Back",x:this._padding*2,y:0}]:[]).select(e).config(this._backConfig).render();this._margin.top+=t?this._backClass.fontSize()()+this._padding:0}function S(t){var e=this;if(t===void 0)t=[];var i={opacity:this._colorScalePosition?1:0,transform:"translate("+this._margin.left+", "+this._margin.top+")"};var n=this._colorScale&&t&&t.length>1;var s=o.elem("g.d3plus-viz-colorScale",{condition:n&&!this._colorScaleConfig.select,enter:i,parent:this._select,transition:this._transition,update:i}).node();if(this._colorScale&&t){var r=t.filter(function(t,i){var o=e._colorScale(t,i);return o!==undefined&&o!==null});var l=this._colorScalePosition||"bottom";var a=["top","bottom"].includes(l);this._colorScaleClass.align({bottom:"end",left:"start",right:"end",top:"start"}[l]).duration(this._duration).data(r).height(this._height-this._margin.bottom-this._margin.top).orient(l).select(s).value(this._colorScale).width(this._width-this._margin.left-this._margin.right).config(this._colorScaleConfig).render();if(n){var h=this._colorScaleClass.outerBounds();if(this._colorScalePosition&&!this._colorScaleConfig.select&&h.height){if(a){this._margin[l]+=h.height+this._legendClass.padding()*2}else{this._margin[l]+=h.width+this._legendClass.padding()*2}}}}}var x={Button:s.Button,Radio:s.Radio,Select:s.Select};function k(){var t=this;var e=this;var i=["left","right","top","bottom"];var s=function(s){var r=i[s];var l=(t._controls||[]).filter(function(t){return!t.position&&r==="bottom"||t.position===r});if(t._downloadButton&&t._downloadPosition===r){l.push({data:[{text:"Download",value:1}],label:"downloadButton",on:{click:function(){var e=t._detectResize;if(e){t.detectResize(false).render()}n.saveElement(t._select.node(),Object.assign({title:t._title||undefined},t._downloadConfig),{callback:function(){setTimeout(function(){if(e){t.detectResize(e).render()}},5e3)}})}},type:"Button"})}var a={height:t._height-t._margin.top-t._margin.bottom,width:t._width-t._margin.left-t._margin.right};a.x=t._margin.left+(r==="right"?a.width:0);a.y=t._margin.top+(r==="bottom"?a.height:0);var h=o.elem("foreignObject.d3plus-viz-controls-"+r,{condition:l.length,enter:Object.assign({opacity:0},a),exit:Object.assign({opacity:0},a),parent:t._select,transition:t._transition,update:{height:a.height,opacity:1,width:a.width}});var c=h.selectAll("div.d3plus-viz-controls-container").data([null]);c=c.enter().append("xhtml:div").attr("class","d3plus-viz-controls-container").merge(c);if(l.length){var d=function(i){var o=Object.assign({},l[i]);var n={};if(o.on){var s=function(t){if({}.hasOwnProperty.call(o.on,t)){n[t]=function(){o.on[t].bind(e)(this.value)}}};for(var a in o.on)s(a)}var h=o.label||r+"-"+i;if(!t._controlCache[h]){var d=o.type&&x[o.type]?o.type:"Select";t._controlCache[h]=(new x[d]).container(c.node());if(o.checked){t._controlCache[h].checked(o.checked)}if(o.selected){t._controlCache[h].selected(o.selected)}}delete o.checked;delete o.selected;t._controlCache[h].config(o).config({on:n}).config(t._controlConfig).render()};for(var u=0;u<l.length;u++)d(u);c.style("display",["top","bottom"].includes(r)?"block":"inline-block").style("text-align",["top","bottom"].includes(r)?"center":r);var _=c.node().getBoundingClientRect();h.transition(t._transition).attr("x",a.x-(r==="right"?_.width:0)).attr("y",a.y-(r==="bottom"?_.height:0));t._margin[r]+=["top","bottom"].includes(r)?_.height:_.width}};for(var r=0;r<i.length;r++)s(r)}function B(t,e){var i=this._drawLabel(t,e);return i instanceof Array?i.join(", "):i}function P(t){var e=this;if(t===void 0)t=[];var i={transform:"translate("+this._margin.left+", "+this._margin.top+")"};var n=o.elem("g.d3plus-viz-legend",{condition:this._legend&&!this._legendConfig.select,enter:i,parent:this._select,transition:this._transition,update:i}).node();if(this._legend){var s=this._legendPosition;var l=["top","bottom"].includes(s);var a=[];var h=function(t,i){var o=e._shape(t,i);var n=o==="Line"?"stroke":"fill";var s=e._shapeConfig[o]&&e._shapeConfig[o][n]?e._shapeConfig[o][n]:e._shapeConfig[n];return typeof s==="function"?s(t,i):s};var c=function(t,i){var o=e._shape(t,i);var n=e._shapeConfig[o]&&e._shapeConfig[o].opacity?e._shapeConfig[o].opacity:e._shapeConfig.opacity;return typeof n==="function"?n(t,i):n};var d=function(t,e){return h(t,e)+"_"+c(t,e)};r.nest().key(d).rollup(function(t){return a.push(o.merge(t,e._aggs))}).entries(this._colorScale?t.filter(function(t,i){return e._colorScale(t,i)===undefined}):t);this._legendClass.id(d).align(l?"center":s).direction(l?"row":"column").duration(this._duration).data(a.length>1||this._colorScale?a:[]).height(this._height-this._margin.bottom-this._margin.top).select(n).verticalAlign(!l?"middle":s).width(this._width-this._margin.left-this._margin.right).shapeConfig(o.configPrep.bind(this)(this._shapeConfig,"legend")).config(this._legendConfig).shapeConfig({fill:h,opacity:c}).render();var u=this._legendClass.outerBounds();if(!this._legendConfig.select&&u.height){if(l){this._margin[s]+=u.height+this._legendClass.padding()*2}else{this._margin[s]+=u.width+this._legendClass.padding()*2}}}}function T(t){var e=this;if(JSON.stringify(t)!==JSON.stringify(this._timelineSelection)){this._timelineSelection=t;if(!(t instanceof Array)){t=[t,t]}t=t.map(Number);this.timeFilter(function(i){var o=a.date(e._time(i)).getTime();return o>=t[0]&&o<=t[1]}).render()}}function A(t){var e=this;if(t===void 0)t=[];var i=this._time&&this._timeline;var n=i?Array.from(new Set(this._data.map(this._time))).map(a.date):[];i=i&&n.length>1;var s=o.elem("g.d3plus-viz-timeline",{condition:i,parent:this._select,transition:this._transition}).node();if(i){var r=this._timelineClass.domain(l.extent(n)).duration(this._duration).height(this._height-this._margin.bottom).select(s).ticks(n.sort(function(t,e){return+t-+e})).width(this._width);if(this._timelineSelection===void 0){var h=l.extent(t.map(this._time).map(a.date));this._timelineSelection=h[0]===h[1]?h[0]:h;r.selection(this._timelineSelection)}var c=this._timelineConfig;r.config(c).on("brush",function(t){T.bind(e)(t);if(c.on&&c.on.brush){c.on.brush(t)}}).on("end",function(t){T.bind(e)(t);if(c.on&&c.on.end){c.on.end(t)}}).render();this._margin.bottom+=r.outerBounds().height+r.padding()*2}}function F(t){if(t===void 0)t=[];var e=this._title?this._title(t):false;var i=o.elem("g.d3plus-viz-title",{enter:{transform:"translate("+this._margin.left+", "+this._margin.top+")"},parent:this._select,transition:this._transition,update:{transform:"translate("+this._margin.left+", "+this._margin.top+")"}}).node();this._titleClass.data(e?[{text:e}]:[]).select(i).width(this._width-this._margin.left-this._margin.right).config(this._titleConfig).render();this._margin.top+=e?i.getBBox().height+this._padding:0}function O(t){if(t===void 0)t=[];var e=typeof this._total==="function"?l.sum(t.map(this._total)):this._total===true&&this._size?l.sum(t.map(this._size)):false;var i=o.elem("g.d3plus-viz-total",{enter:{transform:"translate("+this._margin.left+", "+this._margin.top+")"},parent:this._select,transition:this._transition,update:{transform:"translate("+this._margin.left+", "+this._margin.top+")"}}).node();var n=typeof e==="number";this._totalClass.data(n?[{text:"Total: "+e}]:[]).select(i).width(this._width-this._margin.left-this._margin.right).config(this._totalConfig).render();this._margin.top+=n?i.getBBox().height+this._padding:0}function H(t,e){if(!t){return undefined}if(t.tagName===undefined||["BODY","HTML"].indexOf(t.tagName)>=0){var o=window["inner"+(e.charAt(0).toUpperCase()+e.slice(1))];var n=i.select(t);if(e==="width"){o-=parseFloat(n.style("margin-left"),10);o-=parseFloat(n.style("margin-right"),10);o-=parseFloat(n.style("padding-left"),10);o-=parseFloat(n.style("padding-right"),10)}else{o-=parseFloat(n.style("margin-top"),10);o-=parseFloat(n.style("margin-bottom"),10);o-=parseFloat(n.style("padding-top"),10);o-=parseFloat(n.style("padding-bottom"),10)}return o}else{var s=parseFloat(i.select(t).style(e),10);if(typeof s==="number"&&s>0){return s}else{return H(t.parentNode,e)}}}function q(t){return[H(t,"width"),H(t,"height")]}function D(t,e){if(e===void 0)e=0;var i=window.pageXOffset!==undefined?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,o=window.pageYOffset!==undefined?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;var n=t.getBoundingClientRect();var s=n.height,r=n.left+i,l=n.top+o,a=n.width;return o+window.innerHeight>l+e&&o+e<l+s&&i+window.innerWidth>r+e&&i+e<r+a}function M(t,e){this._select.style("cursor","auto");if(this._drawDepth<this._groupBy.length-1){var i=this._groupBy[this._drawDepth],o=i(t,e);this.hover(false);if(this._tooltip){this._tooltipClass.data([]).render()}this._history.push({depth:this._depth,filter:this._filter});this.config({depth:this._drawDepth+1,filter:function(t,e){return i(t,e)===o}}).render()}}function j(t,e){var i=this;var o=this._ids(t,e);this.hover(function(t,e){var n=i._ids(t,e);var s=l.min([n.length-1,o.length-1,i._drawDepth]);return o.slice(0,s+1).join("_")===n.slice(0,s+1).join("_")})}function N(){this.hover(false);this._select.style("cursor","auto");if(this._tooltip){this._tooltipClass.data([]).render()}}function R(t){if(this._tooltip&&t){this._select.style("cursor","pointer");this._tooltipClass.data([t]).footer(this._drawDepth<this._groupBy.length-1?"Click to Expand":"").title(this._legendConfig.label?this._legendClass.label():B.bind(this)).translate(i.mouse(i.select("html").node())).config(this._tooltipConfig).config(this._legendTooltip).render()}}function L(t){if(this._tooltip&&t){this._select.style("cursor","pointer");this._tooltipClass.data([t]).footer(this._drawDepth<this._groupBy.length-1?"Click to Expand":"").title(this._drawLabel).translate(i.mouse(i.select("html").node())).config(this._tooltipConfig).render()}}var E=false;function V(){if(!this._container||!this._zoomGroup){return}var t=this._zoomHeight||this._height-this._margin.top-this._margin.bottom,e=this,n=this._zoomWidth||this._width-this._margin.left-this._margin.right;this._zoomBehavior.extent([[0,0],[n,t]]).scaleExtent([1,this._zoomMax]).translateExtent([[0,0],[n,t]]).on("zoom",G.bind(this));this._zoomToBounds=J.bind(this);var s=i.select(this._select.node().parentNode).selectAll("div.d3plus-geomap-control").data(this._zoom?[0]:[]);var r=s.enter().append("div").attr("class","d3plus-geomap-control");s.exit().remove();s=s.merge(r).style("position","absolute").style("top",this._margin.top+"px").style("left",this._margin.left+"px");r.append("div").attr("class","zoom-control zoom-in");s.select(".zoom-in").on("click",W.bind(this,this._zoomFactor)).html("&#65291;");r.append("div").attr("class","zoom-control zoom-out");s.select(".zoom-out").on("click",W.bind(this,1/this._zoomFactor)).html("&#65293;");r.append("div").attr("class","zoom-control zoom-reset");s.select(".zoom-reset").on("click",W.bind(this,0)).html("&#8634");r.append("div").attr("class","zoom-control zoom-brush");s.select(".zoom-brush").on("click",function(){i.select(this).classed("active",!E).call(o.stylize,E?e._zoomControlStyle||{}:e._zoomControlStyleActive||{});I.bind(e)(!E)}).html("&#10696");s.selectAll(".zoom-control").call(o.stylize,e._zoomControlStyle).on("mouseenter",function(){i.select(this).call(o.stylize,e._zoomControlStyleHover||{})}).on("mouseleave",function(){i.select(this).call(o.stylize,i.select(this).classed("active")?e._zoomControlStyleActive||{}:e._zoomControlStyle||{})});this._zoomBrush.extent([[0,0],[n,t]]).filter(function(){return!i.event.button&&i.event.detail<2}).handleSize(this._zoomBrushHandleSize).on("start",X.bind(this)).on("brush",Y.bind(this)).on("end",U.bind(this));var l=this._container.selectAll("g.brush").data([0]);this._brushGroup=l.enter().append("g").attr("class","brush").merge(l).call(this._zoomBrush);I.bind(this)();if(this._renderTiles){this._renderTiles(h.zoomTransform(this._container.node()),0)}}function I(t){if(t===void 0)t=false;E=t;if(E){this._brushGroup.style("display","inline")}else{this._brushGroup.style("display","none")}if(!E&&this._zoom){this._container.call(this._zoomBehavior);if(!this._zoomScroll){this._container.on("wheel.zoom",null)}if(!this._zoomPan){this._container.on("mousedown.zoom mousemove.zoom",null).on("touchstart.zoom touchmove.zoom touchend.zoom touchcancel.zoom",null)}}else{this._container.on(".zoom",null)}}function G(t,e){if(t===void 0)t=false;if(e===void 0)e=0;if(this._zoomGroup){if(!e){this._zoomGroup.attr("transform",t||i.event.transform)}else{this._zoomGroup.transition().duration(e).attr("transform",t||i.event.transform)}}if(this._renderTiles){this._renderTiles(h.zoomTransform(this._container.node()),e)}}function W(t){if(t===void 0)t=0;if(!this._container){return}var e=this._zoomBehavior.extent().bind(document)()[1].map(function(t){return t/2}),i=this._zoomBehavior.scaleExtent(),o=h.zoomTransform(this._container.node());if(!t){o.k=i[0];o.x=0;o.y=0}else{var n=[(e[0]-o.x)/o.k,(e[1]-o.y)/o.k];o.k=Math.min(i[1],o.k*t);if(o.k<=i[0]){o.k=i[0];o.x=0;o.y=0}else{o.x+=e[0]-(n[0]*o.k+o.x);o.y+=e[1]-(n[1]*o.k+o.y)}}G.bind(this)(o,this._duration)}function J(t,e){if(e===void 0)e=this._duration;var i=this._zoomBehavior.scaleExtent(),o=h.zoomTransform(this._container.node());if(t){var n=this._zoomBehavior.translateExtent()[1];var s=n[0];var r=n[1];var l=t[1][0]-t[0][0],a=t[1][1]-t[0][1];var c=Math.min(i[1],1/Math.max(l/s,a/r));var d,u;if(l/a<s/r){c*=(r-this._zoomPadding*2)/r;d=(s-l*c)/2/c;u=this._zoomPadding/c}else{c*=(s-this._zoomPadding*2)/s;u=(r-a*c)/2/c;d=this._zoomPadding/c}o.x=(o.x-t[0][0]+d)*(o.k*c/o.k);o.y=(o.y-t[0][1]+u)*(o.k*c/o.k);o.k*=c;if(o.x>0){o.x=0}else if(o.x<s*-o.k+s){o.x=s*-o.k+s}if(o.y>0){o.y=0}else if(o.y<r*-o.k+r){o.y=r*-o.k+r}}else{o.k=i[0];o.x=0;o.y=0}G.bind(this)(o,e)}function Y(){Q.bind(this)()}function U(){if(!i.event.selection){return}this._brushGroup.call(this._zoomBrush.move,null);J.bind(this)(i.event.selection)}function X(){Q.bind(this)()}function Q(){this._brushGroup.selectAll(".selection").call(o.attrize,this._zoomBrushSelectionStyle||{});this._brushGroup.selectAll(".handle").call(o.attrize,this._zoomBrushHandleStyle||{})}var Z=function(t){function e(){var e=this;t.call(this);this._aggs={};this._backClass=(new m.TextBox).on("click",function(){if(e._history.length){e.config(e._history.pop()).render()}else{e.depth(e._drawDepth-1).filter(false).render()}}).on("mousemove",function(){return e._backClass.select().style("cursor","pointer")});this._backConfig={fontSize:10,resize:false};this._cache=true;this._color=function(t,i){return e._groupBy[0](t,i)};this._colorScaleClass=new g.ColorScale;this._colorScaleConfig={};this._colorScalePosition="bottom";var i=new s.Select;this._controlCache={};this._controlConfig={selectStyle:Object.assign({margin:"5px"},i.selectStyle())};this._data=[];this._detectResize=true;this._detectResizeDelay=400;this._detectVisible=true;this._detectVisibleInterval=1e3;this._downloadButton=false;this._downloadConfig={type:"png"};this._downloadPosition="top";this._duration=600;this._history=[];this._groupBy=[o.accessor("id")];this._legend=true;this._legendConfig={label:B.bind(this),shapeConfig:{labelConfig:{fontColor:undefined,fontResize:false}}};this._legendTooltip={};this._legendClass=new g.Legend;this._legendPosition="bottom";this._locale="en-US";this._lrucache=f(10);this._message=true;this._messageClass=new C;this._messageHTML=o.constant('\n    <div style="font-family: \'Roboto\', \'Helvetica Neue\', Helvetica, Arial, sans-serif;">\n      <strong>Loading Visualization</strong>\n      <sub style="display: block; margin-top: 5px;"><a href="https://d3plus.org" target="_blank">Powered by D3plus</a></sub>\n    </div>');this._messageMask="rgba(0, 0, 0, 0.1)";this._messageStyle={left:"0px",position:"absolute","text-align":"center",top:"45%",width:"100%"};this._on={click:M.bind(this),mouseenter:j.bind(this),mouseleave:N.bind(this),"mousemove.shape":L.bind(this),"mousemove.legend":R.bind(this)};this._padding=5;this._queue=[];this._shape=o.constant("Rect");this._shapes=[];this._shapeConfig={fill:function(t,i){while(t.__d3plus__&&t.data){t=t.data;i=t.i}if(e._colorScale){var o=e._colorScale(t,i);if(o!==undefined&&o!==null){var n=e._colorScaleClass._colorScale;if(!n.domain().length){return n.range()[n.range().length-1]}return n(o)}}var s=e._color(t,i);if(d.color(s)){return s}return p.colorAssign(s)},labelConfig:{fontColor:function(t,i){var o=typeof e._shapeConfig.fill==="function"?e._shapeConfig.fill(t,i):e._shapeConfig.fill;return p.colorContrast(o)}},opacity:o.constant(1),stroke:function(t,i){var o=typeof e._shapeConfig.fill==="function"?e._shapeConfig.fill(t,i):e._shapeConfig.fill;return d.color(o).darker()},strokeWidth:o.constant(0)};this._timeline=true;this._timelineClass=(new y.Timeline).align("end");this._timelineConfig={};this._titleClass=new m.TextBox;this._titleConfig={fontSize:12,resize:false,textAnchor:"middle"};this._tooltip=true;this._tooltipClass=new v.Tooltip;this._tooltipConfig={duration:50,pointerEvents:"none",titleStyle:{"max-width":"200px"}};this._totalClass=new m.TextBox;this._totalConfig={fontSize:10,resize:false,textAnchor:"middle"};this._zoom=false;this._zoomBehavior=h.zoom();this._zoomBrush=c.brush();this._zoomBrushHandleSize=1;this._zoomBrushHandleStyle={fill:"#444"};this._zoomBrushSelectionStyle={fill:"#777","stroke-width":0};this._zoomControlStyle={background:"rgba(255, 255, 255, 0.75)",border:"1px solid rgba(0, 0, 0, 0.75)",color:"rgba(0, 0, 0, 0.75)",display:"block",font:"900 15px/21px 'Roboto', 'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",height:"20px",margin:"5px",opacity:.75,padding:0,"text-align":"center",width:"20px"};this._zoomControlStyleActive={background:"rgba(0, 0, 0, 0.75)",color:"rgba(255, 255, 255, 0.75)",opacity:1};this._zoomControlStyleHover={cursor:"pointer",opacity:1};this._zoomFactor=2;this._zoomMax=16;this._zoomPadding=20;this._zoomPan=true;this._zoomScroll=true}if(t)e.__proto__=t;e.prototype=Object.create(t&&t.prototype);e.prototype.constructor=e;e.prototype._draw=function t(){var e=this;var i=this;this._drawDepth=this._depth!==void 0?this._depth:this._groupBy.length-1;this._id=this._groupBy[this._drawDepth];this._ids=function(t,i){return e._groupBy.map(function(e){return!t||t.__d3plus__&&!t.data?undefined:e(t.__d3plus__?t.data:t,t.__d3plus__?t.i:i)}).filter(function(t){return t!==undefined&&t!==null&&t.constructor!==Array})};this._drawLabel=function(t,o){if(!t){return""}while(t.__d3plus__&&t.data){t=t.data;o=t.i}if(e._label){return e._label(t,o)}var n=i._ids(t,o).slice(0,e._drawDepth+1);return n[n.length-1]};if(this._time&&this._timeFilter===void 0&&this._data.length){var n=this._data.map(this._time).map(a.date);var s=this._data[0],h=0;if(this._discrete&&"_"+this._discrete in this&&this["_"+this._discrete](s,h)===this._time(s,h)){this._timeFilter=function(){return true}}else{var c=+l.max(n);this._timeFilter=function(t,i){return+a.date(e._time(t,i))===c}}}this._filteredData=[];var d=[];if(this._data.length){d=this._timeFilter?this._data.filter(this._timeFilter):this._data;if(this._filter){d=d.filter(this._filter)}var u=r.nest();for(var _=0;_<=this._drawDepth;_++){u.key(e._groupBy[_])}if(this._discrete&&"_"+this._discrete in this){u.key(this["_"+this._discrete])}u.rollup(function(t){return e._filteredData.push(o.merge(t,e._aggs))}).entries(d)}F.bind(this)(this._filteredData);k.bind(this)(this._filteredData);A.bind(this)(this._filteredData);P.bind(this)(this._filteredData);S.bind(this)(this._filteredData);w.bind(this)();O.bind(this)(this._filteredData);this._shapes=[]};e.prototype.render=function t(e){var o=this;this._margin={bottom:0,left:0,right:0,top:0};this._transition=_.transition().duration(this._duration);if(this._select===void 0||this._select.node().tagName.toLowerCase()!=="svg"){var n=this._select===void 0?i.select("body"):this._select;var s=q(n.node());var r=s[0];var l=s[1];var a=n.append("svg");r-=parseFloat(a.style("border-left-width"),10);r-=parseFloat(a.style("border-right-width"),10);l-=parseFloat(a.style("border-top-width"),10);l-=parseFloat(a.style("border-bottom-width"),10);if(!this._width){this._autoWidth=true;this.width(r)}if(!this._height){this._autoHeight=true;this.height(l)}a.style("width",this._width+"px").style("height",this._height+"px");this.select(a.node())}if(!this._width||!this._height){var h=q(this._select.node());var c=h[0];var d=h[1];if(!this._width){this.width(c)}if(!this._height){this.height(d)}}this._select.transition(this._transition).style("width",this._width+"px").style("height",this._height+"px");clearInterval(this._visiblePoll);clearTimeout(this._resizePoll);i.select(window).on("scroll."+this._uuid,null);i.select(window).on("resize."+this._uuid,null);if(this._detectVisible&&this._select.style("visibility")==="hidden"){this._visiblePoll=setInterval(function(){if(o._select.style("visibility")!=="hidden"){clearInterval(o._visiblePoll);o.render(e)}},this._detectVisibleInterval)}else if(this._detectVisible&&this._select.style("display")==="none"){this._visiblePoll=setInterval(function(){if(o._select.style("display")!=="none"){clearInterval(o._visiblePoll);o.render(e)}},this._detectVisibleInterval)}else if(this._detectVisible&&!D(this._select.node())){i.select(window).on("scroll."+this._uuid,function(){if(D(o._select.node())){i.select(window).on("scroll."+o._uuid,null);o.render(e)}})}else{var f=u.queue();if(this._message){this._messageClass.render({container:this._select.node().parentNode,html:this._messageHTML(this),mask:this._messageMask,style:this._messageStyle})}this._queue.forEach(function(t){var e=o._cache?o._lrucache.get(t[1]):undefined;if(!e){f.defer.apply(f,t)}else{o["_"+t[3]]=e}});this._queue=[];f.awaitAll(function(){o._draw(e);V.bind(o)();if(o._message){o._messageClass.hide()}if(o._detectResize&&(o._autoWidth||o._autoHeight)){i.select(window).on("resize."+o._uuid,function(){clearTimeout(o._resizePoll);o._resizePoll=setTimeout(function(){clearTimeout(o._resizePoll);var t=o._select.style("display");o._select.style("display","none");var i=q(o._select.node().parentNode);var n=i[0];var s=i[1];n-=parseFloat(o._select.style("border-left-width"),10);n-=parseFloat(o._select.style("border-right-width"),10);s-=parseFloat(o._select.style("border-top-width"),10);s-=parseFloat(o._select.style("border-bottom-width"),10);o._select.style("display",t);if(o._autoWidth){o.width(n)}if(o._autoHeight){o.height(s)}o.render(e)},o._detectResizeDelay)})}if(e){setTimeout(e,o._duration+100)}})}return this};e.prototype.active=function t(e){this._active=e;if(this._shapeConfig.activeOpacity!==1){this._shapes.forEach(function(t){return t.active(e)});if(this._legend){this._legendClass.active(e)}}return this};e.prototype.aggs=function t(e){return arguments.length?(this._aggs=o.assign(this._aggs,e),this):this._aggs};e.prototype.backConfig=function t(e){return arguments.length?(this._backConfig=o.assign(this._backConfig,e),this):this._backConfig};e.prototype.cache=function t(e){return arguments.length?(this._cache=e,this):this._cache};e.prototype.color=function t(e){return arguments.length?(this._color=!e||typeof e==="function"?e:o.accessor(e),this):this._color};e.prototype.colorScale=function t(e){return arguments.length?(this._colorScale=!e||typeof e==="function"?e:o.accessor(e),this):this._colorScale};e.prototype.colorScaleConfig=function t(e){return arguments.length?(this._colorScaleConfig=o.assign(this._colorScaleConfig,e),this):this._colorScaleConfig};e.prototype.colorScalePosition=function t(e){return arguments.length?(this._colorScalePosition=e,this):this._colorScalePosition};e.prototype.controls=function t(e){return arguments.length?(this._controls=e,this):this._controls};e.prototype.controlConfig=function t(e){return arguments.length?(this._controlConfig=o.assign(this._controlConfig,e),this):this._controlConfig};e.prototype.data=function t(e,i){return arguments.length?(this._queue.push([z.bind(this),e,i,"data"]),this):this._data};e.prototype.depth=function t(e){return arguments.length?(this._depth=e,this):this._depth};e.prototype.detectResize=function t(e){return arguments.length?(this._detectResize=e,this):this._detectResize};e.prototype.detectResizeDelay=function t(e){return arguments.length?(this._detectResizeDelay=e,this):this._detectResizeDelay};e.prototype.detectVisible=function t(e){return arguments.length?(this._detectVisible=e,this):this._detectVisible};e.prototype.detectVisibleInterval=function t(e){return arguments.length?(this._detectVisibleInterval=e,this):this._detectVisibleInterval};e.prototype.discrete=function t(e){return arguments.length?(this._discrete=e,this):this._discrete};e.prototype.downloadButton=function t(e){return arguments.length?(this._downloadButton=e,this):this._downloadButton};e.prototype.downloadConfig=function t(e){return arguments.length?(this._downloadConfig=o.assign(this._downloadConfig,e),this):this._downloadConfig};e.prototype.downloadPosition=function t(e){return arguments.length?(this._downloadPosition=e,this):this._downloadPosition};e.prototype.duration=function t(e){return arguments.length?(this._duration=e,this):this._duration};e.prototype.filter=function t(e){return arguments.length?(this._filter=e,this):this._filter};e.prototype.groupBy=function t(e){var i=this;if(!arguments.length){return this._groupBy}if(!(e instanceof Array)){e=[e]}return this._groupBy=e.map(function(t){if(typeof t==="function"){return t}else{if(!i._aggs[t]){i._aggs[t]=function(t){var e=Array.from(new Set(t));return e.length===1?e[0]:e}}return o.accessor(t)}}),this};e.prototype.height=function t(e){return arguments.length?(this._height=e,this):this._height};e.prototype.hover=function t(e){var i=this;var o=this._hover=e;if(this._shapeConfig.hoverOpacity!==1){if(typeof e==="function"){var n=l.merge(this._shapes.map(function(t){return t.data()}));n=n.concat(this._legendClass.data());var s=e?n.filter(e):[];var r=[];s.map(this._ids).forEach(function(t){for(var e=1;e<=t.length;e++){r.push(JSON.stringify(t.slice(0,e)))}});r=r.filter(function(t,e){return r.indexOf(t)===e});if(r.length){o=function(t,e){return r.includes(JSON.stringify(i._ids(t,e)))}}}this._shapes.forEach(function(t){return t.hover(o)});if(this._legend){this._legendClass.hover(o)}}return this};e.prototype.label=function t(e){return arguments.length?(this._label=typeof e==="function"?e:o.constant(e),this):this._label};e.prototype.legend=function t(e){return arguments.length?(this._legend=e,this):this._legend};e.prototype.legendConfig=function t(e){return arguments.length?(this._legendConfig=o.assign(this._legendConfig,e),this):this._legendConfig};e.prototype.legendTooltip=function t(e){return arguments.length?(this._legendTooltip=o.assign(this._legendTooltip,e),this):this._legendTooltip};e.prototype.legendPosition=function t(e){return arguments.length?(this._legendPosition=e,this):this._legendPosition};e.prototype.locale=function t(e){return arguments.length?(this._locale=e,this):this._locale};e.prototype.message=function t(e){return arguments.length?(this._message=e,this):this._message};e.prototype.messageHTML=function t(e){return arguments.length?(this._messageHTML=typeof e==="function"?e:o.constant(e),this):this._messageHTML};e.prototype.messageMask=function t(e){return arguments.length?(this._messageMask=e,this):this._messageMask};e.prototype.messageStyle=function t(e){return arguments.length?(this._messageStyle=o.assign(this._messageStyle,e),this):this._messageStyle};e.prototype.select=function t(e){return arguments.length?(this._select=i.select(e),this):this._select};e.prototype.shape=function t(e){return arguments.length?(this._shape=typeof e==="function"?e:o.constant(e),this):this._shape};e.prototype.shapeConfig=function t(e){return arguments.length?(this._shapeConfig=o.assign(this._shapeConfig,e),this):this._shapeConfig};e.prototype.time=function t(e){if(arguments.length){if(typeof e==="function"){this._time=e}else{this._time=o.accessor(e);if(!this._aggs[e]){this._aggs[e]=function(t){var e=Array.from(new Set(t));return e.length===1?e[0]:e}}}return this}else{return this._time}};e.prototype.timeFilter=function t(e){return arguments.length?(this._timeFilter=e,this):this._timeFilter};e.prototype.timeline=function t(e){return arguments.length?(this._timeline=e,this):this._timeline};e.prototype.timelineConfig=function t(e){return arguments.length?(this._timelineConfig=o.assign(this._timelineConfig,e),this):this._timelineConfig};e.prototype.title=function t(e){return arguments.length?(this._title=typeof e==="function"?e:o.constant(e),this):this._title};e.prototype.titleConfig=function t(e){return arguments.length?(this._titleConfig=o.assign(this._titleConfig,e),this):this._titleConfig};e.prototype.tooltip=function t(e){return arguments.length?(this._tooltip=e,this):this._tooltip};e.prototype.tooltipConfig=function t(e){return arguments.length?(this._tooltipConfig=o.assign(this._tooltipConfig,e),this):this._tooltipConfig};e.prototype.total=function t(e){return arguments.length?(this._total=typeof e==="function"?e:o.accessor(e),this):this._total};e.prototype.totalConfig=function t(e){return arguments.length?(this._totalConfig=o.assign(this._totalConfig,e),this):this._totalConfig};e.prototype.width=function t(e){return arguments.length?(this._width=e,this):this._width};e.prototype.zoom=function t(e){return arguments.length?(this._zoom=e,this):this._zoom};e.prototype.zoomBrushHandleSize=function t(e){return arguments.length?(this._zoomBrushHandleSize=e,this):this._zoomBrushHandleSize};e.prototype.zoomBrushHandleStyle=function t(e){return arguments.length?(this._zoomBrushHandleStyle=e,this):this._zoomBrushHandleStyle};e.prototype.zoomBrushSelectionStyle=function t(e){return arguments.length?(this._zoomBrushSelectionStyle=e,this):this._zoomBrushSelectionStyle};e.prototype.zoomControlStyle=function t(e){return arguments.length?(this._zoomControlStyle=e,this):this._zoomControlStyle};e.prototype.zoomControlStyleActive=function t(e){return arguments.length?(this._zoomControlStyleActive=e,this):this._zoomControlStyleActive};e.prototype.zoomControlStyleHover=function t(e){return arguments.length?(this._zoomControlStyleHover=e,this):this._zoomControlStyleHover};e.prototype.zoomFactor=function t(e){return arguments.length?(this._zoomFactor=e,this):this._zoomFactor};e.prototype.zoomMax=function t(e){return arguments.length?(this._zoomMax=e,this):this._zoomMax};e.prototype.zoomPan=function t(e){return arguments.length?(this._zoomPan=e,this):this._zoomPan};e.prototype.zoomPadding=function t(e){return arguments.length?(this._zoomPadding=e,this):this._zoomPadding};e.prototype.zoomScroll=function t(e){return arguments.length?(this._zoomScroll=e,this):this._zoomScroll};return e}(o.BaseClass);t.dataFold=b;t.dataLoad=z;t.Viz=Z;Object.defineProperty(t,"__esModule",{value:true})});