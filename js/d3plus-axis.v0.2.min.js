/*
  d3plus-axis v0.2.0
  Beautiful javascript scales and axes.
  Copyright (c) 2016 D3plus - https://d3plus.org
  @license MIT
*/
!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports,require("d3-array"),require("d3-scale"),require("d3-selection"),require("d3-transition"),require("d3plus-common"),require("d3plus-shape"),require("d3plus-text")):"function"==typeof define&&define.amd?define("d3plus-axis",["exports","d3-array","d3-scale","d3-selection","d3-transition","d3plus-common","d3plus-shape","d3plus-text"],i):i(t.d3plus=t.d3plus||{},t.d3Array,t.scales,t.d3Selection,t.d3Transition,t.d3plusCommon,t.shapes,t.d3plusText)}(this,function(t,i,e,n,s,o,r,h){"use strict";var a=function(t){function a(){var i=this;t.call(this),this._align="middle",this._barConfig={stroke:"#000","stroke-width":1},this._domain=[0,10],this._duration=600,this._gridConfig={stroke:"#ccc","stroke-width":1},this._height=400,this.orient("bottom"),this._outerBounds={width:0,height:0,x:0,y:0},this._padding=5,this._scale="linear",this._shape="Line",this._shapeConfig={fill:"#000",fontColor:"#000",fontFamily:(new h.TextBox).fontFamily(),fontResize:!1,fontSize:o.constant(10),height:8,label:function(t){return t.text},labelBounds:function(t){return t.labelBounds},labelPadding:0,r:4,stroke:"#000",strokeWidth:1,textAnchor:function(){return"left"===i._orient?"end":"right"===i._orient?"start":"middle"},verticalAlign:function(){return"bottom"===i._orient?"top":"top"===i._orient?"bottom":"middle"},width:8},this._tickSize=5,this._titleConfig={fontFamily:"Verdana",fontSize:12,lineHeight:13,textAnchor:"middle"},this._width=400}return t&&(a.__proto__=t),a.prototype=Object.create(t&&t.prototype),a.prototype.constructor=a,a.prototype._barPosition=function(t){var i=this._position,e=i.height,n=i.x,s=i.y,r=i.opposite,h=this._margin[r],a=["top","left"].includes(this._orient)?this._outerBounds[s]+this._outerBounds[e]-h:this._outerBounds[s]+h;t.call(o.attrize,this._barConfig).attr(n+"1",this._d3Scale(this._d3Scale.domain()[0])).attr(n+"2",this._d3Scale(this._d3Scale.domain()[1])).attr(s+"1",a).attr(s+"2",a)},a.prototype._gridPosition=function(t,i){void 0===i&&(i=!1);var e=this._position,n=e.height,s=e.x,r=e.y,h=e.opposite,a=this._margin[h],_=["top","left"].includes(this._orient)?this._outerBounds[r]+this._outerBounds[n]-a:this._outerBounds[r]+a,l=i?this._lastScale||this._d3Scale:this._d3Scale,u=["top","left"].includes(this._orient)?a:-a;t.call(o.attrize,this._gridConfig).attr(s+"1",function(t){return l(t.id)}).attr(s+"2",function(t){return l(t.id)}).attr(r+"1",_).attr(r+"2",i?_:_+u)},a.prototype._parseDate=function(t){return t.constructor===Date?t:t.constructor===Number&&(""+t).length>4&&t%1===0?new Date(t):(t=""+t,4===t.length&&""+parseInt(t,10)===t&&(t+="/01/01"),new Date(t))},a.prototype.align=function(t){return arguments.length?(this._align=t,this):this._align},a.prototype.barConfig=function(t){return arguments.length?(this._barConfig=Object.assign(this._barConfig,t),this):this._barConfig},a.prototype.domain=function(t){return arguments.length?(this._domain=t,this):this._domain},a.prototype.duration=function(t){return arguments.length?(this._duration=t,this):this._duration},a.prototype.grid=function(t){return arguments.length?(this._grid=t,this):this._grid},a.prototype.gridConfig=function(t){return arguments.length?(this._gridConfig=Object.assign(this._gridConfig,t),this):this._gridConfig},a.prototype.gridSize=function(t){return arguments.length?(this._gridSize=t,this):this._gridSize},a.prototype.height=function(t){return arguments.length?(this._height=t,this):this._height},a.prototype.labels=function(t){return arguments.length?(this._labels=t,this):this._labels},a.prototype.orient=function(t){if(arguments.length){var i=["top","bottom"].includes(t),e={top:"bottom",right:"left",bottom:"top",left:"right"};return this._position={horizontal:i,width:i?"width":"height",height:i?"height":"width",x:i?"x":"y",y:i?"y":"x",opposite:e[t]},this._orient=t,this}return this._orient},a.prototype.outerBounds=function(){return this._outerBounds},a.prototype.padding=function(t){return arguments.length?(this._padding=t,this):this._padding},a.prototype.range=function(t){return arguments.length?(this._range=t,this):this._range},a.prototype.render=function(t){var a=this;void 0===this._select&&this.select(n.select("body").append("svg").attr("width",this._width+"px").attr("height",this._height+"px").node()),void 0===this._lineHeight&&(this._lineHeight=function(t,i){return 1.1*a._shapeConfig.fontSize(t,i)});var _=this._position,l=_.width,u=_.height,d=_.x,c=_.y,p=_.horizontal,g=_.opposite,f="d3plus-Axis-clip-"+this._uuid,m="Circle"===this._shape?this._shapeConfig.r:"Rect"===this._shape?this._shapeConfig[u]/2:this._tickSize,y=this._padding,b=this._select,x=this._range?this._range.slice():[void 0,void 0],C=s.transition().duration(this._duration),S="Circle"===this._shape?this._shapeConfig.r:"Rect"===this._shape?this._shapeConfig[l]/2:this._tickSize;if(void 0===x[0]&&(x[0]=y),void 0===x[1]&&(x[1]=this["_"+l]-y),this._size=x[1]-x[0],this._margin={top:0,right:0,bottom:0,left:0},this._title){var v=this._titleConfig.lineHeight?this._titleConfig.lineHeight:1.1*this._titleConfig.fontSize,z=h.textWrap().fontFamily(this._titleConfig.fontFamily).fontSize(this._titleConfig.fontSize).lineHeight(v).width(this._size).height(this["_"+u]-this._tickSize-y)(this._title);this._margin[this._orient]=z.lines.length*v+y}this._d3Scale=e["scale"+this._scale.charAt(0).toUpperCase()+this._scale.slice(1)]().domain("time"===this._scale?this._domain.map(this._parseDate):this._domain).rangeRound(x);var B=e.scaleSqrt().domain([10,400]).range([10,0===this._gridSize?25:50]),w=e.scaleSqrt().domain([10,400]).range([10,50]),k=this._ticks?"time"===this._scale?this._ticks.map(this._parseDate):this._ticks:this._d3Scale.ticks(Math.floor(this._size/B(this._size))),A=this._labels||this._d3Scale.ticks(Math.floor(this._size/w(this._size))),j=this._d3Scale.tickFormat(A.length-1);if(this._visibleTicks=k,this._space=0,A.length>1)for(var O=0;O<A.length;O++){var q=a._d3Scale(A[O+1])-a._d3Scale(A[O]);q>a._space&&(a._space=q)}else this._space=this._size;var H=A.map(function(t,e){var n=a._shapeConfig.fontFamily(t,e),s=a._shapeConfig.fontSize(t,e),o=a._shapeConfig.lineHeight?a._shapeConfig.lineHeight(t,e):1.1*s,r=h.textWrap().fontFamily(n).fontSize(s).lineHeight(o).width(p?a._space:a._width-m-y).height(p?a._height-m-y:a._space)(j(t));return r.lines=r.lines.filter(function(t){return""!==t}),r.d=t,r.fS=s,r.width=Math.ceil(i.max(r.lines.map(function(t){return h.textWidth(t,{"font-family":n,"font-size":s})})))+s/4,r.height=Math.ceil(r.lines.length*(o+1)),r.width%2&&r.width++,r}),P=x.slice();if(H.length){var F=H[0],T=H[H.length-1],D=i.min([this._d3Scale(F.d)-F[l]/2,x[0]-S]);if(D<x[0]){var R=x[0]-D;void 0===this._range||void 0===this._range[0]?(this._size-=R,x[0]+=R):this._range&&(P[0]-=R)}var M=i.max([this._d3Scale(T.d)+T[l]/2,x[1]+S]);if(M>x[1]){var L=M-x[1];void 0===this._range||void 0===this._range[1]?(this._size-=L,x[1]-=L):this._range&&(P[1]+=L)}this._d3Scale.rangeRound(x)}var W;this._outerBounds=(W={},W[u]=this._margin[this._orient]+m+(i.max(H,function(t){return t[u]})||0)+(H.length?y:0),W[l]=P[1]-P[0],W[d]=P[0],W),this._margin[g]=void 0!==this._gridSize?i.max([this._gridSize,m]):this["_"+u]-this._outerBounds[u]-2*y+m,this._outerBounds[u]+=this._margin[g],this._margin[g]<m&&(this._outerBounds[u]+=m),this._outerBounds[c]="start"===this._align?this._padding:"end"===this._align?this["_"+u]-this._outerBounds[u]:this["_"+u]/2-this._outerBounds[u]/2;var I=o.elem("g#d3plus-Axis-"+this._uuid,{parent:b});this._group=I;var N=o.elem("g.grid",{parent:I}).selectAll("line").data((this._grid||k).map(function(t){return{id:t}}),function(t){return t.id});N.exit().transition(C).attr("opacity",0).call(this._gridPosition.bind(this)).remove(),N.enter().append("line").attr("opacity",0).attr("clip-path","url(#"+f+")").call(this._gridPosition.bind(this),!0).merge(N).transition(C).attr("opacity",1).call(this._gridPosition.bind(this));var U=i.max(H,function(t){return t.height})||0,V=p?this._space:this._outerBounds.width-this._margin[this._position.opposite]-m-this._margin[this._orient]+y,E=k.concat(A.filter(function(t,i){return H[i].lines.length&&!k.includes(t)})).map(function(t){var i,e=a._margin[g],n=["top","left"].includes(a._orient)?a._outerBounds[c]+a._outerBounds[u]-e:a._outerBounds[c]+e,s=["top","left"].includes(a._orient)?-m:m,o="Line"===a._shape?s/2:s;return i={id:t,labelBounds:{x:p?-V/2:"left"===a._orient?-V-y+o:o+y,y:p?"bottom"===a._orient?o+y:o-y-U:-U/2,width:V,height:U},size:s,text:!!A.includes(t)&&j(t)},i[d]=a._d3Scale(t),i[c]=n,i});"Line"===this._shape&&(E=E.concat(E.map(function(t){var i=Object.assign({},t);return i[c]+=t.size,i}))),(new r[this._shape]).data(E).duration(this._duration).select(o.elem("g.ticks",{parent:I}).node()).config(this._shapeConfig).render();var G=I.selectAll("line.bar").data([null]);return G.enter().append("line").attr("class","bar").attr("opacity",0).call(this._barPosition.bind(this)).merge(G).transition(C).attr("opacity",1).call(this._barPosition.bind(this)),(new h.TextBox).data(this._title?[{text:this._title}]:[]).duration(this._duration).height(this._outerBounds.height).rotate("left"===this._orient?-90:"right"===this._orient?90:0).select(o.elem("g.d3plus-Axis-title",{parent:I}).node()).text(function(t){return t.text}).textAnchor("middle").verticalAlign("bottom"===this._orient?"bottom":"top").width(this._outerBounds[l]).x(p?this._outerBounds.x:"left"===this._orient?this._outerBounds.x+this._margin[this._orient]/2-this._outerBounds[l]/2:this._outerBounds.x+this._outerBounds.width-this._margin[this._orient]/2-this._outerBounds[l]/2).y(p?this._outerBounds.y:this._outerBounds.y-this._margin[this._orient]/2+this._outerBounds[l]/2).config(this._titleConfig).render(),this._lastScale=this._d3Scale,t&&setTimeout(t,this._duration+100),this},a.prototype.scale=function(t){return arguments.length?(this._scale=t,this):this._scale},a.prototype.select=function(t){return arguments.length?(this._select=n.select(t),this):this._select},a.prototype.shape=function(t){return arguments.length?(this._shape=t,this):this._shape},a.prototype.shapeConfig=function(t){return arguments.length?(this._shapeConfig=Object.assign(this._shapeConfig,t),this):this._shapeConfig},a.prototype.ticks=function(t){return arguments.length?(this._ticks=t,this):this._ticks},a.prototype.tickSize=function(t){return arguments.length?(this._tickSize=t,this):this._tickSize},a.prototype.title=function(t){return arguments.length?(this._title=t,this):this._title},a.prototype.titleConfig=function(t){return arguments.length?(this._titleConfig=Object.assign(this._titleConfig,t),this):this._titleConfig},a.prototype.width=function(t){return arguments.length?(this._width=t,this):this._width},a}(o.BaseClass),_=function(t){function i(){t.call(this),this.orient("bottom")}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i}(a),l=function(t){function i(){t.call(this),this.orient("left")}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i}(a),u=function(t){function i(){t.call(this),this.orient("right")}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i}(a),d=function(t){function i(){t.call(this),this.orient("top")}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i}(a);t.Axis=a,t.AxisBottom=_,t.AxisLeft=l,t.AxisRight=u,t.AxisTop=d,Object.defineProperty(t,"__esModule",{value:!0})});