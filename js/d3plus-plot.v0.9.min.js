/*
  d3plus-plot v0.9.1
  A reusable javascript x/y plot built on D3.
  Copyright (c) 2020 D3plus - https://d3plus.org
  @license MIT
*/
(function(e){typeof define==="function"&&define.amd?define(e):e()})(function(){"use strict";var e=typeof globalThis!=="undefined"?globalThis:typeof window!=="undefined"?window:typeof global!=="undefined"?global:typeof self!=="undefined"?self:{};function t(e,t){return t={exports:{}},e(t,t.exports),t.exports}var n=function(e){return e&&e.Math==Math&&e};var l=n(typeof globalThis=="object"&&globalThis)||n(typeof window=="object"&&window)||n(typeof self=="object"&&self)||n(typeof e=="object"&&e)||Function("return this")();var o=function(e){try{return!!e()}catch(e){return true}};var h=!o(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7});var r={}.propertyIsEnumerable;var i=Object.getOwnPropertyDescriptor;var a=i&&!r.call({1:2},1);var s=a?function e(t){var n=i(this,t);return!!n&&n.enumerable}:r;var v={f:s};var c=function(e,t){return{enumerable:!(e&1),configurable:!(e&2),writable:!(e&4),value:t}};var u={}.toString;var f=function(e){return u.call(e).slice(8,-1)};var d="".split;var x=o(function(){return!Object("z").propertyIsEnumerable(0)})?function(e){return f(e)=="String"?d.call(e,""):Object(e)}:Object;var g=function(e){if(e==undefined)throw TypeError("Can't call method on "+e);return e};var _=function(e){return x(g(e))};var y=function(e){return typeof e==="object"?e!==null:typeof e==="function"};var p=function(e,t){if(!y(e))return e;var n,r;if(t&&typeof(n=e.toString)=="function"&&!y(r=n.call(e)))return r;if(typeof(n=e.valueOf)=="function"&&!y(r=n.call(e)))return r;if(!t&&typeof(n=e.toString)=="function"&&!y(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")};var m={}.hasOwnProperty;var b=function(e,t){return m.call(e,t)};var S=l.document;var k=y(S)&&y(S.createElement);var C=function(e){return k?S.createElement(e):{}};var w=!h&&!o(function(){return Object.defineProperty(C("div"),"a",{get:function(){return 7}}).a!=7});var A=Object.getOwnPropertyDescriptor;var O=h?A:function e(t,n){t=_(t);n=p(n,true);if(w)try{return A(t,n)}catch(e){}if(b(t,n))return c(!v.f.call(t,n),t[n])};var P={f:O};var z=function(e){if(!y(e)){throw TypeError(String(e)+" is not an object")}return e};var T=Object.defineProperty;var j=h?T:function e(t,n,r){z(t);n=p(n,true);z(r);if(w)try{return T(t,n,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported");if("value"in r)t[n]=r.value;return t};var L={f:j};var M=h?function(e,t,n){return L.f(e,t,c(1,n))}:function(e,t,n){e[t]=n;return e};var D=function(t,n){try{M(l,t,n)}catch(e){l[t]=n}return n};var E="__core-js_shared__";var B=l[E]||D(E,{});var R=B;var N=Function.toString;if(typeof R.inspectSource!="function"){R.inspectSource=function(e){return N.call(e)}}var W=R.inspectSource;var q=l.WeakMap;var F=typeof q==="function"&&/native code/.test(W(q));var I=t(function(e){(e.exports=function(e,t){return R[e]||(R[e]=t!==undefined?t:{})})("versions",[]).push({version:"3.6.5",mode:"global",copyright:"Â© 2020 Denis Pushkarev (zloirock.ru)"})});var V=0;var G=Math.random();var H=function(e){return"Symbol("+String(e===undefined?"":e)+")_"+(++V+G).toString(36)};var U=I("keys");var K=function(e){return U[e]||(U[e]=H(e))};var X={};var Y=l.WeakMap;var $,J,Q;var Z=function(e){return Q(e)?J(e):$(e,{})};var ee=function(n){return function(e){var t;if(!y(e)||(t=J(e)).type!==n){throw TypeError("Incompatible receiver, "+n+" required")}return t}};if(F){var te=new Y;var ne=te.get;var re=te.has;var ie=te.set;$=function(e,t){ie.call(te,e,t);return t};J=function(e){return ne.call(te,e)||{}};Q=function(e){return re.call(te,e)}}else{var ae=K("state");X[ae]=true;$=function(e,t){M(e,ae,t);return t};J=function(e){return b(e,ae)?e[ae]:{}};Q=function(e){return b(e,ae)}}var oe={set:$,get:J,has:Q,enforce:Z,getterFor:ee};var se=t(function(e){var t=oe.get;var s=oe.enforce;var c=String(String).split("String");(e.exports=function(e,t,n,r){var i=r?!!r.unsafe:false;var a=r?!!r.enumerable:false;var o=r?!!r.noTargetGet:false;if(typeof n=="function"){if(typeof t=="string"&&!b(n,"name"))M(n,"name",t);s(n).source=c.join(typeof t=="string"?t:"")}if(e===l){if(a)e[t]=n;else D(t,n);return}else if(!i){delete e[t]}else if(!o&&e[t]){a=true}if(a)e[t]=n;else M(e,t,n)})(Function.prototype,"toString",function e(){return typeof this=="function"&&t(this).source||W(this)})});var ce=l;var ue=function(e){return typeof e=="function"?e:undefined};var fe=function(e,t){return arguments.length<2?ue(ce[e])||ue(l[e]):ce[e]&&ce[e][t]||l[e]&&l[e][t]};var le=Math.ceil;var de=Math.floor;var he=function(e){return isNaN(e=+e)?0:(e>0?de:le)(e)};var ve=Math.min;var ge=function(e){return e>0?ve(he(e),9007199254740991):0};var _e=Math.max;var ye=Math.min;var pe=function(e,t){var n=he(e);return n<0?_e(n+t,0):ye(n,t)};var me=function(s){return function(e,t,n){var r=_(e);var i=ge(r.length);var a=pe(n,i);var o;if(s&&t!=t)while(i>a){o=r[a++];if(o!=o)return true}else for(;i>a;a++){if((s||a in r)&&r[a]===t)return s||a||0}return!s&&-1}};var xe={includes:me(true),indexOf:me(false)};var be=xe.indexOf;var Se=function(e,t){var n=_(e);var r=0;var i=[];var a;for(a in n)!b(X,a)&&b(n,a)&&i.push(a);while(t.length>r)if(b(n,a=t[r++])){~be(i,a)||i.push(a)}return i};var ke=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"];var Ce=ke.concat("length","prototype");var we=Object.getOwnPropertyNames||function e(t){return Se(t,Ce)};var Ae={f:we};var Oe=Object.getOwnPropertySymbols;var Pe={f:Oe};var ze=fe("Reflect","ownKeys")||function e(t){var n=Ae.f(z(t));var r=Pe.f;return r?n.concat(r(t)):n};var Te=function(e,t){var n=ze(t);var r=L.f;var i=P.f;for(var a=0;a<n.length;a++){var o=n[a];if(!b(e,o))r(e,o,i(t,o))}};var je=/#|\.prototype\./;var Le=function(e,t){var n=De[Me(e)];return n==Be?true:n==Ee?false:typeof t=="function"?o(t):!!t};var Me=Le.normalize=function(e){return String(e).replace(je,".").toLowerCase()};var De=Le.data={};var Ee=Le.NATIVE="N";var Be=Le.POLYFILL="P";var Re=Le;var Ne=P.f;var We=function(e,t){var n=e.target;var r=e.global;var i=e.stat;var a,o,s,c,u,f;if(r){o=l}else if(i){o=l[n]||D(n,{})}else{o=(l[n]||{}).prototype}if(o)for(s in t){u=t[s];if(e.noTargetGet){f=Ne(o,s);c=f&&f.value}else c=o[s];a=Re(r?s:n+(i?".":"#")+s,e.forced);if(!a&&c!==undefined){if(typeof u===typeof c)continue;Te(u,c)}if(e.sham||c&&c.sham){M(u,"sham",true)}se(o,s,u,e)}};var qe=function(e){if(typeof e!="function"){throw TypeError(String(e)+" is not a function")}return e};var Fe=function(r,i,e){qe(r);if(i===undefined)return r;switch(e){case 0:return function(){return r.call(i)};case 1:return function(e){return r.call(i,e)};case 2:return function(e,t){return r.call(i,e,t)};case 3:return function(e,t,n){return r.call(i,e,t,n)}}return function(){return r.apply(i,arguments)}};var Ie=function(e){return Object(g(e))};var Ve=Array.isArray||function e(t){return f(t)=="Array"};var Ge=!!Object.getOwnPropertySymbols&&!o(function(){return!String(Symbol())});var He=Ge&&!Symbol.sham&&typeof Symbol.iterator=="symbol";var Ue=I("wks");var Ke=l.Symbol;var Xe=He?Ke:Ke&&Ke.withoutSetter||H;var Ye=function(e){if(!b(Ue,e)){if(Ge&&b(Ke,e))Ue[e]=Ke[e];else Ue[e]=Xe("Symbol."+e)}return Ue[e]};var $e=Ye("species");var Je=function(e,t){var n;if(Ve(e)){n=e.constructor;if(typeof n=="function"&&(n===Array||Ve(n.prototype)))n=undefined;else if(y(n)){n=n[$e];if(n===null)n=undefined}}return new(n===undefined?Array:n)(t===0?0:t)};var Qe=[].push;var Ze=function(h){var v=h==1;var g=h==2;var _=h==3;var y=h==4;var p=h==6;var m=h==5||p;return function(e,t,n,r){var i=Ie(e);var a=x(i);var o=Fe(t,n,3);var s=ge(a.length);var c=0;var u=r||Je;var f=v?u(e,s):g?u(e,0):undefined;var l,d;for(;s>c;c++)if(m||c in a){l=a[c];d=o(l,c,i);if(h){if(v)f[c]=d;else if(d)switch(h){case 3:return true;case 5:return l;case 6:return c;case 2:Qe.call(f,l)}else if(y)return false}}return p?-1:_||y?y:f}};var et={forEach:Ze(0),map:Ze(1),filter:Ze(2),some:Ze(3),every:Ze(4),find:Ze(5),findIndex:Ze(6)};var tt=Object.keys||function e(t){return Se(t,ke)};var nt=h?Object.defineProperties:function e(t,n){z(t);var r=tt(n);var i=r.length;var a=0;var o;while(i>a)L.f(t,o=r[a++],n[o]);return t};var rt=fe("document","documentElement");var it=">";var at="<";var ot="prototype";var st="script";var ct=K("IE_PROTO");var ut=function(){};var ft=function(e){return at+st+it+e+at+"/"+st+it};var lt=function(e){e.write(ft(""));e.close();var t=e.parentWindow.Object;e=null;return t};var dt=function(){var e=C("iframe");var t="java"+st+":";var n;e.style.display="none";rt.appendChild(e);e.src=String(t);n=e.contentWindow.document;n.open();n.write(ft("document.F=Object"));n.close();return n.F};var ht;var vt=function(){try{ht=document.domain&&new ActiveXObject("htmlfile")}catch(e){}vt=ht?lt(ht):dt();var e=ke.length;while(e--)delete vt[ot][ke[e]];return vt()};X[ct]=true;var gt=Object.create||function e(t,n){var r;if(t!==null){ut[ot]=z(t);r=new ut;ut[ot]=null;r[ct]=t}else r=vt();return n===undefined?r:nt(r,n)};var _t=Ye("unscopables");var yt=Array.prototype;if(yt[_t]==undefined){L.f(yt,_t,{configurable:true,value:gt(null)})}var pt=function(e){yt[_t][e]=true};var mt=Object.defineProperty;var xt={};var bt=function(e){throw e};var St=function(e,t){if(b(xt,e))return xt[e];if(!t)t={};var n=[][e];var r=b(t,"ACCESSORS")?t.ACCESSORS:false;var i=b(t,0)?t[0]:bt;var a=b(t,1)?t[1]:undefined;return xt[e]=!!n&&!o(function(){if(r&&!h)return true;var e={length:-1};if(r)mt(e,1,{enumerable:true,get:bt});else e[1]=1;n.call(e,i,a)})};var kt=et.find;var Ct="find";var wt=true;var At=St(Ct);if(Ct in[])Array(1)[Ct](function(){wt=false});We({target:"Array",proto:true,forced:wt||!At},{find:function e(t){return kt(this,t,arguments.length>1?arguments[1]:undefined)}});pt(Ct);var Ot=xe.includes;var Pt=St("indexOf",{ACCESSORS:true,1:0});We({target:"Array",proto:true,forced:!Pt},{includes:function e(t){return Ot(this,t,arguments.length>1?arguments[1]:undefined)}});pt("includes");var zt=Object.assign;var Tt=Object.defineProperty;var jt=!zt||o(function(){if(h&&zt({b:1},zt(Tt({},"a",{enumerable:true,get:function(){Tt(this,"b",{value:3,enumerable:false})}}),{b:2})).b!==1)return true;var e={};var t={};var n=Symbol();var r="abcdefghijklmnopqrst";e[n]=7;r.split("").forEach(function(e){t[e]=e});return zt({},e)[n]!=7||tt(zt({},t)).join("")!=r})?function e(t,n){var r=Ie(t);var i=arguments.length;var a=1;var o=Pe.f;var s=v.f;while(i>a){var c=x(arguments[a++]);var u=o?tt(c).concat(o(c)):tt(c);var f=u.length;var l=0;var d;while(f>l){d=u[l++];if(!h||s.call(c,d))r[d]=c[d]}}return r}:zt;We({target:"Object",stat:true,forced:Object.assign!==jt},{assign:jt});var Lt=Ye("match");var Mt=function(e){var t;return y(e)&&((t=e[Lt])!==undefined?!!t:f(e)=="RegExp")};var Dt=function(e){if(Mt(e)){throw TypeError("The method doesn't accept regular expressions")}return e};var Et=Ye("match");var Bt=function(t){var n=/./;try{"/./"[t](n)}catch(e){try{n[Et]=false;return"/./"[t](n)}catch(e){}}return false};We({target:"String",proto:true,forced:!Bt("includes")},{includes:function e(t){return!!~String(g(this)).indexOf(Dt(t),arguments.length>1?arguments[1]:undefined)}});var Rt=P.f;var Nt="".startsWith;var Wt=Math.min;var qt=Bt("startsWith");var Ft=!qt&&!!function(){var e=Rt(String.prototype,"startsWith");return e&&!e.writable}();We({target:"String",proto:true,forced:!Ft&&!qt},{startsWith:function e(t){var n=String(g(this));Dt(t);var r=ge(Wt(arguments.length>1?arguments[1]:undefined,n.length));var i=String(t);return Nt?Nt.call(n,i,r):n.slice(r,r+i.length)===i}});if(typeof window!=="undefined"){(function(){try{if(typeof SVGElement==="undefined"||Boolean(SVGElement.prototype.innerHTML)){return}}catch(e){return}function n(e){switch(e.nodeType){case 1:return i(e);case 3:return t(e);case 8:return r(e)}}function t(e){return e.textContent.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function r(e){return"\x3c!--"+e.nodeValue+"--\x3e"}function i(e){var t="";t+="<"+e.tagName;if(e.hasAttributes()){[].forEach.call(e.attributes,function(e){t+=" "+e.name+'="'+e.value+'"'})}t+=">";if(e.hasChildNodes()){[].forEach.call(e.childNodes,function(e){t+=n(e)})}t+="</"+e.tagName+">";return t}Object.defineProperty(SVGElement.prototype,"innerHTML",{get:function(){var t="";[].forEach.call(this.childNodes,function(e){t+=n(e)});return t},set:function(e){while(this.firstChild){this.removeChild(this.firstChild)}try{var t=new DOMParser;t.async=false;var n="<svg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'>"+e+"</svg>";var r=t.parseFromString(n,"text/xml").documentElement;[].forEach.call(r.childNodes,function(e){this.appendChild(this.ownerDocument.importNode(e,true))}.bind(this))}catch(e){throw new Error("Error parsing markup string")}}});Object.defineProperty(SVGElement.prototype,"innerSVG",{get:function(){return this.innerHTML},set:function(e){this.innerHTML=e}})})()}});(function(e,t){typeof exports==="object"&&typeof module!=="undefined"?t(exports,require("d3plus-common"),require("d3-array"),require("d3-collection"),require("d3-scale"),require("d3-shape"),require("d3plus-axis"),require("d3plus-color"),require("d3plus-shape"),require("d3plus-text"),require("d3plus-viz"),require("d3-selection")):typeof define==="function"&&define.amd?define("d3plus-plot",["exports","d3plus-common","d3-array","d3-collection","d3-scale","d3-shape","d3plus-axis","d3plus-color","d3plus-shape","d3plus-text","d3plus-viz","d3-selection"],t):(e=e||self,t(e.d3plus={},e.d3plusCommon,e.d3Array,e.d3Collection,e.scales,e.d3Shape,e.d3plusAxis,e.d3plusColor,e.shapes,e.d3plusText,e.d3plusViz,e.d3Selection))})(this,function(e,it,at,ot,st,ct,ut,a,ft,lt,t,x){"use strict";function dt(e){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){dt=function(e){return typeof e}}else{dt=function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e}}return dt(e)}function r(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}function n(e,t,n){if(t)i(e.prototype,t);if(n)i(e,n);return e}function ht(e,t,n){if(t in e){Object.defineProperty(e,t,{value:n,enumerable:true,configurable:true,writable:true})}else{e[t]=n}return e}function o(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function")}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:true,configurable:true}});if(t)s(e,t)}function vt(e){vt=Object.setPrototypeOf?Object.getPrototypeOf:function e(t){return t.__proto__||Object.getPrototypeOf(t)};return vt(e)}function s(e,t){s=Object.setPrototypeOf||function e(t,n){t.__proto__=n;return t};return s(e,t)}function c(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true}catch(e){return false}}function u(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function f(e,t){if(t&&(typeof t==="object"||typeof t==="function")){return t}return u(e)}function l(i){var a=c();return function e(){var t=vt(i),n;if(a){var r=vt(this).constructor;n=Reflect.construct(t,arguments,r)}else{n=t.apply(this,arguments)}return f(this,n)}}function d(e,t){while(!Object.prototype.hasOwnProperty.call(e,t)){e=vt(e);if(e===null)break}return e}function gt(e,t,n){if(typeof Reflect!=="undefined"&&Reflect.get){gt=Reflect.get}else{gt=function e(t,n,r){var i=d(t,n);if(!i)return;var a=Object.getOwnPropertyDescriptor(i,n);if(a.get){return a.get.call(r)}return a.value}}return gt(e,t,n||e)}function _t(e,t){return h(e)||v(e,t)||g(e,t)||y()}function h(e){if(Array.isArray(e))return e}function v(e,t){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(e)))return;var n=[];var r=true;var i=false;var a=undefined;try{for(var o=e[Symbol.iterator](),s;!(r=(s=o.next()).done);r=true){n.push(s.value);if(t&&n.length===t)break}}catch(e){i=true;a=e}finally{try{if(!r&&o["return"]!=null)o["return"]()}finally{if(i)throw a}}return n}function g(e,t){if(!e)return;if(typeof e==="string")return _(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor)n=e.constructor.name;if(n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _(e,t)}function _(e,t){if(t==null||t>e.length)t=e.length;for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function y(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var m=function(e,t,n){if(e.padding)e.padding(.5);else{var r=t.map(function(e){return e[n]}).reduce(function(e,t,n,r){if(!n)return e;var i=r[n-1];if(!e||t-i<e)return t-i;else return e},0);var i=e.domain().slice();if(n==="y")i.reverse();i[0]=new Date(+i[0]-r/2);i[1]=new Date(+i[1]+r/2);if(n==="y")i.reverse();e.domain(i)}};function p(e){var t=this;var n=e.data,r=e.x,i=e.y,a=e.x2,o=e.y2,s=e.buffer,c=s===void 0?10:s;var u=a?"x2":"x";var f=o?"y2":"y";var l=this._discrete==="x"?i:r;var d=l.domain().slice();var h=this._discrete==="x";if(h)d.reverse();var v,g;if(this._stacked){var _=ot.nest().key(function(e){return"".concat(e[t._discrete],"_").concat(e.group)}).entries(n).map(function(e){return e.values.map(function(e){return e[h?f:u]})});g=_.map(function(e){return at.sum(e.filter(function(e){return e>0}))});v=_.map(function(e){return at.sum(e.filter(function(e){return e<0}))})}else{g=n.map(function(e){return e[h?f:u]});v=g}var y=l(at.max(g));if(h?y<l(0):y>l(0))y+=h?-c:c;y=l.invert(y);var p=l(at.min(v));if(h?p>l(0):p<l(0))p+=h?c:-c;p=l.invert(p);if(y>d[1])d[1]=y;if(p<d[0])d[0]=p;if(h)d.reverse();l.domain(d);m(h?r:i,n,this._discrete);return[r,i]}function b(e){var t=this;var n=e.data,r=e.x,i=e.y,a=e.x2,o=e.y2,s=e.buffer,c=s===void 0?10:s;var u=a?"x2":"x";var f=o?"y2":"y";var l=this._discrete==="x"?i:r;var d=l.domain().slice();var h=this._discrete==="x";if(h)d.reverse();var v,g;if(this._stacked){var _=ot.nest().key(function(e){return e[t._discrete]}).entries(n).map(function(e){return e.values.map(function(e){return e[h?f:u]})});g=_.map(function(e){return at.sum(e.filter(function(e){return e>0}))});v=_.map(function(e){return at.sum(e.filter(function(e){return e<0}))})}else{g=n.map(function(e){return e[h?f:u]});v=g}var y=l(at.max(g));y+=h?-c:c;y=l.invert(y);var p=l(at.min(v));p+=h?c:-c;p=l.invert(p);if(y>d[1])d[1]=y;if(p<d[0])d[0]=p;if(h)d.reverse();l.domain(d);m(h?r:i,n,this._discrete);return[r,i]}function S(l,d,h,v,e,t,g,_){if(_){t=t.slice().reverse();e=e.slice().reverse()}var n=Math.abs(Math.log(t[1]-t[0])/10);var r=function e(){var t=l.copy();var n=false;if(d==="log"){var r=l.domain().slice(),i=l.range().slice();if(_){r=r.reverse();i=i.reverse()}n=r[0]*r[1]<0;if(n){var a=st.scaleLog().domain([1e-6,Math.abs(r[g])]).range([0,1]);var o=a(Math.abs(r[g?0:1]));var s=o/(o+1)*(i[1]-i[0]);r=(g===0?[r[0],1e-6]:[1e-6,r[1]]).map(Math.abs);i=g===0?[i[0],i[0]+s]:[i[0]+s,i[1]]}t=st.scaleLog().domain(r).range(i)}var c=false;var u=t.range();var f;if(d==="log"){f=n?t(Math.abs(h)):t(h)}else f=t(h);if(_){if(g===0)c=f+v>u[g];else if(g===1)c=f-v<u[g]}else{if(g===0)c=f-v<u[g];else if(g===1)c=f+v>u[g]}return c};if(l.invert&&r()){if(d==="log"){var i=0;while(i<10&&r()){var a=(g===0?-1:1)*(t[g]<0?-1:1);t[g]+=t[g]*n*a;l.domain(_?t.slice().reverse():t);i++}}else if(g===0){var o=l.invert(l(h)+v*(_?1:-1));if(o<t[g]){t[g]=o;l.domain(_?t.slice().reverse():t)}}else if(g===1){var s=l.invert(l(h)+v*(_?-1:1));if(s>t[g]){t[g]=s;l.domain(_?t.slice().reverse():t)}}}return _?t.reverse():t}function k(e){var t=e.data,n=e.x,r=e.y,i=e.x2,a=e.y2,o=e.yScale,s=e.xScale,c=e.config,u=e.buffer;n=n.copy();r=r.copy();var f=i?"x2":"x";var l=a?"y2":"y";var d=n.domain().slice(),h=r.domain().slice();var v=n.range(),g=r.range();if(!n.invert&&n.padding)m(n,t,this._discrete);if(!r.invert&&r.padding)m(r,t,this._discrete);if(n.invert||r.invert){t.forEach(function(e){var t=u?u:c.r(e.data,e.i)*2;if(n.invert){d=S(n,s,e[f],t,v,d,0,false);d=S(n,s,e[f],t,v,d,1,false)}if(r.invert){h=S(r,o,e[l],t,g,h,0,true);h=S(r,o,e[l],t,g,h,1,true)}})}return[n,r]}function C(e){var t=this;var n=e.data,r=e.x,i=e.y,a=e.x2,o=e.y2;var s=a?"x2":"x";var c=o?"y2":"y";var u=this._discrete==="x"?i:r;var f=u.domain().slice();if(this._discrete==="x")f.reverse();var l=n.map(function(e){return e[t._discrete==="x"?c:s]});var d=u.invert(u(at.max(l))+(this._discrete==="x"?-10:10));if(d>f[1])f[1]=d;if(this._discrete==="x")f.reverse();u.domain(f);return[r,i]}function w(e){var t=e.data,r=e.x,i=e.y,n=e.x2,a=e.y2,o=e.yScale,s=e.xScale,c=e.config;r=r.copy();i=i.copy();var u=n?"x2":"x";var f=a?"y2":"y";var l=r.domain().slice(),d=i.domain().slice();var h=r.range(),v=i.range();if(!r.invert&&r.padding)m(r,t,this._discrete);if(!i.invert&&i.padding)m(i,t,this._discrete);if(r.invert||i.invert){t.forEach(function(e){if(r.invert){var t=c.width(e.data,e.i);l=S(r,s,e[u],t,h,l,0,false);l=S(r,s,e[u],t,h,l,1,false)}if(i.invert){var n=c.height(e.data,e.i);d=S(i,o,e[f],n,v,d,0,true);d=S(i,o,e[f],n,v,d,1,true)}})}return[r,i]}var yt=new ft.Line;var pt=new lt.TextBox;function A(e){return this._sizeScaleD3(this._size?this._size(e):null)}function O(e){var n=e.map(z);var r=e.map(function(e){return e.key.split("_")[0]});return ct.stackOrderNone(e).sort(function(e,t){return r[t].localeCompare(r[e])||n[e]-n[t]})}function P(e){return O(e).reverse()}function z(e){var t=-1,n=0,r;var i=e.length;while(++t<i){if(r=+e[t][1])n+=r}return n}function T(e,t){var n;if(!((n=e.length)>0))return;var r,i,a,o,s;var c=e[t[0]].length;for(var u=0;u<c;++u){for(s=o=0,a=0;a<n;++a){if((i=(r=e[t[a]][u])[1]-r[0])>=0){r[0]=s,r[1]=s+=i}else if(i<0){r[1]=o,r[0]=o+=i}else{r[0]=s}}}}var j=function(e){o(rt,e);var t=l(rt);function rt(){var i;r(this,rt);i=t.call(this);i._annotations=[];i._backgroundConfig={duration:0,fill:"transparent"};i._barPadding=0;i._buffer={Bar:p,Box:b,Circle:k,Line:C,Rect:w};i._confidenceConfig={fill:function e(t,n){var r=typeof i._shapeConfig.Line.stroke==="function"?i._shapeConfig.Line.stroke(t,n):i._shapeConfig.Line.stroke;return r},fillOpacity:it.constant(.5)};i._discreteCutoff=100;i._groupPadding=5;i._lineMarkerConfig={fill:function e(t,n){return a.colorAssign(i._id(t,n))},r:it.constant(3)};i._lineMarkers=false;i._previousShapes=[];i._shape=it.constant("Circle");i._shapeConfig=it.assign(i._shapeConfig,{Area:{label:function e(t,n){return i._stacked?i._drawLabel(t,n):false},labelConfig:{fontResize:true}},ariaLabel:function e(t,n){var r="";if(t.nested)r="".concat(i._drawLabel(t.data,t.i));else{r="".concat(i._drawLabel(t,n));if(i._x(t,n)!==undefined)r+=", x: ".concat(i._x(t,n));if(i._y(t,n)!==undefined)r+=", y: ".concat(i._y(t,n));if(i._x2(t,n)!==undefined)r+=", x2: ".concat(i._x2(t,n));if(i._y2(t,n)!==undefined)r+=", y2: ".concat(i._y2(t,n))}return"".concat(r,".")},Bar:{labelConfig:{textAnchor:function e(){return i._discrete==="x"?"middle":"end"},verticalAlign:function e(){return i._discrete==="x"?"top":"middle"}}},Circle:{r:A.bind(u(i))},Line:{fill:it.constant("none"),labelConfig:{fontColor:function e(t,n){var r=typeof i._shapeConfig.Line.stroke==="function"?i._shapeConfig.Line.stroke(t,n):i._shapeConfig.Line.stroke;return a.colorLegible(r)},fontResize:false,padding:5,textAnchor:"start",verticalAlign:"middle"},stroke:function e(t,n){return a.colorAssign(i._id(t,n))},strokeWidth:it.constant(2)},Rect:{height:function e(t){return A.bind(u(i))(t)*2},width:function e(t){return A.bind(u(i))(t)*2}}});i._shapeOrder=["Area","Path","Bar","Box","Line","Rect","Circle"];i._shapeSort=function(e,t){return i._shapeOrder.indexOf(e)-i._shapeOrder.indexOf(t)};i._sizeMax=20;i._sizeMin=5;i._sizeScale="sqrt";i._stackOffset=T;i._stackOrder=P;i._timelineConfig=it.assign(i._timelineConfig,{brushing:true});i._x=it.accessor("x");i._xAxis=(new ut.AxisBottom).align("end");i._xTest=(new ut.AxisBottom).align("end").gridSize(0);i._xConfig={};i._xCutoff=150;i._x2=it.accessor("x2");i._x2Axis=(new ut.AxisTop).align("start");i._x2Test=(new ut.AxisTop).align("start").gridSize(0);i._x2Config={padding:0};i._y=it.accessor("y");i._yAxis=(new ut.AxisLeft).align("start");i._yTest=(new ut.AxisLeft).align("start").gridSize(0);i._yConfig={gridConfig:{stroke:function e(t){var n=i._yAxis.range();return n[n.length-1]===i._yAxis._getPosition.bind(i._yAxis)(t.id)?"transparent":"#ccc"}}};i._yCutoff=150;i._y2=it.accessor("y2");i._y2Axis=(new ut.AxisRight).align("end");i._y2Test=(new ut.AxisLeft).align("end").gridSize(0);i._y2Config={};return i}n(rt,[{key:"_draw",value:function e(t){var B=this;if(!this._filteredData.length)return this;var s=function e(t,n){return B._stacked?"".concat(B._groupBy.length>1?B._ids(t,n).slice(0,-1).join("_"):"group"):"".concat(B._ids(t,n).join("_"))};var c=this._filteredData.map(function(e,t){return{__d3plus__:true,data:e,group:s(e,t),i:t,hci:B._confidence&&B._confidence[1]&&B._confidence[1](e,t),id:B._ids(e,t).slice(0,B._drawDepth+1).join("_"),lci:B._confidence&&B._confidence[0]&&B._confidence[0](e,t),shape:B._shape(e,t),x:B._x(e,t),x2:B._x2(e,t),y:B._y(e,t),y2:B._y2(e,t)}});this._formattedData=c;if(this._size){var n=at.extent(c,function(e){return B._size(e.data)});this._sizeScaleD3=function(){return B._sizeMin};this._sizeScaleD3=st["scale".concat(this._sizeScale.charAt(0).toUpperCase()).concat(this._sizeScale.slice(1))]().domain(n).range([n[0]===n[1]?this._sizeMax:at.min([this._sizeMax/2,this._sizeMin]),this._sizeMax])}else{this._sizeScaleD3=function(){return B._sizeMin}}var r=c.some(function(e){return e.x2!==undefined}),i=c.some(function(e){return e.y2!==undefined});var a=this._height-this._margin.top-this._margin.bottom,u=this._discrete?this._discrete==="x"?"y":"x":undefined,o=this._discrete?this._discrete==="x"?"y2":"x2":undefined,f=[u,o].filter(function(e){return e}),l=this._select,d=this._transition,R=this._width-this._margin.left-this._margin.right;var h=this._time&&c[0].x2===this._time(c[0].data,c[0].i),v=this._time&&c[0].x===this._time(c[0].data,c[0].i),g=this._time&&c[0].y2===this._time(c[0].data,c[0].i),_=this._time&&c[0].y===this._time(c[0].data,c[0].i);for(var y=0;y<c.length;y++){var p=c[y];if(v)p.x=ut.date(p.x);if(h)p.x2=ut.date(p.x2);if(_)p.y=ut.date(p.y);if(g)p.y2=ut.date(p.y2);p.discrete=p.shape==="Bar"?"".concat(p[this._discrete],"_").concat(p.group):"".concat(p[this._discrete])}var m,x,b,S;if(this._stacked){var k;var C=ot.nest().key(function(e){return e.group}).entries(c).reduce(function(e,t){if(!e[t.key])e[t.key]=0;e[t.key]+=at.sum(t.values,function(e){return e[u]});return e},{});c=c.sort(function(e,t){if(B["_".concat(B._discrete,"Sort")])return B["_".concat(B._discrete,"Sort")](e.data,t.data);var n=e[B._discrete],r=t[B._discrete];if(n-r!==0)return n-r;if(e.group!==t.group)return C[t.group]-C[e.group];return t[u]-e[u]});m=Array.from(new Set(c.map(function(e){return e.discrete})));S=Array.from(new Set(c.map(function(e){return e.id})));b=ot.nest().key(function(e){return e.discrete}).entries(c).map(function(e){return e.values});b.forEach(function(a){var o=Array.from(new Set(a.map(function(e){return e.id})));if(o.length<S.length){S.forEach(function(t){if(!o.includes(t)){var e=c.filter(function(e){return e.id===t})[0];if(e.shape==="Area"){var n;var r=s(e.data,e.i);var i=(n={__d3plus__:true,data:e.data,discrete:e.shape==="Bar"?"".concat(a[0][B._discrete],"_").concat(r):"".concat(a[0][B._discrete]),group:r,id:t,shape:e.shape},ht(n,B._discrete,a[0][B._discrete]),ht(n,u,0),n);c.push(i)}}})}});if(this["_".concat(this._discrete,"Sort")]){c.sort(function(e,t){return B["_".concat(B._discrete,"Sort")](e.data,t.data)})}else{c.sort(function(e,t){return e[B._discrete]-t[B._discrete]})}var w=this._stackOrder;if(w instanceof Array)S.sort(function(e,t){return w.indexOf(e)-w.indexOf(t)});else if(w===ct.stackOrderNone)S.sort(function(e,t){return e.localeCompare(t)});b=ct.stack().keys(S).offset(this._stackOffset).order(w instanceof Array?ct.stackOrderNone:w).value(function(e,t){var n=e.filter(function(e){return e.id===t});return n.length?n[0][u]:0})(b);x=(k={},ht(k,this._discrete,at.extent(c,function(e){return e[B._discrete]})),ht(k,u,[at.min(b.map(function(e){return at.min(e.map(function(e){return e[0]}))})),at.max(b.map(function(e){return at.max(e.map(function(e){return e[1]}))}))]),k)}else{var A=this._discrete||"x";if(this["_".concat(this._discrete,"Sort")]){c.sort(function(e,t){return B["_".concat(B._discrete,"Sort")](e.data,t.data)})}else{c.sort(function(e,t){return e[A]-t[A]})}var O=A==="x"?c.map(function(e){return e.x}):c.map(function(e){return e.x}).concat(this._confidence&&this._confidence[0]?c.map(function(e){return e.lci}):[]).concat(this._confidence&&this._confidence[1]?c.map(function(e){return e.hci}):[]);var P=A==="x"?c.map(function(e){return e.x2}):c.map(function(e){return e.x2}).concat(this._confidence&&this._confidence[0]?c.map(function(e){return e.lci}):[]).concat(this._confidence&&this._confidence[1]?c.map(function(e){return e.hci}):[]);var z=A==="y"?c.map(function(e){return e.y}):c.map(function(e){return e.y}).concat(this._confidence&&this._confidence[0]?c.map(function(e){return e.lci}):[]).concat(this._confidence&&this._confidence[1]?c.map(function(e){return e.hci}):[]);var T=A==="y"?c.map(function(e){return e.y2}):c.map(function(e){return e.y2}).concat(this._confidence&&this._confidence[0]?c.map(function(e){return e.lci}):[]).concat(this._confidence&&this._confidence[1]?c.map(function(e){return e.hci}):[]);x={x:this._xSort?Array.from(new Set(c.filter(function(e){return e.x}).sort(function(e,t){return B._xSort(e.data,t.data)}).map(function(e){return e.x}))):at.extent(O,function(e){return e}),x2:this._x2Sort?Array.from(new Set(c.filter(function(e){return e.x2}).sort(function(e,t){return B._x2Sort(e.data,t.data)}).map(function(e){return e.x2}))):at.extent(P,function(e){return e}),y:this._ySort?Array.from(new Set(c.filter(function(e){return e.y}).sort(function(e,t){return B._ySort(e.data,t.data)}).map(function(e){return e.y}))):at.extent(z,function(e){return e}),y2:this._y2Sort?Array.from(new Set(c.filter(function(e){return e.y2}).sort(function(e,t){return B._y2Sort(e.data,t.data)}).map(function(e){return e.y2}))):at.extent(T,function(e){return e})}}var N=this._xDomain?this._xDomain.slice():x.x,W=this._xSort?"Point":"Linear";if(N[0]===void 0)N[0]=x.x[0];if(N[1]===void 0)N[1]=x.x[1];if(v){N=N.map(ut.date);W="Time"}else if(this._discrete==="x"){if(!this._xDomain)N=Array.from(new Set(c.filter(function(e){return["number","string"].includes(dt(e.x))}).sort(function(e,t){return B._xSort?B._xSort(e.data,t.data):e.x-t.x}).map(function(e){return e.x})));W="Point"}var j=this._x2Domain?this._x2Domain.slice():x.x2,L=this._x2Sort?"Point":"Linear";if(j&&j[0]===void 0)j[0]=x.x2[0];if(j&&j[1]===void 0)j[1]=x.x2[1];if(h){j=j.map(ut.date);L="Time"}else if(this._discrete==="x"){if(!this._x2Domain)j=Array.from(new Set(c.filter(function(e){return["number","string"].includes(dt(e.x2))}).sort(function(e,t){return B._x2Sort?B._x2Sort(e.data,t.data):e.x2-t.x2}).map(function(e){return e.x2})));L="Point"}var q=this._yDomain?this._yDomain.slice():x.y,F=this._ySort?"Point":"Linear";if(q[0]===void 0)q[0]=x.y[0];if(q[1]===void 0)q[1]=x.y[1];var M=this._y2Domain?this._y2Domain.slice():x.y2,D=this._y2Sort?"Point":"Linear";if(M&&M[0]===void 0)M[0]=x.y2[0];if(M&&M[1]===void 0)M[1]=x.y2[1];if(_){q=q.map(ut.date);F="Time"}else if(this._discrete==="y"){if(!this._yDomain)q=Array.from(new Set(c.filter(function(e){return["number","string"].includes(dt(e.y))}).sort(function(e,t){return B._ySort?B._ySort(e.data,t.data):e.y-t.y}).map(function(e){return e.y})));F="Point";if(!this._y2Domain)M=Array.from(new Set(c.filter(function(e){return["number","string"].includes(dt(e.y2))}).sort(function(e,t){return B._y2Sort?B._y2Sort(e.data,t.data):e.y2-t.y2}).map(function(e){return e.y2})));D="Point"}if(g){M=M.map(ut.date);D="Time"}var E=function e(t,n){var r=B["_".concat(t,"Config")].scale;if(r==="auto"){if(B._discrete===t)return n;var i=c.map(function(e){return e[t]});return at.deviation(i)/at.mean(i)>3?"log":"linear"}return r||n};var I=this._yConfigScale=E("y",F).toLowerCase();var V=this._y2ConfigScale=E("y2",D).toLowerCase();var G=this._xConfigScale=E("x",W).toLowerCase();var H=this._x2ConfigScale=E("x2",L).toLowerCase();x={x:N,x2:j||N,y:q,y2:M||q};Object.keys(x).forEach(function(t){if(B["_".concat(t,"ConfigScale")]==="log"&&x[t].includes(0)){if(at.min(x[t])<0)x[t][1]=at.max(c.map(function(e){return e[t]}).filter(Boolean));else x[t][0]=at.min(c.map(function(e){return e[t]}).filter(Boolean))}});f.forEach(function(e){if(B["_".concat(e,"Config")].domain){var t=B["_".concat(e,"Config")].domain;if(B._discrete==="x")t.reverse();x[e]=t}else if(e&&B._baseline!==void 0){var n=B._baseline;if(x[e]&&x[e][0]>n)x[e][0]=n;else if(x[e]&&x[e][1]<n)x[e][1]=n}});var U=st["scale".concat(W)]().domain(x.x).range(at.range(0,R+1,R/(x.x.length-1))),K=st["scale".concat(L)]().domain(x.x2).range(at.range(0,R+1,R/(x.x2.length-1))),X=st["scale".concat(F)]().domain(x.y.reverse()).range(at.range(0,a+1,a/(x.y.length-1))),Y=st["scale".concat(D)]().domain(x.y2.reverse()).range(at.range(0,a+1,a/(x.y2.length-1)));var $=ot.nest().key(function(e){return e.shape}).entries(c).sort(function(e,t){return B._shapeSort(e.key,t.key)});var J=this._discrete==="x"?F:W;if(J!=="Point"){$.forEach(function(e){if(B._buffer[e.key]){var t=B._buffer[e.key].bind(B)({data:e.values,x:U,y:X,yScale:I,xScale:G,config:B._shapeConfig[e.key]});U=t[0];X=t[1];var n=B._buffer[e.key].bind(B)({data:e.values,x:K,y:Y,yScale:V,xScale:H,x2:true,y2:true,config:B._shapeConfig[e.key]});K=n[0];Y=n[1]}})}N=U.domain();j=K.domain();q=X.domain();M=Y.domain();var Q={barConfig:{"stroke-width":0},gridSize:0,labels:[],title:false,tickSize:0};var Z=r?{}:Q;var ee=i?{}:Q;var te=this._discrete==="x"&&this._width>this._discreteCutoff||this._width>this._xCutoff;var ne=this._discrete==="y"&&this._height>this._discreteCutoff||this._height>this._yCutoff;var re={gridConfig:{stroke:!this._discrete||this._discrete==="x"?this._yTest.gridConfig().stroke:"transparent"},locale:this._locale,scalePadding:X.padding?X.padding():0};if(!te){re.barConfig={stroke:"transparent"};re.tickSize=0;re.shapeConfig={labelBounds:function e(t,n){var r=t.labelBounds,i=r.width,a=r.y;var o=B._height/2;var s=n?-o:0;return{x:s,y:a,width:i,height:o}},labelConfig:{padding:0,rotate:0,verticalAlign:function e(t){return t.id===ce[0]?"top":"bottom"}},labelRotation:false}}var ie=it.elem("g.d3plus-plot-test",{enter:{opacity:0},parent:this._select}),ae=this._discrete==="x"&&!h?x.x2:undefined,oe=!ne?at.extent(x.x):this._discrete==="x"&&!v?x.x:undefined,se=this._discrete==="y"&&!g?x.y2:undefined,ce=!te?at.extent(x.y):this._discrete==="y"&&!_?x.y:undefined;if(ne){this._yTest.domain(q).height(a).maxSize(R/2).range([undefined,undefined]).select(ie.node()).ticks(ce).width(R).config(re).config(this._yConfig).scale(I).render()}var ue=this._yTest.outerBounds();var fe=ue.width?ue.width+this._yTest.padding():undefined;if(i){this._y2Test.domain(M).height(a).range([undefined,undefined]).select(ie.node()).ticks(se).width(R).config(re).config(ee).config(this._y2Config).scale(V).render()}var le=this._y2Test.outerBounds();var de=le.width?le.width+this._y2Test.padding():undefined;var he={gridConfig:{stroke:!this._discrete||this._discrete==="y"?this._xTest.gridConfig().stroke:"transparent"},locale:this._locale,scalePadding:U.padding?U.padding():0};if(!ne){he.barConfig={stroke:"transparent"};he.tickSize=0;he.shapeConfig={labelBounds:function e(t,n){var r=t.labelBounds,i=r.height,a=r.y;var o=B._width/2;var s=n?-o:0;return{x:s,y:a,width:o,height:i}},labelConfig:{padding:0,rotate:0,textAnchor:function e(t){return t.id===oe[0]?"start":"end"}},labelRotation:false}}var ve=undefined;if(this._lineLabels){var ge=ot.nest().key(function(e){return e.id}).entries(c.filter(function(e){return e.shape==="Line"}));if(ge.length&&ge.length<this._dataCutoff){var _e=it.configPrep.bind(this)(this._shapeConfig,"shape","Line");yt.config(_e);var ye=yt.labelConfig();var pe=ye.fontSize!==undefined?ye.fontSize:pt.fontSize();var me=ye.fontWeight!==undefined?ye.fontWeight:pt.fontWeight();var xe=ye.fontFamily!==undefined?ye.fontFamily:pt.fontFamily();var be=ye.padding!==undefined?ye.padding:pt.padding();var Se=_e.label||this._drawLabel;var ke=ge.map(function(e){var t=e.values[e.values.length-1];var n;while(t.__d3plus__&&t.data){t=t.data;n=t.i}var r=typeof Se==="function"?Se(t,n):Se;var i=typeof pe==="function"?pe(t,n):pe;var a=typeof me==="function"?me(t,n):me;var o=typeof xe==="function"?xe(t,n):xe;if(o instanceof Array)o=o.map(function(e){return"'".concat(e,"'")}).join(", ");var s=typeof be==="function"?be(t,n):be;var c=lt.textWidth(r,{"font-size":i,"font-family":o,"font-weight":a});return c+s*2});var Ce=at.max(ke);var we=at.min([Ce,R/4]);ve=R-we-this._margin.right}}if(te){this._xTest.domain(N).height(a).maxSize(a/2).range([undefined,ve]).select(ie.node()).ticks(oe).width(R).config(he).config(this._xConfig).scale(G).render()}if(r){this._x2Test.domain(j).height(a).range([undefined,ve]).select(ie.node()).ticks(ae).width(R).config(he).tickSize(0).config(Z).config(this._x2Config).scale(H).render()}var Ae=this._xTest._getRange();var Oe=this._x2Test._getRange();var Pe=this._x2Test.outerBounds();var ze=r?Pe.height+this._x2Test.padding():0;var Te=at.max([fe,Ae[0],Oe[0]]);if(te){this._xTest.range([Te,undefined]).render()}var je=ne?this._yTest.shapeConfig().labelConfig.fontSize()/2:0;var Le=at.max([de,R-Ae[1],R-Oe[1]]);var Me=this._xTest.outerBounds();var De=Me.height+(ne?this._xTest.padding():0);this._padding.left+=Te;this._padding.right+=Le;this._padding.bottom+=De;this._padding.top+=ze+je;gt(vt(rt.prototype),"_draw",this).call(this,t);var Ee=this._margin.left+this._margin.right;var Be=this._margin.top+this._margin.bottom;var Re=[ze,a-(De+je+Be)];if(ne){this._yTest.domain(q).height(a).maxSize(R/2).range(Re).select(ie.node()).ticks(ce).width(R).config(re).config(this._yConfig).scale(I).render()}ue=this._yTest.outerBounds();fe=ue.width?ue.width+this._yTest.padding():undefined;Te=at.max([fe,Ae[0],Oe[0]]);if(i){this._y2Test.config(re).domain(M).gridSize(0).height(a).range(Re).select(ie.node()).width(R-at.max([0,Le-de])).title(false).config(this._y2Config).config(ee).scale(V).render()}le=this._y2Test.outerBounds();de=le.width?le.width+this._y2Test.padding():undefined;Le=at.max([0,de,R-Ae[1],R-Oe[1]]);var Ne=[Te,R-(Le+Ee)];var We=it.elem("g.d3plus-plot-background",{parent:l,transition:d});var qe="translate(".concat(this._margin.left,", ").concat(this._margin.top+ze+je,")");var Fe="translate(".concat(this._margin.left,", ").concat(this._margin.top+je,")");var Ie=te&&it.elem("g.d3plus-plot-x-axis",{parent:l,transition:d,enter:{transform:qe},update:{transform:qe}});var Ve=r&&it.elem("g.d3plus-plot-x2-axis",{parent:l,transition:d,enter:{transform:Fe},update:{transform:Fe}});var Ge=Te>fe?Te-fe:0;var He="translate(".concat(this._margin.left+Ge,", ").concat(this._margin.top+je,")");var Ue=ne&&it.elem("g.d3plus-plot-y-axis",{parent:l,transition:d,enter:{transform:He},update:{transform:He}});var Ke="translate(-".concat(this._margin.right,", ").concat(this._margin.top+je,")");var Xe=i&&it.elem("g.d3plus-plot-y2-axis",{parent:l,transition:d,enter:{transform:Ke},update:{transform:Ke}});this._xAxis.domain(N).height(a-(ze+je+Be)).maxSize(a/2).range(Ne).select(te?Ie.node():undefined).ticks(oe).width(R).config(he).config(this._xConfig).scale(G).render();if(r){this._x2Axis.domain(j).height(a-(De+je+Be)).range(Ne).select(Ve.node()).ticks(ae).width(R).config(he).config(Z).config(this._x2Config).scale(H).render()}U=function e(t,n){if(n==="x2"){if(H==="log"&&t===0)t=j[0]<0?B._x2Axis._d3Scale.domain()[1]:B._x2Axis._d3Scale.domain()[0];return B._x2Axis._getPosition.bind(B._x2Axis)(t)}else{if(G==="log"&&t===0)t=N[0]<0?B._xAxis._d3Scale.domain()[1]:B._xAxis._d3Scale.domain()[0];return B._xAxis._getPosition.bind(B._xAxis)(t)}};Re=[this._xAxis.outerBounds().y+ze,a-(De+je+Be)];this._yAxis.domain(q).height(a).maxSize(R/2).range(Re).select(ne?Ue.node():undefined).ticks(ce).width(Ne[Ne.length-1]).config(re).config(this._yConfig).scale(I).render();if(i){this._y2Axis.config(re).domain(i?M:q).gridSize(0).height(a).range(Re).select(Xe.node()).width(R-at.max([0,Le-de])).title(false).config(this._y2Config).config(ee).scale(V).render()}X=function e(t,n){if(n==="y2"){if(V==="log"&&t===0)t=M[1]<0?B._y2Axis._d3ScaleNegative.domain()[0]:B._y2Axis._d3Scale.domain()[1];return B._y2Axis._getPosition.bind(B._y2Axis)(t)-ze}else{if(I==="log"&&t===0)t=q[1]<0?B._yAxis._d3ScaleNegative.domain()[0]:B._yAxis._d3Scale.domain()[1];return B._yAxis._getPosition.bind(B._yAxis)(t)-ze}};(new ft.Rect).data([{}]).select(We.node()).x(Ne[0]+(Ne[1]-Ne[0])/2).width(Ne[1]-Ne[0]).y(this._margin.top+je+Re[0]+(Re[1]-Re[0])/2).height(Re[1]-Re[0]).config(this._backgroundConfig).render();var Ye=it.elem("g.d3plus-plot-annotations",{parent:l,transition:d,enter:{transform:qe},update:{transform:qe}}).node();this._annotations.forEach(function(e){(new ft[e.shape]).config(e).config({x:function e(t){return t.x2?U(t.x2,"x2"):U(t.x)},x0:B._discrete==="x"?function(e){return e.x2?U(e.x2,"x2"):U(e.x)}:U(x.x[0]),x1:B._discrete==="x"?null:function(e){return e.x2?U(e.x2,"x2"):U(e.x)},y:function e(t){return t.y2?X(t.y2,"y2"):X(t.y)},y0:B._discrete==="y"?function(e){return e.y2?X(e.y2,"y2"):X(e.y)}:X(x.y[1])-$e,y1:B._discrete==="y"?null:function(e){return e.y2?X(e.y2,"y2"):X(e.y)-$e}}).select(Ye).render()});var $e=this._xAxis.barConfig()["stroke-width"];if($e)$e/=2;var Je=this._discrete||"x";var Qe={discrete:this._discrete,duration:this._duration,label:function e(t){return B._drawLabel(t.data,t.i)},select:it.elem("g.d3plus-plot-shapes",{parent:l,transition:d,enter:{transform:qe},update:{transform:qe}}).node(),x:function e(t){return t.x2!==undefined?U(t.x2,"x2"):U(t.x)},x0:Je==="x"?function(e){return e.x2?U(e.x2,"x2"):U(e.x)}:U(typeof this._baseline==="number"?this._baseline:x.x[0]),x1:Je==="x"?null:function(e){return e.x2?U(e.x2,"x2"):U(e.x)},y:function e(t){return t.y2!==undefined?X(t.y2,"y2"):X(t.y)},y0:Je==="y"?function(e){return e.y2?X(e.y2,"y2"):X(e.y)}:X(typeof this._baseline==="number"?this._baseline:x.y[1])-$e,y1:Je==="y"?null:function(e){return e.y2?X(e.y2,"y2"):X(e.y)-$e}};if(this._stacked){var Ze=u==="x"?U:X;Qe["".concat(u)]=Qe["".concat(u,"0")]=function(e){var t=S.indexOf(e.id),n=m.indexOf(e.discrete);return t>=0?Ze(b[t][n][0]):Ze(x[u][u==="x"?0:1])};Qe["".concat(u,"1")]=function(e){var t=S.indexOf(e.id),n=m.indexOf(e.discrete);return t>=0?Ze(b[t][n][1]):Ze(x[u][u==="x"?0:1])}}var et=Object.keys(this._on);$.forEach(function(t){var n=(new ft[t.key]).config(Qe).data(t.values);if(t.key==="Bar"){var e;var r=B._discrete==="x"?U:X;var i=B._discrete==="x"?W:F;var a=B._discrete==="x"?N:q;var o=B._discrete==="x"?Ne:Re;if(i!=="Point"&&a.length===2){e=(r(t.values[B._discrete==="x"?0:t.values.length-1][B._discrete])-r(a[0]))*2}else if(a.length>1)e=r(a[1])-r(a[0]);else e=o[o.length-1]-o[0];if(B._groupPadding<e)e-=B._groupPadding;var s=e||1;var c=ot.nest().key(function(e){return e[B._discrete]}).key(function(e){return e.group}).entries(t.values);var u=at.merge(c.map(function(e){return e.values.map(function(e){return e.key})}));var f=Array.from(new Set(u));if(at.max(c.map(function(e){return e.values.length}))===1){n[B._discrete](function(e,t){return Qe[B._discrete](e,t)})}else{s=(s-B._barPadding*f.length-1)/f.length;var l=e/2-s/2;var d=st.scaleLinear().domain([0,f.length-1]).range([-l,l]);n[B._discrete](function(e,t){return Qe[B._discrete](e,t)+d(f.indexOf(e.group))})}n.width(s);n.height(s)}else if(t.key==="Line"){n.duration(R*1.5);if(B._confidence){var h=Object.assign({},Qe);var v=B._discrete||"x";var g=v==="x"?"y":"x";var _=v==="x"?X:U;h["".concat(g,"0")]=function(e){return _(B._confidence[0]?e.lci:e[g])};h["".concat(g,"1")]=function(e){return _(B._confidence[1]?e.hci:e[g])};var y=(new ft.Area).config(h).data(t.values);var p=Object.assign(B._shapeConfig,B._confidenceConfig);y.config(it.configPrep.bind(B)(p,"shape","Area")).render();B._shapes.push(y)}n.config({discrete:Qe.discrete||"x",label:B._lineLabels?B._drawLabel:false,labelBounds:B._lineLabels?function(e,t,n){var r=_t(n.points[0],2),i=r[0],a=r[1];var o=_t(n.points[n.points.length-1],2),s=o[0],c=o[1];var u=B._height/4;return{x:s-i,y:c-a-u/2,width:B._padding.right,height:u}}:false})}var m=et.filter(function(e){return e.includes(".".concat(t.key))}),x=et.filter(function(e){return!e.includes(".")}),b=et.filter(function(e){return e.includes(".shape")});var S=function e(t){n.on(x[t],function(e){return B._on[x[t]](e.data,e.i)})};for(var k=0;k<x.length;k++){S(k)}var C=function e(t){n.on(b[t],function(e){return B._on[b[t]](e.data,e.i)})};for(var w=0;w<b.length;w++){C(w)}var A=function e(t){n.on(m[t],function(e){return B._on[m[t]](e.data,e.i)})};for(var O=0;O<m.length;O++){A(O)}var P=it.configPrep.bind(B)(B._shapeConfig,"shape",t.key);if(B._shapeConfig.duration===undefined)delete P.duration;n.config(P).render();B._shapes.push(n);if(t.key==="Line"&&B._lineMarkers){var z=(new ft.Circle).data(t.values).config(Qe).config(B._lineMarkerConfig).id(function(e){return"".concat(e.id,"_").concat(e.discrete)});var T=function e(t){z.on(x[t],function(e){return B._on[x[t]](e.data,e.i)})};for(var j=0;j<x.length;j++){T(j)}var L=function e(t){z.on(b[t],function(e){return B._on[b[t]](e.data,e.i)})};for(var M=0;M<b.length;M++){L(M)}var D=function e(t){z.on(m[t],function(e){return B._on[m[t]](e.data,e.i)})};for(var E=0;E<m.length;E++){D(E)}z.render();B._shapes.push(z)}});var tt=$.map(function(e){return e.key});if(tt.includes("Line")){if(this._confidence)tt.push("Area");if(this._labelMarkers)tt.push("Circle")}var nt=this._previousShapes.filter(function(e){return!tt.includes(e)});nt.forEach(function(e){(new ft[e]).config(Qe).data([]).render()});this._previousShapes=tt;return this}},{key:"annotations",value:function e(t){return arguments.length?(this._annotations=t instanceof Array?t:[t],this):this._annotations}},{key:"backgroundConfig",value:function e(t){return arguments.length?(this._backgroundConfig=it.assign(this._backgroundConfig,t),this):this._backgroundConfig}},{key:"barPadding",value:function e(t){return arguments.length?(this._barPadding=t,this):this._barPadding}},{key:"baseline",value:function e(t){return arguments.length?(this._baseline=t,this):this._baseline}},{key:"confidence",value:function e(t){if(arguments.length&&t instanceof Array){this._confidence=[];var n=t[0];this._confidence[0]=typeof n==="function"||!n?n:it.accessor(n);var r=t[1];this._confidence[1]=typeof r==="function"||!r?r:it.accessor(r);return this}else return this._confidence}},{key:"confidenceConfig",value:function e(t){return arguments.length?(this._confidenceConfig=it.assign(this._confidenceConfig,t),this):this._confidenceConfig}},{key:"discrete",value:function e(t){return arguments.length?(this._discrete=t,this):this._discrete}},{key:"discreteCutoff",value:function e(t){return arguments.length?(this._discreteCutoff=t,this):this._discreteCutoff}},{key:"groupPadding",value:function e(t){return arguments.length?(this._groupPadding=t,this):this._groupPadding}},{key:"lineLabels",value:function e(t){return arguments.length?(this._lineLabels=t,this):this._lineLabels}},{key:"lineMarkerConfig",value:function e(t){return arguments.length?(this._lineMarkerConfig=it.assign(this._lineMarkerConfig,t),this):this._lineMarkerConfig}},{key:"lineMarkers",value:function e(t){return arguments.length?(this._lineMarkers=t,this):this._lineMarkers}},{key:"shapeSort",value:function e(t){return arguments.length?(this._shapeSort=t,this):this._shapeSort}},{key:"size",value:function e(t){return arguments.length?(this._size=typeof t==="function"||!t?t:it.accessor(t),this):this._size}},{key:"sizeMax",value:function e(t){return arguments.length?(this._sizeMax=t,this):this._sizeMax}},{key:"sizeMin",value:function e(t){return arguments.length?(this._sizeMin=t,this):this._sizeMin}},{key:"sizeScale",value:function e(t){return arguments.length?(this._sizeScale=t,this):this._sizeScale}},{key:"stacked",value:function e(t){return arguments.length?(this._stacked=t,this):this._stacked}},{key:"stackOffset",value:function e(t){return arguments.length?(this._stackOffset=typeof t==="function"?t:ct["stackOffset".concat(t.charAt(0).toUpperCase()+t.slice(1))],this):this._stackOffset}},{key:"stackOrder",value:function e(t){if(arguments.length){if(typeof t==="string")this._stackOrder=t==="ascending"?O:t==="descending"?P:ct["stackOrder".concat(t.charAt(0).toUpperCase()+t.slice(1))];else this._stackOrder=t;return this}else return this._stackOrder}},{key:"x",value:function e(t){if(arguments.length){if(typeof t==="function")this._x=t;else{this._x=it.accessor(t);if(!this._aggs[t]&&this._discrete==="x"){this._aggs[t]=function(e,t){var n=Array.from(new Set(e.map(t)));return n.length===1?n[0]:n}}}return this}else return this._x}},{key:"x2",value:function e(t){if(arguments.length){if(typeof t==="function")this._x2=t;else{this._x2=it.accessor(t);if(!this._aggs[t]&&this._discrete==="x"){this._aggs[t]=function(e,t){var n=Array.from(new Set(e.map(t)));return n.length===1?n[0]:n}}}return this}else return this._x2}},{key:"xConfig",value:function e(t){return arguments.length?(this._xConfig=it.assign(this._xConfig,t),this):this._xConfig}},{key:"xCutoff",value:function e(t){return arguments.length?(this._xCutoff=t,this):this._xCutoff}},{key:"x2Config",value:function e(t){return arguments.length?(this._x2Config=it.assign(this._x2Config,t),this):this._x2Config}},{key:"xDomain",value:function e(t){return arguments.length?(this._xDomain=t,this):this._xDomain}},{key:"x2Domain",value:function e(t){return arguments.length?(this._x2Domain=t,this):this._x2Domain}},{key:"xSort",value:function e(t){return arguments.length?(this._xSort=t,this):this._xSort}},{key:"x2Sort",value:function e(t){return arguments.length?(this._x2Sort=t,this):this._x2Sort}},{key:"y",value:function e(t){if(arguments.length){if(typeof t==="function")this._y=t;else{this._y=it.accessor(t);if(!this._aggs[t]&&this._discrete==="y"){this._aggs[t]=function(e,t){var n=Array.from(new Set(e.map(t)));return n.length===1?n[0]:n}}}return this}else return this._y}},{key:"y2",value:function e(t){if(arguments.length){if(typeof t==="function")this._y2=t;else{this._y2=it.accessor(t);if(!this._aggs[t]&&this._discrete==="y2"){this._aggs[t]=function(e,t){var n=Array.from(new Set(e.map(t)));return n.length===1?n[0]:n}}}return this}else return this._y2}},{key:"yConfig",value:function e(t){if(arguments.length){if(t.domain)t.domain=t.domain.slice().reverse();this._yConfig=it.assign(this._yConfig,t);return this}return this._yConfig}},{key:"yCutoff",value:function e(t){return arguments.length?(this._yCutoff=t,this):this._yCutoff}},{key:"y2Config",value:function e(t){if(arguments.length){if(t.domain)t.domain=t.domain.slice().reverse();this._y2Config=it.assign(this._y2Config,t);return this}return this._y2Config}},{key:"yDomain",value:function e(t){return arguments.length?(this._yDomain=t,this):this._yDomain}},{key:"y2Domain",value:function e(t){return arguments.length?(this._y2Domain=t,this):this._y2Domain}},{key:"ySort",value:function e(t){return arguments.length?(this._ySort=t,this):this._ySort}},{key:"y2Sort",value:function e(t){return arguments.length?(this._y2Sort=t,this):this._y2Sort}}]);return rt}(t.Viz);var L=function(e){o(n,e);var t=l(n);function n(){var e;r(this,n);e=t.call(this);e._baseline=0;e._discrete="x";e._shape=it.constant("Area");e.x("x");return e}return n}(j);var M=function(e){o(n,e);var t=l(n);function n(){var e;r(this,n);e=t.call(this);e._baseline=0;e._discrete="x";e._shape=it.constant("Bar");e.x("x");return e}return n}(j);var D=function(e){o(n,e);var t=l(n);function n(){var i;r(this,n);i=t.call(this);i._discrete="x";i._shape=it.constant("Box");i.x("x");i._tooltipConfig=it.assign(i._tooltipConfig,{title:function e(t,n){if(!t)return"";while(t.__d3plus__&&t.data){t=t.data;n=t.i}if(i._label)return i._label(t,n);var r=i._ids(t,n).slice(0,i._drawDepth);return r[r.length-1]}});return i}return n}(j);var E=function(e){o(n,e);var t=l(n);function n(){var o;r(this,n);o=t.call(this);o._discrete="x";o._shape=it.constant("Line");o.x("x");o.y2(function(e){return o._y(e)});o.yConfig({tickFormat:function e(t){var n=o._formattedData;var r=n[0].x instanceof Date?n[0].x.getTime():n[0].x;var i=n.filter(function(e){return(e.x instanceof Date?e.x.getTime():e.x)===r});var a=i.find(function(e){return e.y===t});return a?o._drawLabel(a,a.i):""}});o.y2Config({tickFormat:function e(t){var n=o._formattedData;var r=n[n.length-1].x instanceof Date?n[n.length-1].x.getTime():n[n.length-1].x;var i=n.filter(function(e){return(e.x instanceof Date?e.x.getTime():e.x)===r});var a=i.find(function(e){return e.y===t});return a?o._drawLabel(a,a.i):""}});o.ySort(function(e,t){return o._y(t)-o._y(e)});o.y2Sort(function(e,t){return o._y(t)-o._y(e)});return o}return n}(j);var B=function(e){o(n,e);var t=l(n);function n(){var e;r(this,n);e=t.call(this);e._discrete="x";e._shape=it.constant("Line");e.x("x");return e}return n}(j);var R=Math.PI*2;var N=function(e){o(m,e);var t=l(m);function m(){var e;r(this,m);e=t.call(this);e._axisConfig={shapeConfig:{fill:it.constant("none"),labelConfig:{fontColor:"#000",padding:0,textAnchor:function e(t,n,r){return r.textAnchor},verticalAlign:"middle"},stroke:"#ccc",strokeWidth:it.constant(1)}};e._discrete="metric";e._levels=6;e._metric=it.accessor("metric");e._outerPadding=100;e._shape=it.constant("Path");e._value=it.accessor("value");return e}n(m,[{key:"_draw",value:function e(t){var h=this;gt(vt(m.prototype),"_draw",this).call(this,t);var u=this._height-this._margin.top-this._margin.bottom,f=this._width-this._margin.left-this._margin.right;var v=at.min([u,f])/2-this._outerPadding,n="translate(".concat(f/2,", ").concat(u/2,")");var r=ot.nest().key(this._metric).entries(this._filteredData),i=ot.nest().key(this._id).key(this._metric).entries(this._filteredData);var a=at.max(i.map(function(e){return e.values.map(function(e){return at.sum(e.values,function(e,t){return h._value(e,t)})})}).flat());var o=Array.from(Array(this._levels).keys()).map(function(e){return{id:e,r:v*((e+1)/h._levels)}});var s=it.configPrep.bind(this)(this._axisConfig.shapeConfig,"shape","Circle");delete s.label;(new ft.Circle).data(o).select(it.elem("g.d3plus-Radar-radial-circles",{parent:this._select,enter:{transform:n},update:{transform:n}}).node()).config(s).render();var g=r.length;var c=r.map(function(e,t){var n=h._outerPadding;var r=h._shapeConfig.labelConfig.fontSize&&h._shapeConfig.labelConfig.fontSize(e,t)||11;var i=r*1.4;var a=i*2;var o=10,s=parseInt(360-360/g*t/90,10)%4+1,c=R/g*t;var u=360/g*t;var f="start";var l=o;if(s===2||s===3){l=-n-o;f="end";u+=180}var d={x:l,y:-a/2,width:n,height:a};return{__d3plus__:true,data:it.merge(e.values,h._aggs),i:t,id:e.key,angle:u,textAnchor:f,labelBounds:d,rotateAnchor:[-l,a/2],x:v*Math.cos(c),y:v*Math.sin(c)}}).sort(function(e,t){return e.key-t.key});(new ft.Rect).data(c).rotate(function(e){return e.angle||0}).width(0).height(0).x(function(e){return e.x}).y(function(e){return e.y}).label(function(e){return e.id}).labelBounds(function(e){return e.labelBounds}).labelConfig(this._axisConfig.shapeConfig.labelConfig).select(it.elem("g.d3plus-Radar-text",{parent:this._select,enter:{transform:n},update:{transform:n}}).node()).render();(new ft.Path).data(c).d(function(e){return"M".concat(0,",",0," ",-e.x,",").concat(-e.y)}).select(it.elem("g.d3plus-Radar-axis",{parent:this._select,enter:{transform:n},update:{transform:n}}).node()).config(it.configPrep.bind(this)(this._axisConfig.shapeConfig,"shape","Path")).render();var l=i.map(function(e){var t=e.values.map(function(e,t){var n=at.sum(e.values,function(e,t){return h._value(e,t)});var r=n/a*v,i=R/g*t;return{x:r*Math.cos(i),y:r*Math.sin(i)}});var n="M ".concat(t[0].x," ").concat(t[0].y," ").concat(t.map(function(e){return"L ".concat(e.x," ").concat(e.y)}).join(" ")," L ").concat(t[0].x," ").concat(t[0].y);return{arr:e.values.map(function(e){return it.merge(e.values,h._aggs)}),id:e.key,points:t,d:n,__d3plus__:true,data:it.merge(e.values.map(function(e){return it.merge(e.values,h._aggs)}),h._aggs)}});var d=it.configPrep.bind(this)(this._shapeConfig,"shape","Path");var _=Object.keys(d.on);d.on={};var y=function e(t){var c=_[t];d.on[c]=function(e,t){var n=e.points.map(function(e){return e.x+f/2});var r=e.points.map(function(e){return e.y+u/2});var i=x.mouse(h._select.node());var a=n.map(function(e){return Math.abs(e-i[0])});var o=r.map(function(e){return Math.abs(e-i[1])});var s=a.map(function(e,t){return e+o[t]});h._on[c].bind(h)(e.arr[s.indexOf(at.min(s))],t)}};for(var p=0;p<_.length;p++){y(p)}this._shapes.push((new ft.Path).data(l).d(function(e){return e.d}).select(it.elem("g.d3plus-Radar-items",{parent:this._select,enter:{transform:n},update:{transform:n}}).node()).config(d).render());return this}},{key:"axisConfig",value:function e(t){return arguments.length?(this._axisConfig=it.assign(this._axisConfig,t),this):this._axisConfig}},{key:"metric",value:function e(t){return arguments.length?(this._metric=typeof t==="function"?t:it.accessor(t),this):this._metric}},{key:"outerPadding",value:function e(t){return arguments.length?(this._outerPadding=t,this):this._outerPadding}},{key:"value",value:function e(t){return arguments.length?(this._value=typeof t==="function"?t:it.accessor(t),this):this._value}}]);return m}(t.Viz);var W=function(e){o(n,e);var t=l(n);function n(){var e;r(this,n);e=t.call(this);e._stacked=true;return e}return n}(L);e.AreaPlot=L;e.BarChart=M;e.BoxWhisker=D;e.BumpChart=E;e.LinePlot=B;e.Plot=j;e.Radar=N;e.StackedArea=W;Object.defineProperty(e,"__esModule",{value:true})});