/*
  d3plus-plot v0.8.36
  A reusable javascript x/y plot built on D3.
  Copyright (c) 2020 D3plus - https://d3plus.org
  @license MIT
*/
(function(e){typeof define==="function"&&define.amd?define(e):e()})(function(){"use strict";var e=typeof globalThis!=="undefined"?globalThis:typeof window!=="undefined"?window:typeof global!=="undefined"?global:typeof self!=="undefined"?self:{};function t(e,t){return t={exports:{}},e(t,t.exports),t.exports}var n=function(e){return e&&e.Math==Math&&e};var l=n(typeof globalThis=="object"&&globalThis)||n(typeof window=="object"&&window)||n(typeof self=="object"&&self)||n(typeof e=="object"&&e)||Function("return this")();var r=function(e){try{return!!e()}catch(e){return true}};var h=!r(function(){return Object.defineProperty({},"a",{get:function(){return 7}}).a!=7});var i={}.propertyIsEnumerable;var a=Object.getOwnPropertyDescriptor;var o=a&&!i.call({1:2},1);var s=o?function e(t){var n=a(this,t);return!!n&&n.enumerable}:i;var v={f:s};var c=function(e,t){return{enumerable:!(e&1),configurable:!(e&2),writable:!(e&4),value:t}};var u={}.toString;var f=function(e){return u.call(e).slice(8,-1)};var d="".split;var m=r(function(){return!Object("z").propertyIsEnumerable(0)})?function(e){return f(e)=="String"?d.call(e,""):Object(e)}:Object;var _=function(e){if(e==undefined)throw TypeError("Can't call method on "+e);return e};var g=function(e){return m(_(e))};var y=function(e){return typeof e==="object"?e!==null:typeof e==="function"};var p=function(e,t){if(!y(e))return e;var n,r;if(t&&typeof(n=e.toString)=="function"&&!y(r=n.call(e)))return r;if(typeof(n=e.valueOf)=="function"&&!y(r=n.call(e)))return r;if(!t&&typeof(n=e.toString)=="function"&&!y(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")};var x={}.hasOwnProperty;var b=function(e,t){return x.call(e,t)};var w=l.document;var k=y(w)&&y(w.createElement);var S=function(e){return k?w.createElement(e):{}};var C=!h&&!r(function(){return Object.defineProperty(S("div"),"a",{get:function(){return 7}}).a!=7});var O=Object.getOwnPropertyDescriptor;var A=h?O:function e(t,n){t=g(t);n=p(n,true);if(C)try{return O(t,n)}catch(e){}if(b(t,n))return c(!v.f.call(t,n),t[n])};var P={f:A};var T=function(e){if(!y(e)){throw TypeError(String(e)+" is not an object")}return e};var z=Object.defineProperty;var j=h?z:function e(t,n,r){T(t);n=p(n,true);T(r);if(C)try{return z(t,n,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported");if("value"in r)t[n]=r.value;return t};var M={f:j};var D=h?function(e,t,n){return M.f(e,t,c(1,n))}:function(e,t,n){e[t]=n;return e};var L=function(t,n){try{D(l,t,n)}catch(e){l[t]=n}return n};var E="__core-js_shared__";var B=l[E]||L(E,{});var R=B;var q=t(function(e){(e.exports=function(e,t){return R[e]||(R[e]=t!==undefined?t:{})})("versions",[]).push({version:"3.4.7",mode:"global",copyright:"Â© 2019 Denis Pushkarev (zloirock.ru)"})});var N=Function.toString;var F=q("inspectSource",function(e){return N.call(e)});var I=l.WeakMap;var W=typeof I==="function"&&/native code/.test(F(I));var V=0;var G=Math.random();var H=function(e){return"Symbol("+String(e===undefined?"":e)+")_"+(++V+G).toString(36)};var U=q("keys");var K=function(e){return U[e]||(U[e]=H(e))};var Y={};var J=l.WeakMap;var Q,X,Z;var $=function(e){return Z(e)?X(e):Q(e,{})};var ee=function(n){return function(e){var t;if(!y(e)||(t=X(e)).type!==n){throw TypeError("Incompatible receiver, "+n+" required")}return t}};if(W){var te=new J;var ne=te.get;var re=te.has;var ie=te.set;Q=function(e,t){ie.call(te,e,t);return t};X=function(e){return ne.call(te,e)||{}};Z=function(e){return re.call(te,e)}}else{var ae=K("state");Y[ae]=true;Q=function(e,t){D(e,ae,t);return t};X=function(e){return b(e,ae)?e[ae]:{}};Z=function(e){return b(e,ae)}}var oe={set:Q,get:X,has:Z,enforce:$,getterFor:ee};var se=t(function(e){var t=oe.get;var s=oe.enforce;var c=String(String).split("String");(e.exports=function(e,t,n,r){var i=r?!!r.unsafe:false;var a=r?!!r.enumerable:false;var o=r?!!r.noTargetGet:false;if(typeof n=="function"){if(typeof t=="string"&&!b(n,"name"))D(n,"name",t);s(n).source=c.join(typeof t=="string"?t:"")}if(e===l){if(a)e[t]=n;else L(t,n);return}else if(!i){delete e[t]}else if(!o&&e[t]){a=true}if(a)e[t]=n;else D(e,t,n)})(Function.prototype,"toString",function e(){return typeof this=="function"&&t(this).source||F(this)})});var ce=l;var ue=function(e){return typeof e=="function"?e:undefined};var fe=function(e,t){return arguments.length<2?ue(ce[e])||ue(l[e]):ce[e]&&ce[e][t]||l[e]&&l[e][t]};var le=Math.ceil;var de=Math.floor;var he=function(e){return isNaN(e=+e)?0:(e>0?de:le)(e)};var ve=Math.min;var _e=function(e){return e>0?ve(he(e),9007199254740991):0};var ge=Math.max;var ye=Math.min;var pe=function(e,t){var n=he(e);return n<0?ge(n+t,0):ye(n,t)};var xe=function(s){return function(e,t,n){var r=g(e);var i=_e(r.length);var a=pe(n,i);var o;if(s&&t!=t)while(i>a){o=r[a++];if(o!=o)return true}else for(;i>a;a++){if((s||a in r)&&r[a]===t)return s||a||0}return!s&&-1}};var me={includes:xe(true),indexOf:xe(false)};var be=me.indexOf;var we=function(e,t){var n=g(e);var r=0;var i=[];var a;for(a in n)!b(Y,a)&&b(n,a)&&i.push(a);while(t.length>r)if(b(n,a=t[r++])){~be(i,a)||i.push(a)}return i};var ke=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"];var Se=ke.concat("length","prototype");var Ce=Object.getOwnPropertyNames||function e(t){return we(t,Se)};var Oe={f:Ce};var Ae=Object.getOwnPropertySymbols;var Pe={f:Ae};var Te=fe("Reflect","ownKeys")||function e(t){var n=Oe.f(T(t));var r=Pe.f;return r?n.concat(r(t)):n};var ze=function(e,t){var n=Te(t);var r=M.f;var i=P.f;for(var a=0;a<n.length;a++){var o=n[a];if(!b(e,o))r(e,o,i(t,o))}};var je=/#|\.prototype\./;var Me=function(e,t){var n=Le[De(e)];return n==Be?true:n==Ee?false:typeof t=="function"?r(t):!!t};var De=Me.normalize=function(e){return String(e).replace(je,".").toLowerCase()};var Le=Me.data={};var Ee=Me.NATIVE="N";var Be=Me.POLYFILL="P";var Re=Me;var qe=P.f;var Ne=function(e,t){var n=e.target;var r=e.global;var i=e.stat;var a,o,s,c,u,f;if(r){o=l}else if(i){o=l[n]||L(n,{})}else{o=(l[n]||{}).prototype}if(o)for(s in t){u=t[s];if(e.noTargetGet){f=qe(o,s);c=f&&f.value}else c=o[s];a=Re(r?s:n+(i?".":"#")+s,e.forced);if(!a&&c!==undefined){if(typeof u===typeof c)continue;ze(u,c)}if(e.sham||c&&c.sham){D(u,"sham",true)}se(o,s,u,e)}};var Fe=function(e){if(typeof e!="function"){throw TypeError(String(e)+" is not a function")}return e};var Ie=function(r,i,e){Fe(r);if(i===undefined)return r;switch(e){case 0:return function(){return r.call(i)};case 1:return function(e){return r.call(i,e)};case 2:return function(e,t){return r.call(i,e,t)};case 3:return function(e,t,n){return r.call(i,e,t,n)}}return function(){return r.apply(i,arguments)}};var We=function(e){return Object(_(e))};var Ve=Array.isArray||function e(t){return f(t)=="Array"};var Ge=!!Object.getOwnPropertySymbols&&!r(function(){return!String(Symbol())});var He=Ge&&!Symbol.sham&&typeof Symbol()=="symbol";var Ue=q("wks");var Ke=l.Symbol;var Ye=He?Ke:H;var Je=function(e){if(!b(Ue,e)){if(Ge&&b(Ke,e))Ue[e]=Ke[e];else Ue[e]=Ye("Symbol."+e)}return Ue[e]};var Qe=Je("species");var Xe=function(e,t){var n;if(Ve(e)){n=e.constructor;if(typeof n=="function"&&(n===Array||Ve(n.prototype)))n=undefined;else if(y(n)){n=n[Qe];if(n===null)n=undefined}}return new(n===undefined?Array:n)(t===0?0:t)};var Ze=[].push;var $e=function(h){var v=h==1;var _=h==2;var g=h==3;var y=h==4;var p=h==6;var x=h==5||p;return function(e,t,n,r){var i=We(e);var a=m(i);var o=Ie(t,n,3);var s=_e(a.length);var c=0;var u=r||Xe;var f=v?u(e,s):_?u(e,0):undefined;var l,d;for(;s>c;c++)if(x||c in a){l=a[c];d=o(l,c,i);if(h){if(v)f[c]=d;else if(d)switch(h){case 3:return true;case 5:return l;case 6:return c;case 2:Ze.call(f,l)}else if(y)return false}}return p?-1:g||y?y:f}};var et={forEach:$e(0),map:$e(1),filter:$e(2),some:$e(3),every:$e(4),find:$e(5),findIndex:$e(6)};var tt=Object.keys||function e(t){return we(t,ke)};var nt=h?Object.defineProperties:function e(t,n){T(t);var r=tt(n);var i=r.length;var a=0;var o;while(i>a)M.f(t,o=r[a++],n[o]);return t};var rt=fe("document","documentElement");var it=K("IE_PROTO");var at="prototype";var ot=function(){};var st=function(){var e=S("iframe");var t=ke.length;var n="<";var r="script";var i=">";var a="java"+r+":";var o;e.style.display="none";rt.appendChild(e);e.src=String(a);o=e.contentWindow.document;o.open();o.write(n+r+i+"document.F=Object"+n+"/"+r+i);o.close();st=o.F;while(t--)delete st[at][ke[t]];return st()};var ct=Object.create||function e(t,n){var r;if(t!==null){ot[at]=T(t);r=new ot;ot[at]=null;r[it]=t}else r=st();return n===undefined?r:nt(r,n)};Y[it]=true;var ut=Je("unscopables");var ft=Array.prototype;if(ft[ut]==undefined){D(ft,ut,ct(null))}var lt=function(e){ft[ut][e]=true};var dt=et.find;var ht="find";var vt=true;if(ht in[])Array(1)[ht](function(){vt=false});Ne({target:"Array",proto:true,forced:vt},{find:function e(t){return dt(this,t,arguments.length>1?arguments[1]:undefined)}});lt(ht);var _t=me.includes;Ne({target:"Array",proto:true},{includes:function e(t){return _t(this,t,arguments.length>1?arguments[1]:undefined)}});lt("includes");var gt=Object.assign;var yt=Object.defineProperty;var pt=!gt||r(function(){if(h&&gt({b:1},gt(yt({},"a",{enumerable:true,get:function(){yt(this,"b",{value:3,enumerable:false})}}),{b:2})).b!==1)return true;var e={};var t={};var n=Symbol();var r="abcdefghijklmnopqrst";e[n]=7;r.split("").forEach(function(e){t[e]=e});return gt({},e)[n]!=7||tt(gt({},t)).join("")!=r})?function e(t,n){var r=We(t);var i=arguments.length;var a=1;var o=Pe.f;var s=v.f;while(i>a){var c=m(arguments[a++]);var u=o?tt(c).concat(o(c)):tt(c);var f=u.length;var l=0;var d;while(f>l){d=u[l++];if(!h||s.call(c,d))r[d]=c[d]}}return r}:gt;Ne({target:"Object",stat:true,forced:Object.assign!==pt},{assign:pt});var xt=Je("match");var mt=function(e){var t;return y(e)&&((t=e[xt])!==undefined?!!t:f(e)=="RegExp")};var bt=function(e){if(mt(e)){throw TypeError("The method doesn't accept regular expressions")}return e};var wt=Je("match");var kt=function(t){var n=/./;try{"/./"[t](n)}catch(e){try{n[wt]=false;return"/./"[t](n)}catch(e){}}return false};Ne({target:"String",proto:true,forced:!kt("includes")},{includes:function e(t){return!!~String(_(this)).indexOf(bt(t),arguments.length>1?arguments[1]:undefined)}});var St=P.f;var Ct="".startsWith;var Ot=Math.min;var At=kt("startsWith");var Pt=!At&&!!function(){var e=St(String.prototype,"startsWith");return e&&!e.writable}();Ne({target:"String",proto:true,forced:!Pt&&!At},{startsWith:function e(t){var n=String(_(this));bt(t);var r=_e(Ot(arguments.length>1?arguments[1]:undefined,n.length));var i=String(t);return Ct?Ct.call(n,i,r):n.slice(r,r+i.length)===i}});if(typeof window!=="undefined"){(function(){var r=function(e,t){var n=e.nodeType;if(n===3){t.push(e.textContent.replace(/&/,"&amp;").replace(/</,"&lt;").replace(">","&gt;"))}else if(n===1){t.push("<",e.tagName);if(e.hasAttributes()){[].forEach.call(e.attributes,function(e){t.push(" ",e.item.name,"='",e.item.value,"'")})}if(e.hasChildNodes()){t.push(">");[].forEach.call(e.childNodes,function(e){r(e,t)});t.push("</",e.tagName,">")}else{t.push("/>")}}else if(n==8){t.push("\x3c!--",e.nodeValue,"--\x3e")}};Object.defineProperty(SVGElement.prototype,"innerHTML",{get:function(){var e=[];var t=this.firstChild;while(t){r(t,e);t=t.nextSibling}return e.join("")},set:function(e){while(this.firstChild){this.removeChild(this.firstChild)}try{var t=new DOMParser;t.async=false;var n="<svg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'>"+e+"</svg>";var r=t.parseFromString(n,"text/xml").documentElement;var i=r.firstChild;while(i){this.appendChild(this.ownerDocument.importNode(i,true));i=i.nextSibling}}catch(e){}}});Object.defineProperty(SVGElement.prototype,"innerSVG",{get:function(){return this.innerHTML},set:function(e){this.innerHTML=e}})})()}});(function(e,t){typeof exports==="object"&&typeof module!=="undefined"?t(exports,require("d3plus-common"),require("d3-array"),require("d3-collection"),require("d3-scale"),require("d3-shape"),require("d3plus-axis"),require("d3plus-color"),require("d3plus-shape"),require("d3plus-viz"),require("d3-selection")):typeof define==="function"&&define.amd?define("d3plus-plot",["exports","d3plus-common","d3-array","d3-collection","d3-scale","d3-shape","d3plus-axis","d3plus-color","d3plus-shape","d3plus-viz","d3-selection"],t):(e=e||self,t(e.d3plus={},e.d3plusCommon,e.d3Array,e.d3Collection,e.scales,e.d3Shape,e.d3plusAxis,e.d3plusColor,e.shapes,e.d3plusViz,e.d3Selection))})(this,function(e,Ue,Ke,Ye,Je,Qe,Xe,r,Ze,t,m){"use strict";function $e(e){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){$e=function(e){return typeof e}}else{$e=function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e}}return $e(e)}function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}function a(e,t,n){if(t)i(e.prototype,t);if(n)i(e,n);return e}function et(e,t,n){if(t in e){Object.defineProperty(e,t,{value:n,enumerable:true,configurable:true,writable:true})}else{e[t]=n}return e}function o(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function")}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:true,configurable:true}});if(t)s(e,t)}function tt(e){tt=Object.setPrototypeOf?Object.getPrototypeOf:function e(t){return t.__proto__||Object.getPrototypeOf(t)};return tt(e)}function s(e,t){s=Object.setPrototypeOf||function e(t,n){t.__proto__=n;return t};return s(e,t)}function c(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function u(e,t){if(t&&(typeof t==="object"||typeof t==="function")){return t}return c(e)}function f(e,t){while(!Object.prototype.hasOwnProperty.call(e,t)){e=tt(e);if(e===null)break}return e}function nt(e,t,n){if(typeof Reflect!=="undefined"&&Reflect.get){nt=Reflect.get}else{nt=function e(t,n,r){var i=f(t,n);if(!i)return;var a=Object.getOwnPropertyDescriptor(i,n);if(a.get){return a.get.call(r)}return a.value}}return nt(e,t,n||e)}var x=function(e,t,n){if(e.padding)e.padding(.5);else{var r=t.map(function(e){return e[n]}).reduce(function(e,t,n,r){if(!n)return e;var i=r[n-1];if(!e||t-i<e)return t-i;else return e},0);var i=e.domain().slice();if(n==="y")i.reverse();i[0]=new Date(+i[0]-r/2);i[1]=new Date(+i[1]+r/2);if(n==="y")i.reverse();e.domain(i)}};function l(e){var t=this;var n=e.data,r=e.x,i=e.y,a=e.x2,o=e.y2,s=e.buffer,c=s===void 0?10:s;var u=a?"x2":"x";var f=o?"y2":"y";var l=this._discrete==="x"?i:r;var d=l.domain().slice();var h=this._discrete==="x";if(h)d.reverse();var v,_;if(this._stacked){var g=Ye.nest().key(function(e){return"".concat(e[t._discrete],"_").concat(e.group)}).entries(n).map(function(e){return e.values.map(function(e){return e[h?f:u]})});_=g.map(function(e){return Ke.sum(e.filter(function(e){return e>0}))});v=g.map(function(e){return Ke.sum(e.filter(function(e){return e<0}))})}else{_=n.map(function(e){return e[h?f:u]});v=_}var y=l(Ke.max(_));if(h?y<l(0):y>l(0))y+=h?-c:c;y=l.invert(y);var p=l(Ke.min(v));if(h?p>l(0):p<l(0))p+=h?c:-c;p=l.invert(p);if(y>d[1])d[1]=y;if(p<d[0])d[0]=p;if(h)d.reverse();l.domain(d);x(h?r:i,n,this._discrete);return[r,i]}function d(e){var t=this;var n=e.data,r=e.x,i=e.y,a=e.x2,o=e.y2,s=e.buffer,c=s===void 0?10:s;var u=a?"x2":"x";var f=o?"y2":"y";var l=this._discrete==="x"?i:r;var d=l.domain().slice();var h=this._discrete==="x";if(h)d.reverse();var v,_;if(this._stacked){var g=Ye.nest().key(function(e){return e[t._discrete]}).entries(n).map(function(e){return e.values.map(function(e){return e[h?f:u]})});_=g.map(function(e){return Ke.sum(e.filter(function(e){return e>0}))});v=g.map(function(e){return Ke.sum(e.filter(function(e){return e<0}))})}else{_=n.map(function(e){return e[h?f:u]});v=_}var y=l(Ke.max(_));y+=h?-c:c;y=l.invert(y);var p=l(Ke.min(v));p+=h?c:-c;p=l.invert(p);if(y>d[1])d[1]=y;if(p<d[0])d[0]=p;if(h)d.reverse();l.domain(d);x(h?r:i,n,this._discrete);return[r,i]}function g(l,d,h,v,e,t,_,g){if(g){t=t.slice().reverse();e=e.slice().reverse()}var n=function e(){var t=l.copy();var n=false;if(d==="log"){var r=l.domain().slice(),i=l.range().slice();if(g){r=r.reverse();i=i.reverse()}n=r[0]*r[1]<0;if(n){var a=Je.scaleLog().domain([1,Math.abs(r[_])]).range([0,1]);var o=a(Math.abs(r[_?0:1]));var s=o/(o+1)*(i[1]-i[0]);r=(_===0?[r[0],1]:[1,r[1]]).map(Math.abs);i=_===0?[i[0],i[0]+s]:[i[0]+s,i[1]]}t=Je.scaleLog().domain(r).range(i)}var c=false;var u=t.range();var f;if(d==="log"){f=!n||h<0&&!_||h>0&&_?t(Math.abs(h)):u[h<0?0:1]}else f=t(h);if(g){if(_===0)c=f+v>u[_];else if(_===1)c=f-v<u[_]}else{if(_===0)c=f-v<u[_];else if(_===1)c=f+v>u[_]}return c};if(l.invert&&n()){if(d==="log"){var r=_===0&&t[0]>0||_===1&&t[1]<0;var i=Math[r?"ceil":"floor"](Math.log10(Math.abs(t[_])));while(n()&&i<20){i=r?i-1:i+1;var a=t[_]<0?-1:1;if(i<0){i=1;r=!r;a=!a}t[_]=Math.pow(10,i)*a;l.domain(g?t.slice().reverse():t)}}else if(_===0){var o=l.invert(l(h)+v*(g?1:-1));if(o<t[_]){t[_]=o;l.domain(g?t.slice().reverse():t)}}else if(_===1){var s=l.invert(l(h)+v*(g?-1:1));if(s>t[_]){t[_]=s;l.domain(g?t.slice().reverse():t)}}}return g?t.reverse():t}function h(e){var t=e.data,n=e.x,r=e.y,i=e.x2,a=e.y2,o=e.yScale,s=e.xScale,c=e.config,u=e.buffer;n=n.copy();r=r.copy();var f=i?"x2":"x";var l=a?"y2":"y";var d=n.domain().slice(),h=r.domain().slice();var v=n.range(),_=r.range();if(!n.invert&&n.padding)x(n,t,this._discrete);if(!r.invert&&r.padding)x(r,t,this._discrete);if(n.invert||r.invert){t.forEach(function(e){var t=u?u:c.r(e.data,e.i)*2;if(n.invert){d=g(n,s,e[f],t,v,d,0,false);d=g(n,s,e[f],t,v,d,1,false)}if(r.invert){h=g(r,o,e[l],t,_,h,0,true);h=g(r,o,e[l],t,_,h,1,true)}})}return[n,r]}function v(e){var t=this;var n=e.data,r=e.x,i=e.y,a=e.x2,o=e.y2;var s=a?"x2":"x";var c=o?"y2":"y";var u=this._discrete==="x"?i:r;var f=u.domain().slice();if(this._discrete==="x")f.reverse();var l=n.map(function(e){return e[t._discrete==="x"?c:s]});var d=u.invert(u(Ke.max(l))+(this._discrete==="x"?-10:10));if(d>f[1])f[1]=d;if(this._discrete==="x")f.reverse();u.domain(f);return[r,i]}function _(e){var t=e.data,r=e.x,i=e.y,n=e.x2,a=e.y2,o=e.yScale,s=e.xScale,c=e.config;r=r.copy();i=i.copy();var u=n?"x2":"x";var f=a?"y2":"y";var l=r.domain().slice(),d=i.domain().slice();var h=r.range(),v=i.range();if(!r.invert&&r.padding)x(r,t,this._discrete);if(!i.invert&&i.padding)x(i,t,this._discrete);if(r.invert||i.invert){t.forEach(function(e){if(r.invert){var t=c.width(e.data,e.i);l=g(r,s,e[u],t,h,l,0,false);l=g(r,s,e[u],t,h,l,1,false)}if(i.invert){var n=c.height(e.data,e.i);d=g(i,o,e[f],n,v,d,0,true);d=g(i,o,e[f],n,v,d,1,true)}})}return[r,i]}function y(e){return this._sizeScaleD3(this._size?this._size(e):null)}function p(e){var n=e.map(w);var r=e.map(function(e){return e.key.split("_")[0]});return Qe.stackOrderNone(e).sort(function(e,t){return r[t].localeCompare(r[e])||n[e]-n[t]})}function b(e){return p(e).reverse()}function w(e){var t=-1,n=0,r;var i=e.length;while(++t<i){if(r=+e[t][1])n+=r}return n}function k(e,t){var n;if(!((n=e.length)>0))return;var r,i,a,o,s;var c=e[t[0]].length;for(var u=0;u<c;++u){for(s=o=0,a=0;a<n;++a){if((i=(r=e[t[a]][u])[1]-r[0])>=0){r[0]=s,r[1]=s+=i}else if(i<0){r[1]=o,r[0]=o+=i}else{r[0]=s}}}}var S=function(e){o(He,e);function He(){var i;n(this,He);i=u(this,tt(He).call(this));i._annotations=[];i._backgroundConfig={duration:0,fill:"transparent"};i._barPadding=0;i._buffer={Bar:l,Box:d,Circle:h,Line:v,Rect:_};i._confidenceConfig={fillOpacity:Ue.constant(.5)};i._discreteCutoff=100;i._groupPadding=5;i._previousShapes=[];i._shape=Ue.constant("Circle");i._shapeConfig=Ue.assign(i._shapeConfig,{Area:{label:function e(t,n){return i._stacked?i._drawLabel(t,n):false},labelConfig:{fontResize:true}},ariaLabel:function e(t,n){var r="";if(t.nested)r="".concat(i._drawLabel(t.data,t.i));else{r="".concat(i._drawLabel(t,n));if(i._x(t,n)!==undefined)r+=", x: ".concat(i._x(t,n));if(i._y(t,n)!==undefined)r+=", y: ".concat(i._y(t,n));if(i._x2(t,n)!==undefined)r+=", x2: ".concat(i._x2(t,n));if(i._y2(t,n)!==undefined)r+=", y2: ".concat(i._y2(t,n))}return"".concat(r,".")},Bar:{labelConfig:{textAnchor:function e(){return i._discrete==="x"?"middle":"end"},verticalAlign:function e(){return i._discrete==="x"?"top":"middle"}}},Circle:{r:y.bind(c(i))},Line:{fill:Ue.constant("none"),label:false,stroke:function e(t,n){return r.colorAssign(i._id(t,n))},strokeWidth:Ue.constant(1)},Rect:{height:function e(t){return y.bind(c(i))(t)*2},width:function e(t){return y.bind(c(i))(t)*2}}});i._shapeOrder=["Area","Path","Bar","Box","Line","Rect","Circle"];i._shapeSort=function(e,t){return i._shapeOrder.indexOf(e)-i._shapeOrder.indexOf(t)};i._sizeMax=20;i._sizeMin=5;i._sizeScale="sqrt";i._stackOffset=k;i._stackOrder=b;i._timelineConfig=Ue.assign(i._timelineConfig,{brushing:true});i._x=Ue.accessor("x");i._xAxis=(new Xe.AxisBottom).align("end");i._xTest=(new Xe.AxisBottom).align("end").gridSize(0);i._xConfig={};i._xCutoff=150;i._x2=Ue.accessor("x2");i._x2Axis=(new Xe.AxisTop).align("start");i._x2Test=(new Xe.AxisTop).align("start").gridSize(0);i._x2Config={padding:0};i._y=Ue.accessor("y");i._yAxis=(new Xe.AxisLeft).align("start");i._yTest=(new Xe.AxisLeft).align("start").gridSize(0);i._yConfig={gridConfig:{stroke:function e(t){var n=i._yAxis.domain();return n[n.length-1]===t.id?"transparent":"#ccc"}}};i._yCutoff=150;i._y2=Ue.accessor("y2");i._y2Axis=(new Xe.AxisRight).align("end");i._y2Test=(new Xe.AxisLeft).align("end").gridSize(0);i._y2Config={};return i}a(He,[{key:"_draw",value:function e(t){var T=this;if(!this._filteredData.length)return this;var s=function e(t,n){return T._stacked?"".concat(T._groupBy.length>1?T._ids(t,n).slice(0,-1).join("_"):"group"):"".concat(T._ids(t,n).join("_"))};var c=this._filteredData.map(function(e,t){return{__d3plus__:true,data:e,group:s(e,t),i:t,hci:T._confidence&&T._confidence[1]&&T._confidence[1](e,t),id:T._ids(e,t).slice(0,T._drawDepth+1).join("_"),lci:T._confidence&&T._confidence[0]&&T._confidence[0](e,t),shape:T._shape(e,t),x:T._x(e,t),x2:T._x2(e,t),y:T._y(e,t),y2:T._y2(e,t)}});this._formattedData=c;if(this._size){var n=Ke.extent(c,function(e){return T._size(e.data)});this._sizeScaleD3=function(){return T._sizeMin};this._sizeScaleD3=Je["scale".concat(this._sizeScale.charAt(0).toUpperCase()).concat(this._sizeScale.slice(1))]().domain(n).range([n[0]===n[1]?this._sizeMax:Ke.min([this._sizeMax/2,this._sizeMin]),this._sizeMax])}else{this._sizeScaleD3=function(){return T._sizeMin}}var r=c.some(function(e){return e.x2!==undefined}),i=c.some(function(e){return e.y2!==undefined});var a=this._height-this._margin.top-this._margin.bottom,u=this._discrete?this._discrete==="x"?"y":"x":undefined,o=this._discrete?this._discrete==="x"?"y2":"x2":undefined,f=[u,o].filter(function(e){return e}),l=this._select,d=this._transition,z=this._width-this._margin.left-this._margin.right;var h=this._time&&c[0].x2===this._time(c[0].data,c[0].i),v=this._time&&c[0].x===this._time(c[0].data,c[0].i),_=this._time&&c[0].y2===this._time(c[0].data,c[0].i),g=this._time&&c[0].y===this._time(c[0].data,c[0].i);for(var y=0;y<c.length;y++){var p=c[y];if(v)p.x=Xe.date(p.x);if(h)p.x2=Xe.date(p.x2);if(g)p.y=Xe.date(p.y);if(_)p.y2=Xe.date(p.y2);p.discrete=p.shape==="Bar"?"".concat(p[this._discrete],"_").concat(p.group):"".concat(p[this._discrete])}var x,m,b,w;if(this._stacked){var k;var S=Ye.nest().key(function(e){return e.group}).entries(c).reduce(function(e,t){if(!e[t.key])e[t.key]=0;e[t.key]+=Ke.sum(t.values,function(e){return e[u]});return e},{});c=c.sort(function(e,t){if(T["_".concat(T._discrete,"Sort")])return T["_".concat(T._discrete,"Sort")](e.data,t.data);var n=e[T._discrete],r=t[T._discrete];if(n-r!==0)return n-r;if(e.group!==t.group)return S[t.group]-S[e.group];return t[u]-e[u]});x=Array.from(new Set(c.map(function(e){return e.discrete})));w=Array.from(new Set(c.map(function(e){return e.id})));b=Ye.nest().key(function(e){return e.discrete}).entries(c).map(function(e){return e.values});b.forEach(function(a){var o=Array.from(new Set(a.map(function(e){return e.id})));if(o.length<w.length){w.forEach(function(t){if(!o.includes(t)){var e=c.filter(function(e){return e.id===t})[0];if(e.shape==="Area"){var n;var r=s(e.data,e.i);var i=(n={__d3plus__:true,data:e.data,discrete:e.shape==="Bar"?"".concat(a[0][T._discrete],"_").concat(r):"".concat(a[0][T._discrete]),group:r,id:t,shape:e.shape},et(n,T._discrete,a[0][T._discrete]),et(n,u,0),n);c.push(i)}}})}});if(this["_".concat(this._discrete,"Sort")]){c.sort(function(e,t){return T["_".concat(T._discrete,"Sort")](e.data,t.data)})}else{c.sort(function(e,t){return e[T._discrete]-t[T._discrete]})}var C=this._stackOrder;if(C instanceof Array)w.sort(function(e,t){return C.indexOf(e)-C.indexOf(t)});else if(C===Qe.stackOrderNone)w.sort(function(e,t){return e.localeCompare(t)});b=Qe.stack().keys(w).offset(this._stackOffset).order(C instanceof Array?Qe.stackOrderNone:C).value(function(e,t){var n=e.filter(function(e){return e.id===t});return n.length?n[0][u]:0})(b);m=(k={},et(k,this._discrete,Ke.extent(c,function(e){return e[T._discrete]})),et(k,u,[Ke.min(b.map(function(e){return Ke.min(e.map(function(e){return e[0]}))})),Ke.max(b.map(function(e){return Ke.max(e.map(function(e){return e[1]}))}))]),k)}else{var O=this._discrete||"x";if(this["_".concat(this._discrete,"Sort")]){c.sort(function(e,t){return T["_".concat(T._discrete,"Sort")](e.data,t.data)})}else{c.sort(function(e,t){return e[O]-t[O]})}var A=O==="x"?c.map(function(e){return e.x}):c.map(function(e){return e.x}).concat(this._confidence&&this._confidence[0]?c.map(function(e){return e.lci}):[]).concat(this._confidence&&this._confidence[1]?c.map(function(e){return e.hci}):[]);var P=O==="x"?c.map(function(e){return e.x2}):c.map(function(e){return e.x2}).concat(this._confidence&&this._confidence[0]?c.map(function(e){return e.lci}):[]).concat(this._confidence&&this._confidence[1]?c.map(function(e){return e.hci}):[]);var j=O==="y"?c.map(function(e){return e.y}):c.map(function(e){return e.y}).concat(this._confidence&&this._confidence[0]?c.map(function(e){return e.lci}):[]).concat(this._confidence&&this._confidence[1]?c.map(function(e){return e.hci}):[]);var M=O==="y"?c.map(function(e){return e.y2}):c.map(function(e){return e.y2}).concat(this._confidence&&this._confidence[0]?c.map(function(e){return e.lci}):[]).concat(this._confidence&&this._confidence[1]?c.map(function(e){return e.hci}):[]);m={x:this._xSort?Array.from(new Set(c.filter(function(e){return e.x}).sort(function(e,t){return T._xSort(e.data,t.data)}).map(function(e){return e.x}))):Ke.extent(A,function(e){return e}),x2:this._x2Sort?Array.from(new Set(c.filter(function(e){return e.x2}).sort(function(e,t){return T._x2Sort(e.data,t.data)}).map(function(e){return e.x2}))):Ke.extent(P,function(e){return e}),y:this._ySort?Array.from(new Set(c.filter(function(e){return e.y}).sort(function(e,t){return T._ySort(e.data,t.data)}).map(function(e){return e.y}))):Ke.extent(j,function(e){return e}),y2:this._y2Sort?Array.from(new Set(c.filter(function(e){return e.y2}).sort(function(e,t){return T._y2Sort(e.data,t.data)}).map(function(e){return e.y2}))):Ke.extent(M,function(e){return e})}}var D=this._xDomain?this._xDomain.slice():m.x,L=this._xSort?"Point":"Linear";if(D[0]===void 0)D[0]=m.x[0];if(D[1]===void 0)D[1]=m.x[1];if(v){D=D.map(Xe.date);L="Time"}else if(this._discrete==="x"){D=Array.from(new Set(c.filter(function(e){return["number","string"].includes($e(e.x))}).sort(function(e,t){return T._xSort?T._xSort(e.data,t.data):e.x-t.x}).map(function(e){return e.x})));L="Point"}var E=this._x2Domain?this._x2Domain.slice():m.x2,B=this._x2Sort?"Point":"Linear";if(E&&E[0]===void 0)E[0]=m.x2[0];if(E&&E[1]===void 0)E[1]=m.x2[1];if(h){E=E.map(Xe.date);B="Time"}else if(this._discrete==="x"){E=Array.from(new Set(c.filter(function(e){return["number","string"].includes($e(e.x2))}).sort(function(e,t){return T._x2Sort?T._x2Sort(e.data,t.data):e.x2-t.x2}).map(function(e){return e.x2})));B="Point"}var R=this._yDomain?this._yDomain.slice():m.y,q=this._ySort?"Point":"Linear";if(R[0]===void 0)R[0]=m.y[0];if(R[1]===void 0)R[1]=m.y[1];var N=this._y2Domain?this._y2Domain.slice():m.y2,F=this._y2Sort?"Point":"Linear";if(N&&N[0]===void 0)N[0]=m.y2[0];if(N&&N[1]===void 0)N[1]=m.y2[1];if(g){R=R.map(Xe.date);q="Time"}else if(this._discrete==="y"){R=Array.from(new Set(c.filter(function(e){return["number","string"].includes($e(e.y))}).sort(function(e,t){return T._ySort?T._ySort(e.data,t.data):e.y-t.y}).map(function(e){return e.y})));q="Point";N=Array.from(new Set(c.filter(function(e){return["number","string"].includes($e(e.y2))}).sort(function(e,t){return T._y2Sort?T._y2Sort(e.data,t.data):e.y2-t.y2}).map(function(e){return e.y2})));F="Point"}if(_){N=N.map(Xe.date);F="Time"}m={x:D,x2:E||D,y:R,y2:N||R};f.forEach(function(e){if(T["_".concat(e,"Config")].domain){var t=T["_".concat(e,"Config")].domain;if(T._discrete==="x")t.reverse();m[e]=t}else if(e&&T._baseline!==void 0){var n=T._baseline;if(m[e]&&m[e][0]>n)m[e][0]=n;else if(m[e]&&m[e][1]<n)m[e][1]=n}});var I=Je["scale".concat(L)]().domain(m.x).range(Ke.range(0,z+1,z/(m.x.length-1))),W=Je["scale".concat(B)]().domain(m.x2).range(Ke.range(0,z+1,z/(m.x2.length-1))),V=Je["scale".concat(q)]().domain(m.y.reverse()).range(Ke.range(0,a+1,a/(m.y.length-1))),G=Je["scale".concat(F)]().domain(m.y2.reverse()).range(Ke.range(0,a+1,a/(m.y2.length-1)));var H=Ye.nest().key(function(e){return e.shape}).entries(c).sort(function(e,t){return T._shapeSort(e.key,t.key)});var U=function e(t,n){var r=T["_".concat(t,"Config")].scale;if(r==="auto"){if(T._discrete===t)return n;var i=c.map(function(e){return e[t]});return Ke.deviation(i)/Ke.mean(i)>3?"log":"linear"}return r||n};var K=U("y",q).toLowerCase();var Y=U("y2",F).toLowerCase();var J=U("x",L).toLowerCase();var Q=U("x2",B).toLowerCase();var X=this._discrete==="x"?q:L;if(X!=="Point"){H.forEach(function(e){if(T._buffer[e.key]){var t=T._buffer[e.key].bind(T)({data:e.values,x:I,y:V,yScale:K,xScale:J,config:T._shapeConfig[e.key]});I=t[0];V=t[1];var n=T._buffer[e.key].bind(T)({data:e.values,x:W,y:G,yScale:Y,xScale:Q,x2:true,y2:true,config:T._shapeConfig[e.key]});W=n[0];G=n[1]}})}D=I.domain();E=W.domain();R=V.domain();N=G.domain();var Z={barConfig:{"stroke-width":0},gridSize:0,labels:[],title:false,tickSize:0};var $=r?{}:Z;var ee=i?{}:Z;var te=this._discrete==="x"&&this._width>this._discreteCutoff||this._width>this._xCutoff;var ne=this._discrete==="y"&&this._height>this._discreteCutoff||this._height>this._yCutoff;var re={gridConfig:{stroke:!this._discrete||this._discrete==="x"?this._yTest.gridConfig().stroke:"transparent"},locale:this._locale,scalePadding:V.padding?V.padding():0};if(!te){re.barConfig={stroke:"transparent"};re.tickSize=0;re.shapeConfig={labelBounds:function e(t,n){var r=t.labelBounds,i=r.width,a=r.y;var o=T._height/2;var s=n?-o:0;return{x:s,y:a,width:i,height:o}},labelConfig:{padding:0,rotate:0,verticalAlign:function e(t){return t.id===ce[0]?"top":"bottom"}},labelRotation:false}}var ie=Ue.elem("g.d3plus-plot-test",{enter:{opacity:0},parent:this._select}),ae=this._discrete==="x"&&!h?m.x2:undefined,oe=!ne?Ke.extent(m.x):this._discrete==="x"&&!v?m.x:undefined,se=this._discrete==="y"&&!_?m.y2:undefined,ce=!te?Ke.extent(m.y):this._discrete==="y"&&!g?m.y:undefined;if(ne){this._yTest.domain(R).height(a).maxSize(z/2).range([undefined,undefined]).select(ie.node()).ticks(ce).width(z).config(re).config(this._yConfig).scale(K).render()}var ue=this._yTest.outerBounds();var fe=ue.width?ue.width+this._yTest.padding():undefined;if(i){this._y2Test.domain(N).height(a).range([undefined,undefined]).select(ie.node()).ticks(se).width(z).config(re).config(ee).config(this._y2Config).scale(Y).render()}var le=this._y2Test.outerBounds();var de=le.width?le.width+this._y2Test.padding():undefined;var he={gridConfig:{stroke:!this._discrete||this._discrete==="y"?this._xTest.gridConfig().stroke:"transparent"},locale:this._locale,scalePadding:I.padding?I.padding():0};if(!ne){he.barConfig={stroke:"transparent"};he.tickSize=0;he.shapeConfig={labelBounds:function e(t,n){var r=t.labelBounds,i=r.height,a=r.y;var o=T._width/2;var s=n?-o:0;return{x:s,y:a,width:o,height:i}},labelConfig:{padding:0,rotate:0,textAnchor:function e(t){return t.id===oe[0]?"start":"end"}},labelRotation:false}}if(te){this._xTest.domain(D).height(a).maxSize(a/2).range([undefined,undefined]).select(ie.node()).ticks(oe).width(z).config(he).config(this._xConfig).scale(J).render()}if(r){this._x2Test.domain(E).height(a).range([undefined,undefined]).select(ie.node()).ticks(ae).width(z).config(he).tickSize(0).config($).config(this._x2Config).scale(Q).render()}var ve=this._xTest._getRange();var _e=this._x2Test._getRange();var ge=this._x2Test.outerBounds();var ye=r?ge.height+this._x2Test.padding():0;var pe=Ke.max([fe,ve[0],_e[0]]);if(te){this._xTest.range([pe,undefined]).render()}var xe=ne?this._yTest.shapeConfig().labelConfig.fontSize()/2:0;var me=Ke.max([de,z-ve[1],z-_e[1]]);var be=this._xTest.outerBounds();var we=be.height+(ne?this._xTest.padding():0);this._padding.left+=pe;this._padding.right+=me;this._padding.bottom+=we;this._padding.top+=ye+xe;nt(tt(He.prototype),"_draw",this).call(this,t);var ke=this._margin.left+this._margin.right;var Se=this._margin.top+this._margin.bottom;var Ce=[ye,a-(we+xe+Se)];if(ne){this._yTest.domain(R).height(a).maxSize(z/2).range(Ce).select(ie.node()).ticks(ce).width(z).config(re).config(this._yConfig).scale(K).render()}ue=this._yTest.outerBounds();fe=ue.width?ue.width+this._yTest.padding():undefined;pe=Ke.max([fe,ve[0],_e[0]]);if(i){this._y2Test.config(re).domain(N).gridSize(0).height(a).range(Ce).select(ie.node()).width(z-Ke.max([0,me-de])).title(false).config(this._y2Config).config(ee).scale(Y).render()}le=this._y2Test.outerBounds();de=le.width?le.width+this._y2Test.padding():undefined;me=Ke.max([0,de,z-ve[1],z-_e[1]]);var Oe=[pe,z-(me+ke)];var Ae=Ue.elem("g.d3plus-plot-background",{parent:l,transition:d});var Pe="translate(".concat(this._margin.left,", ").concat(this._margin.top+ye+xe,")");var Te="translate(".concat(this._margin.left,", ").concat(this._margin.top+xe,")");var ze=te&&Ue.elem("g.d3plus-plot-x-axis",{parent:l,transition:d,enter:{transform:Pe},update:{transform:Pe}});var je=r&&Ue.elem("g.d3plus-plot-x2-axis",{parent:l,transition:d,enter:{transform:Te},update:{transform:Te}});var Me=pe>fe?pe-fe:0;var De="translate(".concat(this._margin.left+Me,", ").concat(this._margin.top+xe,")");var Le=ne&&Ue.elem("g.d3plus-plot-y-axis",{parent:l,transition:d,enter:{transform:De},update:{transform:De}});var Ee="translate(-".concat(this._margin.right,", ").concat(this._margin.top+xe,")");var Be=i&&Ue.elem("g.d3plus-plot-y2-axis",{parent:l,transition:d,enter:{transform:Ee},update:{transform:Ee}});this._xAxis.domain(D).height(a-(ye+xe+Se)).maxSize(a/2).range(Oe).select(te?ze.node():undefined).ticks(oe).width(z).config(he).config(this._xConfig).scale(J).render();if(r){this._x2Axis.domain(E).height(a-(we+xe+Se)).range(Oe).select(je.node()).ticks(ae).width(z).config(he).config($).config(this._x2Config).scale(Q).render()}I=function e(t,n){if(n==="x2"){if(T._x2Config.scale==="log"&&t===0)t=E[0]<0?-1:1;return T._x2Axis._getPosition.bind(T._x2Axis)(t)}else{if(T._xConfig.scale==="log"&&t===0)t=D[0]<0?-1:1;return T._xAxis._getPosition.bind(T._xAxis)(t)}};Ce=[this._xAxis.outerBounds().y+ye,a-(we+xe+Se)];this._yAxis.domain(R).height(a).maxSize(z/2).range(Ce).select(ne?Le.node():undefined).ticks(ce).width(Oe[Oe.length-1]).config(re).config(this._yConfig).scale(K).render();if(i){this._y2Axis.config(re).domain(i?N:R).gridSize(0).height(a).range(Ce).select(Be.node()).width(z-Ke.max([0,me-de])).title(false).config(this._y2Config).config(ee).scale(Y).render()}V=function e(t,n){if(n==="y2"){if(T._y2Config.scale==="log"&&t===0)t=N[0]<0?-1:1;return T._y2Axis._getPosition.bind(T._y2Axis)(t)-ye}else{if(T._yConfig.scale==="log"&&t===0)t=R[0]<0?-1:1;return T._yAxis._getPosition.bind(T._yAxis)(t)-ye}};(new Ze.Rect).data([{}]).select(Ae.node()).x(Oe[0]+(Oe[1]-Oe[0])/2).width(Oe[1]-Oe[0]).y(this._margin.top+xe+Ce[0]+(Ce[1]-Ce[0])/2).height(Ce[1]-Ce[0]).config(this._backgroundConfig).render();var Re=Ue.elem("g.d3plus-plot-annotations",{parent:l,transition:d,enter:{transform:Pe},update:{transform:Pe}}).node();this._annotations.forEach(function(e){(new Ze[e.shape]).config(e).config({x:function e(t){return t.x2?I(t.x2,"x2"):I(t.x)},x0:T._discrete==="x"?function(e){return e.x2?I(e.x2,"x2"):I(e.x)}:I(m.x[0]),x1:T._discrete==="x"?null:function(e){return e.x2?I(e.x2,"x2"):I(e.x)},y:function e(t){return t.y2?V(t.y2,"y2"):V(t.y)},y0:T._discrete==="y"?function(e){return e.y2?V(e.y2,"y2"):V(e.y)}:V(m.y[1])-qe,y1:T._discrete==="y"?null:function(e){return e.y2?V(e.y2,"y2"):V(e.y)-qe}}).select(Re).render()});var qe=this._xAxis.barConfig()["stroke-width"];if(qe)qe/=2;var Ne=this._discrete||"x";var Fe={duration:this._duration,label:function e(t){return T._drawLabel(t.data,t.i)},select:Ue.elem("g.d3plus-plot-shapes",{parent:l,transition:d,enter:{transform:Pe},update:{transform:Pe}}).node(),x:function e(t){return t.x2?I(t.x2,"x2"):I(t.x)},x0:Ne==="x"?function(e){return e.x2?I(e.x2,"x2"):I(e.x)}:I(typeof this._baseline==="number"?this._baseline:m.x[0]),x1:Ne==="x"?null:function(e){return e.x2?I(e.x2,"x2"):I(e.x)},y:function e(t){return t.y2?V(t.y2,"y2"):V(t.y)},y0:Ne==="y"?function(e){return e.y2?V(e.y2,"y2"):V(e.y)}:V(typeof this._baseline==="number"?this._baseline:m.y[1])-qe,y1:Ne==="y"?null:function(e){return e.y2?V(e.y2,"y2"):V(e.y)-qe}};if(this._stacked){var Ie=u==="x"?I:V;Fe["".concat(u)]=Fe["".concat(u,"0")]=function(e){var t=w.indexOf(e.id),n=x.indexOf(e.discrete);return t>=0?Ie(b[t][n][0]):Ie(m[u][u==="x"?0:1])};Fe["".concat(u,"1")]=function(e){var t=w.indexOf(e.id),n=x.indexOf(e.discrete);return t>=0?Ie(b[t][n][1]):Ie(m[u][u==="x"?0:1])}}var We=Object.keys(this._on);H.forEach(function(t){var n=(new Ze[t.key]).config(Fe).data(t.values);if(t.key==="Bar"){var e;var r=T._discrete==="x"?I:V;var i=T._discrete==="x"?L:q;var a=T._discrete==="x"?D:R;var o=T._discrete==="x"?Oe:Ce;if(i!=="Point"&&a.length===2){e=(r(t.values[T._discrete==="x"?0:t.values.length-1][T._discrete])-r(a[0]))*2}else if(a.length>1)e=r(a[1])-r(a[0]);else e=o[o.length-1]-o[0];if(T._groupPadding<e)e-=T._groupPadding;var s=e||1;var c=Ye.nest().key(function(e){return e[T._discrete]}).key(function(e){return e.group}).entries(t.values);var u=Ke.merge(c.map(function(e){return e.values.map(function(e){return e.key})}));var f=Array.from(new Set(u));if(Ke.max(c.map(function(e){return e.values.length}))===1){n[T._discrete](function(e,t){return Fe[T._discrete](e,t)})}else{s=(s-T._barPadding*f.length-1)/f.length;var l=e/2-s/2;var d=Je.scaleLinear().domain([0,f.length-1]).range([-l,l]);n[T._discrete](function(e,t){return Fe[T._discrete](e,t)+d(f.indexOf(e.group))})}n.width(s);n.height(s)}else if(t.key==="Line"){n.duration(z*1.5);if(T._confidence){var h=Object.assign({},Fe);var v=T._discrete||"x";var _=v==="x"?"y":"x";var g=v==="x"?V:I;h["".concat(_,"0")]=function(e){return g(T._confidence[0]?e.lci:e[_])};h["".concat(_,"1")]=function(e){return g(T._confidence[1]?e.hci:e[_])};var y=(new Ze.Area).config(h).data(t.values);var p=Object.assign(T._shapeConfig,T._confidenceConfig);y.config(Ue.configPrep.bind(T)(p,"shape","Area")).render();T._shapes.push(y)}}var x=We.filter(function(e){return e.includes(".".concat(t.key))}),m=We.filter(function(e){return!e.includes(".")}),b=We.filter(function(e){return e.includes(".shape")});var w=function e(t){n.on(m[t],function(e){return T._on[m[t]](e.data,e.i)})};for(var k=0;k<m.length;k++){w(k)}var S=function e(t){n.on(b[t],function(e){return T._on[b[t]](e.data,e.i)})};for(var C=0;C<b.length;C++){S(C)}var O=function e(t){n.on(x[t],function(e){return T._on[x[t]](e.data,e.i)})};for(var A=0;A<x.length;A++){O(A)}var P=Ue.configPrep.bind(T)(T._shapeConfig,"shape",t.key);if(T._shapeConfig.duration===undefined)delete P.duration;n.config(P).render();T._shapes.push(n)});var Ve=H.map(function(e){return e.key});if(this._confidence&&Ve.includes("Line"))Ve.push("Area");var Ge=this._previousShapes.filter(function(e){return!Ve.includes(e)});Ge.forEach(function(e){(new Ze[e]).config(Fe).data([]).render()});this._previousShapes=Ve;return this}},{key:"annotations",value:function e(t){return arguments.length?(this._annotations=t instanceof Array?t:[t],this):this._annotations}},{key:"backgroundConfig",value:function e(t){return arguments.length?(this._backgroundConfig=Ue.assign(this._backgroundConfig,t),this):this._backgroundConfig}},{key:"barPadding",value:function e(t){return arguments.length?(this._barPadding=t,this):this._barPadding}},{key:"baseline",value:function e(t){return arguments.length?(this._baseline=t,this):this._baseline}},{key:"confidence",value:function e(t){if(arguments.length&&t instanceof Array){this._confidence=[];var n=t[0];this._confidence[0]=typeof n==="function"||!n?n:Ue.accessor(n);var r=t[1];this._confidence[1]=typeof r==="function"||!r?r:Ue.accessor(r);return this}else return this._confidence}},{key:"confidenceConfig",value:function e(t){return arguments.length?(this._confidenceConfig=Ue.assign(this._confidenceConfig,t),this):this._confidenceConfig}},{key:"discrete",value:function e(t){return arguments.length?(this._discrete=t,this):this._discrete}},{key:"discreteCutoff",value:function e(t){return arguments.length?(this._discreteCutoff=t,this):this._discreteCutoff}},{key:"groupPadding",value:function e(t){return arguments.length?(this._groupPadding=t,this):this._groupPadding}},{key:"shapeSort",value:function e(t){return arguments.length?(this._shapeSort=t,this):this._shapeSort}},{key:"size",value:function e(t){return arguments.length?(this._size=typeof t==="function"||!t?t:Ue.accessor(t),this):this._size}},{key:"sizeMax",value:function e(t){return arguments.length?(this._sizeMax=t,this):this._sizeMax}},{key:"sizeMin",value:function e(t){return arguments.length?(this._sizeMin=t,this):this._sizeMin}},{key:"sizeScale",value:function e(t){return arguments.length?(this._sizeScale=t,this):this._sizeScale}},{key:"stacked",value:function e(t){return arguments.length?(this._stacked=t,this):this._stacked}},{key:"stackOffset",value:function e(t){return arguments.length?(this._stackOffset=typeof t==="function"?t:Qe["stackOffset".concat(t.charAt(0).toUpperCase()+t.slice(1))],this):this._stackOffset}},{key:"stackOrder",value:function e(t){if(arguments.length){if(typeof t==="string")this._stackOrder=t==="ascending"?p:t==="descending"?b:Qe["stackOrder".concat(t.charAt(0).toUpperCase()+t.slice(1))];else this._stackOrder=t;return this}else return this._stackOrder}},{key:"x",value:function e(t){if(arguments.length){if(typeof t==="function")this._x=t;else{this._x=Ue.accessor(t);if(!this._aggs[t]&&this._discrete==="x"){this._aggs[t]=function(e){var t=Array.from(new Set(e));return t.length===1?t[0]:t}}}return this}else return this._x}},{key:"x2",value:function e(t){if(arguments.length){if(typeof t==="function")this._x2=t;else{this._x2=Ue.accessor(t);if(!this._aggs[t]&&this._discrete==="x"){this._aggs[t]=function(e){var t=Array.from(new Set(e));return t.length===1?t[0]:t}}}return this}else return this._x2}},{key:"xConfig",value:function e(t){return arguments.length?(this._xConfig=Ue.assign(this._xConfig,t),this):this._xConfig}},{key:"xCutoff",value:function e(t){return arguments.length?(this._xCutoff=t,this):this._xCutoff}},{key:"x2Config",value:function e(t){return arguments.length?(this._x2Config=Ue.assign(this._x2Config,t),this):this._x2Config}},{key:"xDomain",value:function e(t){return arguments.length?(this._xDomain=t,this):this._xDomain}},{key:"x2Domain",value:function e(t){return arguments.length?(this._x2Domain=t,this):this._x2Domain}},{key:"xSort",value:function e(t){return arguments.length?(this._xSort=t,this):this._xSort}},{key:"x2Sort",value:function e(t){return arguments.length?(this._x2Sort=t,this):this._x2Sort}},{key:"y",value:function e(t){if(arguments.length){if(typeof t==="function")this._y=t;else{this._y=Ue.accessor(t);if(!this._aggs[t]&&this._discrete==="y"){this._aggs[t]=function(e){var t=Array.from(new Set(e));return t.length===1?t[0]:t}}}return this}else return this._y}},{key:"y2",value:function e(t){if(arguments.length){if(typeof t==="function")this._y2=t;else{this._y2=Ue.accessor(t);if(!this._aggs[t]&&this._discrete==="y2"){this._aggs[t]=function(e){var t=Array.from(new Set(e));return t.length===1?t[0]:t}}}return this}else return this._y2}},{key:"yConfig",value:function e(t){if(arguments.length){if(t.domain)t.domain=t.domain.slice().reverse();this._yConfig=Ue.assign(this._yConfig,t);return this}return this._yConfig}},{key:"yCutoff",value:function e(t){return arguments.length?(this._yCutoff=t,this):this._yCutoff}},{key:"y2Config",value:function e(t){return arguments.length?(this._y2Config=Ue.assign(this._y2Config,t),this):this._y2Config}},{key:"yDomain",value:function e(t){return arguments.length?(this._yDomain=t,this):this._yDomain}},{key:"y2Domain",value:function e(t){return arguments.length?(this._y2Domain=t,this):this._y2Domain}},{key:"ySort",value:function e(t){return arguments.length?(this._ySort=t,this):this._ySort}},{key:"y2Sort",value:function e(t){return arguments.length?(this._y2Sort=t,this):this._y2Sort}}]);return He}(t.Viz);var C=function(e){o(t,e);function t(){var e;n(this,t);e=u(this,tt(t).call(this));e._baseline=0;e._discrete="x";e._shape=Ue.constant("Area");e.x("x");return e}return t}(S);var O=function(e){o(t,e);function t(){var e;n(this,t);e=u(this,tt(t).call(this));e._baseline=0;e._discrete="x";e._shape=Ue.constant("Bar");e.x("x");return e}return t}(S);var A=function(e){o(t,e);function t(){var i;n(this,t);i=u(this,tt(t).call(this));i._discrete="x";i._shape=Ue.constant("Box");i.x("x");i._tooltipConfig=Ue.assign(i._tooltipConfig,{title:function e(t,n){if(!t)return"";while(t.__d3plus__&&t.data){t=t.data;n=t.i}if(i._label)return i._label(t,n);var r=i._ids(t,n).slice(0,i._drawDepth);return r[r.length-1]}});return i}return t}(S);var P=function(e){o(t,e);function t(){var o;n(this,t);o=u(this,tt(t).call(this));o._discrete="x";o._shape=Ue.constant("Line");o.x("x");o.y2(function(e){return o._y(e)});o.yConfig({tickFormat:function e(t){var n=o._formattedData;var r=n[0].x instanceof Date?n[0].x.getTime():n[0].x;var i=n.filter(function(e){return(e.x instanceof Date?e.x.getTime():e.x)===r});var a=i.find(function(e){return e.y===t});return a?o._drawLabel(a,a.i):""}});o.y2Config({tickFormat:function e(t){var n=o._formattedData;var r=n[n.length-1].x instanceof Date?n[n.length-1].x.getTime():n[n.length-1].x;var i=n.filter(function(e){return(e.x instanceof Date?e.x.getTime():e.x)===r});var a=i.find(function(e){return e.y===t});return a?o._drawLabel(a,a.i):""}});o.ySort(function(e,t){return o._y(t)-o._y(e)});o.y2Sort(function(e,t){return o._y(t)-o._y(e)});return o}return t}(S);var T=function(e){o(t,e);function t(){var e;n(this,t);e=u(this,tt(t).call(this));e._shape=Ue.constant("Line");return e}return t}(S);var z=Math.PI*2;var j=function(e){o(x,e);function x(){var e;n(this,x);e=u(this,tt(x).call(this));e._axisConfig={shapeConfig:{fill:Ue.constant("none"),labelConfig:{fontColor:"#000",padding:0,textAnchor:function e(t,n,r){return r.textAnchor},verticalAlign:"middle"},stroke:"#ccc",strokeWidth:Ue.constant(1)}};e._discrete="metric";e._levels=6;e._metric=Ue.accessor("metric");e._outerPadding=100;e._shape=Ue.constant("Path");e._value=Ue.accessor("value");return e}a(x,[{key:"_draw",value:function e(t){var h=this;nt(tt(x.prototype),"_draw",this).call(this,t);var u=this._height-this._margin.top-this._margin.bottom,f=this._width-this._margin.left-this._margin.right;var v=Ke.min([u,f])/2-this._outerPadding,n="translate(".concat(f/2,", ").concat(u/2,")");var r=Ye.nest().key(this._metric).entries(this._filteredData),i=Ye.nest().key(this._id).key(this._metric).entries(this._filteredData);var a=Ke.max(i.map(function(e){return e.values.map(function(e){return Ke.sum(e.values,function(e,t){return h._value(e,t)})})}).flat());var o=Array.from(Array(this._levels).keys()).map(function(e){return{id:e,r:v*((e+1)/h._levels)}});var s=Ue.configPrep.bind(this)(this._axisConfig.shapeConfig,"shape","Circle");delete s.label;(new Ze.Circle).data(o).select(Ue.elem("g.d3plus-Radar-radial-circles",{parent:this._select,enter:{transform:n},update:{transform:n}}).node()).config(s).render();var _=r.length;var c=r.map(function(e,t){var n=h._outerPadding;var r=h._shapeConfig.labelConfig.fontSize&&h._shapeConfig.labelConfig.fontSize(e,t)||11;var i=r*1.4;var a=i*2;var o=10,s=parseInt(360-360/_*t/90,10)%4+1,c=z/_*t;var u=360/_*t;var f="start";var l=o;if(s===2||s===3){l=-n-o;f="end";u+=180}var d={x:l,y:-a/2,width:n,height:a};return{__d3plus__:true,data:Ue.merge(e.values),i:t,id:e.key,angle:u,textAnchor:f,labelBounds:d,rotateAnchor:[-l,a/2],x:v*Math.cos(c),y:v*Math.sin(c)}}).sort(function(e,t){return e.key-t.key});(new Ze.Rect).data(c).rotate(function(e){return e.angle||0}).width(0).height(0).x(function(e){return e.x}).y(function(e){return e.y}).label(function(e){return e.id}).labelBounds(function(e){return e.labelBounds}).labelConfig(this._axisConfig.shapeConfig.labelConfig).select(Ue.elem("g.d3plus-Radar-text",{parent:this._select,enter:{transform:n},update:{transform:n}}).node()).render();(new Ze.Path).data(c).d(function(e){return"M".concat(0,",",0," ",-e.x,",").concat(-e.y)}).select(Ue.elem("g.d3plus-Radar-axis",{parent:this._select,enter:{transform:n},update:{transform:n}}).node()).config(Ue.configPrep.bind(this)(this._axisConfig.shapeConfig,"shape","Path")).render();var l=i.map(function(e){var t=e.values.map(function(e,t){var n=Ke.sum(e.values,function(e,t){return h._value(e,t)});var r=n/a*v,i=z/_*t;return{x:r*Math.cos(i),y:r*Math.sin(i)}});var n="M ".concat(t[0].x," ").concat(t[0].y," ").concat(t.map(function(e){return"L ".concat(e.x," ").concat(e.y)}).join(" ")," L ").concat(t[0].x," ").concat(t[0].y);return{arr:e.values.map(function(e){return Ue.merge(e.values)}),id:e.key,points:t,d:n,__d3plus__:true,data:Ue.merge(e.values.map(function(e){return Ue.merge(e.values)}))}});var d=Ue.configPrep.bind(this)(this._shapeConfig,"shape","Path");var g=Object.keys(d.on);d.on={};var y=function e(t){var c=g[t];d.on[c]=function(e,t){var n=e.points.map(function(e){return e.x+f/2});var r=e.points.map(function(e){return e.y+u/2});var i=m.mouse(h._select.node());var a=n.map(function(e){return Math.abs(e-i[0])});var o=r.map(function(e){return Math.abs(e-i[1])});var s=a.map(function(e,t){return e+o[t]});h._on[c].bind(h)(e.arr[s.indexOf(Ke.min(s))],t)}};for(var p=0;p<g.length;p++){y(p)}this._shapes.push((new Ze.Path).data(l).d(function(e){return e.d}).select(Ue.elem("g.d3plus-Radar-items",{parent:this._select,enter:{transform:n},update:{transform:n}}).node()).config(d).render());return this}},{key:"axisConfig",value:function e(t){return arguments.length?(this._axisConfig=Ue.assign(this._axisConfig,t),this):this._axisConfig}},{key:"metric",value:function e(t){return arguments.length?(this._metric=typeof t==="function"?t:Ue.accessor(t),this):this._metric}},{key:"outerPadding",value:function e(t){return arguments.length?(this._outerPadding=t,this):this._outerPadding}},{key:"value",value:function e(t){return arguments.length?(this._value=typeof t==="function"?t:Ue.accessor(t),this):this._value}}]);return x}(t.Viz);var M=function(e){o(t,e);function t(){var e;n(this,t);e=u(this,tt(t).call(this));e._stacked=true;return e}return t}(C);e.AreaPlot=C;e.BarChart=O;e.BoxWhisker=A;e.BumpChart=P;e.LinePlot=T;e.Plot=S;e.Radar=j;e.StackedArea=M;Object.defineProperty(e,"__esModule",{value:true})});