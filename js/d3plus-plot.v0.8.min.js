/*
  d3plus-plot v0.8.40
  A reusable javascript x/y plot built on D3.
  Copyright (c) 2020 D3plus - https://d3plus.org
  @license MIT
*/
(function(e){typeof define==="function"&&define.amd?define(e):e()})(function(){"use strict";var e=typeof globalThis!=="undefined"?globalThis:typeof window!=="undefined"?window:typeof global!=="undefined"?global:typeof self!=="undefined"?self:{};function t(e,t){return t={exports:{}},e(t,t.exports),t.exports}var n=function(e){return e&&e.Math==Math&&e};var l=n(typeof globalThis=="object"&&globalThis)||n(typeof window=="object"&&window)||n(typeof self=="object"&&self)||n(typeof e=="object"&&e)||Function("return this")();var r=function(e){try{return!!e()}catch(e){return true}};var h=!r(function(){return Object.defineProperty({},"a",{get:function(){return 7}}).a!=7});var i={}.propertyIsEnumerable;var a=Object.getOwnPropertyDescriptor;var o=a&&!i.call({1:2},1);var s=o?function e(t){var n=a(this,t);return!!n&&n.enumerable}:i;var v={f:s};var c=function(e,t){return{enumerable:!(e&1),configurable:!(e&2),writable:!(e&4),value:t}};var f={}.toString;var u=function(e){return f.call(e).slice(8,-1)};var d="".split;var m=r(function(){return!Object("z").propertyIsEnumerable(0)})?function(e){return u(e)=="String"?d.call(e,""):Object(e)}:Object;var _=function(e){if(e==undefined)throw TypeError("Can't call method on "+e);return e};var g=function(e){return m(_(e))};var y=function(e){return typeof e==="object"?e!==null:typeof e==="function"};var p=function(e,t){if(!y(e))return e;var n,r;if(t&&typeof(n=e.toString)=="function"&&!y(r=n.call(e)))return r;if(typeof(n=e.valueOf)=="function"&&!y(r=n.call(e)))return r;if(!t&&typeof(n=e.toString)=="function"&&!y(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")};var x={}.hasOwnProperty;var b=function(e,t){return x.call(e,t)};var k=l.document;var C=y(k)&&y(k.createElement);var S=function(e){return C?k.createElement(e):{}};var w=!h&&!r(function(){return Object.defineProperty(S("div"),"a",{get:function(){return 7}}).a!=7});var A=Object.getOwnPropertyDescriptor;var O=h?A:function e(t,n){t=g(t);n=p(n,true);if(w)try{return A(t,n)}catch(e){}if(b(t,n))return c(!v.f.call(t,n),t[n])};var P={f:O};var z=function(e){if(!y(e)){throw TypeError(String(e)+" is not an object")}return e};var T=Object.defineProperty;var j=h?T:function e(t,n,r){z(t);n=p(n,true);z(r);if(w)try{return T(t,n,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported");if("value"in r)t[n]=r.value;return t};var L={f:j};var M=h?function(e,t,n){return L.f(e,t,c(1,n))}:function(e,t,n){e[t]=n;return e};var D=function(t,n){try{M(l,t,n)}catch(e){l[t]=n}return n};var E="__core-js_shared__";var B=l[E]||D(E,{});var R=B;var N=t(function(e){(e.exports=function(e,t){return R[e]||(R[e]=t!==undefined?t:{})})("versions",[]).push({version:"3.4.7",mode:"global",copyright:"Â© 2019 Denis Pushkarev (zloirock.ru)"})});var q=Function.toString;var W=N("inspectSource",function(e){return q.call(e)});var F=l.WeakMap;var I=typeof F==="function"&&/native code/.test(W(F));var V=0;var G=Math.random();var H=function(e){return"Symbol("+String(e===undefined?"":e)+")_"+(++V+G).toString(36)};var U=N("keys");var K=function(e){return U[e]||(U[e]=H(e))};var Y={};var J=l.WeakMap;var Q,X,Z;var $=function(e){return Z(e)?X(e):Q(e,{})};var ee=function(n){return function(e){var t;if(!y(e)||(t=X(e)).type!==n){throw TypeError("Incompatible receiver, "+n+" required")}return t}};if(I){var te=new J;var ne=te.get;var re=te.has;var ie=te.set;Q=function(e,t){ie.call(te,e,t);return t};X=function(e){return ne.call(te,e)||{}};Z=function(e){return re.call(te,e)}}else{var ae=K("state");Y[ae]=true;Q=function(e,t){M(e,ae,t);return t};X=function(e){return b(e,ae)?e[ae]:{}};Z=function(e){return b(e,ae)}}var oe={set:Q,get:X,has:Z,enforce:$,getterFor:ee};var se=t(function(e){var t=oe.get;var s=oe.enforce;var c=String(String).split("String");(e.exports=function(e,t,n,r){var i=r?!!r.unsafe:false;var a=r?!!r.enumerable:false;var o=r?!!r.noTargetGet:false;if(typeof n=="function"){if(typeof t=="string"&&!b(n,"name"))M(n,"name",t);s(n).source=c.join(typeof t=="string"?t:"")}if(e===l){if(a)e[t]=n;else D(t,n);return}else if(!i){delete e[t]}else if(!o&&e[t]){a=true}if(a)e[t]=n;else M(e,t,n)})(Function.prototype,"toString",function e(){return typeof this=="function"&&t(this).source||W(this)})});var ce=l;var fe=function(e){return typeof e=="function"?e:undefined};var ue=function(e,t){return arguments.length<2?fe(ce[e])||fe(l[e]):ce[e]&&ce[e][t]||l[e]&&l[e][t]};var le=Math.ceil;var de=Math.floor;var he=function(e){return isNaN(e=+e)?0:(e>0?de:le)(e)};var ve=Math.min;var _e=function(e){return e>0?ve(he(e),9007199254740991):0};var ge=Math.max;var ye=Math.min;var pe=function(e,t){var n=he(e);return n<0?ge(n+t,0):ye(n,t)};var xe=function(s){return function(e,t,n){var r=g(e);var i=_e(r.length);var a=pe(n,i);var o;if(s&&t!=t)while(i>a){o=r[a++];if(o!=o)return true}else for(;i>a;a++){if((s||a in r)&&r[a]===t)return s||a||0}return!s&&-1}};var me={includes:xe(true),indexOf:xe(false)};var be=me.indexOf;var ke=function(e,t){var n=g(e);var r=0;var i=[];var a;for(a in n)!b(Y,a)&&b(n,a)&&i.push(a);while(t.length>r)if(b(n,a=t[r++])){~be(i,a)||i.push(a)}return i};var Ce=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"];var Se=Ce.concat("length","prototype");var we=Object.getOwnPropertyNames||function e(t){return ke(t,Se)};var Ae={f:we};var Oe=Object.getOwnPropertySymbols;var Pe={f:Oe};var ze=ue("Reflect","ownKeys")||function e(t){var n=Ae.f(z(t));var r=Pe.f;return r?n.concat(r(t)):n};var Te=function(e,t){var n=ze(t);var r=L.f;var i=P.f;for(var a=0;a<n.length;a++){var o=n[a];if(!b(e,o))r(e,o,i(t,o))}};var je=/#|\.prototype\./;var Le=function(e,t){var n=De[Me(e)];return n==Be?true:n==Ee?false:typeof t=="function"?r(t):!!t};var Me=Le.normalize=function(e){return String(e).replace(je,".").toLowerCase()};var De=Le.data={};var Ee=Le.NATIVE="N";var Be=Le.POLYFILL="P";var Re=Le;var Ne=P.f;var qe=function(e,t){var n=e.target;var r=e.global;var i=e.stat;var a,o,s,c,f,u;if(r){o=l}else if(i){o=l[n]||D(n,{})}else{o=(l[n]||{}).prototype}if(o)for(s in t){f=t[s];if(e.noTargetGet){u=Ne(o,s);c=u&&u.value}else c=o[s];a=Re(r?s:n+(i?".":"#")+s,e.forced);if(!a&&c!==undefined){if(typeof f===typeof c)continue;Te(f,c)}if(e.sham||c&&c.sham){M(f,"sham",true)}se(o,s,f,e)}};var We=function(e){if(typeof e!="function"){throw TypeError(String(e)+" is not a function")}return e};var Fe=function(r,i,e){We(r);if(i===undefined)return r;switch(e){case 0:return function(){return r.call(i)};case 1:return function(e){return r.call(i,e)};case 2:return function(e,t){return r.call(i,e,t)};case 3:return function(e,t,n){return r.call(i,e,t,n)}}return function(){return r.apply(i,arguments)}};var Ie=function(e){return Object(_(e))};var Ve=Array.isArray||function e(t){return u(t)=="Array"};var Ge=!!Object.getOwnPropertySymbols&&!r(function(){return!String(Symbol())});var He=Ge&&!Symbol.sham&&typeof Symbol()=="symbol";var Ue=N("wks");var Ke=l.Symbol;var Ye=He?Ke:H;var Je=function(e){if(!b(Ue,e)){if(Ge&&b(Ke,e))Ue[e]=Ke[e];else Ue[e]=Ye("Symbol."+e)}return Ue[e]};var Qe=Je("species");var Xe=function(e,t){var n;if(Ve(e)){n=e.constructor;if(typeof n=="function"&&(n===Array||Ve(n.prototype)))n=undefined;else if(y(n)){n=n[Qe];if(n===null)n=undefined}}return new(n===undefined?Array:n)(t===0?0:t)};var Ze=[].push;var $e=function(h){var v=h==1;var _=h==2;var g=h==3;var y=h==4;var p=h==6;var x=h==5||p;return function(e,t,n,r){var i=Ie(e);var a=m(i);var o=Fe(t,n,3);var s=_e(a.length);var c=0;var f=r||Xe;var u=v?f(e,s):_?f(e,0):undefined;var l,d;for(;s>c;c++)if(x||c in a){l=a[c];d=o(l,c,i);if(h){if(v)u[c]=d;else if(d)switch(h){case 3:return true;case 5:return l;case 6:return c;case 2:Ze.call(u,l)}else if(y)return false}}return p?-1:g||y?y:u}};var et={forEach:$e(0),map:$e(1),filter:$e(2),some:$e(3),every:$e(4),find:$e(5),findIndex:$e(6)};var tt=Object.keys||function e(t){return ke(t,Ce)};var nt=h?Object.defineProperties:function e(t,n){z(t);var r=tt(n);var i=r.length;var a=0;var o;while(i>a)L.f(t,o=r[a++],n[o]);return t};var rt=ue("document","documentElement");var it=K("IE_PROTO");var at="prototype";var ot=function(){};var st=function(){var e=S("iframe");var t=Ce.length;var n="<";var r="script";var i=">";var a="java"+r+":";var o;e.style.display="none";rt.appendChild(e);e.src=String(a);o=e.contentWindow.document;o.open();o.write(n+r+i+"document.F=Object"+n+"/"+r+i);o.close();st=o.F;while(t--)delete st[at][Ce[t]];return st()};var ct=Object.create||function e(t,n){var r;if(t!==null){ot[at]=z(t);r=new ot;ot[at]=null;r[it]=t}else r=st();return n===undefined?r:nt(r,n)};Y[it]=true;var ft=Je("unscopables");var ut=Array.prototype;if(ut[ft]==undefined){M(ut,ft,ct(null))}var lt=function(e){ut[ft][e]=true};var dt=et.find;var ht="find";var vt=true;if(ht in[])Array(1)[ht](function(){vt=false});qe({target:"Array",proto:true,forced:vt},{find:function e(t){return dt(this,t,arguments.length>1?arguments[1]:undefined)}});lt(ht);var _t=me.includes;qe({target:"Array",proto:true},{includes:function e(t){return _t(this,t,arguments.length>1?arguments[1]:undefined)}});lt("includes");var gt=Object.assign;var yt=Object.defineProperty;var pt=!gt||r(function(){if(h&&gt({b:1},gt(yt({},"a",{enumerable:true,get:function(){yt(this,"b",{value:3,enumerable:false})}}),{b:2})).b!==1)return true;var e={};var t={};var n=Symbol();var r="abcdefghijklmnopqrst";e[n]=7;r.split("").forEach(function(e){t[e]=e});return gt({},e)[n]!=7||tt(gt({},t)).join("")!=r})?function e(t,n){var r=Ie(t);var i=arguments.length;var a=1;var o=Pe.f;var s=v.f;while(i>a){var c=m(arguments[a++]);var f=o?tt(c).concat(o(c)):tt(c);var u=f.length;var l=0;var d;while(u>l){d=f[l++];if(!h||s.call(c,d))r[d]=c[d]}}return r}:gt;qe({target:"Object",stat:true,forced:Object.assign!==pt},{assign:pt});var xt=Je("match");var mt=function(e){var t;return y(e)&&((t=e[xt])!==undefined?!!t:u(e)=="RegExp")};var bt=function(e){if(mt(e)){throw TypeError("The method doesn't accept regular expressions")}return e};var kt=Je("match");var Ct=function(t){var n=/./;try{"/./"[t](n)}catch(e){try{n[kt]=false;return"/./"[t](n)}catch(e){}}return false};qe({target:"String",proto:true,forced:!Ct("includes")},{includes:function e(t){return!!~String(_(this)).indexOf(bt(t),arguments.length>1?arguments[1]:undefined)}});var St=P.f;var wt="".startsWith;var At=Math.min;var Ot=Ct("startsWith");var Pt=!Ot&&!!function(){var e=St(String.prototype,"startsWith");return e&&!e.writable}();qe({target:"String",proto:true,forced:!Pt&&!Ot},{startsWith:function e(t){var n=String(_(this));bt(t);var r=_e(At(arguments.length>1?arguments[1]:undefined,n.length));var i=String(t);return wt?wt.call(n,i,r):n.slice(r,r+i.length)===i}});if(typeof window!=="undefined"){(function(){var r=function(e,t){var n=e.nodeType;if(n===3){t.push(e.textContent.replace(/&/,"&amp;").replace(/</,"&lt;").replace(">","&gt;"))}else if(n===1){t.push("<",e.tagName);if(e.hasAttributes()){[].forEach.call(e.attributes,function(e){t.push(" ",e.item.name,"='",e.item.value,"'")})}if(e.hasChildNodes()){t.push(">");[].forEach.call(e.childNodes,function(e){r(e,t)});t.push("</",e.tagName,">")}else{t.push("/>")}}else if(n==8){t.push("\x3c!--",e.nodeValue,"--\x3e")}};Object.defineProperty(SVGElement.prototype,"innerHTML",{get:function(){var e=[];var t=this.firstChild;while(t){r(t,e);t=t.nextSibling}return e.join("")},set:function(e){while(this.firstChild){this.removeChild(this.firstChild)}try{var t=new DOMParser;t.async=false;var n="<svg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'>"+e+"</svg>";var r=t.parseFromString(n,"text/xml").documentElement;var i=r.firstChild;while(i){this.appendChild(this.ownerDocument.importNode(i,true));i=i.nextSibling}}catch(e){}}});Object.defineProperty(SVGElement.prototype,"innerSVG",{get:function(){return this.innerHTML},set:function(e){this.innerHTML=e}})})()}});(function(e,t){typeof exports==="object"&&typeof module!=="undefined"?t(exports,require("d3plus-common"),require("d3-array"),require("d3-collection"),require("d3-scale"),require("d3-shape"),require("d3plus-axis"),require("d3plus-color"),require("d3plus-shape"),require("d3plus-text"),require("d3plus-viz"),require("d3-selection")):typeof define==="function"&&define.amd?define("d3plus-plot",["exports","d3plus-common","d3-array","d3-collection","d3-scale","d3-shape","d3plus-axis","d3plus-color","d3plus-shape","d3plus-text","d3plus-viz","d3-selection"],t):(e=e||self,t(e.d3plus={},e.d3plusCommon,e.d3Array,e.d3Collection,e.scales,e.d3Shape,e.d3plusAxis,e.d3plusColor,e.shapes,e.d3plusText,e.d3plusViz,e.d3Selection))})(this,function(e,it,at,ot,st,ct,ft,a,ut,lt,t,m){"use strict";function dt(e){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){dt=function(e){return typeof e}}else{dt=function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e}}return dt(e)}function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}function i(e,t,n){if(t)r(e.prototype,t);if(n)r(e,n);return e}function ht(e,t,n){if(t in e){Object.defineProperty(e,t,{value:n,enumerable:true,configurable:true,writable:true})}else{e[t]=n}return e}function o(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function")}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:true,configurable:true}});if(t)s(e,t)}function vt(e){vt=Object.setPrototypeOf?Object.getPrototypeOf:function e(t){return t.__proto__||Object.getPrototypeOf(t)};return vt(e)}function s(e,t){s=Object.setPrototypeOf||function e(t,n){t.__proto__=n;return t};return s(e,t)}function c(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function f(e,t){if(t&&(typeof t==="object"||typeof t==="function")){return t}return c(e)}function u(e,t){while(!Object.prototype.hasOwnProperty.call(e,t)){e=vt(e);if(e===null)break}return e}function _t(e,t,n){if(typeof Reflect!=="undefined"&&Reflect.get){_t=Reflect.get}else{_t=function e(t,n,r){var i=u(t,n);if(!i)return;var a=Object.getOwnPropertyDescriptor(i,n);if(a.get){return a.get.call(r)}return a.value}}return _t(e,t,n||e)}function gt(e,t){return l(e)||d(e,t)||h()}function l(e){if(Array.isArray(e))return e}function d(e,t){if(!(Symbol.iterator in Object(e)||Object.prototype.toString.call(e)==="[object Arguments]")){return}var n=[];var r=true;var i=false;var a=undefined;try{for(var o=e[Symbol.iterator](),s;!(r=(s=o.next()).done);r=true){n.push(s.value);if(t&&n.length===t)break}}catch(e){i=true;a=e}finally{try{if(!r&&o["return"]!=null)o["return"]()}finally{if(i)throw a}}return n}function h(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}var x=function(e,t,n){if(e.padding)e.padding(.5);else{var r=t.map(function(e){return e[n]}).reduce(function(e,t,n,r){if(!n)return e;var i=r[n-1];if(!e||t-i<e)return t-i;else return e},0);var i=e.domain().slice();if(n==="y")i.reverse();i[0]=new Date(+i[0]-r/2);i[1]=new Date(+i[1]+r/2);if(n==="y")i.reverse();e.domain(i)}};function v(e){var t=this;var n=e.data,r=e.x,i=e.y,a=e.x2,o=e.y2,s=e.buffer,c=s===void 0?10:s;var f=a?"x2":"x";var u=o?"y2":"y";var l=this._discrete==="x"?i:r;var d=l.domain().slice();var h=this._discrete==="x";if(h)d.reverse();var v,_;if(this._stacked){var g=ot.nest().key(function(e){return"".concat(e[t._discrete],"_").concat(e.group)}).entries(n).map(function(e){return e.values.map(function(e){return e[h?u:f]})});_=g.map(function(e){return at.sum(e.filter(function(e){return e>0}))});v=g.map(function(e){return at.sum(e.filter(function(e){return e<0}))})}else{_=n.map(function(e){return e[h?u:f]});v=_}var y=l(at.max(_));if(h?y<l(0):y>l(0))y+=h?-c:c;y=l.invert(y);var p=l(at.min(v));if(h?p>l(0):p<l(0))p+=h?c:-c;p=l.invert(p);if(y>d[1])d[1]=y;if(p<d[0])d[0]=p;if(h)d.reverse();l.domain(d);x(h?r:i,n,this._discrete);return[r,i]}function _(e){var t=this;var n=e.data,r=e.x,i=e.y,a=e.x2,o=e.y2,s=e.buffer,c=s===void 0?10:s;var f=a?"x2":"x";var u=o?"y2":"y";var l=this._discrete==="x"?i:r;var d=l.domain().slice();var h=this._discrete==="x";if(h)d.reverse();var v,_;if(this._stacked){var g=ot.nest().key(function(e){return e[t._discrete]}).entries(n).map(function(e){return e.values.map(function(e){return e[h?u:f]})});_=g.map(function(e){return at.sum(e.filter(function(e){return e>0}))});v=g.map(function(e){return at.sum(e.filter(function(e){return e<0}))})}else{_=n.map(function(e){return e[h?u:f]});v=_}var y=l(at.max(_));y+=h?-c:c;y=l.invert(y);var p=l(at.min(v));p+=h?c:-c;p=l.invert(p);if(y>d[1])d[1]=y;if(p<d[0])d[0]=p;if(h)d.reverse();l.domain(d);x(h?r:i,n,this._discrete);return[r,i]}function g(l,d,h,v,e,t,_,g){if(g){t=t.slice().reverse();e=e.slice().reverse()}var n=Math.abs(Math.log(t[1]-t[0])/10);var r=function e(){var t=l.copy();var n=false;if(d==="log"){var r=l.domain().slice(),i=l.range().slice();if(g){r=r.reverse();i=i.reverse()}n=r[0]*r[1]<0;if(n){var a=st.scaleLog().domain([1e-6,Math.abs(r[_])]).range([0,1]);var o=a(Math.abs(r[_?0:1]));var s=o/(o+1)*(i[1]-i[0]);r=(_===0?[r[0],1e-6]:[1e-6,r[1]]).map(Math.abs);i=_===0?[i[0],i[0]+s]:[i[0]+s,i[1]]}t=st.scaleLog().domain(r).range(i)}var c=false;var f=t.range();var u;if(d==="log"){u=n?t(Math.abs(h)):t(h)}else u=t(h);if(g){if(_===0)c=u+v>f[_];else if(_===1)c=u-v<f[_]}else{if(_===0)c=u-v<f[_];else if(_===1)c=u+v>f[_]}return c};if(l.invert&&r()){if(d==="log"){var i=0;while(i<10&&r()){var a=(_===0?-1:1)*(t[_]<0?-1:1);t[_]+=t[_]*n*a;l.domain(g?t.slice().reverse():t);i++}}else if(_===0){var o=l.invert(l(h)+v*(g?1:-1));if(o<t[_]){t[_]=o;l.domain(g?t.slice().reverse():t)}}else if(_===1){var s=l.invert(l(h)+v*(g?-1:1));if(s>t[_]){t[_]=s;l.domain(g?t.slice().reverse():t)}}}return g?t.reverse():t}function y(e){var t=e.data,n=e.x,r=e.y,i=e.x2,a=e.y2,o=e.yScale,s=e.xScale,c=e.config,f=e.buffer;n=n.copy();r=r.copy();var u=i?"x2":"x";var l=a?"y2":"y";var d=n.domain().slice(),h=r.domain().slice();var v=n.range(),_=r.range();if(!n.invert&&n.padding)x(n,t,this._discrete);if(!r.invert&&r.padding)x(r,t,this._discrete);if(n.invert||r.invert){t.forEach(function(e){var t=f?f:c.r(e.data,e.i)*2;if(n.invert){d=g(n,s,e[u],t,v,d,0,false);d=g(n,s,e[u],t,v,d,1,false)}if(r.invert){h=g(r,o,e[l],t,_,h,0,true);h=g(r,o,e[l],t,_,h,1,true)}})}return[n,r]}function p(e){var t=this;var n=e.data,r=e.x,i=e.y,a=e.x2,o=e.y2;var s=a?"x2":"x";var c=o?"y2":"y";var f=this._discrete==="x"?i:r;var u=f.domain().slice();if(this._discrete==="x")u.reverse();var l=n.map(function(e){return e[t._discrete==="x"?c:s]});var d=f.invert(f(at.max(l))+(this._discrete==="x"?-10:10));if(d>u[1])u[1]=d;if(this._discrete==="x")u.reverse();f.domain(u);return[r,i]}function b(e){var t=e.data,r=e.x,i=e.y,n=e.x2,a=e.y2,o=e.yScale,s=e.xScale,c=e.config;r=r.copy();i=i.copy();var f=n?"x2":"x";var u=a?"y2":"y";var l=r.domain().slice(),d=i.domain().slice();var h=r.range(),v=i.range();if(!r.invert&&r.padding)x(r,t,this._discrete);if(!i.invert&&i.padding)x(i,t,this._discrete);if(r.invert||i.invert){t.forEach(function(e){if(r.invert){var t=c.width(e.data,e.i);l=g(r,s,e[f],t,h,l,0,false);l=g(r,s,e[f],t,h,l,1,false)}if(i.invert){var n=c.height(e.data,e.i);d=g(i,o,e[u],n,v,d,0,true);d=g(i,o,e[u],n,v,d,1,true)}})}return[r,i]}var yt=new ut.Line;var pt=new lt.TextBox;function k(e){return this._sizeScaleD3(this._size?this._size(e):null)}function C(e){var n=e.map(w);var r=e.map(function(e){return e.key.split("_")[0]});return ct.stackOrderNone(e).sort(function(e,t){return r[t].localeCompare(r[e])||n[e]-n[t]})}function S(e){return C(e).reverse()}function w(e){var t=-1,n=0,r;var i=e.length;while(++t<i){if(r=+e[t][1])n+=r}return n}function A(e,t){var n;if(!((n=e.length)>0))return;var r,i,a,o,s;var c=e[t[0]].length;for(var f=0;f<c;++f){for(s=o=0,a=0;a<n;++a){if((i=(r=e[t[a]][f])[1]-r[0])>=0){r[0]=s,r[1]=s+=i}else if(i<0){r[1]=o,r[0]=o+=i}else{r[0]=s}}}}var O=function(e){o(rt,e);function rt(){var i;n(this,rt);i=f(this,vt(rt).call(this));i._annotations=[];i._backgroundConfig={duration:0,fill:"transparent"};i._barPadding=0;i._buffer={Bar:v,Box:_,Circle:y,Line:p,Rect:b};i._confidenceConfig={fill:function e(t,n){var r=typeof i._shapeConfig.Line.stroke==="function"?i._shapeConfig.Line.stroke(t,n):i._shapeConfig.Line.stroke;return r},fillOpacity:it.constant(.5)};i._discreteCutoff=100;i._groupPadding=5;i._lineMarkerConfig={fill:function e(t,n){return a.colorAssign(i._id(t,n))},r:it.constant(3)};i._lineMarkers=false;i._previousShapes=[];i._shape=it.constant("Circle");i._shapeConfig=it.assign(i._shapeConfig,{Area:{label:function e(t,n){return i._stacked?i._drawLabel(t,n):false},labelConfig:{fontResize:true}},ariaLabel:function e(t,n){var r="";if(t.nested)r="".concat(i._drawLabel(t.data,t.i));else{r="".concat(i._drawLabel(t,n));if(i._x(t,n)!==undefined)r+=", x: ".concat(i._x(t,n));if(i._y(t,n)!==undefined)r+=", y: ".concat(i._y(t,n));if(i._x2(t,n)!==undefined)r+=", x2: ".concat(i._x2(t,n));if(i._y2(t,n)!==undefined)r+=", y2: ".concat(i._y2(t,n))}return"".concat(r,".")},Bar:{labelConfig:{textAnchor:function e(){return i._discrete==="x"?"middle":"end"},verticalAlign:function e(){return i._discrete==="x"?"top":"middle"}}},Circle:{r:k.bind(c(i))},Line:{fill:it.constant("none"),labelConfig:{fontColor:function e(t,n){var r=typeof i._shapeConfig.Line.stroke==="function"?i._shapeConfig.Line.stroke(t,n):i._shapeConfig.Line.stroke;return a.colorLegible(r)},fontResize:false,padding:5,textAnchor:"start",verticalAlign:"middle"},stroke:function e(t,n){return a.colorAssign(i._id(t,n))},strokeWidth:it.constant(2)},Rect:{height:function e(t){return k.bind(c(i))(t)*2},width:function e(t){return k.bind(c(i))(t)*2}}});i._shapeOrder=["Area","Path","Bar","Box","Line","Rect","Circle"];i._shapeSort=function(e,t){return i._shapeOrder.indexOf(e)-i._shapeOrder.indexOf(t)};i._sizeMax=20;i._sizeMin=5;i._sizeScale="sqrt";i._stackOffset=A;i._stackOrder=S;i._timelineConfig=it.assign(i._timelineConfig,{brushing:true});i._x=it.accessor("x");i._xAxis=(new ft.AxisBottom).align("end");i._xTest=(new ft.AxisBottom).align("end").gridSize(0);i._xConfig={};i._xCutoff=150;i._x2=it.accessor("x2");i._x2Axis=(new ft.AxisTop).align("start");i._x2Test=(new ft.AxisTop).align("start").gridSize(0);i._x2Config={padding:0};i._y=it.accessor("y");i._yAxis=(new ft.AxisLeft).align("start");i._yTest=(new ft.AxisLeft).align("start").gridSize(0);i._yConfig={gridConfig:{stroke:function e(t){var n=i._yAxis.range();return n[n.length-1]===i._yAxis._getPosition.bind(i._yAxis)(t.id)?"transparent":"#ccc"}}};i._yCutoff=150;i._y2=it.accessor("y2");i._y2Axis=(new ft.AxisRight).align("end");i._y2Test=(new ft.AxisLeft).align("end").gridSize(0);i._y2Config={};return i}i(rt,[{key:"_draw",value:function e(t){var B=this;if(!this._filteredData.length)return this;var s=function e(t,n){return B._stacked?"".concat(B._groupBy.length>1?B._ids(t,n).slice(0,-1).join("_"):"group"):"".concat(B._ids(t,n).join("_"))};var c=this._filteredData.map(function(e,t){return{__d3plus__:true,data:e,group:s(e,t),i:t,hci:B._confidence&&B._confidence[1]&&B._confidence[1](e,t),id:B._ids(e,t).slice(0,B._drawDepth+1).join("_"),lci:B._confidence&&B._confidence[0]&&B._confidence[0](e,t),shape:B._shape(e,t),x:B._x(e,t),x2:B._x2(e,t),y:B._y(e,t),y2:B._y2(e,t)}});this._formattedData=c;if(this._size){var n=at.extent(c,function(e){return B._size(e.data)});this._sizeScaleD3=function(){return B._sizeMin};this._sizeScaleD3=st["scale".concat(this._sizeScale.charAt(0).toUpperCase()).concat(this._sizeScale.slice(1))]().domain(n).range([n[0]===n[1]?this._sizeMax:at.min([this._sizeMax/2,this._sizeMin]),this._sizeMax])}else{this._sizeScaleD3=function(){return B._sizeMin}}var r=c.some(function(e){return e.x2!==undefined}),i=c.some(function(e){return e.y2!==undefined});var a=this._height-this._margin.top-this._margin.bottom,f=this._discrete?this._discrete==="x"?"y":"x":undefined,o=this._discrete?this._discrete==="x"?"y2":"x2":undefined,u=[f,o].filter(function(e){return e}),l=this._select,d=this._transition,R=this._width-this._margin.left-this._margin.right;var h=this._time&&c[0].x2===this._time(c[0].data,c[0].i),v=this._time&&c[0].x===this._time(c[0].data,c[0].i),_=this._time&&c[0].y2===this._time(c[0].data,c[0].i),g=this._time&&c[0].y===this._time(c[0].data,c[0].i);for(var y=0;y<c.length;y++){var p=c[y];if(v)p.x=ft.date(p.x);if(h)p.x2=ft.date(p.x2);if(g)p.y=ft.date(p.y);if(_)p.y2=ft.date(p.y2);p.discrete=p.shape==="Bar"?"".concat(p[this._discrete],"_").concat(p.group):"".concat(p[this._discrete])}var x,m,b,k;if(this._stacked){var C;var S=ot.nest().key(function(e){return e.group}).entries(c).reduce(function(e,t){if(!e[t.key])e[t.key]=0;e[t.key]+=at.sum(t.values,function(e){return e[f]});return e},{});c=c.sort(function(e,t){if(B["_".concat(B._discrete,"Sort")])return B["_".concat(B._discrete,"Sort")](e.data,t.data);var n=e[B._discrete],r=t[B._discrete];if(n-r!==0)return n-r;if(e.group!==t.group)return S[t.group]-S[e.group];return t[f]-e[f]});x=Array.from(new Set(c.map(function(e){return e.discrete})));k=Array.from(new Set(c.map(function(e){return e.id})));b=ot.nest().key(function(e){return e.discrete}).entries(c).map(function(e){return e.values});b.forEach(function(a){var o=Array.from(new Set(a.map(function(e){return e.id})));if(o.length<k.length){k.forEach(function(t){if(!o.includes(t)){var e=c.filter(function(e){return e.id===t})[0];if(e.shape==="Area"){var n;var r=s(e.data,e.i);var i=(n={__d3plus__:true,data:e.data,discrete:e.shape==="Bar"?"".concat(a[0][B._discrete],"_").concat(r):"".concat(a[0][B._discrete]),group:r,id:t,shape:e.shape},ht(n,B._discrete,a[0][B._discrete]),ht(n,f,0),n);c.push(i)}}})}});if(this["_".concat(this._discrete,"Sort")]){c.sort(function(e,t){return B["_".concat(B._discrete,"Sort")](e.data,t.data)})}else{c.sort(function(e,t){return e[B._discrete]-t[B._discrete]})}var w=this._stackOrder;if(w instanceof Array)k.sort(function(e,t){return w.indexOf(e)-w.indexOf(t)});else if(w===ct.stackOrderNone)k.sort(function(e,t){return e.localeCompare(t)});b=ct.stack().keys(k).offset(this._stackOffset).order(w instanceof Array?ct.stackOrderNone:w).value(function(e,t){var n=e.filter(function(e){return e.id===t});return n.length?n[0][f]:0})(b);m=(C={},ht(C,this._discrete,at.extent(c,function(e){return e[B._discrete]})),ht(C,f,[at.min(b.map(function(e){return at.min(e.map(function(e){return e[0]}))})),at.max(b.map(function(e){return at.max(e.map(function(e){return e[1]}))}))]),C)}else{var A=this._discrete||"x";if(this["_".concat(this._discrete,"Sort")]){c.sort(function(e,t){return B["_".concat(B._discrete,"Sort")](e.data,t.data)})}else{c.sort(function(e,t){return e[A]-t[A]})}var O=A==="x"?c.map(function(e){return e.x}):c.map(function(e){return e.x}).concat(this._confidence&&this._confidence[0]?c.map(function(e){return e.lci}):[]).concat(this._confidence&&this._confidence[1]?c.map(function(e){return e.hci}):[]);var P=A==="x"?c.map(function(e){return e.x2}):c.map(function(e){return e.x2}).concat(this._confidence&&this._confidence[0]?c.map(function(e){return e.lci}):[]).concat(this._confidence&&this._confidence[1]?c.map(function(e){return e.hci}):[]);var z=A==="y"?c.map(function(e){return e.y}):c.map(function(e){return e.y}).concat(this._confidence&&this._confidence[0]?c.map(function(e){return e.lci}):[]).concat(this._confidence&&this._confidence[1]?c.map(function(e){return e.hci}):[]);var T=A==="y"?c.map(function(e){return e.y2}):c.map(function(e){return e.y2}).concat(this._confidence&&this._confidence[0]?c.map(function(e){return e.lci}):[]).concat(this._confidence&&this._confidence[1]?c.map(function(e){return e.hci}):[]);m={x:this._xSort?Array.from(new Set(c.filter(function(e){return e.x}).sort(function(e,t){return B._xSort(e.data,t.data)}).map(function(e){return e.x}))):at.extent(O,function(e){return e}),x2:this._x2Sort?Array.from(new Set(c.filter(function(e){return e.x2}).sort(function(e,t){return B._x2Sort(e.data,t.data)}).map(function(e){return e.x2}))):at.extent(P,function(e){return e}),y:this._ySort?Array.from(new Set(c.filter(function(e){return e.y}).sort(function(e,t){return B._ySort(e.data,t.data)}).map(function(e){return e.y}))):at.extent(z,function(e){return e}),y2:this._y2Sort?Array.from(new Set(c.filter(function(e){return e.y2}).sort(function(e,t){return B._y2Sort(e.data,t.data)}).map(function(e){return e.y2}))):at.extent(T,function(e){return e})}}var N=this._xDomain?this._xDomain.slice():m.x,q=this._xSort?"Point":"Linear";if(N[0]===void 0)N[0]=m.x[0];if(N[1]===void 0)N[1]=m.x[1];if(v){N=N.map(ft.date);q="Time"}else if(this._discrete==="x"){if(!this._xDomain)N=Array.from(new Set(c.filter(function(e){return["number","string"].includes(dt(e.x))}).sort(function(e,t){return B._xSort?B._xSort(e.data,t.data):e.x-t.x}).map(function(e){return e.x})));q="Point"}var j=this._x2Domain?this._x2Domain.slice():m.x2,L=this._x2Sort?"Point":"Linear";if(j&&j[0]===void 0)j[0]=m.x2[0];if(j&&j[1]===void 0)j[1]=m.x2[1];if(h){j=j.map(ft.date);L="Time"}else if(this._discrete==="x"){if(!this._x2Domain)j=Array.from(new Set(c.filter(function(e){return["number","string"].includes(dt(e.x2))}).sort(function(e,t){return B._x2Sort?B._x2Sort(e.data,t.data):e.x2-t.x2}).map(function(e){return e.x2})));L="Point"}var W=this._yDomain?this._yDomain.slice():m.y,F=this._ySort?"Point":"Linear";if(W[0]===void 0)W[0]=m.y[0];if(W[1]===void 0)W[1]=m.y[1];var M=this._y2Domain?this._y2Domain.slice():m.y2,D=this._y2Sort?"Point":"Linear";if(M&&M[0]===void 0)M[0]=m.y2[0];if(M&&M[1]===void 0)M[1]=m.y2[1];if(g){W=W.map(ft.date);F="Time"}else if(this._discrete==="y"){if(!this._yDomain)W=Array.from(new Set(c.filter(function(e){return["number","string"].includes(dt(e.y))}).sort(function(e,t){return B._ySort?B._ySort(e.data,t.data):e.y-t.y}).map(function(e){return e.y})));F="Point";if(!this._y2Domain)M=Array.from(new Set(c.filter(function(e){return["number","string"].includes(dt(e.y2))}).sort(function(e,t){return B._y2Sort?B._y2Sort(e.data,t.data):e.y2-t.y2}).map(function(e){return e.y2})));D="Point"}if(_){M=M.map(ft.date);D="Time"}var E=function e(t,n){var r=B["_".concat(t,"Config")].scale;if(r==="auto"){if(B._discrete===t)return n;var i=c.map(function(e){return e[t]});return at.deviation(i)/at.mean(i)>3?"log":"linear"}return r||n};var I=this._yConfigScale=E("y",F).toLowerCase();var V=this._y2ConfigScale=E("y2",D).toLowerCase();var G=this._xConfigScale=E("x",q).toLowerCase();var H=this._x2ConfigScale=E("x2",L).toLowerCase();m={x:N,x2:j||N,y:W,y2:M||W};Object.keys(m).forEach(function(t){if(B["_".concat(t,"ConfigScale")]==="log"&&m[t].includes(0)){if(at.min(m[t])<0)m[t][1]=at.max(c.map(function(e){return e[t]}).filter(Boolean));else m[t][0]=at.min(c.map(function(e){return e[t]}).filter(Boolean))}});u.forEach(function(e){if(B["_".concat(e,"Config")].domain){var t=B["_".concat(e,"Config")].domain;if(B._discrete==="x")t.reverse();m[e]=t}else if(e&&B._baseline!==void 0){var n=B._baseline;if(m[e]&&m[e][0]>n)m[e][0]=n;else if(m[e]&&m[e][1]<n)m[e][1]=n}});var U=st["scale".concat(q)]().domain(m.x).range(at.range(0,R+1,R/(m.x.length-1))),K=st["scale".concat(L)]().domain(m.x2).range(at.range(0,R+1,R/(m.x2.length-1))),Y=st["scale".concat(F)]().domain(m.y.reverse()).range(at.range(0,a+1,a/(m.y.length-1))),J=st["scale".concat(D)]().domain(m.y2.reverse()).range(at.range(0,a+1,a/(m.y2.length-1)));var Q=ot.nest().key(function(e){return e.shape}).entries(c).sort(function(e,t){return B._shapeSort(e.key,t.key)});var X=this._discrete==="x"?F:q;if(X!=="Point"){Q.forEach(function(e){if(B._buffer[e.key]){var t=B._buffer[e.key].bind(B)({data:e.values,x:U,y:Y,yScale:I,xScale:G,config:B._shapeConfig[e.key]});U=t[0];Y=t[1];var n=B._buffer[e.key].bind(B)({data:e.values,x:K,y:J,yScale:V,xScale:H,x2:true,y2:true,config:B._shapeConfig[e.key]});K=n[0];J=n[1]}})}N=U.domain();j=K.domain();W=Y.domain();M=J.domain();var Z={barConfig:{"stroke-width":0},gridSize:0,labels:[],title:false,tickSize:0};var $=r?{}:Z;var ee=i?{}:Z;var te=this._discrete==="x"&&this._width>this._discreteCutoff||this._width>this._xCutoff;var ne=this._discrete==="y"&&this._height>this._discreteCutoff||this._height>this._yCutoff;var re={gridConfig:{stroke:!this._discrete||this._discrete==="x"?this._yTest.gridConfig().stroke:"transparent"},locale:this._locale,scalePadding:Y.padding?Y.padding():0};if(!te){re.barConfig={stroke:"transparent"};re.tickSize=0;re.shapeConfig={labelBounds:function e(t,n){var r=t.labelBounds,i=r.width,a=r.y;var o=B._height/2;var s=n?-o:0;return{x:s,y:a,width:i,height:o}},labelConfig:{padding:0,rotate:0,verticalAlign:function e(t){return t.id===ce[0]?"top":"bottom"}},labelRotation:false}}var ie=it.elem("g.d3plus-plot-test",{enter:{opacity:0},parent:this._select}),ae=this._discrete==="x"&&!h?m.x2:undefined,oe=!ne?at.extent(m.x):this._discrete==="x"&&!v?m.x:undefined,se=this._discrete==="y"&&!_?m.y2:undefined,ce=!te?at.extent(m.y):this._discrete==="y"&&!g?m.y:undefined;if(ne){this._yTest.domain(W).height(a).maxSize(R/2).range([undefined,undefined]).select(ie.node()).ticks(ce).width(R).config(re).config(this._yConfig).scale(I).render()}var fe=this._yTest.outerBounds();var ue=fe.width?fe.width+this._yTest.padding():undefined;if(i){this._y2Test.domain(M).height(a).range([undefined,undefined]).select(ie.node()).ticks(se).width(R).config(re).config(ee).config(this._y2Config).scale(V).render()}var le=this._y2Test.outerBounds();var de=le.width?le.width+this._y2Test.padding():undefined;var he={gridConfig:{stroke:!this._discrete||this._discrete==="y"?this._xTest.gridConfig().stroke:"transparent"},locale:this._locale,scalePadding:U.padding?U.padding():0};if(!ne){he.barConfig={stroke:"transparent"};he.tickSize=0;he.shapeConfig={labelBounds:function e(t,n){var r=t.labelBounds,i=r.height,a=r.y;var o=B._width/2;var s=n?-o:0;return{x:s,y:a,width:o,height:i}},labelConfig:{padding:0,rotate:0,textAnchor:function e(t){return t.id===oe[0]?"start":"end"}},labelRotation:false}}var ve=undefined;if(this._lineLabels){var _e=ot.nest().key(function(e){return e.id}).entries(c.filter(function(e){return e.shape==="Line"}));if(_e.length&&_e.length<this._dataCutoff){var ge=it.configPrep.bind(this)(this._shapeConfig,"shape","Line");yt.config(ge);var ye=yt.labelConfig();var pe=ye.fontSize!==undefined?ye.fontSize:pt.fontSize();var xe=ye.fontWeight!==undefined?ye.fontWeight:pt.fontWeight();var me=ye.fontFamily!==undefined?ye.fontFamily:pt.fontFamily();var be=ye.padding!==undefined?ye.padding:pt.padding();var ke=ge.label||this._drawLabel;var Ce=_e.map(function(e){var t=e.values[e.values.length-1];var n;while(t.__d3plus__&&t.data){t=t.data;n=t.i}var r=typeof ke==="function"?ke(t,n):ke;var i=typeof pe==="function"?pe(t,n):pe;var a=typeof xe==="function"?xe(t,n):xe;var o=typeof me==="function"?me(t,n):me;if(o instanceof Array)o=o.map(function(e){return"'".concat(e,"'")}).join(", ");var s=typeof be==="function"?be(t,n):be;var c=lt.textWidth(r,{"font-size":i,"font-family":o,"font-weight":a});return c+s*2});var Se=at.max(Ce);var we=at.min([Se,R/4]);ve=R-we-this._margin.right}}if(te){this._xTest.domain(N).height(a).maxSize(a/2).range([undefined,ve]).select(ie.node()).ticks(oe).width(R).config(he).config(this._xConfig).scale(G).render()}if(r){this._x2Test.domain(j).height(a).range([undefined,ve]).select(ie.node()).ticks(ae).width(R).config(he).tickSize(0).config($).config(this._x2Config).scale(H).render()}var Ae=this._xTest._getRange();var Oe=this._x2Test._getRange();var Pe=this._x2Test.outerBounds();var ze=r?Pe.height+this._x2Test.padding():0;var Te=at.max([ue,Ae[0],Oe[0]]);if(te){this._xTest.range([Te,undefined]).render()}var je=ne?this._yTest.shapeConfig().labelConfig.fontSize()/2:0;var Le=at.max([de,R-Ae[1],R-Oe[1]]);var Me=this._xTest.outerBounds();var De=Me.height+(ne?this._xTest.padding():0);this._padding.left+=Te;this._padding.right+=Le;this._padding.bottom+=De;this._padding.top+=ze+je;_t(vt(rt.prototype),"_draw",this).call(this,t);var Ee=this._margin.left+this._margin.right;var Be=this._margin.top+this._margin.bottom;var Re=[ze,a-(De+je+Be)];if(ne){this._yTest.domain(W).height(a).maxSize(R/2).range(Re).select(ie.node()).ticks(ce).width(R).config(re).config(this._yConfig).scale(I).render()}fe=this._yTest.outerBounds();ue=fe.width?fe.width+this._yTest.padding():undefined;Te=at.max([ue,Ae[0],Oe[0]]);if(i){this._y2Test.config(re).domain(M).gridSize(0).height(a).range(Re).select(ie.node()).width(R-at.max([0,Le-de])).title(false).config(this._y2Config).config(ee).scale(V).render()}le=this._y2Test.outerBounds();de=le.width?le.width+this._y2Test.padding():undefined;Le=at.max([0,de,R-Ae[1],R-Oe[1]]);var Ne=[Te,R-(Le+Ee)];var qe=it.elem("g.d3plus-plot-background",{parent:l,transition:d});var We="translate(".concat(this._margin.left,", ").concat(this._margin.top+ze+je,")");var Fe="translate(".concat(this._margin.left,", ").concat(this._margin.top+je,")");var Ie=te&&it.elem("g.d3plus-plot-x-axis",{parent:l,transition:d,enter:{transform:We},update:{transform:We}});var Ve=r&&it.elem("g.d3plus-plot-x2-axis",{parent:l,transition:d,enter:{transform:Fe},update:{transform:Fe}});var Ge=Te>ue?Te-ue:0;var He="translate(".concat(this._margin.left+Ge,", ").concat(this._margin.top+je,")");var Ue=ne&&it.elem("g.d3plus-plot-y-axis",{parent:l,transition:d,enter:{transform:He},update:{transform:He}});var Ke="translate(-".concat(this._margin.right,", ").concat(this._margin.top+je,")");var Ye=i&&it.elem("g.d3plus-plot-y2-axis",{parent:l,transition:d,enter:{transform:Ke},update:{transform:Ke}});this._xAxis.domain(N).height(a-(ze+je+Be)).maxSize(a/2).range(Ne).select(te?Ie.node():undefined).ticks(oe).width(R).config(he).config(this._xConfig).scale(G).render();if(r){this._x2Axis.domain(j).height(a-(De+je+Be)).range(Ne).select(Ve.node()).ticks(ae).width(R).config(he).config($).config(this._x2Config).scale(H).render()}U=function e(t,n){if(n==="x2"){if(H==="log"&&t===0)t=j[0]<0?B._x2Axis._d3Scale.domain()[1]:B._x2Axis._d3Scale.domain()[0];return B._x2Axis._getPosition.bind(B._x2Axis)(t)}else{if(G==="log"&&t===0)t=N[0]<0?B._xAxis._d3Scale.domain()[1]:B._xAxis._d3Scale.domain()[0];return B._xAxis._getPosition.bind(B._xAxis)(t)}};Re=[this._xAxis.outerBounds().y+ze,a-(De+je+Be)];this._yAxis.domain(W).height(a).maxSize(R/2).range(Re).select(ne?Ue.node():undefined).ticks(ce).width(Ne[Ne.length-1]).config(re).config(this._yConfig).scale(I).render();if(i){this._y2Axis.config(re).domain(i?M:W).gridSize(0).height(a).range(Re).select(Ye.node()).width(R-at.max([0,Le-de])).title(false).config(this._y2Config).config(ee).scale(V).render()}Y=function e(t,n){if(n==="y2"){if(V==="log"&&t===0)t=M[1]<0?B._y2Axis._d3ScaleNegative.domain()[0]:B._y2Axis._d3Scale.domain()[1];return B._y2Axis._getPosition.bind(B._y2Axis)(t)-ze}else{if(I==="log"&&t===0)t=W[1]<0?B._yAxis._d3ScaleNegative.domain()[0]:B._yAxis._d3Scale.domain()[1];return B._yAxis._getPosition.bind(B._yAxis)(t)-ze}};(new ut.Rect).data([{}]).select(qe.node()).x(Ne[0]+(Ne[1]-Ne[0])/2).width(Ne[1]-Ne[0]).y(this._margin.top+je+Re[0]+(Re[1]-Re[0])/2).height(Re[1]-Re[0]).config(this._backgroundConfig).render();var Je=it.elem("g.d3plus-plot-annotations",{parent:l,transition:d,enter:{transform:We},update:{transform:We}}).node();this._annotations.forEach(function(e){(new ut[e.shape]).config(e).config({x:function e(t){return t.x2?U(t.x2,"x2"):U(t.x)},x0:B._discrete==="x"?function(e){return e.x2?U(e.x2,"x2"):U(e.x)}:U(m.x[0]),x1:B._discrete==="x"?null:function(e){return e.x2?U(e.x2,"x2"):U(e.x)},y:function e(t){return t.y2?Y(t.y2,"y2"):Y(t.y)},y0:B._discrete==="y"?function(e){return e.y2?Y(e.y2,"y2"):Y(e.y)}:Y(m.y[1])-Qe,y1:B._discrete==="y"?null:function(e){return e.y2?Y(e.y2,"y2"):Y(e.y)-Qe}}).select(Je).render()});var Qe=this._xAxis.barConfig()["stroke-width"];if(Qe)Qe/=2;var Xe=this._discrete||"x";var Ze={discrete:this._discrete,duration:this._duration,label:function e(t){return B._drawLabel(t.data,t.i)},select:it.elem("g.d3plus-plot-shapes",{parent:l,transition:d,enter:{transform:We},update:{transform:We}}).node(),x:function e(t){return t.x2!==undefined?U(t.x2,"x2"):U(t.x)},x0:Xe==="x"?function(e){return e.x2?U(e.x2,"x2"):U(e.x)}:U(typeof this._baseline==="number"?this._baseline:m.x[0]),x1:Xe==="x"?null:function(e){return e.x2?U(e.x2,"x2"):U(e.x)},y:function e(t){return t.y2!==undefined?Y(t.y2,"y2"):Y(t.y)},y0:Xe==="y"?function(e){return e.y2?Y(e.y2,"y2"):Y(e.y)}:Y(typeof this._baseline==="number"?this._baseline:m.y[1])-Qe,y1:Xe==="y"?null:function(e){return e.y2?Y(e.y2,"y2"):Y(e.y)-Qe}};if(this._stacked){var $e=f==="x"?U:Y;Ze["".concat(f)]=Ze["".concat(f,"0")]=function(e){var t=k.indexOf(e.id),n=x.indexOf(e.discrete);return t>=0?$e(b[t][n][0]):$e(m[f][f==="x"?0:1])};Ze["".concat(f,"1")]=function(e){var t=k.indexOf(e.id),n=x.indexOf(e.discrete);return t>=0?$e(b[t][n][1]):$e(m[f][f==="x"?0:1])}}var et=Object.keys(this._on);Q.forEach(function(t){var n=(new ut[t.key]).config(Ze).data(t.values);if(t.key==="Bar"){var e;var r=B._discrete==="x"?U:Y;var i=B._discrete==="x"?q:F;var a=B._discrete==="x"?N:W;var o=B._discrete==="x"?Ne:Re;if(i!=="Point"&&a.length===2){e=(r(t.values[B._discrete==="x"?0:t.values.length-1][B._discrete])-r(a[0]))*2}else if(a.length>1)e=r(a[1])-r(a[0]);else e=o[o.length-1]-o[0];if(B._groupPadding<e)e-=B._groupPadding;var s=e||1;var c=ot.nest().key(function(e){return e[B._discrete]}).key(function(e){return e.group}).entries(t.values);var f=at.merge(c.map(function(e){return e.values.map(function(e){return e.key})}));var u=Array.from(new Set(f));if(at.max(c.map(function(e){return e.values.length}))===1){n[B._discrete](function(e,t){return Ze[B._discrete](e,t)})}else{s=(s-B._barPadding*u.length-1)/u.length;var l=e/2-s/2;var d=st.scaleLinear().domain([0,u.length-1]).range([-l,l]);n[B._discrete](function(e,t){return Ze[B._discrete](e,t)+d(u.indexOf(e.group))})}n.width(s);n.height(s)}else if(t.key==="Line"){n.duration(R*1.5);if(B._confidence){var h=Object.assign({},Ze);var v=B._discrete||"x";var _=v==="x"?"y":"x";var g=v==="x"?Y:U;h["".concat(_,"0")]=function(e){return g(B._confidence[0]?e.lci:e[_])};h["".concat(_,"1")]=function(e){return g(B._confidence[1]?e.hci:e[_])};var y=(new ut.Area).config(h).data(t.values);var p=Object.assign(B._shapeConfig,B._confidenceConfig);y.config(it.configPrep.bind(B)(p,"shape","Area")).render();B._shapes.push(y)}n.config({discrete:Ze.discrete||"x",label:B._lineLabels?B._drawLabel:false,labelBounds:B._lineLabels?function(e,t,n){var r=gt(n.points[0],2),i=r[0],a=r[1];var o=gt(n.points[n.points.length-1],2),s=o[0],c=o[1];var f=B._height/4;return{x:s-i,y:c-a-f/2,width:B._padding.right,height:f}}:false})}var x=et.filter(function(e){return e.includes(".".concat(t.key))}),m=et.filter(function(e){return!e.includes(".")}),b=et.filter(function(e){return e.includes(".shape")});var k=function e(t){n.on(m[t],function(e){return B._on[m[t]](e.data,e.i)})};for(var C=0;C<m.length;C++){k(C)}var S=function e(t){n.on(b[t],function(e){return B._on[b[t]](e.data,e.i)})};for(var w=0;w<b.length;w++){S(w)}var A=function e(t){n.on(x[t],function(e){return B._on[x[t]](e.data,e.i)})};for(var O=0;O<x.length;O++){A(O)}var P=it.configPrep.bind(B)(B._shapeConfig,"shape",t.key);if(B._shapeConfig.duration===undefined)delete P.duration;n.config(P).render();B._shapes.push(n);if(t.key==="Line"&&B._lineMarkers){var z=(new ut.Circle).data(t.values).config(Ze).config(B._lineMarkerConfig).id(function(e){return"".concat(e.id,"_").concat(e.discrete)});var T=function e(t){z.on(m[t],function(e){return B._on[m[t]](e.data,e.i)})};for(var j=0;j<m.length;j++){T(j)}var L=function e(t){z.on(b[t],function(e){return B._on[b[t]](e.data,e.i)})};for(var M=0;M<b.length;M++){L(M)}var D=function e(t){z.on(x[t],function(e){return B._on[x[t]](e.data,e.i)})};for(var E=0;E<x.length;E++){D(E)}z.render();B._shapes.push(z)}});var tt=Q.map(function(e){return e.key});if(tt.includes("Line")){if(this._confidence)tt.push("Area");if(this._labelMarkers)tt.push("Circle")}var nt=this._previousShapes.filter(function(e){return!tt.includes(e)});nt.forEach(function(e){(new ut[e]).config(Ze).data([]).render()});this._previousShapes=tt;return this}},{key:"annotations",value:function e(t){return arguments.length?(this._annotations=t instanceof Array?t:[t],this):this._annotations}},{key:"backgroundConfig",value:function e(t){return arguments.length?(this._backgroundConfig=it.assign(this._backgroundConfig,t),this):this._backgroundConfig}},{key:"barPadding",value:function e(t){return arguments.length?(this._barPadding=t,this):this._barPadding}},{key:"baseline",value:function e(t){return arguments.length?(this._baseline=t,this):this._baseline}},{key:"confidence",value:function e(t){if(arguments.length&&t instanceof Array){this._confidence=[];var n=t[0];this._confidence[0]=typeof n==="function"||!n?n:it.accessor(n);var r=t[1];this._confidence[1]=typeof r==="function"||!r?r:it.accessor(r);return this}else return this._confidence}},{key:"confidenceConfig",value:function e(t){return arguments.length?(this._confidenceConfig=it.assign(this._confidenceConfig,t),this):this._confidenceConfig}},{key:"discrete",value:function e(t){return arguments.length?(this._discrete=t,this):this._discrete}},{key:"discreteCutoff",value:function e(t){return arguments.length?(this._discreteCutoff=t,this):this._discreteCutoff}},{key:"groupPadding",value:function e(t){return arguments.length?(this._groupPadding=t,this):this._groupPadding}},{key:"lineLabels",value:function e(t){return arguments.length?(this._lineLabels=t,this):this._lineLabels}},{key:"lineMarkerConfig",value:function e(t){return arguments.length?(this._lineMarkerConfig=it.assign(this._lineMarkerConfig,t),this):this._lineMarkerConfig}},{key:"lineMarkers",value:function e(t){return arguments.length?(this._lineMarkers=t,this):this._lineMarkers}},{key:"shapeSort",value:function e(t){return arguments.length?(this._shapeSort=t,this):this._shapeSort}},{key:"size",value:function e(t){return arguments.length?(this._size=typeof t==="function"||!t?t:it.accessor(t),this):this._size}},{key:"sizeMax",value:function e(t){return arguments.length?(this._sizeMax=t,this):this._sizeMax}},{key:"sizeMin",value:function e(t){return arguments.length?(this._sizeMin=t,this):this._sizeMin}},{key:"sizeScale",value:function e(t){return arguments.length?(this._sizeScale=t,this):this._sizeScale}},{key:"stacked",value:function e(t){return arguments.length?(this._stacked=t,this):this._stacked}},{key:"stackOffset",value:function e(t){return arguments.length?(this._stackOffset=typeof t==="function"?t:ct["stackOffset".concat(t.charAt(0).toUpperCase()+t.slice(1))],this):this._stackOffset}},{key:"stackOrder",value:function e(t){if(arguments.length){if(typeof t==="string")this._stackOrder=t==="ascending"?C:t==="descending"?S:ct["stackOrder".concat(t.charAt(0).toUpperCase()+t.slice(1))];else this._stackOrder=t;return this}else return this._stackOrder}},{key:"x",value:function e(t){if(arguments.length){if(typeof t==="function")this._x=t;else{this._x=it.accessor(t);if(!this._aggs[t]&&this._discrete==="x"){this._aggs[t]=function(e){var t=Array.from(new Set(e));return t.length===1?t[0]:t}}}return this}else return this._x}},{key:"x2",value:function e(t){if(arguments.length){if(typeof t==="function")this._x2=t;else{this._x2=it.accessor(t);if(!this._aggs[t]&&this._discrete==="x"){this._aggs[t]=function(e){var t=Array.from(new Set(e));return t.length===1?t[0]:t}}}return this}else return this._x2}},{key:"xConfig",value:function e(t){return arguments.length?(this._xConfig=it.assign(this._xConfig,t),this):this._xConfig}},{key:"xCutoff",value:function e(t){return arguments.length?(this._xCutoff=t,this):this._xCutoff}},{key:"x2Config",value:function e(t){return arguments.length?(this._x2Config=it.assign(this._x2Config,t),this):this._x2Config}},{key:"xDomain",value:function e(t){return arguments.length?(this._xDomain=t,this):this._xDomain}},{key:"x2Domain",value:function e(t){return arguments.length?(this._x2Domain=t,this):this._x2Domain}},{key:"xSort",value:function e(t){return arguments.length?(this._xSort=t,this):this._xSort}},{key:"x2Sort",value:function e(t){return arguments.length?(this._x2Sort=t,this):this._x2Sort}},{key:"y",value:function e(t){if(arguments.length){if(typeof t==="function")this._y=t;else{this._y=it.accessor(t);if(!this._aggs[t]&&this._discrete==="y"){this._aggs[t]=function(e){var t=Array.from(new Set(e));return t.length===1?t[0]:t}}}return this}else return this._y}},{key:"y2",value:function e(t){if(arguments.length){if(typeof t==="function")this._y2=t;else{this._y2=it.accessor(t);if(!this._aggs[t]&&this._discrete==="y2"){this._aggs[t]=function(e){var t=Array.from(new Set(e));return t.length===1?t[0]:t}}}return this}else return this._y2}},{key:"yConfig",value:function e(t){if(arguments.length){if(t.domain)t.domain=t.domain.slice().reverse();this._yConfig=it.assign(this._yConfig,t);return this}return this._yConfig}},{key:"yCutoff",value:function e(t){return arguments.length?(this._yCutoff=t,this):this._yCutoff}},{key:"y2Config",value:function e(t){if(arguments.length){if(t.domain)t.domain=t.domain.slice().reverse();this._y2Config=it.assign(this._y2Config,t);return this}return this._y2Config}},{key:"yDomain",value:function e(t){return arguments.length?(this._yDomain=t,this):this._yDomain}},{key:"y2Domain",value:function e(t){return arguments.length?(this._y2Domain=t,this):this._y2Domain}},{key:"ySort",value:function e(t){return arguments.length?(this._ySort=t,this):this._ySort}},{key:"y2Sort",value:function e(t){return arguments.length?(this._y2Sort=t,this):this._y2Sort}}]);return rt}(t.Viz);var P=function(e){o(t,e);function t(){var e;n(this,t);e=f(this,vt(t).call(this));e._baseline=0;e._discrete="x";e._shape=it.constant("Area");e.x("x");return e}return t}(O);var z=function(e){o(t,e);function t(){var e;n(this,t);e=f(this,vt(t).call(this));e._baseline=0;e._discrete="x";e._shape=it.constant("Bar");e.x("x");return e}return t}(O);var T=function(e){o(t,e);function t(){var i;n(this,t);i=f(this,vt(t).call(this));i._discrete="x";i._shape=it.constant("Box");i.x("x");i._tooltipConfig=it.assign(i._tooltipConfig,{title:function e(t,n){if(!t)return"";while(t.__d3plus__&&t.data){t=t.data;n=t.i}if(i._label)return i._label(t,n);var r=i._ids(t,n).slice(0,i._drawDepth);return r[r.length-1]}});return i}return t}(O);var j=function(e){o(t,e);function t(){var o;n(this,t);o=f(this,vt(t).call(this));o._discrete="x";o._shape=it.constant("Line");o.x("x");o.y2(function(e){return o._y(e)});o.yConfig({tickFormat:function e(t){var n=o._formattedData;var r=n[0].x instanceof Date?n[0].x.getTime():n[0].x;var i=n.filter(function(e){return(e.x instanceof Date?e.x.getTime():e.x)===r});var a=i.find(function(e){return e.y===t});return a?o._drawLabel(a,a.i):""}});o.y2Config({tickFormat:function e(t){var n=o._formattedData;var r=n[n.length-1].x instanceof Date?n[n.length-1].x.getTime():n[n.length-1].x;var i=n.filter(function(e){return(e.x instanceof Date?e.x.getTime():e.x)===r});var a=i.find(function(e){return e.y===t});return a?o._drawLabel(a,a.i):""}});o.ySort(function(e,t){return o._y(t)-o._y(e)});o.y2Sort(function(e,t){return o._y(t)-o._y(e)});return o}return t}(O);var L=function(e){o(t,e);function t(){var e;n(this,t);e=f(this,vt(t).call(this));e._discrete="x";e._shape=it.constant("Line");e.x("x");return e}return t}(O);var M=Math.PI*2;var D=function(e){o(x,e);function x(){var e;n(this,x);e=f(this,vt(x).call(this));e._axisConfig={shapeConfig:{fill:it.constant("none"),labelConfig:{fontColor:"#000",padding:0,textAnchor:function e(t,n,r){return r.textAnchor},verticalAlign:"middle"},stroke:"#ccc",strokeWidth:it.constant(1)}};e._discrete="metric";e._levels=6;e._metric=it.accessor("metric");e._outerPadding=100;e._shape=it.constant("Path");e._value=it.accessor("value");return e}i(x,[{key:"_draw",value:function e(t){var h=this;_t(vt(x.prototype),"_draw",this).call(this,t);var f=this._height-this._margin.top-this._margin.bottom,u=this._width-this._margin.left-this._margin.right;var v=at.min([f,u])/2-this._outerPadding,n="translate(".concat(u/2,", ").concat(f/2,")");var r=ot.nest().key(this._metric).entries(this._filteredData),i=ot.nest().key(this._id).key(this._metric).entries(this._filteredData);var a=at.max(i.map(function(e){return e.values.map(function(e){return at.sum(e.values,function(e,t){return h._value(e,t)})})}).flat());var o=Array.from(Array(this._levels).keys()).map(function(e){return{id:e,r:v*((e+1)/h._levels)}});var s=it.configPrep.bind(this)(this._axisConfig.shapeConfig,"shape","Circle");delete s.label;(new ut.Circle).data(o).select(it.elem("g.d3plus-Radar-radial-circles",{parent:this._select,enter:{transform:n},update:{transform:n}}).node()).config(s).render();var _=r.length;var c=r.map(function(e,t){var n=h._outerPadding;var r=h._shapeConfig.labelConfig.fontSize&&h._shapeConfig.labelConfig.fontSize(e,t)||11;var i=r*1.4;var a=i*2;var o=10,s=parseInt(360-360/_*t/90,10)%4+1,c=M/_*t;var f=360/_*t;var u="start";var l=o;if(s===2||s===3){l=-n-o;u="end";f+=180}var d={x:l,y:-a/2,width:n,height:a};return{__d3plus__:true,data:it.merge(e.values),i:t,id:e.key,angle:f,textAnchor:u,labelBounds:d,rotateAnchor:[-l,a/2],x:v*Math.cos(c),y:v*Math.sin(c)}}).sort(function(e,t){return e.key-t.key});(new ut.Rect).data(c).rotate(function(e){return e.angle||0}).width(0).height(0).x(function(e){return e.x}).y(function(e){return e.y}).label(function(e){return e.id}).labelBounds(function(e){return e.labelBounds}).labelConfig(this._axisConfig.shapeConfig.labelConfig).select(it.elem("g.d3plus-Radar-text",{parent:this._select,enter:{transform:n},update:{transform:n}}).node()).render();(new ut.Path).data(c).d(function(e){return"M".concat(0,",",0," ",-e.x,",").concat(-e.y)}).select(it.elem("g.d3plus-Radar-axis",{parent:this._select,enter:{transform:n},update:{transform:n}}).node()).config(it.configPrep.bind(this)(this._axisConfig.shapeConfig,"shape","Path")).render();var l=i.map(function(e){var t=e.values.map(function(e,t){var n=at.sum(e.values,function(e,t){return h._value(e,t)});var r=n/a*v,i=M/_*t;return{x:r*Math.cos(i),y:r*Math.sin(i)}});var n="M ".concat(t[0].x," ").concat(t[0].y," ").concat(t.map(function(e){return"L ".concat(e.x," ").concat(e.y)}).join(" ")," L ").concat(t[0].x," ").concat(t[0].y);return{arr:e.values.map(function(e){return it.merge(e.values)}),id:e.key,points:t,d:n,__d3plus__:true,data:it.merge(e.values.map(function(e){return it.merge(e.values)}))}});var d=it.configPrep.bind(this)(this._shapeConfig,"shape","Path");var g=Object.keys(d.on);d.on={};var y=function e(t){var c=g[t];d.on[c]=function(e,t){var n=e.points.map(function(e){return e.x+u/2});var r=e.points.map(function(e){return e.y+f/2});var i=m.mouse(h._select.node());var a=n.map(function(e){return Math.abs(e-i[0])});var o=r.map(function(e){return Math.abs(e-i[1])});var s=a.map(function(e,t){return e+o[t]});h._on[c].bind(h)(e.arr[s.indexOf(at.min(s))],t)}};for(var p=0;p<g.length;p++){y(p)}this._shapes.push((new ut.Path).data(l).d(function(e){return e.d}).select(it.elem("g.d3plus-Radar-items",{parent:this._select,enter:{transform:n},update:{transform:n}}).node()).config(d).render());return this}},{key:"axisConfig",value:function e(t){return arguments.length?(this._axisConfig=it.assign(this._axisConfig,t),this):this._axisConfig}},{key:"metric",value:function e(t){return arguments.length?(this._metric=typeof t==="function"?t:it.accessor(t),this):this._metric}},{key:"outerPadding",value:function e(t){return arguments.length?(this._outerPadding=t,this):this._outerPadding}},{key:"value",value:function e(t){return arguments.length?(this._value=typeof t==="function"?t:it.accessor(t),this):this._value}}]);return x}(t.Viz);var E=function(e){o(t,e);function t(){var e;n(this,t);e=f(this,vt(t).call(this));e._stacked=true;return e}return t}(P);e.AreaPlot=P;e.BarChart=z;e.BoxWhisker=T;e.BumpChart=j;e.LinePlot=L;e.Plot=O;e.Radar=D;e.StackedArea=E;Object.defineProperty(e,"__esModule",{value:true})});