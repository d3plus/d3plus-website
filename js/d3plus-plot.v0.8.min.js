/*
  d3plus-plot v0.8.33
  A reusable javascript x/y plot built on D3.
  Copyright (c) 2020 D3plus - https://d3plus.org
  @license MIT
*/
(function(t){typeof define==="function"&&define.amd?define(t):t()})(function(){"use strict";var t=typeof globalThis!=="undefined"?globalThis:typeof window!=="undefined"?window:typeof global!=="undefined"?global:typeof self!=="undefined"?self:{};function e(t,e){return e={exports:{}},t(e,e.exports),e.exports}var n=function(t){return t&&t.Math==Math&&t};var d=n(typeof globalThis=="object"&&globalThis)||n(typeof window=="object"&&window)||n(typeof self=="object"&&self)||n(typeof t=="object"&&t)||Function("return this")();var r=function(t){try{return!!t()}catch(t){return true}};var h=!r(function(){return Object.defineProperty({},"a",{get:function(){return 7}}).a!=7});var i={}.propertyIsEnumerable;var a=Object.getOwnPropertyDescriptor;var o=a&&!i.call({1:2},1);var s=o?function t(e){var n=a(this,e);return!!n&&n.enumerable}:i;var v={f:s};var c=function(t,e){return{enumerable:!(t&1),configurable:!(t&2),writable:!(t&4),value:e}};var u={}.toString;var f=function(t){return u.call(t).slice(8,-1)};var l="".split;var m=r(function(){return!Object("z").propertyIsEnumerable(0)})?function(t){return f(t)=="String"?l.call(t,""):Object(t)}:Object;var _=function(t){if(t==undefined)throw TypeError("Can't call method on "+t);return t};var g=function(t){return m(_(t))};var y=function(t){return typeof t==="object"?t!==null:typeof t==="function"};var p=function(t,e){if(!y(t))return t;var n,r;if(e&&typeof(n=t.toString)=="function"&&!y(r=n.call(t)))return r;if(typeof(n=t.valueOf)=="function"&&!y(r=n.call(t)))return r;if(!e&&typeof(n=t.toString)=="function"&&!y(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")};var x={}.hasOwnProperty;var b=function(t,e){return x.call(t,e)};var k=d.document;var w=y(k)&&y(k.createElement);var C=function(t){return w?k.createElement(t):{}};var S=!h&&!r(function(){return Object.defineProperty(C("div"),"a",{get:function(){return 7}}).a!=7});var O=Object.getOwnPropertyDescriptor;var A=h?O:function t(e,n){e=g(e);n=p(n,true);if(S)try{return O(e,n)}catch(t){}if(b(e,n))return c(!v.f.call(e,n),e[n])};var P={f:A};var T=function(t){if(!y(t)){throw TypeError(String(t)+" is not an object")}return t};var z=Object.defineProperty;var j=h?z:function t(e,n,r){T(e);n=p(n,true);T(r);if(S)try{return z(e,n,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported");if("value"in r)e[n]=r.value;return e};var D={f:j};var M=h?function(t,e,n){return D.f(t,e,c(1,n))}:function(t,e,n){t[e]=n;return t};var E=function(e,n){try{M(d,e,n)}catch(t){d[e]=n}return n};var L="__core-js_shared__";var B=d[L]||E(L,{});var R=B;var q=e(function(t){(t.exports=function(t,e){return R[t]||(R[t]=e!==undefined?e:{})})("versions",[]).push({version:"3.4.7",mode:"global",copyright:"Â© 2019 Denis Pushkarev (zloirock.ru)"})});var N=Function.toString;var F=q("inspectSource",function(t){return N.call(t)});var I=d.WeakMap;var W=typeof I==="function"&&/native code/.test(F(I));var V=0;var G=Math.random();var H=function(t){return"Symbol("+String(t===undefined?"":t)+")_"+(++V+G).toString(36)};var U=q("keys");var K=function(t){return U[t]||(U[t]=H(t))};var Y={};var J=d.WeakMap;var Q,X,Z;var $=function(t){return Z(t)?X(t):Q(t,{})};var tt=function(n){return function(t){var e;if(!y(t)||(e=X(t)).type!==n){throw TypeError("Incompatible receiver, "+n+" required")}return e}};if(W){var et=new J;var nt=et.get;var rt=et.has;var it=et.set;Q=function(t,e){it.call(et,t,e);return e};X=function(t){return nt.call(et,t)||{}};Z=function(t){return rt.call(et,t)}}else{var at=K("state");Y[at]=true;Q=function(t,e){M(t,at,e);return e};X=function(t){return b(t,at)?t[at]:{}};Z=function(t){return b(t,at)}}var ot={set:Q,get:X,has:Z,enforce:$,getterFor:tt};var st=e(function(t){var e=ot.get;var s=ot.enforce;var c=String(String).split("String");(t.exports=function(t,e,n,r){var i=r?!!r.unsafe:false;var a=r?!!r.enumerable:false;var o=r?!!r.noTargetGet:false;if(typeof n=="function"){if(typeof e=="string"&&!b(n,"name"))M(n,"name",e);s(n).source=c.join(typeof e=="string"?e:"")}if(t===d){if(a)t[e]=n;else E(e,n);return}else if(!i){delete t[e]}else if(!o&&t[e]){a=true}if(a)t[e]=n;else M(t,e,n)})(Function.prototype,"toString",function t(){return typeof this=="function"&&e(this).source||F(this)})});var ct=d;var ut=function(t){return typeof t=="function"?t:undefined};var ft=function(t,e){return arguments.length<2?ut(ct[t])||ut(d[t]):ct[t]&&ct[t][e]||d[t]&&d[t][e]};var dt=Math.ceil;var lt=Math.floor;var ht=function(t){return isNaN(t=+t)?0:(t>0?lt:dt)(t)};var vt=Math.min;var _t=function(t){return t>0?vt(ht(t),9007199254740991):0};var gt=Math.max;var yt=Math.min;var pt=function(t,e){var n=ht(t);return n<0?gt(n+e,0):yt(n,e)};var xt=function(s){return function(t,e,n){var r=g(t);var i=_t(r.length);var a=pt(n,i);var o;if(s&&e!=e)while(i>a){o=r[a++];if(o!=o)return true}else for(;i>a;a++){if((s||a in r)&&r[a]===e)return s||a||0}return!s&&-1}};var mt={includes:xt(true),indexOf:xt(false)};var bt=mt.indexOf;var kt=function(t,e){var n=g(t);var r=0;var i=[];var a;for(a in n)!b(Y,a)&&b(n,a)&&i.push(a);while(e.length>r)if(b(n,a=e[r++])){~bt(i,a)||i.push(a)}return i};var wt=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"];var Ct=wt.concat("length","prototype");var St=Object.getOwnPropertyNames||function t(e){return kt(e,Ct)};var Ot={f:St};var At=Object.getOwnPropertySymbols;var Pt={f:At};var Tt=ft("Reflect","ownKeys")||function t(e){var n=Ot.f(T(e));var r=Pt.f;return r?n.concat(r(e)):n};var zt=function(t,e){var n=Tt(e);var r=D.f;var i=P.f;for(var a=0;a<n.length;a++){var o=n[a];if(!b(t,o))r(t,o,i(e,o))}};var jt=/#|\.prototype\./;var Dt=function(t,e){var n=Et[Mt(t)];return n==Bt?true:n==Lt?false:typeof e=="function"?r(e):!!e};var Mt=Dt.normalize=function(t){return String(t).replace(jt,".").toLowerCase()};var Et=Dt.data={};var Lt=Dt.NATIVE="N";var Bt=Dt.POLYFILL="P";var Rt=Dt;var qt=P.f;var Nt=function(t,e){var n=t.target;var r=t.global;var i=t.stat;var a,o,s,c,u,f;if(r){o=d}else if(i){o=d[n]||E(n,{})}else{o=(d[n]||{}).prototype}if(o)for(s in e){u=e[s];if(t.noTargetGet){f=qt(o,s);c=f&&f.value}else c=o[s];a=Rt(r?s:n+(i?".":"#")+s,t.forced);if(!a&&c!==undefined){if(typeof u===typeof c)continue;zt(u,c)}if(t.sham||c&&c.sham){M(u,"sham",true)}st(o,s,u,t)}};var Ft=function(t){if(typeof t!="function"){throw TypeError(String(t)+" is not a function")}return t};var It=function(r,i,t){Ft(r);if(i===undefined)return r;switch(t){case 0:return function(){return r.call(i)};case 1:return function(t){return r.call(i,t)};case 2:return function(t,e){return r.call(i,t,e)};case 3:return function(t,e,n){return r.call(i,t,e,n)}}return function(){return r.apply(i,arguments)}};var Wt=function(t){return Object(_(t))};var Vt=Array.isArray||function t(e){return f(e)=="Array"};var Gt=!!Object.getOwnPropertySymbols&&!r(function(){return!String(Symbol())});var Ht=Gt&&!Symbol.sham&&typeof Symbol()=="symbol";var Ut=q("wks");var Kt=d.Symbol;var Yt=Ht?Kt:H;var Jt=function(t){if(!b(Ut,t)){if(Gt&&b(Kt,t))Ut[t]=Kt[t];else Ut[t]=Yt("Symbol."+t)}return Ut[t]};var Qt=Jt("species");var Xt=function(t,e){var n;if(Vt(t)){n=t.constructor;if(typeof n=="function"&&(n===Array||Vt(n.prototype)))n=undefined;else if(y(n)){n=n[Qt];if(n===null)n=undefined}}return new(n===undefined?Array:n)(e===0?0:e)};var Zt=[].push;var $t=function(h){var v=h==1;var _=h==2;var g=h==3;var y=h==4;var p=h==6;var x=h==5||p;return function(t,e,n,r){var i=Wt(t);var a=m(i);var o=It(e,n,3);var s=_t(a.length);var c=0;var u=r||Xt;var f=v?u(t,s):_?u(t,0):undefined;var d,l;for(;s>c;c++)if(x||c in a){d=a[c];l=o(d,c,i);if(h){if(v)f[c]=l;else if(l)switch(h){case 3:return true;case 5:return d;case 6:return c;case 2:Zt.call(f,d)}else if(y)return false}}return p?-1:g||y?y:f}};var te={forEach:$t(0),map:$t(1),filter:$t(2),some:$t(3),every:$t(4),find:$t(5),findIndex:$t(6)};var ee=Object.keys||function t(e){return kt(e,wt)};var ne=h?Object.defineProperties:function t(e,n){T(e);var r=ee(n);var i=r.length;var a=0;var o;while(i>a)D.f(e,o=r[a++],n[o]);return e};var re=ft("document","documentElement");var ie=K("IE_PROTO");var ae="prototype";var oe=function(){};var se=function(){var t=C("iframe");var e=wt.length;var n="<";var r="script";var i=">";var a="java"+r+":";var o;t.style.display="none";re.appendChild(t);t.src=String(a);o=t.contentWindow.document;o.open();o.write(n+r+i+"document.F=Object"+n+"/"+r+i);o.close();se=o.F;while(e--)delete se[ae][wt[e]];return se()};var ce=Object.create||function t(e,n){var r;if(e!==null){oe[ae]=T(e);r=new oe;oe[ae]=null;r[ie]=e}else r=se();return n===undefined?r:ne(r,n)};Y[ie]=true;var ue=Jt("unscopables");var fe=Array.prototype;if(fe[ue]==undefined){M(fe,ue,ce(null))}var de=function(t){fe[ue][t]=true};var le=te.find;var he="find";var ve=true;if(he in[])Array(1)[he](function(){ve=false});Nt({target:"Array",proto:true,forced:ve},{find:function t(e){return le(this,e,arguments.length>1?arguments[1]:undefined)}});de(he);var _e=mt.includes;Nt({target:"Array",proto:true},{includes:function t(e){return _e(this,e,arguments.length>1?arguments[1]:undefined)}});de("includes");var ge=Object.assign;var ye=Object.defineProperty;var pe=!ge||r(function(){if(h&&ge({b:1},ge(ye({},"a",{enumerable:true,get:function(){ye(this,"b",{value:3,enumerable:false})}}),{b:2})).b!==1)return true;var t={};var e={};var n=Symbol();var r="abcdefghijklmnopqrst";t[n]=7;r.split("").forEach(function(t){e[t]=t});return ge({},t)[n]!=7||ee(ge({},e)).join("")!=r})?function t(e,n){var r=Wt(e);var i=arguments.length;var a=1;var o=Pt.f;var s=v.f;while(i>a){var c=m(arguments[a++]);var u=o?ee(c).concat(o(c)):ee(c);var f=u.length;var d=0;var l;while(f>d){l=u[d++];if(!h||s.call(c,l))r[l]=c[l]}}return r}:ge;Nt({target:"Object",stat:true,forced:Object.assign!==pe},{assign:pe});var xe=Jt("match");var me=function(t){var e;return y(t)&&((e=t[xe])!==undefined?!!e:f(t)=="RegExp")};var be=function(t){if(me(t)){throw TypeError("The method doesn't accept regular expressions")}return t};var ke=Jt("match");var we=function(e){var n=/./;try{"/./"[e](n)}catch(t){try{n[ke]=false;return"/./"[e](n)}catch(t){}}return false};Nt({target:"String",proto:true,forced:!we("includes")},{includes:function t(e){return!!~String(_(this)).indexOf(be(e),arguments.length>1?arguments[1]:undefined)}});var Ce=P.f;var Se="".startsWith;var Oe=Math.min;var Ae=we("startsWith");var Pe=!Ae&&!!function(){var t=Ce(String.prototype,"startsWith");return t&&!t.writable}();Nt({target:"String",proto:true,forced:!Pe&&!Ae},{startsWith:function t(e){var n=String(_(this));be(e);var r=_t(Oe(arguments.length>1?arguments[1]:undefined,n.length));var i=String(e);return Se?Se.call(n,i,r):n.slice(r,r+i.length)===i}});if(typeof window!=="undefined"){(function(){var r=function(t,e){var n=t.nodeType;if(n===3){e.push(t.textContent.replace(/&/,"&amp;").replace(/</,"&lt;").replace(">","&gt;"))}else if(n===1){e.push("<",t.tagName);if(t.hasAttributes()){[].forEach.call(t.attributes,function(t){e.push(" ",t.item.name,"='",t.item.value,"'")})}if(t.hasChildNodes()){e.push(">");[].forEach.call(t.childNodes,function(t){r(t,e)});e.push("</",t.tagName,">")}else{e.push("/>")}}else if(n==8){e.push("\x3c!--",t.nodeValue,"--\x3e")}};Object.defineProperty(SVGElement.prototype,"innerHTML",{get:function(){var t=[];var e=this.firstChild;while(e){r(e,t);e=e.nextSibling}return t.join("")},set:function(t){while(this.firstChild){this.removeChild(this.firstChild)}try{var e=new DOMParser;e.async=false;var n="<svg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'>"+t+"</svg>";var r=e.parseFromString(n,"text/xml").documentElement;var i=r.firstChild;while(i){this.appendChild(this.ownerDocument.importNode(i,true));i=i.nextSibling}}catch(t){}}});Object.defineProperty(SVGElement.prototype,"innerSVG",{get:function(){return this.innerHTML},set:function(t){this.innerHTML=t}})})()}});(function(t,e){typeof exports==="object"&&typeof module!=="undefined"?e(exports,require("d3plus-common"),require("d3-array"),require("d3-collection"),require("d3-scale"),require("d3-shape"),require("d3plus-axis"),require("d3plus-color"),require("d3plus-shape"),require("d3plus-viz"),require("d3-selection")):typeof define==="function"&&define.amd?define("d3plus-plot",["exports","d3plus-common","d3-array","d3-collection","d3-scale","d3-shape","d3plus-axis","d3plus-color","d3plus-shape","d3plus-viz","d3-selection"],e):(t=t||self,e(t.d3plus={},t.d3plusCommon,t.d3Array,t.d3Collection,t.scales,t.d3Shape,t.d3plusAxis,t.d3plusColor,t.shapes,t.d3plusViz,t.d3Selection))})(this,function(t,Ut,Kt,Yt,Jt,Qt,Xt,r,Zt,e,m){"use strict";function $t(t){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){$t=function(t){return typeof t}}else{$t=function(t){return t&&typeof Symbol==="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t}}return $t(t)}function n(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(t,r.key,r)}}function a(t,e,n){if(e)i(t.prototype,e);if(n)i(t,n);return t}function te(t,e,n){if(e in t){Object.defineProperty(t,e,{value:n,enumerable:true,configurable:true,writable:true})}else{t[e]=n}return t}function o(t,e){if(typeof e!=="function"&&e!==null){throw new TypeError("Super expression must either be null or a function")}t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:true,configurable:true}});if(e)s(t,e)}function ee(t){ee=Object.setPrototypeOf?Object.getPrototypeOf:function t(e){return e.__proto__||Object.getPrototypeOf(e)};return ee(t)}function s(t,e){s=Object.setPrototypeOf||function t(e,n){e.__proto__=n;return e};return s(t,e)}function c(t){if(t===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t}function u(t,e){if(e&&(typeof e==="object"||typeof e==="function")){return e}return c(t)}function f(t,e){while(!Object.prototype.hasOwnProperty.call(t,e)){t=ee(t);if(t===null)break}return t}function ne(t,e,n){if(typeof Reflect!=="undefined"&&Reflect.get){ne=Reflect.get}else{ne=function t(e,n,r){var i=f(e,n);if(!i)return;var a=Object.getOwnPropertyDescriptor(i,n);if(a.get){return a.get.call(r)}return a.value}}return ne(t,e,n||t)}var x=function(t,e,n){if(t.padding)t.padding(.5);else{var r=e.map(function(t){return t[n]}).reduce(function(t,e,n,r){if(!n)return t;var i=r[n-1];if(!t||e-i<t)return e-i;else return t},0);var i=t.domain().slice();if(n==="y")i.reverse();i[0]=new Date(+i[0]-r/2);i[1]=new Date(+i[1]+r/2);if(n==="y")i.reverse();t.domain(i)}};function d(t){var e=this;var n=t.data,r=t.x,i=t.y,a=t.x2,o=t.y2,s=t.buffer,c=s===void 0?10:s;var u=a?"x2":"x";var f=o?"y2":"y";var d=this._discrete==="x"?i:r;var l=d.domain().slice();var h=this._discrete==="x";if(h)l.reverse();var v,_;if(this._stacked){var g=Yt.nest().key(function(t){return"".concat(t[e._discrete],"_").concat(t.group)}).entries(n).map(function(t){return t.values.map(function(t){return t[h?f:u]})});_=g.map(function(t){return Kt.sum(t.filter(function(t){return t>0}))});v=g.map(function(t){return Kt.sum(t.filter(function(t){return t<0}))})}else{_=n.map(function(t){return t[h?f:u]});v=_}var y=d(Kt.max(_));if(h?y<d(0):y>d(0))y+=h?-c:c;y=d.invert(y);var p=d(Kt.min(v));if(h?p>d(0):p<d(0))p+=h?c:-c;p=d.invert(p);if(y>l[1])l[1]=y;if(p<l[0])l[0]=p;if(h)l.reverse();d.domain(l);x(h?r:i,n,this._discrete);return[r,i]}function l(t){var e=this;var n=t.data,r=t.x,i=t.y,a=t.x2,o=t.y2,s=t.buffer,c=s===void 0?10:s;var u=a?"x2":"x";var f=o?"y2":"y";var d=this._discrete==="x"?i:r;var l=d.domain().slice();var h=this._discrete==="x";if(h)l.reverse();var v,_;if(this._stacked){var g=Yt.nest().key(function(t){return t[e._discrete]}).entries(n).map(function(t){return t.values.map(function(t){return t[h?f:u]})});_=g.map(function(t){return Kt.sum(t.filter(function(t){return t>0}))});v=g.map(function(t){return Kt.sum(t.filter(function(t){return t<0}))})}else{_=n.map(function(t){return t[h?f:u]});v=_}var y=d(Kt.max(_));y+=h?-c:c;y=d.invert(y);var p=d(Kt.min(v));p+=h?c:-c;p=d.invert(p);if(y>l[1])l[1]=y;if(p<l[0])l[0]=p;if(h)l.reverse();d.domain(l);x(h?r:i,n,this._discrete);return[r,i]}function h(t){var e=t.data,o=t.x,s=t.y,n=t.x2,r=t.y2,c=t.config,u=t.buffer;var f=n?"x2":"x";var d=r?"y2":"y";var l=o.domain().slice(),h=s.domain().slice();var v=o.range(),_=s.range();if(!o.invert&&o.padding)x(o,e,this._discrete);if(!s.invert&&s.padding)x(s,e,this._discrete);e.forEach(function(t){var e=u?u:c.r(t.data,t.i)*2;if(o.invert&&o(t[f])-v[0]<e){var n=o.invert(o(t[f])-e);if(n<l[0])l[0]=n}if(o.invert&&v[1]-o(t[f])<e){var r=o.invert(o(t[f])+e);if(r>l[1])l[1]=r}if(s.invert&&s(t[d])-_[0]<e){var i=s.invert(s(t[d])-e);if(i>h[0])h[0]=i}if(s.invert&&_[1]-s(t[d])<e){var a=s.invert(s(t[d])+e);if(a<h[1])h[1]=a}});o=o.copy().domain(l).range(v);s=s.copy().domain(h).range(_);return[o,s]}function v(t){var e=this;var n=t.data,r=t.x,i=t.y,a=t.x2,o=t.y2;var s=a?"x2":"x";var c=o?"y2":"y";var u=this._discrete==="x"?i:r;var f=u.domain().slice();if(this._discrete==="x")f.reverse();var d=n.map(function(t){return t[e._discrete==="x"?c:s]});var l=u.invert(u(Kt.max(d))+(this._discrete==="x"?-10:10));if(l>f[1])f[1]=l;if(this._discrete==="x")f.reverse();u.domain(f);return[r,i]}function _(t){var e=t.data,s=t.x,c=t.y,n=t.x2,r=t.y2,u=t.config;var f=n?"x2":"x";var d=r?"y2":"y";var l=s.domain().slice(),h=c.domain().slice();var v=s.range(),_=c.range();if(!s.invert&&s.padding)x(s,e,this._discrete);if(!c.invert&&c.padding)x(c,e,this._discrete);e.forEach(function(t){var e=u.height(t.data,t.i),n=u.width(t.data,t.i);if(s.invert&&s(t[f])-v[0]<n){var r=s.invert(s(t[f])-n);if(r<l[0])l[0]=r}if(s.invert&&v[1]-s(t[f])<n){var i=s.invert(s(t[f])+n);if(i>l[1])l[1]=i}if(c.invert&&c(t[d])-_[0]<e){var a=c.invert(c(t[d])-e);if(a>h[0])h[0]=a}if(c.invert&&_[1]-c(t[d])<e){var o=c.invert(c(t[d])+e);if(o<h[1])h[1]=o}});s=s.copy().domain(l);c=c.copy().domain(h);return[s,c]}function g(t){return this._sizeScaleD3(this._size?this._size(t):null)}function y(t){var n=t.map(b);var r=t.map(function(t){return t.key.split("_")[0]});return Qt.stackOrderNone(t).sort(function(t,e){return r[e].localeCompare(r[t])||n[t]-n[e]})}function p(t){return y(t).reverse()}function b(t){var e=-1,n=0,r;var i=t.length;while(++e<i){if(r=+t[e][1])n+=r}return n}function k(t,e){var n;if(!((n=t.length)>0))return;var r,i,a,o,s;var c=t[e[0]].length;for(var u=0;u<c;++u){for(s=o=0,a=0;a<n;++a){if((i=(r=t[e[a]][u])[1]-r[0])>=0){r[0]=s,r[1]=s+=i}else if(i<0){r[1]=o,r[0]=o+=i}else{r[0]=s}}}}var w=function(t){o(Ht,t);function Ht(){var i;n(this,Ht);i=u(this,ee(Ht).call(this));i._annotations=[];i._backgroundConfig={duration:0,fill:"transparent"};i._barPadding=0;i._buffer={Bar:d,Box:l,Circle:h,Line:v,Rect:_};i._confidenceConfig={fillOpacity:Ut.constant(.5)};i._discreteCutoff=100;i._groupPadding=5;i._previousShapes=[];i._shape=Ut.constant("Circle");i._shapeConfig=Ut.assign(i._shapeConfig,{Area:{label:function t(e,n){return i._stacked?i._drawLabel(e,n):false},labelConfig:{fontResize:true}},ariaLabel:function t(e,n){var r="";if(e.nested)r="".concat(i._drawLabel(e.data,e.i));else{r="".concat(i._drawLabel(e,n));if(i._x(e,n)!==undefined)r+=", x: ".concat(i._x(e,n));if(i._y(e,n)!==undefined)r+=", y: ".concat(i._y(e,n));if(i._x2(e,n)!==undefined)r+=", x2: ".concat(i._x2(e,n));if(i._y2(e,n)!==undefined)r+=", y2: ".concat(i._y2(e,n))}return"".concat(r,".")},Bar:{labelConfig:{textAnchor:function t(){return i._discrete==="x"?"middle":"end"},verticalAlign:function t(){return i._discrete==="x"?"top":"middle"}}},Circle:{r:g.bind(c(i))},Line:{fill:Ut.constant("none"),label:false,stroke:function t(e,n){return r.colorAssign(i._id(e,n))},strokeWidth:Ut.constant(1)},Rect:{height:function t(e){return g.bind(c(i))(e)*2},width:function t(e){return g.bind(c(i))(e)*2}}});i._shapeOrder=["Area","Path","Bar","Box","Line","Rect","Circle"];i._shapeSort=function(t,e){return i._shapeOrder.indexOf(t)-i._shapeOrder.indexOf(e)};i._sizeMax=20;i._sizeMin=5;i._sizeScale="sqrt";i._stackOffset=k;i._stackOrder=p;i._timelineConfig=Ut.assign(i._timelineConfig,{brushing:true});i._x=Ut.accessor("x");i._xAxis=(new Xt.AxisBottom).align("end");i._xTest=(new Xt.AxisBottom).align("end").gridSize(0);i._xConfig={};i._xCutoff=150;i._x2=Ut.accessor("x2");i._x2Axis=(new Xt.AxisTop).align("start");i._x2Test=(new Xt.AxisTop).align("start").gridSize(0);i._x2Config={padding:0};i._y=Ut.accessor("y");i._yAxis=(new Xt.AxisLeft).align("start");i._yTest=(new Xt.AxisLeft).align("start").gridSize(0);i._yConfig={gridConfig:{stroke:function t(e){var n=i._yAxis.domain();return n[n.length-1]===e.id?"transparent":"#ccc"}}};i._yCutoff=150;i._y2=Ut.accessor("y2");i._y2Axis=(new Xt.AxisRight).align("end");i._y2Test=(new Xt.AxisLeft).align("end").gridSize(0);i._y2Config={};return i}a(Ht,[{key:"_draw",value:function t(e){var T=this;if(!this._filteredData.length)return this;var s=function t(e,n){return T._stacked?"".concat(T._groupBy.length>1?T._ids(e,n).slice(0,-1).join("_"):"group"):"".concat(T._ids(e,n).join("_"))};var c=this._filteredData.map(function(t,e){return{__d3plus__:true,data:t,group:s(t,e),i:e,hci:T._confidence&&T._confidence[1]&&T._confidence[1](t,e),id:T._ids(t,e).slice(0,T._drawDepth+1).join("_"),lci:T._confidence&&T._confidence[0]&&T._confidence[0](t,e),shape:T._shape(t,e),x:T._x(t,e),x2:T._x2(t,e),y:T._y(t,e),y2:T._y2(t,e)}});this._formattedData=c;if(this._size){var n=Kt.extent(c,function(t){return T._size(t.data)});this._sizeScaleD3=function(){return T._sizeMin};this._sizeScaleD3=Jt["scale".concat(this._sizeScale.charAt(0).toUpperCase()).concat(this._sizeScale.slice(1))]().domain(n).range([n[0]===n[1]?this._sizeMax:Kt.min([this._sizeMax/2,this._sizeMin]),this._sizeMax])}else{this._sizeScaleD3=function(){return T._sizeMin}}var r=c.some(function(t){return t.x2!==undefined}),i=c.some(function(t){return t.y2!==undefined});var a=this._height-this._margin.top-this._margin.bottom,u=this._discrete?this._discrete==="x"?"y":"x":undefined,o=this._discrete?this._discrete==="x"?"y2":"x2":undefined,f=[u,o].filter(function(t){return t}),d=this._select,l=this._transition,z=this._width-this._margin.left-this._margin.right;var h=this._time&&c[0].x2===this._time(c[0].data,c[0].i),v=this._time&&c[0].x===this._time(c[0].data,c[0].i),_=this._time&&c[0].y2===this._time(c[0].data,c[0].i),g=this._time&&c[0].y===this._time(c[0].data,c[0].i);for(var y=0;y<c.length;y++){var p=c[y];if(v)p.x=Xt.date(p.x);if(h)p.x2=Xt.date(p.x2);if(g)p.y=Xt.date(p.y);if(_)p.y2=Xt.date(p.y2);p.discrete=p.shape==="Bar"?"".concat(p[this._discrete],"_").concat(p.group):"".concat(p[this._discrete])}var x,m,b,k;if(this._stacked){var w;var C=Yt.nest().key(function(t){return t.group}).entries(c).reduce(function(t,e){if(!t[e.key])t[e.key]=0;t[e.key]+=Kt.sum(e.values,function(t){return t[u]});return t},{});c=c.sort(function(t,e){if(T["_".concat(T._discrete,"Sort")])return T["_".concat(T._discrete,"Sort")](t.data,e.data);var n=t[T._discrete],r=e[T._discrete];if(n-r!==0)return n-r;if(t.group!==e.group)return C[e.group]-C[t.group];return e[u]-t[u]});x=Array.from(new Set(c.map(function(t){return t.discrete})));k=Array.from(new Set(c.map(function(t){return t.id})));b=Yt.nest().key(function(t){return t.discrete}).entries(c).map(function(t){return t.values});b.forEach(function(a){var o=Array.from(new Set(a.map(function(t){return t.id})));if(o.length<k.length){k.forEach(function(e){if(!o.includes(e)){var t=c.filter(function(t){return t.id===e})[0];if(t.shape==="Area"){var n;var r=s(t.data,t.i);var i=(n={__d3plus__:true,data:t.data,discrete:t.shape==="Bar"?"".concat(a[0][T._discrete],"_").concat(r):"".concat(a[0][T._discrete]),group:r,id:e,shape:t.shape},te(n,T._discrete,a[0][T._discrete]),te(n,u,0),n);c.push(i)}}})}});if(this["_".concat(this._discrete,"Sort")]){c.sort(function(t,e){return T["_".concat(T._discrete,"Sort")](t.data,e.data)})}else{c.sort(function(t,e){return t[T._discrete]-e[T._discrete]})}var S=this._stackOrder;if(S instanceof Array)k.sort(function(t,e){return S.indexOf(t)-S.indexOf(e)});else if(S===Qt.stackOrderNone)k.sort(function(t,e){return t.localeCompare(e)});b=Qt.stack().keys(k).offset(this._stackOffset).order(S instanceof Array?Qt.stackOrderNone:S).value(function(t,e){var n=t.filter(function(t){return t.id===e});return n.length?n[0][u]:0})(b);m=(w={},te(w,this._discrete,Kt.extent(c,function(t){return t[T._discrete]})),te(w,u,[Kt.min(b.map(function(t){return Kt.min(t.map(function(t){return t[0]}))})),Kt.max(b.map(function(t){return Kt.max(t.map(function(t){return t[1]}))}))]),w)}else{var O=this._discrete||"x";if(this["_".concat(this._discrete,"Sort")]){c.sort(function(t,e){return T["_".concat(T._discrete,"Sort")](t.data,e.data)})}else{c.sort(function(t,e){return t[O]-e[O]})}var A=O==="x"?c.map(function(t){return t.x}):c.map(function(t){return t.x}).concat(this._confidence&&this._confidence[0]?c.map(function(t){return t.lci}):[]).concat(this._confidence&&this._confidence[1]?c.map(function(t){return t.hci}):[]);var P=O==="x"?c.map(function(t){return t.x2}):c.map(function(t){return t.x2}).concat(this._confidence&&this._confidence[0]?c.map(function(t){return t.lci}):[]).concat(this._confidence&&this._confidence[1]?c.map(function(t){return t.hci}):[]);var j=O==="y"?c.map(function(t){return t.y}):c.map(function(t){return t.y}).concat(this._confidence&&this._confidence[0]?c.map(function(t){return t.lci}):[]).concat(this._confidence&&this._confidence[1]?c.map(function(t){return t.hci}):[]);var D=O==="y"?c.map(function(t){return t.y2}):c.map(function(t){return t.y2}).concat(this._confidence&&this._confidence[0]?c.map(function(t){return t.lci}):[]).concat(this._confidence&&this._confidence[1]?c.map(function(t){return t.hci}):[]);m={x:this._xSort?Array.from(new Set(c.filter(function(t){return t.x}).sort(function(t,e){return T._xSort(t.data,e.data)}).map(function(t){return t.x}))):Kt.extent(A,function(t){return t}),x2:this._x2Sort?Array.from(new Set(c.filter(function(t){return t.x2}).sort(function(t,e){return T._x2Sort(t.data,e.data)}).map(function(t){return t.x2}))):Kt.extent(P,function(t){return t}),y:this._ySort?Array.from(new Set(c.filter(function(t){return t.y}).sort(function(t,e){return T._ySort(t.data,e.data)}).map(function(t){return t.y}))):Kt.extent(j,function(t){return t}),y2:this._y2Sort?Array.from(new Set(c.filter(function(t){return t.y2}).sort(function(t,e){return T._y2Sort(t.data,e.data)}).map(function(t){return t.y2}))):Kt.extent(D,function(t){return t})}}var M=this._xDomain?this._xDomain.slice():m.x,E=this._xSort?"Point":"Linear";if(M[0]===void 0)M[0]=m.x[0];if(M[1]===void 0)M[1]=m.x[1];if(v){M=M.map(Xt.date);E="Time"}else if(this._discrete==="x"){M=Array.from(new Set(c.filter(function(t){return["number","string"].includes($t(t.x))}).sort(function(t,e){return T._xSort?T._xSort(t.data,e.data):t.x-e.x}).map(function(t){return t.x})));E="Point"}var L=this._x2Domain?this._x2Domain.slice():m.x2,B=this._x2Sort?"Point":"Linear";if(L&&L[0]===void 0)L[0]=m.x2[0];if(L&&L[1]===void 0)L[1]=m.x2[1];if(h){L=L.map(Xt.date);B="Time"}else if(this._discrete==="x"){L=Array.from(new Set(c.filter(function(t){return["number","string"].includes($t(t.x2))}).sort(function(t,e){return T._x2Sort?T._x2Sort(t.data,e.data):t.x2-e.x2}).map(function(t){return t.x2})));B="Point"}var R=this._yDomain?this._yDomain.slice():m.y,q=this._ySort?"Point":"Linear";if(R[0]===void 0)R[0]=m.y[0];if(R[1]===void 0)R[1]=m.y[1];var N=this._y2Domain?this._y2Domain.slice():m.y2,F=this._y2Sort?"Point":"Linear";if(N&&N[0]===void 0)N[0]=m.y2[0];if(N&&N[1]===void 0)N[1]=m.y2[1];if(g){R=R.map(Xt.date);q="Time"}else if(this._discrete==="y"){R=Array.from(new Set(c.filter(function(t){return["number","string"].includes($t(t.y))}).sort(function(t,e){return T._ySort?T._ySort(t.data,e.data):t.y-e.y}).map(function(t){return t.y})));q="Point";N=Array.from(new Set(c.filter(function(t){return["number","string"].includes($t(t.y2))}).sort(function(t,e){return T._y2Sort?T._y2Sort(t.data,e.data):t.y2-e.y2}).map(function(t){return t.y2})));F="Point"}if(_){N=N.map(Xt.date);F="Time"}m={x:M,x2:L||M,y:R,y2:N||R};f.forEach(function(t){if(T["_".concat(t,"Config")].domain){var e=T["_".concat(t,"Config")].domain;if(T._discrete==="x")e.reverse();m[t]=e}else if(t&&T._baseline!==void 0){var n=T._baseline;if(m[t]&&m[t][0]>n)m[t][0]=n;else if(m[t]&&m[t][1]<n)m[t][1]=n}});var I=Jt["scale".concat(E)]().domain(m.x).range(Kt.range(0,z+1,z/(m.x.length-1))),W=Jt["scale".concat(B)]().domain(m.x2).range(Kt.range(0,z+1,z/(m.x2.length-1))),V=Jt["scale".concat(q)]().domain(m.y.reverse()).range(Kt.range(0,a+1,a/(m.y.length-1))),G=Jt["scale".concat(F)]().domain(m.y2.reverse()).range(Kt.range(0,a+1,a/(m.y2.length-1)));var H=Yt.nest().key(function(t){return t.shape}).entries(c).sort(function(t,e){return T._shapeSort(t.key,e.key)});var U=function t(e,n){var r=T["_".concat(e,"Config")].scale;if(r==="auto"){if(T._discrete===e)return n;var i=c.map(function(t){return t[e]});return Kt.deviation(i)/Kt.mean(i)>3?"log":"linear"}return r||n};var K=U("y",q);var Y=U("y2",F);var J=U("x",E);var Q=U("x2",B);var X=this._discrete==="x"?q:E;if(X!=="Point"){H.forEach(function(t){if(T._buffer[t.key]){var e=T._buffer[t.key].bind(T)({data:t.values,x:I,y:V,config:T._shapeConfig[t.key]});if(J!=="log")I=e[0];if(K!=="log")V=e[1];var n=T._buffer[t.key].bind(T)({data:t.values,x:W,y:G,x2:true,y2:true,config:T._shapeConfig[t.key]});if(Q!=="log")W=n[0];if(Y!=="log")G=n[1]}})}M=I.domain();L=W.domain();R=V.domain();N=G.domain();var Z={barConfig:{"stroke-width":0},gridSize:0,labels:[],title:false,tickSize:0};var $=r?{}:Z;var tt=i?{}:Z;var et=this._discrete==="x"&&this._width>this._discreteCutoff||this._width>this._xCutoff;var nt=this._discrete==="y"&&this._height>this._discreteCutoff||this._height>this._yCutoff;var rt={gridConfig:{stroke:!this._discrete||this._discrete==="x"?this._yTest.gridConfig().stroke:"transparent"},locale:this._locale,scalePadding:V.padding?V.padding():0};if(!et){rt.barConfig={stroke:"transparent"};rt.tickSize=0;rt.shapeConfig={labelBounds:function t(e,n){var r=e.labelBounds,i=r.width,a=r.y;var o=T._height/2;var s=n?-o:0;return{x:s,y:a,width:i,height:o}},labelConfig:{padding:0,rotate:0,verticalAlign:function t(e){return e.id===ct[0]?"top":"bottom"}},labelRotation:false}}var it=Ut.elem("g.d3plus-plot-test",{enter:{opacity:0},parent:this._select}),at=this._discrete==="x"&&!h?m.x2:undefined,ot=!nt?Kt.extent(m.x):this._discrete==="x"&&!v?m.x:undefined,st=this._discrete==="y"&&!_?m.y2:undefined,ct=!et?Kt.extent(m.y):this._discrete==="y"&&!g?m.y:undefined;if(nt){this._yTest.domain(R).height(a).maxSize(z/2).range([undefined,undefined]).select(it.node()).ticks(ct).width(z).config(rt).config(this._yConfig).scale(K).render()}var ut=this._yTest.outerBounds();var ft=ut.width?ut.width+this._yTest.padding():undefined;if(i){this._y2Test.domain(N).height(a).range([undefined,undefined]).select(it.node()).ticks(st).width(z).config(rt).config(tt).config(this._y2Config).scale(Y).render()}var dt=this._y2Test.outerBounds();var lt=dt.width?dt.width+this._y2Test.padding():undefined;var ht={gridConfig:{stroke:!this._discrete||this._discrete==="y"?this._xTest.gridConfig().stroke:"transparent"},locale:this._locale,scalePadding:I.padding?I.padding():0};if(!nt){ht.barConfig={stroke:"transparent"};ht.tickSize=0;ht.shapeConfig={labelBounds:function t(e,n){var r=e.labelBounds,i=r.height,a=r.y;var o=T._width/2;var s=n?-o:0;return{x:s,y:a,width:o,height:i}},labelConfig:{padding:0,rotate:0,textAnchor:function t(e){return e.id===ot[0]?"start":"end"}},labelRotation:false}}if(et){this._xTest.domain(M).height(a).maxSize(a/2).range([undefined,undefined]).select(it.node()).ticks(ot).width(z).config(ht).config(this._xConfig).scale(J).render()}if(r){this._x2Test.domain(L).height(a).range([undefined,undefined]).select(it.node()).ticks(at).width(z).config(ht).tickSize(0).config($).config(this._x2Config).scale(Q).render()}var vt=this._xTest._getRange();var _t=this._x2Test._getRange();var gt=this._x2Test.outerBounds();var yt=r?gt.height+this._x2Test.padding():0;var pt=Kt.max([ft,vt[0],_t[0]]);if(et){this._xTest.range([pt,undefined]).render()}var xt=nt?this._yTest.shapeConfig().labelConfig.fontSize()/2:0;var mt=Kt.max([lt,z-vt[1],z-_t[1]]);var bt=this._xTest.outerBounds();var kt=bt.height+(nt?this._xTest.padding():0);this._padding.left+=pt;this._padding.right+=mt;this._padding.bottom+=kt;this._padding.top+=yt+xt;ne(ee(Ht.prototype),"_draw",this).call(this,e);var wt=this._margin.left+this._margin.right;var Ct=this._margin.top+this._margin.bottom;var St=[yt,a-(kt+xt+Ct)];if(nt){this._yTest.domain(R).height(a).maxSize(z/2).range(St).select(it.node()).ticks(ct).width(z).config(rt).config(this._yConfig).scale(K).render()}ut=this._yTest.outerBounds();ft=ut.width?ut.width+this._yTest.padding():undefined;pt=Kt.max([ft,vt[0],_t[0]]);if(i){this._y2Test.config(rt).domain(N).gridSize(0).height(a).range(St).select(it.node()).width(z-Kt.max([0,mt-lt])).title(false).config(this._y2Config).config(tt).scale(Y).render()}dt=this._y2Test.outerBounds();lt=dt.width?dt.width+this._y2Test.padding():undefined;mt=Kt.max([0,lt,z-vt[1],z-_t[1]]);var Ot=[pt,z-(mt+wt)];var At=Ut.elem("g.d3plus-plot-background",{parent:d,transition:l});var Pt="translate(".concat(this._margin.left,", ").concat(this._margin.top+yt+xt,")");var Tt="translate(".concat(this._margin.left,", ").concat(this._margin.top+xt,")");var zt=et&&Ut.elem("g.d3plus-plot-x-axis",{parent:d,transition:l,enter:{transform:Pt},update:{transform:Pt}});var jt=r&&Ut.elem("g.d3plus-plot-x2-axis",{parent:d,transition:l,enter:{transform:Tt},update:{transform:Tt}});var Dt=pt>ft?pt-ft:0;var Mt="translate(".concat(this._margin.left+Dt,", ").concat(this._margin.top+xt,")");var Et=nt&&Ut.elem("g.d3plus-plot-y-axis",{parent:d,transition:l,enter:{transform:Mt},update:{transform:Mt}});var Lt="translate(-".concat(this._margin.right,", ").concat(this._margin.top+xt,")");var Bt=i&&Ut.elem("g.d3plus-plot-y2-axis",{parent:d,transition:l,enter:{transform:Lt},update:{transform:Lt}});this._xAxis.domain(M).height(a-(yt+xt+Ct)).maxSize(a/2).range(Ot).select(et?zt.node():undefined).ticks(ot).width(z).config(ht).config(this._xConfig).scale(J).render();if(r){this._x2Axis.domain(L).height(a-(kt+xt+Ct)).range(Ot).select(jt.node()).ticks(at).width(z).config(ht).config($).config(this._x2Config).scale(Q).render()}I=function t(e,n){if(n==="x2"){if(T._x2Config.scale==="log"&&e===0)e=L[0]<0?-1:1;return T._x2Axis._getPosition.bind(T._x2Axis)(e)}else{if(T._xConfig.scale==="log"&&e===0)e=M[0]<0?-1:1;return T._xAxis._getPosition.bind(T._xAxis)(e)}};St=[this._xAxis.outerBounds().y+yt,a-(kt+xt+Ct)];this._yAxis.domain(R).height(a).maxSize(z/2).range(St).select(nt?Et.node():undefined).ticks(ct).width(Ot[Ot.length-1]).config(rt).config(this._yConfig).scale(K).render();if(i){this._y2Axis.config(rt).domain(i?N:R).gridSize(0).height(a).range(St).select(Bt.node()).width(z-Kt.max([0,mt-lt])).title(false).config(this._y2Config).config(tt).scale(Y).render()}V=function t(e,n){if(n==="y2"){if(T._y2Config.scale==="log"&&e===0)e=N[0]<0?-1:1;return T._y2Axis._getPosition.bind(T._y2Axis)(e)-yt}else{if(T._yConfig.scale==="log"&&e===0)e=R[0]<0?-1:1;return T._yAxis._getPosition.bind(T._yAxis)(e)-yt}};(new Zt.Rect).data([{}]).select(At.node()).x(Ot[0]+(Ot[1]-Ot[0])/2).width(Ot[1]-Ot[0]).y(this._margin.top+xt+St[0]+(St[1]-St[0])/2).height(St[1]-St[0]).config(this._backgroundConfig).render();var Rt=Ut.elem("g.d3plus-plot-annotations",{parent:d,transition:l,enter:{transform:Pt},update:{transform:Pt}}).node();this._annotations.forEach(function(t){(new Zt[t.shape]).config(t).config({x:function t(e){return e.x2?I(e.x2,"x2"):I(e.x)},x0:T._discrete==="x"?function(t){return t.x2?I(t.x2,"x2"):I(t.x)}:I(m.x[0]),x1:T._discrete==="x"?null:function(t){return t.x2?I(t.x2,"x2"):I(t.x)},y:function t(e){return e.y2?V(e.y2,"y2"):V(e.y)},y0:T._discrete==="y"?function(t){return t.y2?V(t.y2,"y2"):V(t.y)}:V(m.y[1])-qt,y1:T._discrete==="y"?null:function(t){return t.y2?V(t.y2,"y2"):V(t.y)-qt}}).select(Rt).render()});var qt=this._xAxis.barConfig()["stroke-width"];if(qt)qt/=2;var Nt=this._discrete||"x";var Ft={duration:this._duration,label:function t(e){return T._drawLabel(e.data,e.i)},select:Ut.elem("g.d3plus-plot-shapes",{parent:d,transition:l,enter:{transform:Pt},update:{transform:Pt}}).node(),x:function t(e){return e.x2?I(e.x2,"x2"):I(e.x)},x0:Nt==="x"?function(t){return t.x2?I(t.x2,"x2"):I(t.x)}:I(typeof this._baseline==="number"?this._baseline:m.x[0]),x1:Nt==="x"?null:function(t){return t.x2?I(t.x2,"x2"):I(t.x)},y:function t(e){return e.y2?V(e.y2,"y2"):V(e.y)},y0:Nt==="y"?function(t){return t.y2?V(t.y2,"y2"):V(t.y)}:V(typeof this._baseline==="number"?this._baseline:m.y[1])-qt,y1:Nt==="y"?null:function(t){return t.y2?V(t.y2,"y2"):V(t.y)-qt}};if(this._stacked){var It=u==="x"?I:V;Ft["".concat(u)]=Ft["".concat(u,"0")]=function(t){var e=k.indexOf(t.id),n=x.indexOf(t.discrete);return e>=0?It(b[e][n][0]):It(m[u][u==="x"?0:1])};Ft["".concat(u,"1")]=function(t){var e=k.indexOf(t.id),n=x.indexOf(t.discrete);return e>=0?It(b[e][n][1]):It(m[u][u==="x"?0:1])}}var Wt=Object.keys(this._on);H.forEach(function(e){var n=(new Zt[e.key]).config(Ft).data(e.values);if(e.key==="Bar"){var t;var r=T._discrete==="x"?I:V;var i=T._discrete==="x"?E:q;var a=T._discrete==="x"?M:R;var o=T._discrete==="x"?Ot:St;if(i!=="Point"&&a.length===2){t=(r(e.values[T._discrete==="x"?0:e.values.length-1][T._discrete])-r(a[0]))*2}else if(a.length>1)t=r(a[1])-r(a[0]);else t=o[o.length-1]-o[0];if(T._groupPadding<t)t-=T._groupPadding;var s=t||1;var c=Yt.nest().key(function(t){return t[T._discrete]}).key(function(t){return t.group}).entries(e.values);var u=Kt.merge(c.map(function(t){return t.values.map(function(t){return t.key})}));var f=Array.from(new Set(u));if(Kt.max(c.map(function(t){return t.values.length}))===1){n[T._discrete](function(t,e){return Ft[T._discrete](t,e)})}else{s=(s-T._barPadding*f.length-1)/f.length;var d=t/2-s/2;var l=Jt.scaleLinear().domain([0,f.length-1]).range([-d,d]);n[T._discrete](function(t,e){return Ft[T._discrete](t,e)+l(f.indexOf(t.group))})}n.width(s);n.height(s)}else if(e.key==="Line"){n.duration(z*1.5);if(T._confidence){var h=Object.assign({},Ft);var v=T._discrete||"x";var _=v==="x"?"y":"x";var g=v==="x"?V:I;h["".concat(_,"0")]=function(t){return g(T._confidence[0]?t.lci:t[_])};h["".concat(_,"1")]=function(t){return g(T._confidence[1]?t.hci:t[_])};var y=(new Zt.Area).config(h).data(e.values);var p=Object.assign(T._shapeConfig,T._confidenceConfig);y.config(Ut.configPrep.bind(T)(p,"shape","Area")).render();T._shapes.push(y)}}var x=Wt.filter(function(t){return t.includes(".".concat(e.key))}),m=Wt.filter(function(t){return!t.includes(".")}),b=Wt.filter(function(t){return t.includes(".shape")});var k=function t(e){n.on(m[e],function(t){return T._on[m[e]](t.data,t.i)})};for(var w=0;w<m.length;w++){k(w)}var C=function t(e){n.on(b[e],function(t){return T._on[b[e]](t.data,t.i)})};for(var S=0;S<b.length;S++){C(S)}var O=function t(e){n.on(x[e],function(t){return T._on[x[e]](t.data,t.i)})};for(var A=0;A<x.length;A++){O(A)}var P=Ut.configPrep.bind(T)(T._shapeConfig,"shape",e.key);if(T._shapeConfig.duration===undefined)delete P.duration;n.config(P).render();T._shapes.push(n)});var Vt=H.map(function(t){return t.key});if(this._confidence&&Vt.includes("Line"))Vt.push("Area");var Gt=this._previousShapes.filter(function(t){return!Vt.includes(t)});Gt.forEach(function(t){(new Zt[t]).config(Ft).data([]).render()});this._previousShapes=Vt;return this}},{key:"annotations",value:function t(e){return arguments.length?(this._annotations=e instanceof Array?e:[e],this):this._annotations}},{key:"backgroundConfig",value:function t(e){return arguments.length?(this._backgroundConfig=Ut.assign(this._backgroundConfig,e),this):this._backgroundConfig}},{key:"barPadding",value:function t(e){return arguments.length?(this._barPadding=e,this):this._barPadding}},{key:"baseline",value:function t(e){return arguments.length?(this._baseline=e,this):this._baseline}},{key:"confidence",value:function t(e){if(arguments.length&&e instanceof Array){this._confidence=[];var n=e[0];this._confidence[0]=typeof n==="function"||!n?n:Ut.accessor(n);var r=e[1];this._confidence[1]=typeof r==="function"||!r?r:Ut.accessor(r);return this}else return this._confidence}},{key:"confidenceConfig",value:function t(e){return arguments.length?(this._confidenceConfig=Ut.assign(this._confidenceConfig,e),this):this._confidenceConfig}},{key:"discrete",value:function t(e){return arguments.length?(this._discrete=e,this):this._discrete}},{key:"discreteCutoff",value:function t(e){return arguments.length?(this._discreteCutoff=e,this):this._discreteCutoff}},{key:"groupPadding",value:function t(e){return arguments.length?(this._groupPadding=e,this):this._groupPadding}},{key:"shapeSort",value:function t(e){return arguments.length?(this._shapeSort=e,this):this._shapeSort}},{key:"size",value:function t(e){return arguments.length?(this._size=typeof e==="function"||!e?e:Ut.accessor(e),this):this._size}},{key:"sizeMax",value:function t(e){return arguments.length?(this._sizeMax=e,this):this._sizeMax}},{key:"sizeMin",value:function t(e){return arguments.length?(this._sizeMin=e,this):this._sizeMin}},{key:"sizeScale",value:function t(e){return arguments.length?(this._sizeScale=e,this):this._sizeScale}},{key:"stacked",value:function t(e){return arguments.length?(this._stacked=e,this):this._stacked}},{key:"stackOffset",value:function t(e){return arguments.length?(this._stackOffset=typeof e==="function"?e:Qt["stackOffset".concat(e.charAt(0).toUpperCase()+e.slice(1))],this):this._stackOffset}},{key:"stackOrder",value:function t(e){if(arguments.length){if(typeof e==="string")this._stackOrder=e==="ascending"?y:e==="descending"?p:Qt["stackOrder".concat(e.charAt(0).toUpperCase()+e.slice(1))];else this._stackOrder=e;return this}else return this._stackOrder}},{key:"x",value:function t(e){if(arguments.length){if(typeof e==="function")this._x=e;else{this._x=Ut.accessor(e);if(!this._aggs[e]&&this._discrete==="x"){this._aggs[e]=function(t){var e=Array.from(new Set(t));return e.length===1?e[0]:e}}}return this}else return this._x}},{key:"x2",value:function t(e){if(arguments.length){if(typeof e==="function")this._x2=e;else{this._x2=Ut.accessor(e);if(!this._aggs[e]&&this._discrete==="x"){this._aggs[e]=function(t){var e=Array.from(new Set(t));return e.length===1?e[0]:e}}}return this}else return this._x2}},{key:"xConfig",value:function t(e){return arguments.length?(this._xConfig=Ut.assign(this._xConfig,e),this):this._xConfig}},{key:"xCutoff",value:function t(e){return arguments.length?(this._xCutoff=e,this):this._xCutoff}},{key:"x2Config",value:function t(e){return arguments.length?(this._x2Config=Ut.assign(this._x2Config,e),this):this._x2Config}},{key:"xDomain",value:function t(e){return arguments.length?(this._xDomain=e,this):this._xDomain}},{key:"x2Domain",value:function t(e){return arguments.length?(this._x2Domain=e,this):this._x2Domain}},{key:"xSort",value:function t(e){return arguments.length?(this._xSort=e,this):this._xSort}},{key:"x2Sort",value:function t(e){return arguments.length?(this._x2Sort=e,this):this._x2Sort}},{key:"y",value:function t(e){if(arguments.length){if(typeof e==="function")this._y=e;else{this._y=Ut.accessor(e);if(!this._aggs[e]&&this._discrete==="y"){this._aggs[e]=function(t){var e=Array.from(new Set(t));return e.length===1?e[0]:e}}}return this}else return this._y}},{key:"y2",value:function t(e){if(arguments.length){if(typeof e==="function")this._y2=e;else{this._y2=Ut.accessor(e);if(!this._aggs[e]&&this._discrete==="y2"){this._aggs[e]=function(t){var e=Array.from(new Set(t));return e.length===1?e[0]:e}}}return this}else return this._y2}},{key:"yConfig",value:function t(e){if(arguments.length){if(e.domain)e.domain=e.domain.slice().reverse();this._yConfig=Ut.assign(this._yConfig,e);return this}return this._yConfig}},{key:"yCutoff",value:function t(e){return arguments.length?(this._yCutoff=e,this):this._yCutoff}},{key:"y2Config",value:function t(e){return arguments.length?(this._y2Config=Ut.assign(this._y2Config,e),this):this._y2Config}},{key:"yDomain",value:function t(e){return arguments.length?(this._yDomain=e,this):this._yDomain}},{key:"y2Domain",value:function t(e){return arguments.length?(this._y2Domain=e,this):this._y2Domain}},{key:"ySort",value:function t(e){return arguments.length?(this._ySort=e,this):this._ySort}},{key:"y2Sort",value:function t(e){return arguments.length?(this._y2Sort=e,this):this._y2Sort}}]);return Ht}(e.Viz);var C=function(t){o(e,t);function e(){var t;n(this,e);t=u(this,ee(e).call(this));t._baseline=0;t._discrete="x";t._shape=Ut.constant("Area");t.x("x");return t}return e}(w);var S=function(t){o(e,t);function e(){var t;n(this,e);t=u(this,ee(e).call(this));t._baseline=0;t._discrete="x";t._shape=Ut.constant("Bar");t.x("x");return t}return e}(w);var O=function(t){o(e,t);function e(){var i;n(this,e);i=u(this,ee(e).call(this));i._discrete="x";i._shape=Ut.constant("Box");i.x("x");i._tooltipConfig=Ut.assign(i._tooltipConfig,{title:function t(e,n){if(!e)return"";while(e.__d3plus__&&e.data){e=e.data;n=e.i}if(i._label)return i._label(e,n);var r=i._ids(e,n).slice(0,i._drawDepth);return r[r.length-1]}});return i}return e}(w);var A=function(t){o(e,t);function e(){var o;n(this,e);o=u(this,ee(e).call(this));o._discrete="x";o._shape=Ut.constant("Line");o.x("x");o.y2(function(t){return o._y(t)});o.yConfig({tickFormat:function t(e){var n=o._formattedData;var r=n[0].x instanceof Date?n[0].x.getTime():n[0].x;var i=n.filter(function(t){return(t.x instanceof Date?t.x.getTime():t.x)===r});var a=i.find(function(t){return t.y===e});return a?o._drawLabel(a,a.i):""}});o.y2Config({tickFormat:function t(e){var n=o._formattedData;var r=n[n.length-1].x instanceof Date?n[n.length-1].x.getTime():n[n.length-1].x;var i=n.filter(function(t){return(t.x instanceof Date?t.x.getTime():t.x)===r});var a=i.find(function(t){return t.y===e});return a?o._drawLabel(a,a.i):""}});o.ySort(function(t,e){return o._y(e)-o._y(t)});o.y2Sort(function(t,e){return o._y(e)-o._y(t)});return o}return e}(w);var P=function(t){o(e,t);function e(){var t;n(this,e);t=u(this,ee(e).call(this));t._shape=Ut.constant("Line");return t}return e}(w);var T=Math.PI*2;var z=function(t){o(x,t);function x(){var t;n(this,x);t=u(this,ee(x).call(this));t._axisConfig={shapeConfig:{fill:Ut.constant("none"),labelConfig:{fontColor:"#000",padding:0,textAnchor:function t(e,n,r){return r.textAnchor},verticalAlign:"middle"},stroke:"#ccc",strokeWidth:Ut.constant(1)}};t._discrete="metric";t._levels=6;t._metric=Ut.accessor("metric");t._outerPadding=100;t._shape=Ut.constant("Path");t._value=Ut.accessor("value");return t}a(x,[{key:"_draw",value:function t(e){var h=this;ne(ee(x.prototype),"_draw",this).call(this,e);var u=this._height-this._margin.top-this._margin.bottom,f=this._width-this._margin.left-this._margin.right;var v=Kt.min([u,f])/2-this._outerPadding,n="translate(".concat(f/2,", ").concat(u/2,")");var r=Yt.nest().key(this._metric).entries(this._filteredData),i=Yt.nest().key(this._id).key(this._metric).entries(this._filteredData);var a=Kt.max(i.map(function(t){return t.values.map(function(t){return Kt.sum(t.values,function(t,e){return h._value(t,e)})})}).flat());var o=Array.from(Array(this._levels).keys()).map(function(t){return{id:t,r:v*((t+1)/h._levels)}});var s=Ut.configPrep.bind(this)(this._axisConfig.shapeConfig,"shape","Circle");delete s.label;(new Zt.Circle).data(o).select(Ut.elem("g.d3plus-Radar-radial-circles",{parent:this._select,enter:{transform:n},update:{transform:n}}).node()).config(s).render();var _=r.length;var c=r.map(function(t,e){var n=h._outerPadding;var r=h._shapeConfig.labelConfig.fontSize&&h._shapeConfig.labelConfig.fontSize(t,e)||11;var i=r*1.4;var a=i*2;var o=10,s=parseInt(360-360/_*e/90,10)%4+1,c=T/_*e;var u=360/_*e;var f="start";var d=o;if(s===2||s===3){d=-n-o;f="end";u+=180}var l={x:d,y:-a/2,width:n,height:a};return{__d3plus__:true,data:Ut.merge(t.values),i:e,id:t.key,angle:u,textAnchor:f,labelBounds:l,rotateAnchor:[-d,a/2],x:v*Math.cos(c),y:v*Math.sin(c)}}).sort(function(t,e){return t.key-e.key});(new Zt.Rect).data(c).rotate(function(t){return t.angle||0}).width(0).height(0).x(function(t){return t.x}).y(function(t){return t.y}).label(function(t){return t.id}).labelBounds(function(t){return t.labelBounds}).labelConfig(this._axisConfig.shapeConfig.labelConfig).select(Ut.elem("g.d3plus-Radar-text",{parent:this._select,enter:{transform:n},update:{transform:n}}).node()).render();(new Zt.Path).data(c).d(function(t){return"M".concat(0,",",0," ",-t.x,",").concat(-t.y)}).select(Ut.elem("g.d3plus-Radar-axis",{parent:this._select,enter:{transform:n},update:{transform:n}}).node()).config(Ut.configPrep.bind(this)(this._axisConfig.shapeConfig,"shape","Path")).render();var d=i.map(function(t){var e=t.values.map(function(t,e){var n=Kt.sum(t.values,function(t,e){return h._value(t,e)});var r=n/a*v,i=T/_*e;return{x:r*Math.cos(i),y:r*Math.sin(i)}});var n="M ".concat(e[0].x," ").concat(e[0].y," ").concat(e.map(function(t){return"L ".concat(t.x," ").concat(t.y)}).join(" ")," L ").concat(e[0].x," ").concat(e[0].y);return{arr:t.values.map(function(t){return Ut.merge(t.values)}),id:t.key,points:e,d:n,__d3plus__:true,data:Ut.merge(t.values.map(function(t){return Ut.merge(t.values)}))}});var l=Ut.configPrep.bind(this)(this._shapeConfig,"shape","Path");var g=Object.keys(l.on);l.on={};var y=function t(e){var c=g[e];l.on[c]=function(t,e){var n=t.points.map(function(t){return t.x+f/2});var r=t.points.map(function(t){return t.y+u/2});var i=m.mouse(h._select.node());var a=n.map(function(t){return Math.abs(t-i[0])});var o=r.map(function(t){return Math.abs(t-i[1])});var s=a.map(function(t,e){return t+o[e]});h._on[c].bind(h)(t.arr[s.indexOf(Kt.min(s))],e)}};for(var p=0;p<g.length;p++){y(p)}this._shapes.push((new Zt.Path).data(d).d(function(t){return t.d}).select(Ut.elem("g.d3plus-Radar-items",{parent:this._select,enter:{transform:n},update:{transform:n}}).node()).config(l).render());return this}},{key:"axisConfig",value:function t(e){return arguments.length?(this._axisConfig=Ut.assign(this._axisConfig,e),this):this._axisConfig}},{key:"metric",value:function t(e){return arguments.length?(this._metric=typeof e==="function"?e:Ut.accessor(e),this):this._metric}},{key:"outerPadding",value:function t(e){return arguments.length?(this._outerPadding=e,this):this._outerPadding}},{key:"value",value:function t(e){return arguments.length?(this._value=typeof e==="function"?e:Ut.accessor(e),this):this._value}}]);return x}(e.Viz);var j=function(t){o(e,t);function e(){var t;n(this,e);t=u(this,ee(e).call(this));t._stacked=true;return t}return e}(C);t.AreaPlot=C;t.BarChart=S;t.BoxWhisker=O;t.BumpChart=A;t.LinePlot=P;t.Plot=w;t.Radar=z;t.StackedArea=j;Object.defineProperty(t,"__esModule",{value:true})});