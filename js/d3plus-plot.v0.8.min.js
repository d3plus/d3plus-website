/*
  d3plus-plot v0.8.8
  A reusable javascript x/y plot built on D3.
  Copyright (c) 2019 D3plus - https://d3plus.org
  @license MIT
*/
if(typeof Object.assign!=="function"){Object.defineProperty(Object,"assign",{value:function t(e){"use strict";if(e===null){throw new TypeError("Cannot convert undefined or null to object")}var i=Object(e);for(var n=1;n<arguments.length;n++){var r=arguments[n];if(r!==null){for(var s in r){if(Object.prototype.hasOwnProperty.call(r,s)){i[s]=r[s]}}}}return i},writable:true,configurable:true})}if(!Array.prototype.includes){Object.defineProperty(Array.prototype,"includes",{value:function t(e,i){var n=Object(this);var r=n.length>>>0;if(r===0)return false;var s=i|0;var a=Math.max(s>=0?s:r-Math.abs(s),0);function o(t,e){return t===e||typeof t==="number"&&typeof e==="number"&&isNaN(t)&&isNaN(e)}while(a<r){if(o(n[a],e)){return true}a++}return false}})}if(!String.prototype.includes){Object.defineProperty(String.prototype,"includes",{value:function(t,e){if(typeof e!=="number"){e=0}if(e+t.length>this.length){return false}else{return this.indexOf(t,e)!==-1}}})}if(!Array.prototype.find){Object.defineProperty(Array.prototype,"find",{value:function(t){if(this==null){throw new TypeError('"this" is null or not defined')}var e=Object(this);var i=e.length>>>0;if(typeof t!=="function"){throw new TypeError("predicate must be a function")}var n=arguments[1];var r=0;while(r<i){var s=e[r];if(t.call(n,s,r,e)){return s}r++}return undefined},configurable:true,writable:true})}if(!String.prototype.startsWith){Object.defineProperty(String.prototype,"startsWith",{value:function(t,e){e=!e||e<0?0:+e;return this.substring(e,e+t.length)===t}})}if(typeof window!=="undefined"){(function(){var n=function(t,e){var i=t.nodeType;if(i===3){e.push(t.textContent.replace(/&/,"&amp;").replace(/</,"&lt;").replace(">","&gt;"))}else if(i===1){e.push("<",t.tagName);if(t.hasAttributes()){[].forEach.call(t.attributes,function(t){e.push(" ",t.item.name,"='",t.item.value,"'")})}if(t.hasChildNodes()){e.push(">");[].forEach.call(t.childNodes,function(t){n(t,e)});e.push("</",t.tagName,">")}else{e.push("/>")}}else if(i==8){e.push("\x3c!--",t.nodeValue,"--\x3e")}};Object.defineProperty(SVGElement.prototype,"innerHTML",{get:function(){var t=[];var e=this.firstChild;while(e){n(e,t);e=e.nextSibling}return t.join("")},set:function(t){while(this.firstChild){this.removeChild(this.firstChild)}try{var e=new DOMParser;e.async=false;var i="<svg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'>"+t+"</svg>";var n=e.parseFromString(i,"text/xml").documentElement;var r=n.firstChild;while(r){this.appendChild(this.ownerDocument.importNode(r,true));r=r.nextSibling}}catch(t){}}});Object.defineProperty(SVGElement.prototype,"innerSVG",{get:function(){return this.innerHTML},set:function(t){this.innerHTML=t}})})()}(function(t,e){typeof exports==="object"&&typeof module!=="undefined"?e(exports,require("d3-array"),require("d3-collection"),require("d3-scale"),require("d3-shape"),require("d3plus-axis"),require("d3plus-color"),require("d3plus-common"),require("d3plus-shape"),require("d3plus-viz")):typeof define==="function"&&define.amd?define("d3plus-plot",["exports","d3-array","d3-collection","d3-scale","d3-shape","d3plus-axis","d3plus-color","d3plus-common","d3plus-shape","d3plus-viz"],e):e(t.d3plus={},t.d3Array,t.d3Collection,t.scales,t.d3Shape,t.d3plusAxis,t.d3plusColor,t.d3plusCommon,t.shapes,t.d3plusViz)})(this,function(t,jt,Mt,Bt,Et,Rt,i,Nt,qt,e){"use strict";function v(t){if(t.includes("d3plus-buffer-start")){return t}var e=["d3plus-buffer-start"];t.forEach(function(t){e.push(t);e.push("d3plus-buffer-"+t)});return e}function r(t){var e=this;var i=t.data;var n=t.x;var r=t.y;var s=t.x2;var a=t.y2;var o=t.buffer;if(o===void 0)o=10;var c=s?"x2":"x";var f=a?"y2":"y";var u=this._discrete==="x"?r:n;var h=u.domain().slice();var d=this._discrete==="x";if(d){h.reverse()}var _,l;if(this._stacked){var p=Mt.nest().key(function(t){return t[e._discrete]}).entries(i).map(function(t){return t.values.map(function(t){return t[d?f:c]})});l=p.map(function(t){return jt.sum(t.filter(function(t){return t>0}))});_=p.map(function(t){return jt.sum(t.filter(function(t){return t<0}))})}else{l=i.map(function(t){return t[d?f:c]});_=l}var g=u(jt.max(l));if(d?g<u(0):g>u(0)){g+=d?-o:o}g=u.invert(g);var y=u(jt.min(_));if(d?y>u(0):y<u(0)){y+=d?o:-o}y=u.invert(y);if(g>h[1]){h[1]=g}if(y<h[0]){h[0]=y}if(d){h.reverse()}u.domain(h);var x=d?n:r;x.domain(v(x.domain()));return[n,r]}function s(t){var e=this;var i=t.data;var n=t.x;var r=t.y;var s=t.x2;var a=t.y2;var o=t.buffer;if(o===void 0)o=10;var c=s?"x2":"x";var f=a?"y2":"y";var u=this._discrete==="x"?r:n;var h=u.domain().slice();var d=this._discrete==="x";if(d){h.reverse()}var _,l;if(this._stacked){var p=Mt.nest().key(function(t){return t[e._discrete]}).entries(i).map(function(t){return t.values.map(function(t){return t[d?f:c]})});l=p.map(function(t){return jt.sum(t.filter(function(t){return t>0}))});_=p.map(function(t){return jt.sum(t.filter(function(t){return t<0}))})}else{l=i.map(function(t){return t[d?f:c]});_=l}var g=u(jt.max(l));g+=d?-o:o;g=u.invert(g);var y=u(jt.min(_));y+=d?o:-o;y=u.invert(y);if(g>h[1]){h[1]=g}if(y<h[0]){h[0]=y}if(d){h.reverse()}u.domain(h);var x=d?n:r;x.domain(v(x.domain()));return[n,r]}function a(t){var e=t.data;var a=t.x;var o=t.y;var i=t.x2;var n=t.y2;var c=t.config;var f=t.buffer;var u=i?"x2":"x";var h=n?"y2":"y";var d=a.domain().slice(),_=o.domain().slice();var l=a.range(),p=o.range();if(!a.invert){d=v(d)}if(!o.invert){_=v(_)}e.forEach(function(t){var e=f?f:c.r(t.data,t.i)*2;if(a.invert&&a(t[u])-l[0]<e){var i=a.invert(a(t[u])-e);if(i<d[0]){d[0]=i}}if(a.invert&&l[1]-a(t[u])<e){var n=a.invert(a(t[u])+e);if(n>d[1]){d[1]=n}}if(o.invert&&o(t[h])-p[0]<e){var r=o.invert(o(t[h])-e);if(r>_[0]){_[0]=r}}if(o.invert&&p[1]-o(t[h])<e){var s=o.invert(o(t[h])+e);if(s<_[1]){_[1]=s}}});a.domain(d).range(l);o.domain(_).range(p);return[a,o]}function o(t){var e=this;var i=t.data;var n=t.x;var r=t.y;var s=t.x2;var a=t.y2;var o=s?"x2":"x";var c=a?"y2":"y";var f=this._discrete==="x"?r:n;var u=f.domain().slice();if(this._discrete==="x"){u.reverse()}var h=i.map(function(t){return t[e._discrete==="x"?c:o]});var d=f.invert(f(jt.max(h))+(this._discrete==="x"?-10:10));if(d>u[1]){u[1]=d}if(this._discrete==="x"){u.reverse()}f.domain(u);return[n,r]}function c(t){var e=t.data;var o=t.x;var c=t.y;var i=t.x2;var n=t.y2;var f=t.config;var u=i?"x2":"x";var h=n?"y2":"y";var d=o.domain().slice(),_=c.domain().slice();var l=o.range(),p=c.range();if(!o.invert){d=v(d)}if(!c.invert){_=v(_)}e.forEach(function(t){var e=f.height(t.data,t.i),i=f.width(t.data,t.i);if(o.invert&&o(t[u])-l[0]<i){var n=o.invert(o(t[u])-i);if(n<d[0]){d[0]=n}}if(o.invert&&l[1]-o(t[u])<i){var r=o.invert(o(t[u])+i);if(r>d[1]){d[1]=r}}if(c.invert&&c(t[h])-p[0]<e){var s=c.invert(c(t[h])-e);if(s>_[0]){_[0]=s}}if(c.invert&&p[1]-c(t[h])<e){var a=c.invert(c(t[h])+e);if(a<_[1]){_[1]=a}}});o.domain(d);c.domain(_);return[o,c]}function f(t){return this._sizeScaleD3(this._size?this._size(t):null)}function n(t){var i=t.map(h);var n=t.map(function(t){return t.key.split("_")[0]});return Et.stackOrderNone(t).sort(function(t,e){return n[e].localeCompare(n[t])||i[t]-i[e]})}function u(t){return n(t).reverse()}function h(t){var e=-1,i=0,n;var r=t.length;while(++e<r){if(n=+t[e][1]){i+=n}}return i}var d=function(Lt){function t(){var n=this;Lt.call(this);this._annotations=[];this._barPadding=0;this._buffer={Bar:r,Box:s,Circle:a,Line:o,Rect:c};this._confidenceConfig={fillOpacity:Nt.constant(.5)};this._groupPadding=5;this._shape=Nt.constant("Circle");this._shapeConfig=Nt.assign(this._shapeConfig,{Area:{label:function(t,e){return n._stacked?n._drawLabel(t,e):false},labelConfig:{fontResize:true}},ariaLabel:function(t,e){var i="";if(t.nested){i=""+n._drawLabel(t.data,t.i)}else{i=""+n._drawLabel(t,e);if(n._x(t,e)!==undefined){i+=", x: "+n._x(t,e)}if(n._y(t,e)!==undefined){i+=", y: "+n._y(t,e)}if(n._x2(t,e)!==undefined){i+=", x2: "+n._x2(t,e)}if(n._y2(t,e)!==undefined){i+=", y2: "+n._y2(t,e)}}return i+"."},Bar:{labelConfig:{textAnchor:function(){return n._discrete==="x"?"middle":"end"},verticalAlign:function(){return n._discrete==="x"?"top":"middle"}}},Circle:{r:f.bind(this)},Line:{fill:Nt.constant("none"),label:false,stroke:function(t,e){return i.colorAssign(n._id(t,e))},strokeWidth:Nt.constant(1)},Rect:{height:function(t){return f.bind(n)(t)*2},width:function(t){return f.bind(n)(t)*2}}});this._shapeOrder=["Area","Path","Bar","Box","Line","Rect","Circle"];this._shapeSort=function(t,e){return n._shapeOrder.indexOf(t)-n._shapeOrder.indexOf(e)};this._sizeMax=20;this._sizeMin=5;this._sizeScale="sqrt";this._stackOffset=Et.stackOffsetDiverging;this._stackOrder=u;this._timelineConfig=Nt.assign(this._timelineConfig,{brushing:true});this._x=Nt.accessor("x");this._x2=Nt.accessor("x2");this._xAxis=(new Rt.AxisBottom).align("end");this._x2Axis=(new Rt.AxisTop).align("start");this._xTest=(new Rt.AxisBottom).align("end").gridSize(0);this._x2Test=(new Rt.AxisTop).align("start").gridSize(0);this._xConfig={};this._x2Config={padding:0};this._y=Nt.accessor("y");this._y2=Nt.accessor("y2");this._yAxis=(new Rt.AxisLeft).align("start");this._yTest=(new Rt.AxisLeft).align("start").gridSize(0);this._y2Axis=(new Rt.AxisRight).align("end");this._y2Test=(new Rt.AxisLeft).align("end").gridSize(0);this._yConfig={gridConfig:{stroke:function(t){var e=n._yAxis.domain();return e[e.length-1]===t.id?"transparent":"#ccc"}}};this._y2Config={}}if(Lt)t.__proto__=Lt;t.prototype=Object.create(Lt&&Lt.prototype);t.prototype.constructor=t;t.prototype._draw=function t(e){var A=this;if(!this._filteredData.length){return this}var a=function(t,e){return A._stacked?""+(A._groupBy.length>1?A._ids(t,e).slice(0,-1).join("_"):"group"):""+A._ids(t,e).join("_")};var o=this._filteredData.map(function(t,e){return{__d3plus__:true,data:t,group:a(t,e),i:e,hci:A._confidence&&A._confidence[1]&&A._confidence[1](t,e),id:A._ids(t,e).slice(0,A._drawDepth+1).join("_"),lci:A._confidence&&A._confidence[0]&&A._confidence[0](t,e),shape:A._shape(t,e),x:A._x(t,e),x2:A._x2(t,e),y:A._y(t,e),y2:A._y2(t,e)}});this._formattedData=o;if(this._size){var i=jt.extent(o,function(t){return A._size(t.data)});this._sizeScaleD3=function(){return A._sizeMin};this._sizeScaleD3=Bt["scale"+this._sizeScale.charAt(0).toUpperCase()+this._sizeScale.slice(1)]().domain(i).range([i[0]===i[1]?this._sizeMax:jt.min([this._sizeMax/2,this._sizeMin]),this._sizeMax])}else{this._sizeScaleD3=function(){return A._sizeMin}}var n=o.some(function(t){return t.x2!==undefined}),r=o.some(function(t){return t.y2!==undefined});var s=this._height-this._margin.top-this._margin.bottom,c=this._discrete?this._discrete==="x"?"y":"x":undefined,f=this._discrete?this._discrete==="x"?"y2":"x2":undefined,u=[c,f],h=this._select,d=this._transition,_=this._width-this._margin.left-this._margin.right;var l=this._time&&o[0].x2===this._time(o[0].data,o[0].i),p=this._time&&o[0].x===this._time(o[0].data,o[0].i),g=this._time&&o[0].y2===this._time(o[0].data,o[0].i),y=this._time&&o[0].y===this._time(o[0].data,o[0].i);for(var x=0;x<o.length;x++){var v=o[x];if(p){v.x=Rt.date(v.x)}if(l){v.x2=Rt.date(v.x2)}if(y){v.y=Rt.date(v.y)}if(g){v.y2=Rt.date(v.y2)}v.discrete=v.shape==="Bar"?v[this._discrete]+"_"+v.group:""+v[this._discrete]}var m,C,w,b;if(this._stacked){var S=Mt.nest().key(function(t){return t.group}).entries(o).reduce(function(t,e){if(!t[e.key]){t[e.key]=0}t[e.key]+=jt.sum(e.values,function(t){return t[c]});return t},{});o=o.sort(function(t,e){if(A["_"+A._discrete+"Sort"]){return A["_"+A._discrete+"Sort"](t.data,e.data)}var i=t[A._discrete],n=e[A._discrete];if(i-n!==0){return i-n}if(t.group!==e.group){return S[e.group]-S[t.group]}return e[c]-t[c]});m=Array.from(new Set(o.map(function(t){return t.discrete})));b=Array.from(new Set(o.map(function(t){return t.id})));w=Mt.nest().key(function(t){return t.discrete}).entries(o).map(function(t){return t.values});w.forEach(function(r){var s=Array.from(new Set(r.map(function(t){return t.id})));if(s.length<b.length){b.forEach(function(e){if(!s.includes(e)){var t=o.filter(function(t){return t.id===e})[0];if(t.shape==="Area"){var i=a(t.data,t.i);var n={__d3plus__:true,data:t.data,discrete:t.shape==="Bar"?r[0][A._discrete]+"_"+i:""+r[0][A._discrete],group:i,id:e,shape:t.shape};n[A._discrete]=r[0][A._discrete];n[c]=0;o.push(n)}}})}});if(this["_"+this._discrete+"Sort"]){o.sort(function(t,e){return A["_"+A._discrete+"Sort"](t.data,e.data)})}else{o.sort(function(t,e){return t[A._discrete]-e[A._discrete]})}var k=this._stackOrder;if(k instanceof Array){b.sort(function(t,e){return k.indexOf(t)-k.indexOf(e)})}else if(k===Et.stackOrderNone){b.sort(function(t,e){return t.localeCompare(e)})}w=Et.stack().keys(b).offset(this._stackOffset).order(k instanceof Array?Et.stackOrderNone:k).value(function(t,e){var i=t.filter(function(t){return t.id===e});return i.length?i[0][c]:0})(w);C={};C[this._discrete]=jt.extent(o,function(t){return t[A._discrete]});C[c]=[jt.min(w.map(function(t){return jt.min(t.map(function(t){return t[0]}))})),jt.max(w.map(function(t){return jt.max(t.map(function(t){return t[1]}))}))]}else{var O=this._discrete==="x"?o.map(function(t){return t.x}):o.map(function(t){return t.x}).concat(this._confidence&&this._confidence[0]?o.map(function(t){return t.lci}):[]).concat(this._confidence&&this._confidence[1]?o.map(function(t){return t.hci}):[]);var z=this._discrete==="x"?o.map(function(t){return t.x2}):o.map(function(t){return t.x2}).concat(this._confidence&&this._confidence[0]?o.map(function(t){return t.lci}):[]).concat(this._confidence&&this._confidence[1]?o.map(function(t){return t.hci}):[]);var T=this._discrete==="y"?o.map(function(t){return t.y}):o.map(function(t){return t.y}).concat(this._confidence&&this._confidence[0]?o.map(function(t){return t.lci}):[]).concat(this._confidence&&this._confidence[1]?o.map(function(t){return t.hci}):[]);var P=this._discrete==="y"?o.map(function(t){return t.y2}):o.map(function(t){return t.y2}).concat(this._confidence&&this._confidence[0]?o.map(function(t){return t.lci}):[]).concat(this._confidence&&this._confidence[1]?o.map(function(t){return t.hci}):[]);if(this["_"+this._discrete+"Sort"]){o.sort(function(t,e){return A["_"+A._discrete+"Sort"](t.data,e.data)})}else{o.sort(function(t,e){return t[A._discrete]-e[A._discrete]})}C={x:this._xSort?Array.from(new Set(o.filter(function(t){return t.x}).sort(function(t,e){return A._xSort(t.data,e.data)}).map(function(t){return t.x}))):jt.extent(O,function(t){return t}),x2:this._x2Sort?Array.from(new Set(o.filter(function(t){return t.x2}).sort(function(t,e){return A._x2Sort(t.data,e.data)}).map(function(t){return t.x2}))):jt.extent(z,function(t){return t}),y:this._ySort?Array.from(new Set(o.filter(function(t){return t.y}).sort(function(t,e){return A._ySort(t.data,e.data)}).map(function(t){return t.y}))):jt.extent(T,function(t){return t}),y2:this._y2Sort?Array.from(new Set(o.filter(function(t){return t.y2}).sort(function(t,e){return A._y2Sort(t.data,e.data)}).map(function(t){return t.y2}))):jt.extent(P,function(t){return t})}}var D=this._xDomain?this._xDomain.slice():C.x,L=this._xSort?"Ordinal":"Linear";if(D[0]===void 0){D[0]=C.x[0]}if(D[1]===void 0){D[1]=C.x[1]}if(p){D=D.map(Rt.date);L="Time"}else if(this._discrete==="x"){D=Array.from(new Set(o.filter(function(t){return t.x}).sort(function(t,e){return A._xSort?A._xSort(t.data,e.data):t.x-e.x}).map(function(t){return t.x})));L="Ordinal"}var j=this._x2Domain?this._x2Domain.slice():C.x2,M=this._x2Sort?"Ordinal":"Linear";if(j&&j[0]===void 0){j[0]=C.x2[0]}if(j&&j[1]===void 0){j[1]=C.x2[1]}if(l){j=j.map(Rt.date);M="Time"}else if(this._discrete==="x"){j=Array.from(new Set(o.filter(function(t){return t.x2}).sort(function(t,e){return A._x2Sort?A._x2Sort(t.data,e.data):t.x2-e.x2}).map(function(t){return t.x2})));M="Ordinal"}var B=this._yDomain?this._yDomain.slice():C.y,E=this._ySort?"Ordinal":"Linear";if(B[0]===void 0){B[0]=C.y[0]}if(B[1]===void 0){B[1]=C.y[1]}var R=this._y2Domain?this._y2Domain.slice():C.y2,N=this._y2Sort?"Ordinal":"Linear";if(R&&R[0]===void 0){R[0]=C.y2[0]}if(R&&R[1]===void 0){R[1]=C.y2[1]}if(y){B=B.map(Rt.date);E="Time"}else if(this._discrete==="y"){B=Array.from(new Set(o.sort(function(t,e){return A._ySort?A._ySort(t.data,e.data):t.y-e.y}).map(function(t){return t.y})));E="Ordinal";R=Array.from(new Set(o.sort(function(t,e){return A._y2Sort?A._y2Sort(t.data,e.data):t.y2-e.y2}).map(function(t){return t.y2})));N="Ordinal"}if(g){R=R.map(Rt.date);N="Time"}C={x:D,x2:j||D,y:B,y2:R||B};u.forEach(function(t){if(t&&A._baseline!==void 0){var e=A._baseline;if(C[t]&&C[t][0]>e){C[t][0]=e}else if(C[t]&&C[t][1]<e){C[t][1]=e}}});var q=Bt["scale"+L]().domain(C.x).range(jt.range(0,_+1,_/(C.x.length-1))),V=Bt["scale"+M]().domain(C.x2).range(jt.range(0,_+1,_/(C.x2.length-1))),W=Bt["scale"+E]().domain(C.y.reverse()).range(jt.range(0,s+1,s/(C.y.length-1))),F=Bt["scale"+N]().domain(C.y2.reverse()).range(jt.range(0,s+1,s/(C.y2.length-1)));var G=Mt.nest().key(function(t){return t.shape}).entries(o).sort(function(t,e){return A._shapeSort(t.key,e.key)});var H=this._discrete==="x"?E:L;if(this._xConfig.scale!=="log"&&this._yConfig.scale!=="log"&&H!=="Ordinal"){G.forEach(function(t){if(A._buffer[t.key]){var e=A._buffer[t.key].bind(A)({data:t.values,x:q,y:W,config:A._shapeConfig[t.key]});if(A._xConfig.scale!=="log"){q=e[0]}if(A._yConfig.scale!=="log"){W=e[1]}var i=A._buffer[t.key].bind(A)({data:t.values,x:V,y:F,x2:true,y2:true,config:A._shapeConfig[t.key]});if(A._x2Config.scale!=="log"){V=i[0]}if(A._y2Config.scale!=="log"){F=i[1]}}})}D=q.domain();j=V.domain();B=W.domain();R=F.domain();var U=Nt.elem("g.d3plus-plot-test",{enter:{opacity:0},parent:this._select}),I=this._discrete==="x"&&!l?C.x2:undefined,J=this._discrete==="x"&&!p?C.x:undefined,K=this._discrete==="y"&&!g?C.y2:undefined,Q=this._discrete==="y"&&!y?C.y:undefined;var X={gridConfig:{stroke:!this._discrete||this._discrete==="x"?this._yTest.gridConfig().stroke:"transparent"}};var Y={barConfig:{"stroke-width":0},gridSize:0,labels:[],title:false,tickSize:0};var Z=n?{}:Y;var $=r?{}:Y;this._yTest.domain(B).height(s).maxSize(_/2).range([undefined,undefined]).scale(E.toLowerCase()).select(U.node()).ticks(Q).width(_).config(X).config(this._yConfig).render();var tt=this._yTest.outerBounds();var et=tt.width?tt.width+this._yTest.padding():undefined;if(r){this._y2Test.domain(R).height(s).range([undefined,undefined]).scale(N.toLowerCase()).select(U.node()).ticks(K).width(_).config(X).config($).config(this._y2Config).render()}var it=this._y2Test.outerBounds();var nt=it.width?it.width+this._y2Test.padding():undefined;var rt={gridConfig:{stroke:!this._discrete||this._discrete==="y"?this._xTest.gridConfig().stroke:"transparent"}};this._xTest.domain(D).height(s).maxSize(s/2).range([undefined,undefined]).scale(L.toLowerCase()).select(U.node()).ticks(J).width(_).config(rt).config(this._xConfig).render();if(n){this._x2Test.domain(j).height(s).range([undefined,undefined]).scale(M.toLowerCase()).select(U.node()).ticks(I).width(_).config(rt).tickSize(0).config(Z).config(this._x2Config).render()}var st=this._xTest._getRange();var at=this._x2Test._getRange();var ot=this._x2Test.outerBounds();var ct=ot.height+this._x2Test.padding();var ft=jt.max([et,st[0],at[0]]);this._xTest.range([ft,undefined]).render();var ut=this._yTest.shapeConfig().labelConfig.fontSize()/2;var ht=jt.max([nt,_-st[1],_-at[1]]);var dt=this._xTest.outerBounds();var _t=dt.height+this._xTest.padding();this._padding.left+=ft;this._padding.right+=ht;this._padding.bottom+=_t;this._padding.top+=ct+ut;Lt.prototype._draw.call(this,e);var lt=this._margin.left+this._margin.right;var pt=this._margin.top+this._margin.bottom;this._yTest.domain(B).height(s).maxSize(_/2).range([ct,s-(_t+ut+pt)]).scale(E.toLowerCase()).select(U.node()).ticks(Q).width(_).config(X).config(this._yConfig).render();tt=this._yTest.outerBounds();et=tt.width?tt.width+this._yTest.padding():undefined;ft=jt.max([et,st[0],at[0]]);if(r){this._y2Test.config(X).domain(R).gridSize(0).height(s).range([ct,s-(_t+ut+pt)]).scale(N.toLowerCase()).select(U.node()).width(_-jt.max([0,ht-nt])).title(false).config(this._y2Config).config($).render()}it=this._y2Test.outerBounds();nt=it.width?it.width+this._y2Test.padding():undefined;ht=jt.max([nt,_-st[1],_-at[1]]);var gt="translate("+this._margin.left+", "+(this._margin.top+ct+ut)+")";var yt="translate("+this._margin.left+", "+(this._margin.top+ut)+")";var xt=Nt.elem("g.d3plus-plot-x-axis",{parent:h,transition:d,enter:{transform:gt},update:{transform:gt}});var vt=Nt.elem("g.d3plus-plot-x2-axis",{parent:h,transition:d,enter:{transform:yt},update:{transform:yt}});var mt=ft>et?ft-et:0;var Ct="translate("+(this._margin.left+mt)+", "+(this._margin.top+ut)+")";var wt=Nt.elem("g.d3plus-plot-y-axis",{parent:h,transition:d,enter:{transform:Ct},update:{transform:Ct}});var bt="translate(-"+this._margin.right+", "+(this._margin.top+ut)+")";var St=Nt.elem("g.d3plus-plot-y2-axis",{parent:h,transition:d,enter:{transform:bt},update:{transform:bt}});this._xAxis.domain(D).height(s-(ct+ut+pt)).maxSize(s/2).range([ft,_-(ht+lt)]).scale(L.toLowerCase()).select(xt.node()).ticks(J).width(_).config(rt).config(this._xConfig).render();if(n){this._x2Axis.domain(j).height(s-(_t+ut+pt)).range([ft,_-(ht+lt)]).scale(M.toLowerCase()).select(vt.node()).ticks(I).width(_).config(rt).config(Z).config(this._x2Config).render()}q=function(t,e){if(e==="x2"){if(A._x2Config.scale==="log"&&t===0){t=j[0]<0?-1:1}return A._x2Axis._getPosition.bind(A._x2Axis)(t)}else{if(A._xConfig.scale==="log"&&t===0){t=D[0]<0?-1:1}return A._xAxis._getPosition.bind(A._xAxis)(t)}};var kt=this._xAxis._getRange();this._yAxis.domain(B).height(s).maxSize(_/2).range([this._xAxis.outerBounds().y+ct,s-(_t+ut+pt)]).scale(E.toLowerCase()).select(wt.node()).ticks(Q).width(kt[kt.length-1]).config(X).config(this._yConfig).render();if(r){this._y2Axis.config(X).domain(r?R:B).gridSize(0).height(s).range([this._xAxis.outerBounds().y+ct,s-(_t+ut+pt)]).scale(r?N.toLowerCase():E.toLowerCase()).select(St.node()).width(_-jt.max([0,ht-nt])).title(false).config(this._y2Config).config($).render()}W=function(t,e){if(e==="y2"){if(A._y2Config.scale==="log"&&t===0){t=R[0]<0?-1:1}return A._y2Axis._getPosition.bind(A._y2Axis)(t)-ct}else{if(A._yConfig.scale==="log"&&t===0){t=B[0]<0?-1:1}return A._yAxis._getPosition.bind(A._yAxis)(t)-ct}};var At=this._yAxis._getRange();var Ot=Nt.elem("g.d3plus-plot-annotations",{parent:h,transition:d,enter:{transform:gt},update:{transform:gt}}).node();this._annotations.forEach(function(t){(new qt[t.shape]).config(t).config({x:function(t){return t.x2?q(t.x2,"x2"):q(t.x)},x0:A._discrete==="x"?function(t){return t.x2?q(t.x2,"x2"):q(t.x)}:q(0),x1:A._discrete==="x"?null:function(t){return t.x2?q(t.x2,"x2"):q(t.x)},y:function(t){return t.y2?W(t.y2,"y2"):W(t.y)},y0:A._discrete==="y"?function(t){return t.y2?W(t.y2,"y2"):W(t.y)}:W(0)-zt,y1:A._discrete==="y"?null:function(t){return t.y2?W(t.y2,"y2"):W(t.y)-zt}}).select(Ot).render()});var zt=this._xAxis.barConfig()["stroke-width"];if(zt){zt/=2}var Tt={duration:this._duration,label:function(t){return A._drawLabel(t.data,t.i)},select:Nt.elem("g.d3plus-plot-shapes",{parent:h,transition:d,enter:{transform:gt},update:{transform:gt}}).node(),x:function(t){return t.x2?q(t.x2,"x2"):q(t.x)},x0:this._discrete==="x"?function(t){return t.x2?q(t.x2,"x2"):q(t.x)}:q(0),x1:this._discrete==="x"?null:function(t){return t.x2?q(t.x2,"x2"):q(t.x)},y:function(t){return t.y2?W(t.y2,"y2"):W(t.y)},y0:this._discrete==="y"?function(t){return t.y2?W(t.y2,"y2"):W(t.y)}:W(0)-zt,y1:this._discrete==="y"?null:function(t){return t.y2?W(t.y2,"y2"):W(t.y)-zt}};if(this._stacked){var Pt=c==="x"?q:W;Tt[""+c]=Tt[c+"0"]=function(t){var e=b.indexOf(t.id),i=m.indexOf(t.discrete);return e>=0?Pt(w[e][i][0]):Pt(0)};Tt[c+"1"]=function(t){var e=b.indexOf(t.id),i=m.indexOf(t.discrete);return e>=0?Pt(w[e][i][1]):Pt(0)}}var Dt=Object.keys(this._on);G.forEach(function(e){var t=(new qt[e.key]).config(Tt).data(e.values);if(e.key==="Bar"){var i;var n=A._discrete==="x"?q:W;var r=(A._discrete==="x"?D:B).filter(function(t){return typeof t!=="string"||t.indexOf("d3plus-buffer-")<0});var s=A._discrete==="x"?kt:At;if(r.length>1){i=n(r[1])-n(r[0])}else{i=s[s.length-1]-s[0]}i-=A._groupPadding;var a=i;var o=Mt.nest().key(function(t){return t[A._discrete]}).key(function(t){return t.group}).entries(e.values);var c=jt.merge(o.map(function(t){return t.values.map(function(t){return t.key})}));var f=Array.from(new Set(c));if(jt.max(o.map(function(t){return t.values.length}))===1){t[A._discrete](function(t,e){return Tt[A._discrete](t,e)})}else{a=(a-A._barPadding*f.length-1)/f.length;var u=i/2-a/2;var h=Bt.scaleLinear().domain([0,f.length-1]).range([-u,u]);t[A._discrete](function(t,e){return Tt[A._discrete](t,e)+h(f.indexOf(t.group))})}t.width(a);t.height(a)}else if(e.key==="Line"&&A._confidence){var d=Object.assign({},Tt);var _=A._discrete==="x"?"y":"x";var l=A._discrete==="x"?W:q;d[_+"0"]=function(t){return l(A._confidence[0]?t.lci:t[_])};d[_+"1"]=function(t){return l(A._confidence[1]?t.hci:t[_])};var p=(new qt.Area).config(d).data(e.values);var g=Object.assign(A._shapeConfig,A._confidenceConfig);p.config(Nt.configPrep.bind(A)(g,"shape","Area")).render();A._shapes.push(p)}var y=Dt.filter(function(t){return t.includes("."+e.key)}),x=Dt.filter(function(t){return!t.includes(".")}),v=Dt.filter(function(t){return t.includes(".shape")});var m=function(e){t.on(x[e],function(t){return A._on[x[e]](t.data,t.i)})};for(var C=0;C<x.length;C++)m(C);var w=function(e){t.on(v[e],function(t){return A._on[v[e]](t.data,t.i)})};for(var b=0;b<v.length;b++)w(b);var S=function(e){t.on(y[e],function(t){return A._on[y[e]](t.data,t.i)})};for(var k=0;k<y.length;k++)S(k);t.config(Nt.configPrep.bind(A)(A._shapeConfig,"shape",e.key)).render();A._shapes.push(t)});return this};t.prototype.annotations=function t(e){return arguments.length?(this._annotations=e instanceof Array?e:[e],this):this._annotations};t.prototype.barPadding=function t(e){return arguments.length?(this._barPadding=e,this):this._barPadding};t.prototype.baseline=function t(e){return arguments.length?(this._baseline=e,this):this._baseline};t.prototype.confidence=function t(e){if(arguments.length){this._confidence=[];var i=e[0];this._confidence[0]=typeof i==="function"||!i?i:Nt.accessor(i);var n=e[1];this._confidence[1]=typeof n==="function"||!n?n:Nt.accessor(n);return this}else{return this._confidence}};t.prototype.confidenceConfig=function t(e){return arguments.length?(this._confidenceConfig=Nt.assign(this._confidenceConfig,e),this):this._confidenceConfig};t.prototype.discrete=function t(e){return arguments.length?(this._discrete=e,this):this._discrete};t.prototype.groupPadding=function t(e){return arguments.length?(this._groupPadding=e,this):this._groupPadding};t.prototype.shapeSort=function t(e){return arguments.length?(this._shapeSort=e,this):this._shapeSort};t.prototype.size=function t(e){return arguments.length?(this._size=typeof e==="function"||!e?e:Nt.accessor(e),this):this._size};t.prototype.sizeMax=function t(e){return arguments.length?(this._sizeMax=e,this):this._sizeMax};t.prototype.sizeMin=function t(e){return arguments.length?(this._sizeMin=e,this):this._sizeMin};t.prototype.sizeScale=function t(e){return arguments.length?(this._sizeScale=e,this):this._sizeScale};t.prototype.stacked=function t(e){return arguments.length?(this._stacked=e,this):this._stacked};t.prototype.stackOffset=function t(e){return arguments.length?(this._stackOffset=typeof e==="function"?e:Et["stackOffset"+(e.charAt(0).toUpperCase()+e.slice(1))],this):this._stackOffset};t.prototype.stackOrder=function t(e){if(arguments.length){if(typeof e==="string"){this._stackOrder=e==="ascending"?n:e==="descending"?u:Et["stackOrder"+(e.charAt(0).toUpperCase()+e.slice(1))]}else{this._stackOrder=e}return this}else{return this._stackOrder}};t.prototype.x=function t(e){if(arguments.length){if(typeof e==="function"){this._x=e}else{this._x=Nt.accessor(e);if(!this._aggs[e]&&this._discrete==="x"){this._aggs[e]=function(t){var e=Array.from(new Set(t));return e.length===1?e[0]:e}}}return this}else{return this._x}};t.prototype.x2=function t(e){if(arguments.length){if(typeof e==="function"){this._x2=e}else{this._x2=Nt.accessor(e);if(!this._aggs[e]&&this._discrete==="x"){this._aggs[e]=function(t){var e=Array.from(new Set(t));return e.length===1?e[0]:e}}}return this}else{return this._x2}};t.prototype.xConfig=function t(e){return arguments.length?(this._xConfig=Nt.assign(this._xConfig,e),this):this._xConfig};t.prototype.x2Config=function t(e){return arguments.length?(this._x2Config=Nt.assign(this._x2Config,e),this):this._x2Config};t.prototype.xDomain=function t(e){return arguments.length?(this._xDomain=e,this):this._xDomain};t.prototype.x2Domain=function t(e){return arguments.length?(this._x2Domain=e,this):this._x2Domain};t.prototype.xSort=function t(e){return arguments.length?(this._xSort=e,this):this._xSort};t.prototype.x2Sort=function t(e){return arguments.length?(this._x2Sort=e,this):this._x2Sort};t.prototype.y=function t(e){if(arguments.length){if(typeof e==="function"){this._y=e}else{this._y=Nt.accessor(e);if(!this._aggs[e]&&this._discrete==="y"){this._aggs[e]=function(t){var e=Array.from(new Set(t));return e.length===1?e[0]:e}}}return this}else{return this._y}};t.prototype.y2=function t(e){if(arguments.length){if(typeof e==="function"){this._y2=e}else{this._y2=Nt.accessor(e);if(!this._aggs[e]&&this._discrete==="y2"){this._aggs[e]=function(t){var e=Array.from(new Set(t));return e.length===1?e[0]:e}}}return this}else{return this._y2}};t.prototype.yConfig=function t(e){if(arguments.length){if(e.domain){e.domain=e.domain.slice().reverse()}this._yConfig=Nt.assign(this._yConfig,e);return this}return this._yConfig};t.prototype.y2Config=function t(e){return arguments.length?(this._y2Config=Nt.assign(this._y2Config,e),this):this._y2Config};t.prototype.yDomain=function t(e){return arguments.length?(this._yDomain=e,this):this._yDomain};t.prototype.y2Domain=function t(e){return arguments.length?(this._y2Domain=e,this):this._y2Domain};t.prototype.ySort=function t(e){return arguments.length?(this._ySort=e,this):this._ySort};t.prototype.y2Sort=function t(e){return arguments.length?(this._y2Sort=e,this):this._y2Sort};return t}(e.Viz);var _=function(t){function e(){t.call(this);this._baseline=0;this._discrete="x";this._shape=Nt.constant("Area");this.x("x")}if(t)e.__proto__=t;e.prototype=Object.create(t&&t.prototype);e.prototype.constructor=e;return e}(d);var l=function(t){function e(){t.call(this);this._baseline=0;this._discrete="x";this._shape=Nt.constant("Bar");this.x("x")}if(t)e.__proto__=t;e.prototype=Object.create(t&&t.prototype);e.prototype.constructor=e;return e}(d);var p=function(t){function e(){var n=this;t.call(this);this._discrete="x";this._shape=Nt.constant("Box");this.x("x");this._tooltipConfig=Nt.assign(this._tooltipConfig,{title:function(t,e){if(!t){return""}while(t.__d3plus__&&t.data){t=t.data;e=t.i}if(n._label){return n._label(t,e)}var i=n._ids(t,e).slice(0,n._drawDepth);return i[i.length-1]}})}if(t)e.__proto__=t;e.prototype=Object.create(t&&t.prototype);e.prototype.constructor=e;return e}(d);var g=function(t){function e(){var s=this;t.call(this);this._discrete="x";this._shape=Nt.constant("Line");this.x("x");this.y2(function(t){return s._y(t)});this.yConfig({tickFormat:function(e){var t=s._formattedData;var i=t[0].x instanceof Date?t[0].x.getTime():t[0].x;var n=t.filter(function(t){return(t.x instanceof Date?t.x.getTime():t.x)===i});var r=n.find(function(t){return t.y===e});return r?s._drawLabel(r,r.i):""}});this.y2Config({tickFormat:function(e){var t=s._formattedData;var i=t[t.length-1].x instanceof Date?t[t.length-1].x.getTime():t[t.length-1].x;var n=t.filter(function(t){return(t.x instanceof Date?t.x.getTime():t.x)===i});var r=n.find(function(t){return t.y===e});return r?s._drawLabel(r,r.i):""}});this.ySort(function(t,e){return s._y(e)-s._y(t)});this.y2Sort(function(t,e){return s._y(e)-s._y(t)})}if(t)e.__proto__=t;e.prototype=Object.create(t&&t.prototype);e.prototype.constructor=e;return e}(d);var y=function(t){function e(){t.call(this);this._discrete="x";this._shape=Nt.constant("Line");this.x("x")}if(t)e.__proto__=t;e.prototype=Object.create(t&&t.prototype);e.prototype.constructor=e;return e}(d);var x=Math.PI*2;var m=function(h){function t(){h.call(this);this._axisConfig={fill:Nt.constant("none"),stroke:Nt.constant("#CCC"),strokeWidth:Nt.constant(1)};this._discrete="metric";this._hover=true;this._levels=6;this._metric=Nt.accessor("metric");this._radarPadding=100;this._shape=Nt.constant("Path");this._shapeConfig=Nt.assign(this._shapeConfig,{Circle:{r:Nt.accessor("r",0)},Path:{}});this._value=Nt.accessor("value")}if(h)t.__proto__=h;t.prototype=Object.create(h&&h.prototype);t.prototype.constructor=t;t.prototype._draw=function t(e){var _=this;h.prototype._draw.call(this,e);var i=this._height-this._margin.top-this._margin.bottom,n=this._width-this._margin.left-this._margin.right;var l=(Math.min(i,n)-this._radarPadding)/2,r="translate("+n/2+", "+i/2+")";var s=Mt.nest().key(this._metric).entries(this._filteredData),a=Mt.nest().key(this._id).key(this._metric).entries(this._filteredData);var o=jt.max(a.map(function(t){return t.values.map(function(t){return jt.sum(t.values,function(t,e){return _._value(t,e)})})}).flat());var c=Array.from(Array(this._levels).keys()).map(function(t){return{id:t,r:l*((t+1)/_._levels)}});(new qt.Circle).data(c).select(Nt.elem("g.d3plus-Radar-radial-circles",{parent:this._select,enter:{transform:r},update:{transform:r}}).node()).config(this._axisConfig).render();var p=s.length;var f=s.map(function(t,e){var i=100;var n=_._shapeConfig.labelConfig.fontSize&&_._shapeConfig.labelConfig.fontSize(t,e)||11;var r=n*1.4;var s=r*2;var a=10,o=parseInt(360-360/p*e/90,10)%4+1,c=x/p*e;var f=360/p*e;var u="start";var h=a;if(o===2||o===3){h=-i-a;u="end";f+=180}var d={x:h,y:-s/2,width:i,height:s};return{id:t.key,angle:f,textAnchor:u,labelBounds:d,rotateAnchor:[-h,s/2],x:l*Math.cos(c),y:l*Math.sin(c)}}).sort(function(t,e){return t.key-e.key});(new qt.Rect).data(f).rotate(function(t){return t.angle}).width(0).height(0).x(function(t){return t.x}).y(function(t){return t.y}).label(function(t){return t.id}).labelBounds(function(t){return t.labelBounds}).labelConfig({padding:0,textAnchor:function(t){return t.textAnchor},rotateAnchor:function(t){return t.data.rotateAnchor},fontColor:"black",verticalAlign:"middle"}).select(Nt.elem("g.d3plus-Radar-text",{parent:this._select,enter:{transform:r},update:{transform:r}}).node()).render();(new qt.Path).data(f).d(function(t){return"M"+0+","+0+" "+-t.x+","+-t.y}).select(Nt.elem("g.d3plus-Radar-axis",{parent:this._select,enter:{transform:r},update:{transform:r}}).node()).config(this._axisConfig).render();var u=a.map(function(t){var e=t.values.map(function(t,e){var i=jt.sum(t.values,function(t,e){return _._value(t,e)});var n=i/o*l,r=x/p*e;return{x:n*Math.cos(r),y:n*Math.sin(r)}});var i="M "+e[0].x+" "+e[0].y+" "+e.map(function(t){return"L "+t.x+" "+t.y}).join(" ")+" L "+e[0].x+" "+e[0].y;return{id:t.key,d:i,__d3plus__:true,data:Nt.assign.apply(void 0,jt.merge(t.values.map(function(t){return t.values})))}});this._shapes.push((new qt.Path).data(u).d(function(t){return t.d}).select(Nt.elem("g.d3plus-Radar-items",{parent:this._select,enter:{transform:r},update:{transform:r}}).node()).config(Nt.configPrep.bind(this)(this._shapeConfig,"shape","Path")).render());return this};t.prototype.metric=function t(e){return arguments.length?(this._metric=typeof e==="function"?e:Nt.accessor(e),this):this._metric};t.prototype.radarPadding=function t(e){return arguments.length?(this._radarPadding=e,this):this._radarPadding};t.prototype.value=function t(e){return arguments.length?(this._value=typeof e==="function"?e:Nt.accessor(e),this):this._value};return t}(e.Viz);var C=function(t){function e(){t.call(this);this._stacked=true}if(t)e.__proto__=t;e.prototype=Object.create(t&&t.prototype);e.prototype.constructor=e;return e}(_);t.AreaPlot=_;t.BarChart=l;t.BoxWhisker=p;t.BumpChart=g;t.LinePlot=y;t.Plot=d;t.Radar=m;t.StackedArea=C;Object.defineProperty(t,"__esModule",{value:true})});