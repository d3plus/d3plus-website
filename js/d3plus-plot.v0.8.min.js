/*
  d3plus-plot v0.8.38
  A reusable javascript x/y plot built on D3.
  Copyright (c) 2020 D3plus - https://d3plus.org
  @license MIT
*/
(function(e){typeof define==="function"&&define.amd?define(e):e()})(function(){"use strict";var e=typeof globalThis!=="undefined"?globalThis:typeof window!=="undefined"?window:typeof global!=="undefined"?global:typeof self!=="undefined"?self:{};function t(e,t){return t={exports:{}},e(t,t.exports),t.exports}var n=function(e){return e&&e.Math==Math&&e};var l=n(typeof globalThis=="object"&&globalThis)||n(typeof window=="object"&&window)||n(typeof self=="object"&&self)||n(typeof e=="object"&&e)||Function("return this")();var r=function(e){try{return!!e()}catch(e){return true}};var h=!r(function(){return Object.defineProperty({},"a",{get:function(){return 7}}).a!=7});var i={}.propertyIsEnumerable;var a=Object.getOwnPropertyDescriptor;var o=a&&!i.call({1:2},1);var s=o?function e(t){var n=a(this,t);return!!n&&n.enumerable}:i;var v={f:s};var c=function(e,t){return{enumerable:!(e&1),configurable:!(e&2),writable:!(e&4),value:t}};var f={}.toString;var u=function(e){return f.call(e).slice(8,-1)};var d="".split;var m=r(function(){return!Object("z").propertyIsEnumerable(0)})?function(e){return u(e)=="String"?d.call(e,""):Object(e)}:Object;var g=function(e){if(e==undefined)throw TypeError("Can't call method on "+e);return e};var _=function(e){return m(g(e))};var y=function(e){return typeof e==="object"?e!==null:typeof e==="function"};var p=function(e,t){if(!y(e))return e;var n,r;if(t&&typeof(n=e.toString)=="function"&&!y(r=n.call(e)))return r;if(typeof(n=e.valueOf)=="function"&&!y(r=n.call(e)))return r;if(!t&&typeof(n=e.toString)=="function"&&!y(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")};var x={}.hasOwnProperty;var b=function(e,t){return x.call(e,t)};var k=l.document;var C=y(k)&&y(k.createElement);var w=function(e){return C?k.createElement(e):{}};var S=!h&&!r(function(){return Object.defineProperty(w("div"),"a",{get:function(){return 7}}).a!=7});var A=Object.getOwnPropertyDescriptor;var O=h?A:function e(t,n){t=_(t);n=p(n,true);if(S)try{return A(t,n)}catch(e){}if(b(t,n))return c(!v.f.call(t,n),t[n])};var P={f:O};var z=function(e){if(!y(e)){throw TypeError(String(e)+" is not an object")}return e};var T=Object.defineProperty;var j=h?T:function e(t,n,r){z(t);n=p(n,true);z(r);if(S)try{return T(t,n,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported");if("value"in r)t[n]=r.value;return t};var M={f:j};var L=h?function(e,t,n){return M.f(e,t,c(1,n))}:function(e,t,n){e[t]=n;return e};var D=function(t,n){try{L(l,t,n)}catch(e){l[t]=n}return n};var E="__core-js_shared__";var B=l[E]||D(E,{});var R=B;var q=t(function(e){(e.exports=function(e,t){return R[e]||(R[e]=t!==undefined?t:{})})("versions",[]).push({version:"3.4.7",mode:"global",copyright:"Â© 2019 Denis Pushkarev (zloirock.ru)"})});var W=Function.toString;var F=q("inspectSource",function(e){return W.call(e)});var N=l.WeakMap;var I=typeof N==="function"&&/native code/.test(F(N));var V=0;var G=Math.random();var H=function(e){return"Symbol("+String(e===undefined?"":e)+")_"+(++V+G).toString(36)};var U=q("keys");var K=function(e){return U[e]||(U[e]=H(e))};var Y={};var J=l.WeakMap;var Q,X,Z;var $=function(e){return Z(e)?X(e):Q(e,{})};var ee=function(n){return function(e){var t;if(!y(e)||(t=X(e)).type!==n){throw TypeError("Incompatible receiver, "+n+" required")}return t}};if(I){var te=new J;var ne=te.get;var re=te.has;var ie=te.set;Q=function(e,t){ie.call(te,e,t);return t};X=function(e){return ne.call(te,e)||{}};Z=function(e){return re.call(te,e)}}else{var ae=K("state");Y[ae]=true;Q=function(e,t){L(e,ae,t);return t};X=function(e){return b(e,ae)?e[ae]:{}};Z=function(e){return b(e,ae)}}var oe={set:Q,get:X,has:Z,enforce:$,getterFor:ee};var se=t(function(e){var t=oe.get;var s=oe.enforce;var c=String(String).split("String");(e.exports=function(e,t,n,r){var i=r?!!r.unsafe:false;var a=r?!!r.enumerable:false;var o=r?!!r.noTargetGet:false;if(typeof n=="function"){if(typeof t=="string"&&!b(n,"name"))L(n,"name",t);s(n).source=c.join(typeof t=="string"?t:"")}if(e===l){if(a)e[t]=n;else D(t,n);return}else if(!i){delete e[t]}else if(!o&&e[t]){a=true}if(a)e[t]=n;else L(e,t,n)})(Function.prototype,"toString",function e(){return typeof this=="function"&&t(this).source||F(this)})});var ce=l;var fe=function(e){return typeof e=="function"?e:undefined};var ue=function(e,t){return arguments.length<2?fe(ce[e])||fe(l[e]):ce[e]&&ce[e][t]||l[e]&&l[e][t]};var le=Math.ceil;var de=Math.floor;var he=function(e){return isNaN(e=+e)?0:(e>0?de:le)(e)};var ve=Math.min;var ge=function(e){return e>0?ve(he(e),9007199254740991):0};var _e=Math.max;var ye=Math.min;var pe=function(e,t){var n=he(e);return n<0?_e(n+t,0):ye(n,t)};var xe=function(s){return function(e,t,n){var r=_(e);var i=ge(r.length);var a=pe(n,i);var o;if(s&&t!=t)while(i>a){o=r[a++];if(o!=o)return true}else for(;i>a;a++){if((s||a in r)&&r[a]===t)return s||a||0}return!s&&-1}};var me={includes:xe(true),indexOf:xe(false)};var be=me.indexOf;var ke=function(e,t){var n=_(e);var r=0;var i=[];var a;for(a in n)!b(Y,a)&&b(n,a)&&i.push(a);while(t.length>r)if(b(n,a=t[r++])){~be(i,a)||i.push(a)}return i};var Ce=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"];var we=Ce.concat("length","prototype");var Se=Object.getOwnPropertyNames||function e(t){return ke(t,we)};var Ae={f:Se};var Oe=Object.getOwnPropertySymbols;var Pe={f:Oe};var ze=ue("Reflect","ownKeys")||function e(t){var n=Ae.f(z(t));var r=Pe.f;return r?n.concat(r(t)):n};var Te=function(e,t){var n=ze(t);var r=M.f;var i=P.f;for(var a=0;a<n.length;a++){var o=n[a];if(!b(e,o))r(e,o,i(t,o))}};var je=/#|\.prototype\./;var Me=function(e,t){var n=De[Le(e)];return n==Be?true:n==Ee?false:typeof t=="function"?r(t):!!t};var Le=Me.normalize=function(e){return String(e).replace(je,".").toLowerCase()};var De=Me.data={};var Ee=Me.NATIVE="N";var Be=Me.POLYFILL="P";var Re=Me;var qe=P.f;var We=function(e,t){var n=e.target;var r=e.global;var i=e.stat;var a,o,s,c,f,u;if(r){o=l}else if(i){o=l[n]||D(n,{})}else{o=(l[n]||{}).prototype}if(o)for(s in t){f=t[s];if(e.noTargetGet){u=qe(o,s);c=u&&u.value}else c=o[s];a=Re(r?s:n+(i?".":"#")+s,e.forced);if(!a&&c!==undefined){if(typeof f===typeof c)continue;Te(f,c)}if(e.sham||c&&c.sham){L(f,"sham",true)}se(o,s,f,e)}};var Fe=function(e){if(typeof e!="function"){throw TypeError(String(e)+" is not a function")}return e};var Ne=function(r,i,e){Fe(r);if(i===undefined)return r;switch(e){case 0:return function(){return r.call(i)};case 1:return function(e){return r.call(i,e)};case 2:return function(e,t){return r.call(i,e,t)};case 3:return function(e,t,n){return r.call(i,e,t,n)}}return function(){return r.apply(i,arguments)}};var Ie=function(e){return Object(g(e))};var Ve=Array.isArray||function e(t){return u(t)=="Array"};var Ge=!!Object.getOwnPropertySymbols&&!r(function(){return!String(Symbol())});var He=Ge&&!Symbol.sham&&typeof Symbol()=="symbol";var Ue=q("wks");var Ke=l.Symbol;var Ye=He?Ke:H;var Je=function(e){if(!b(Ue,e)){if(Ge&&b(Ke,e))Ue[e]=Ke[e];else Ue[e]=Ye("Symbol."+e)}return Ue[e]};var Qe=Je("species");var Xe=function(e,t){var n;if(Ve(e)){n=e.constructor;if(typeof n=="function"&&(n===Array||Ve(n.prototype)))n=undefined;else if(y(n)){n=n[Qe];if(n===null)n=undefined}}return new(n===undefined?Array:n)(t===0?0:t)};var Ze=[].push;var $e=function(h){var v=h==1;var g=h==2;var _=h==3;var y=h==4;var p=h==6;var x=h==5||p;return function(e,t,n,r){var i=Ie(e);var a=m(i);var o=Ne(t,n,3);var s=ge(a.length);var c=0;var f=r||Xe;var u=v?f(e,s):g?f(e,0):undefined;var l,d;for(;s>c;c++)if(x||c in a){l=a[c];d=o(l,c,i);if(h){if(v)u[c]=d;else if(d)switch(h){case 3:return true;case 5:return l;case 6:return c;case 2:Ze.call(u,l)}else if(y)return false}}return p?-1:_||y?y:u}};var et={forEach:$e(0),map:$e(1),filter:$e(2),some:$e(3),every:$e(4),find:$e(5),findIndex:$e(6)};var tt=Object.keys||function e(t){return ke(t,Ce)};var nt=h?Object.defineProperties:function e(t,n){z(t);var r=tt(n);var i=r.length;var a=0;var o;while(i>a)M.f(t,o=r[a++],n[o]);return t};var rt=ue("document","documentElement");var it=K("IE_PROTO");var at="prototype";var ot=function(){};var st=function(){var e=w("iframe");var t=Ce.length;var n="<";var r="script";var i=">";var a="java"+r+":";var o;e.style.display="none";rt.appendChild(e);e.src=String(a);o=e.contentWindow.document;o.open();o.write(n+r+i+"document.F=Object"+n+"/"+r+i);o.close();st=o.F;while(t--)delete st[at][Ce[t]];return st()};var ct=Object.create||function e(t,n){var r;if(t!==null){ot[at]=z(t);r=new ot;ot[at]=null;r[it]=t}else r=st();return n===undefined?r:nt(r,n)};Y[it]=true;var ft=Je("unscopables");var ut=Array.prototype;if(ut[ft]==undefined){L(ut,ft,ct(null))}var lt=function(e){ut[ft][e]=true};var dt=et.find;var ht="find";var vt=true;if(ht in[])Array(1)[ht](function(){vt=false});We({target:"Array",proto:true,forced:vt},{find:function e(t){return dt(this,t,arguments.length>1?arguments[1]:undefined)}});lt(ht);var gt=me.includes;We({target:"Array",proto:true},{includes:function e(t){return gt(this,t,arguments.length>1?arguments[1]:undefined)}});lt("includes");var _t=Object.assign;var yt=Object.defineProperty;var pt=!_t||r(function(){if(h&&_t({b:1},_t(yt({},"a",{enumerable:true,get:function(){yt(this,"b",{value:3,enumerable:false})}}),{b:2})).b!==1)return true;var e={};var t={};var n=Symbol();var r="abcdefghijklmnopqrst";e[n]=7;r.split("").forEach(function(e){t[e]=e});return _t({},e)[n]!=7||tt(_t({},t)).join("")!=r})?function e(t,n){var r=Ie(t);var i=arguments.length;var a=1;var o=Pe.f;var s=v.f;while(i>a){var c=m(arguments[a++]);var f=o?tt(c).concat(o(c)):tt(c);var u=f.length;var l=0;var d;while(u>l){d=f[l++];if(!h||s.call(c,d))r[d]=c[d]}}return r}:_t;We({target:"Object",stat:true,forced:Object.assign!==pt},{assign:pt});var xt=Je("match");var mt=function(e){var t;return y(e)&&((t=e[xt])!==undefined?!!t:u(e)=="RegExp")};var bt=function(e){if(mt(e)){throw TypeError("The method doesn't accept regular expressions")}return e};var kt=Je("match");var Ct=function(t){var n=/./;try{"/./"[t](n)}catch(e){try{n[kt]=false;return"/./"[t](n)}catch(e){}}return false};We({target:"String",proto:true,forced:!Ct("includes")},{includes:function e(t){return!!~String(g(this)).indexOf(bt(t),arguments.length>1?arguments[1]:undefined)}});var wt=P.f;var St="".startsWith;var At=Math.min;var Ot=Ct("startsWith");var Pt=!Ot&&!!function(){var e=wt(String.prototype,"startsWith");return e&&!e.writable}();We({target:"String",proto:true,forced:!Pt&&!Ot},{startsWith:function e(t){var n=String(g(this));bt(t);var r=ge(At(arguments.length>1?arguments[1]:undefined,n.length));var i=String(t);return St?St.call(n,i,r):n.slice(r,r+i.length)===i}});if(typeof window!=="undefined"){(function(){var r=function(e,t){var n=e.nodeType;if(n===3){t.push(e.textContent.replace(/&/,"&amp;").replace(/</,"&lt;").replace(">","&gt;"))}else if(n===1){t.push("<",e.tagName);if(e.hasAttributes()){[].forEach.call(e.attributes,function(e){t.push(" ",e.item.name,"='",e.item.value,"'")})}if(e.hasChildNodes()){t.push(">");[].forEach.call(e.childNodes,function(e){r(e,t)});t.push("</",e.tagName,">")}else{t.push("/>")}}else if(n==8){t.push("\x3c!--",e.nodeValue,"--\x3e")}};Object.defineProperty(SVGElement.prototype,"innerHTML",{get:function(){var e=[];var t=this.firstChild;while(t){r(t,e);t=t.nextSibling}return e.join("")},set:function(e){while(this.firstChild){this.removeChild(this.firstChild)}try{var t=new DOMParser;t.async=false;var n="<svg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'>"+e+"</svg>";var r=t.parseFromString(n,"text/xml").documentElement;var i=r.firstChild;while(i){this.appendChild(this.ownerDocument.importNode(i,true));i=i.nextSibling}}catch(e){}}});Object.defineProperty(SVGElement.prototype,"innerSVG",{get:function(){return this.innerHTML},set:function(e){this.innerHTML=e}})})()}});(function(e,t){typeof exports==="object"&&typeof module!=="undefined"?t(exports,require("d3plus-common"),require("d3-array"),require("d3-collection"),require("d3-scale"),require("d3-shape"),require("d3plus-axis"),require("d3plus-color"),require("d3plus-shape"),require("d3plus-text"),require("d3plus-viz"),require("d3-selection")):typeof define==="function"&&define.amd?define("d3plus-plot",["exports","d3plus-common","d3-array","d3-collection","d3-scale","d3-shape","d3plus-axis","d3plus-color","d3plus-shape","d3plus-text","d3plus-viz","d3-selection"],t):(e=e||self,t(e.d3plus={},e.d3plusCommon,e.d3Array,e.d3Collection,e.scales,e.d3Shape,e.d3plusAxis,e.d3plusColor,e.shapes,e.d3plusText,e.d3plusViz,e.d3Selection))})(this,function(e,rt,it,at,ot,st,ct,a,ft,ut,t,m){"use strict";function lt(e){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){lt=function(e){return typeof e}}else{lt=function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e}}return lt(e)}function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}function i(e,t,n){if(t)r(e.prototype,t);if(n)r(e,n);return e}function dt(e,t,n){if(t in e){Object.defineProperty(e,t,{value:n,enumerable:true,configurable:true,writable:true})}else{e[t]=n}return e}function o(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function")}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:true,configurable:true}});if(t)s(e,t)}function ht(e){ht=Object.setPrototypeOf?Object.getPrototypeOf:function e(t){return t.__proto__||Object.getPrototypeOf(t)};return ht(e)}function s(e,t){s=Object.setPrototypeOf||function e(t,n){t.__proto__=n;return t};return s(e,t)}function c(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function f(e,t){if(t&&(typeof t==="object"||typeof t==="function")){return t}return c(e)}function u(e,t){while(!Object.prototype.hasOwnProperty.call(e,t)){e=ht(e);if(e===null)break}return e}function vt(e,t,n){if(typeof Reflect!=="undefined"&&Reflect.get){vt=Reflect.get}else{vt=function e(t,n,r){var i=u(t,n);if(!i)return;var a=Object.getOwnPropertyDescriptor(i,n);if(a.get){return a.get.call(r)}return a.value}}return vt(e,t,n||e)}function gt(e,t){return l(e)||d(e,t)||h()}function l(e){if(Array.isArray(e))return e}function d(e,t){if(!(Symbol.iterator in Object(e)||Object.prototype.toString.call(e)==="[object Arguments]")){return}var n=[];var r=true;var i=false;var a=undefined;try{for(var o=e[Symbol.iterator](),s;!(r=(s=o.next()).done);r=true){n.push(s.value);if(t&&n.length===t)break}}catch(e){i=true;a=e}finally{try{if(!r&&o["return"]!=null)o["return"]()}finally{if(i)throw a}}return n}function h(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}var x=function(e,t,n){if(e.padding)e.padding(.5);else{var r=t.map(function(e){return e[n]}).reduce(function(e,t,n,r){if(!n)return e;var i=r[n-1];if(!e||t-i<e)return t-i;else return e},0);var i=e.domain().slice();if(n==="y")i.reverse();i[0]=new Date(+i[0]-r/2);i[1]=new Date(+i[1]+r/2);if(n==="y")i.reverse();e.domain(i)}};function v(e){var t=this;var n=e.data,r=e.x,i=e.y,a=e.x2,o=e.y2,s=e.buffer,c=s===void 0?10:s;var f=a?"x2":"x";var u=o?"y2":"y";var l=this._discrete==="x"?i:r;var d=l.domain().slice();var h=this._discrete==="x";if(h)d.reverse();var v,g;if(this._stacked){var _=at.nest().key(function(e){return"".concat(e[t._discrete],"_").concat(e.group)}).entries(n).map(function(e){return e.values.map(function(e){return e[h?u:f]})});g=_.map(function(e){return it.sum(e.filter(function(e){return e>0}))});v=_.map(function(e){return it.sum(e.filter(function(e){return e<0}))})}else{g=n.map(function(e){return e[h?u:f]});v=g}var y=l(it.max(g));if(h?y<l(0):y>l(0))y+=h?-c:c;y=l.invert(y);var p=l(it.min(v));if(h?p>l(0):p<l(0))p+=h?c:-c;p=l.invert(p);if(y>d[1])d[1]=y;if(p<d[0])d[0]=p;if(h)d.reverse();l.domain(d);x(h?r:i,n,this._discrete);return[r,i]}function g(e){var t=this;var n=e.data,r=e.x,i=e.y,a=e.x2,o=e.y2,s=e.buffer,c=s===void 0?10:s;var f=a?"x2":"x";var u=o?"y2":"y";var l=this._discrete==="x"?i:r;var d=l.domain().slice();var h=this._discrete==="x";if(h)d.reverse();var v,g;if(this._stacked){var _=at.nest().key(function(e){return e[t._discrete]}).entries(n).map(function(e){return e.values.map(function(e){return e[h?u:f]})});g=_.map(function(e){return it.sum(e.filter(function(e){return e>0}))});v=_.map(function(e){return it.sum(e.filter(function(e){return e<0}))})}else{g=n.map(function(e){return e[h?u:f]});v=g}var y=l(it.max(g));y+=h?-c:c;y=l.invert(y);var p=l(it.min(v));p+=h?c:-c;p=l.invert(p);if(y>d[1])d[1]=y;if(p<d[0])d[0]=p;if(h)d.reverse();l.domain(d);x(h?r:i,n,this._discrete);return[r,i]}function _(l,d,h,v,e,t,g,_){if(_){t=t.slice().reverse();e=e.slice().reverse()}var n=function e(){var t=l.copy();var n=false;if(d==="log"){var r=l.domain().slice(),i=l.range().slice();if(_){r=r.reverse();i=i.reverse()}n=r[0]*r[1]<0;if(n){var a=ot.scaleLog().domain([1,Math.abs(r[g])]).range([0,1]);var o=a(Math.abs(r[g?0:1]));var s=o/(o+1)*(i[1]-i[0]);r=(g===0?[r[0],1]:[1,r[1]]).map(Math.abs);i=g===0?[i[0],i[0]+s]:[i[0]+s,i[1]]}t=ot.scaleLog().domain(r).range(i)}var c=false;var f=t.range();var u;if(d==="log"){u=!n||h<0&&!g||h>0&&g?t(Math.abs(h)):f[h<0?0:1]}else u=t(h);if(_){if(g===0)c=u+v>f[g];else if(g===1)c=u-v<f[g]}else{if(g===0)c=u-v<f[g];else if(g===1)c=u+v>f[g]}return c};if(l.invert&&n()){if(d==="log"){var r=g===0&&t[0]>0||g===1&&t[1]<0;var i=Math[r?"ceil":"floor"](Math.log10(Math.abs(t[g])));while(n()&&i<20){i=r?i-1:i+1;var a=t[g]<0?-1:1;if(i<0){i=1;r=!r;a=!a}t[g]=Math.pow(10,i)*a;l.domain(_?t.slice().reverse():t)}}else if(g===0){var o=l.invert(l(h)+v*(_?1:-1));if(o<t[g]){t[g]=o;l.domain(_?t.slice().reverse():t)}}else if(g===1){var s=l.invert(l(h)+v*(_?-1:1));if(s>t[g]){t[g]=s;l.domain(_?t.slice().reverse():t)}}}return _?t.reverse():t}function y(e){var t=e.data,n=e.x,r=e.y,i=e.x2,a=e.y2,o=e.yScale,s=e.xScale,c=e.config,f=e.buffer;n=n.copy();r=r.copy();var u=i?"x2":"x";var l=a?"y2":"y";var d=n.domain().slice(),h=r.domain().slice();var v=n.range(),g=r.range();if(!n.invert&&n.padding)x(n,t,this._discrete);if(!r.invert&&r.padding)x(r,t,this._discrete);if(n.invert||r.invert){t.forEach(function(e){var t=f?f:c.r(e.data,e.i)*2;if(n.invert){d=_(n,s,e[u],t,v,d,0,false);d=_(n,s,e[u],t,v,d,1,false)}if(r.invert){h=_(r,o,e[l],t,g,h,0,true);h=_(r,o,e[l],t,g,h,1,true)}})}return[n,r]}function p(e){var t=this;var n=e.data,r=e.x,i=e.y,a=e.x2,o=e.y2;var s=a?"x2":"x";var c=o?"y2":"y";var f=this._discrete==="x"?i:r;var u=f.domain().slice();if(this._discrete==="x")u.reverse();var l=n.map(function(e){return e[t._discrete==="x"?c:s]});var d=f.invert(f(it.max(l))+(this._discrete==="x"?-10:10));if(d>u[1])u[1]=d;if(this._discrete==="x")u.reverse();f.domain(u);return[r,i]}function b(e){var t=e.data,r=e.x,i=e.y,n=e.x2,a=e.y2,o=e.yScale,s=e.xScale,c=e.config;r=r.copy();i=i.copy();var f=n?"x2":"x";var u=a?"y2":"y";var l=r.domain().slice(),d=i.domain().slice();var h=r.range(),v=i.range();if(!r.invert&&r.padding)x(r,t,this._discrete);if(!i.invert&&i.padding)x(i,t,this._discrete);if(r.invert||i.invert){t.forEach(function(e){if(r.invert){var t=c.width(e.data,e.i);l=_(r,s,e[f],t,h,l,0,false);l=_(r,s,e[f],t,h,l,1,false)}if(i.invert){var n=c.height(e.data,e.i);d=_(i,o,e[u],n,v,d,0,true);d=_(i,o,e[u],n,v,d,1,true)}})}return[r,i]}var _t=new ft.Line;var yt=new ut.TextBox;function k(e){return this._sizeScaleD3(this._size?this._size(e):null)}function C(e){var n=e.map(S);var r=e.map(function(e){return e.key.split("_")[0]});return st.stackOrderNone(e).sort(function(e,t){return r[t].localeCompare(r[e])||n[e]-n[t]})}function w(e){return C(e).reverse()}function S(e){var t=-1,n=0,r;var i=e.length;while(++t<i){if(r=+e[t][1])n+=r}return n}function A(e,t){var n;if(!((n=e.length)>0))return;var r,i,a,o,s;var c=e[t[0]].length;for(var f=0;f<c;++f){for(s=o=0,a=0;a<n;++a){if((i=(r=e[t[a]][f])[1]-r[0])>=0){r[0]=s,r[1]=s+=i}else if(i<0){r[1]=o,r[0]=o+=i}else{r[0]=s}}}}var O=function(e){o(nt,e);function nt(){var i;n(this,nt);i=f(this,ht(nt).call(this));i._annotations=[];i._backgroundConfig={duration:0,fill:"transparent"};i._barPadding=0;i._buffer={Bar:v,Box:g,Circle:y,Line:p,Rect:b};i._confidenceConfig={fill:function e(t,n){var r=typeof i._shapeConfig.Line.stroke==="function"?i._shapeConfig.Line.stroke(t,n):i._shapeConfig.Line.stroke;return r},fillOpacity:rt.constant(.5)};i._discreteCutoff=100;i._groupPadding=5;i._lineMarkerConfig={fill:function e(t,n){return a.colorAssign(i._id(t,n))},r:rt.constant(3)};i._lineMarkers=false;i._previousShapes=[];i._shape=rt.constant("Circle");i._shapeConfig=rt.assign(i._shapeConfig,{Area:{label:function e(t,n){return i._stacked?i._drawLabel(t,n):false},labelConfig:{fontResize:true}},ariaLabel:function e(t,n){var r="";if(t.nested)r="".concat(i._drawLabel(t.data,t.i));else{r="".concat(i._drawLabel(t,n));if(i._x(t,n)!==undefined)r+=", x: ".concat(i._x(t,n));if(i._y(t,n)!==undefined)r+=", y: ".concat(i._y(t,n));if(i._x2(t,n)!==undefined)r+=", x2: ".concat(i._x2(t,n));if(i._y2(t,n)!==undefined)r+=", y2: ".concat(i._y2(t,n))}return"".concat(r,".")},Bar:{labelConfig:{textAnchor:function e(){return i._discrete==="x"?"middle":"end"},verticalAlign:function e(){return i._discrete==="x"?"top":"middle"}}},Circle:{r:k.bind(c(i))},Line:{fill:rt.constant("none"),labelConfig:{fontColor:function e(t,n){var r=typeof i._shapeConfig.Line.stroke==="function"?i._shapeConfig.Line.stroke(t,n):i._shapeConfig.Line.stroke;return a.colorLegible(r)},fontResize:false,padding:5,textAnchor:"start",verticalAlign:"middle"},stroke:function e(t,n){return a.colorAssign(i._id(t,n))},strokeWidth:rt.constant(2)},Rect:{height:function e(t){return k.bind(c(i))(t)*2},width:function e(t){return k.bind(c(i))(t)*2}}});i._shapeOrder=["Area","Path","Bar","Box","Line","Rect","Circle"];i._shapeSort=function(e,t){return i._shapeOrder.indexOf(e)-i._shapeOrder.indexOf(t)};i._sizeMax=20;i._sizeMin=5;i._sizeScale="sqrt";i._stackOffset=A;i._stackOrder=w;i._timelineConfig=rt.assign(i._timelineConfig,{brushing:true});i._x=rt.accessor("x");i._xAxis=(new ct.AxisBottom).align("end");i._xTest=(new ct.AxisBottom).align("end").gridSize(0);i._xConfig={};i._xCutoff=150;i._x2=rt.accessor("x2");i._x2Axis=(new ct.AxisTop).align("start");i._x2Test=(new ct.AxisTop).align("start").gridSize(0);i._x2Config={padding:0};i._y=rt.accessor("y");i._yAxis=(new ct.AxisLeft).align("start");i._yTest=(new ct.AxisLeft).align("start").gridSize(0);i._yConfig={gridConfig:{stroke:function e(t){var n=i._yAxis.range();return n[n.length-1]===i._yAxis._getPosition.bind(i._yAxis)(t.id)?"transparent":"#ccc"}}};i._yCutoff=150;i._y2=rt.accessor("y2");i._y2Axis=(new ct.AxisRight).align("end");i._y2Test=(new ct.AxisLeft).align("end").gridSize(0);i._y2Config={};return i}i(nt,[{key:"_draw",value:function e(t){var B=this;if(!this._filteredData.length)return this;var s=function e(t,n){return B._stacked?"".concat(B._groupBy.length>1?B._ids(t,n).slice(0,-1).join("_"):"group"):"".concat(B._ids(t,n).join("_"))};var c=this._filteredData.map(function(e,t){return{__d3plus__:true,data:e,group:s(e,t),i:t,hci:B._confidence&&B._confidence[1]&&B._confidence[1](e,t),id:B._ids(e,t).slice(0,B._drawDepth+1).join("_"),lci:B._confidence&&B._confidence[0]&&B._confidence[0](e,t),shape:B._shape(e,t),x:B._x(e,t),x2:B._x2(e,t),y:B._y(e,t),y2:B._y2(e,t)}});this._formattedData=c;if(this._size){var n=it.extent(c,function(e){return B._size(e.data)});this._sizeScaleD3=function(){return B._sizeMin};this._sizeScaleD3=ot["scale".concat(this._sizeScale.charAt(0).toUpperCase()).concat(this._sizeScale.slice(1))]().domain(n).range([n[0]===n[1]?this._sizeMax:it.min([this._sizeMax/2,this._sizeMin]),this._sizeMax])}else{this._sizeScaleD3=function(){return B._sizeMin}}var r=c.some(function(e){return e.x2!==undefined}),i=c.some(function(e){return e.y2!==undefined});var a=this._height-this._margin.top-this._margin.bottom,f=this._discrete?this._discrete==="x"?"y":"x":undefined,o=this._discrete?this._discrete==="x"?"y2":"x2":undefined,u=[f,o].filter(function(e){return e}),l=this._select,d=this._transition,R=this._width-this._margin.left-this._margin.right;var h=this._time&&c[0].x2===this._time(c[0].data,c[0].i),v=this._time&&c[0].x===this._time(c[0].data,c[0].i),g=this._time&&c[0].y2===this._time(c[0].data,c[0].i),_=this._time&&c[0].y===this._time(c[0].data,c[0].i);for(var y=0;y<c.length;y++){var p=c[y];if(v)p.x=ct.date(p.x);if(h)p.x2=ct.date(p.x2);if(_)p.y=ct.date(p.y);if(g)p.y2=ct.date(p.y2);p.discrete=p.shape==="Bar"?"".concat(p[this._discrete],"_").concat(p.group):"".concat(p[this._discrete])}var x,m,b,k;if(this._stacked){var C;var w=at.nest().key(function(e){return e.group}).entries(c).reduce(function(e,t){if(!e[t.key])e[t.key]=0;e[t.key]+=it.sum(t.values,function(e){return e[f]});return e},{});c=c.sort(function(e,t){if(B["_".concat(B._discrete,"Sort")])return B["_".concat(B._discrete,"Sort")](e.data,t.data);var n=e[B._discrete],r=t[B._discrete];if(n-r!==0)return n-r;if(e.group!==t.group)return w[t.group]-w[e.group];return t[f]-e[f]});x=Array.from(new Set(c.map(function(e){return e.discrete})));k=Array.from(new Set(c.map(function(e){return e.id})));b=at.nest().key(function(e){return e.discrete}).entries(c).map(function(e){return e.values});b.forEach(function(a){var o=Array.from(new Set(a.map(function(e){return e.id})));if(o.length<k.length){k.forEach(function(t){if(!o.includes(t)){var e=c.filter(function(e){return e.id===t})[0];if(e.shape==="Area"){var n;var r=s(e.data,e.i);var i=(n={__d3plus__:true,data:e.data,discrete:e.shape==="Bar"?"".concat(a[0][B._discrete],"_").concat(r):"".concat(a[0][B._discrete]),group:r,id:t,shape:e.shape},dt(n,B._discrete,a[0][B._discrete]),dt(n,f,0),n);c.push(i)}}})}});if(this["_".concat(this._discrete,"Sort")]){c.sort(function(e,t){return B["_".concat(B._discrete,"Sort")](e.data,t.data)})}else{c.sort(function(e,t){return e[B._discrete]-t[B._discrete]})}var S=this._stackOrder;if(S instanceof Array)k.sort(function(e,t){return S.indexOf(e)-S.indexOf(t)});else if(S===st.stackOrderNone)k.sort(function(e,t){return e.localeCompare(t)});b=st.stack().keys(k).offset(this._stackOffset).order(S instanceof Array?st.stackOrderNone:S).value(function(e,t){var n=e.filter(function(e){return e.id===t});return n.length?n[0][f]:0})(b);m=(C={},dt(C,this._discrete,it.extent(c,function(e){return e[B._discrete]})),dt(C,f,[it.min(b.map(function(e){return it.min(e.map(function(e){return e[0]}))})),it.max(b.map(function(e){return it.max(e.map(function(e){return e[1]}))}))]),C)}else{var A=this._discrete||"x";if(this["_".concat(this._discrete,"Sort")]){c.sort(function(e,t){return B["_".concat(B._discrete,"Sort")](e.data,t.data)})}else{c.sort(function(e,t){return e[A]-t[A]})}var O=A==="x"?c.map(function(e){return e.x}):c.map(function(e){return e.x}).concat(this._confidence&&this._confidence[0]?c.map(function(e){return e.lci}):[]).concat(this._confidence&&this._confidence[1]?c.map(function(e){return e.hci}):[]);var P=A==="x"?c.map(function(e){return e.x2}):c.map(function(e){return e.x2}).concat(this._confidence&&this._confidence[0]?c.map(function(e){return e.lci}):[]).concat(this._confidence&&this._confidence[1]?c.map(function(e){return e.hci}):[]);var z=A==="y"?c.map(function(e){return e.y}):c.map(function(e){return e.y}).concat(this._confidence&&this._confidence[0]?c.map(function(e){return e.lci}):[]).concat(this._confidence&&this._confidence[1]?c.map(function(e){return e.hci}):[]);var T=A==="y"?c.map(function(e){return e.y2}):c.map(function(e){return e.y2}).concat(this._confidence&&this._confidence[0]?c.map(function(e){return e.lci}):[]).concat(this._confidence&&this._confidence[1]?c.map(function(e){return e.hci}):[]);m={x:this._xSort?Array.from(new Set(c.filter(function(e){return e.x}).sort(function(e,t){return B._xSort(e.data,t.data)}).map(function(e){return e.x}))):it.extent(O,function(e){return e}),x2:this._x2Sort?Array.from(new Set(c.filter(function(e){return e.x2}).sort(function(e,t){return B._x2Sort(e.data,t.data)}).map(function(e){return e.x2}))):it.extent(P,function(e){return e}),y:this._ySort?Array.from(new Set(c.filter(function(e){return e.y}).sort(function(e,t){return B._ySort(e.data,t.data)}).map(function(e){return e.y}))):it.extent(z,function(e){return e}),y2:this._y2Sort?Array.from(new Set(c.filter(function(e){return e.y2}).sort(function(e,t){return B._y2Sort(e.data,t.data)}).map(function(e){return e.y2}))):it.extent(T,function(e){return e})}}var q=this._xDomain?this._xDomain.slice():m.x,W=this._xSort?"Point":"Linear";if(q[0]===void 0)q[0]=m.x[0];if(q[1]===void 0)q[1]=m.x[1];if(v){q=q.map(ct.date);W="Time"}else if(this._discrete==="x"){if(!this._xDomain)q=Array.from(new Set(c.filter(function(e){return["number","string"].includes(lt(e.x))}).sort(function(e,t){return B._xSort?B._xSort(e.data,t.data):e.x-t.x}).map(function(e){return e.x})));W="Point"}var j=this._x2Domain?this._x2Domain.slice():m.x2,M=this._x2Sort?"Point":"Linear";if(j&&j[0]===void 0)j[0]=m.x2[0];if(j&&j[1]===void 0)j[1]=m.x2[1];if(h){j=j.map(ct.date);M="Time"}else if(this._discrete==="x"){if(!this._x2Domain)j=Array.from(new Set(c.filter(function(e){return["number","string"].includes(lt(e.x2))}).sort(function(e,t){return B._x2Sort?B._x2Sort(e.data,t.data):e.x2-t.x2}).map(function(e){return e.x2})));M="Point"}var F=this._yDomain?this._yDomain.slice():m.y,N=this._ySort?"Point":"Linear";if(F[0]===void 0)F[0]=m.y[0];if(F[1]===void 0)F[1]=m.y[1];var L=this._y2Domain?this._y2Domain.slice():m.y2,D=this._y2Sort?"Point":"Linear";if(L&&L[0]===void 0)L[0]=m.y2[0];if(L&&L[1]===void 0)L[1]=m.y2[1];if(_){F=F.map(ct.date);N="Time"}else if(this._discrete==="y"){if(!this._yDomain)F=Array.from(new Set(c.filter(function(e){return["number","string"].includes(lt(e.y))}).sort(function(e,t){return B._ySort?B._ySort(e.data,t.data):e.y-t.y}).map(function(e){return e.y})));N="Point";if(!this._y2Domain)L=Array.from(new Set(c.filter(function(e){return["number","string"].includes(lt(e.y2))}).sort(function(e,t){return B._y2Sort?B._y2Sort(e.data,t.data):e.y2-t.y2}).map(function(e){return e.y2})));D="Point"}if(g){L=L.map(ct.date);D="Time"}m={x:q,x2:j||q,y:F,y2:L||F};u.forEach(function(e){if(B["_".concat(e,"Config")].domain){var t=B["_".concat(e,"Config")].domain;if(B._discrete==="x")t.reverse();m[e]=t}else if(e&&B._baseline!==void 0){var n=B._baseline;if(m[e]&&m[e][0]>n)m[e][0]=n;else if(m[e]&&m[e][1]<n)m[e][1]=n}});var I=ot["scale".concat(W)]().domain(m.x).range(it.range(0,R+1,R/(m.x.length-1))),E=ot["scale".concat(M)]().domain(m.x2).range(it.range(0,R+1,R/(m.x2.length-1))),V=ot["scale".concat(N)]().domain(m.y.reverse()).range(it.range(0,a+1,a/(m.y.length-1))),G=ot["scale".concat(D)]().domain(m.y2.reverse()).range(it.range(0,a+1,a/(m.y2.length-1)));var H=at.nest().key(function(e){return e.shape}).entries(c).sort(function(e,t){return B._shapeSort(e.key,t.key)});var U=function e(t,n){var r=B["_".concat(t,"Config")].scale;if(r==="auto"){if(B._discrete===t)return n;var i=c.map(function(e){return e[t]});return it.deviation(i)/it.mean(i)>3?"log":"linear"}return r||n};var K=U("y",N).toLowerCase();var Y=U("y2",D).toLowerCase();var J=U("x",W).toLowerCase();var Q=U("x2",M).toLowerCase();var X=this._discrete==="x"?N:W;if(X!=="Point"){H.forEach(function(e){if(B._buffer[e.key]){var t=B._buffer[e.key].bind(B)({data:e.values,x:I,y:V,yScale:K,xScale:J,config:B._shapeConfig[e.key]});I=t[0];V=t[1];var n=B._buffer[e.key].bind(B)({data:e.values,x:E,y:G,yScale:Y,xScale:Q,x2:true,y2:true,config:B._shapeConfig[e.key]});E=n[0];G=n[1]}})}q=I.domain();j=E.domain();F=V.domain();L=G.domain();var Z={barConfig:{"stroke-width":0},gridSize:0,labels:[],title:false,tickSize:0};var $=r?{}:Z;var ee=i?{}:Z;var te=this._discrete==="x"&&this._width>this._discreteCutoff||this._width>this._xCutoff;var ne=this._discrete==="y"&&this._height>this._discreteCutoff||this._height>this._yCutoff;var re={gridConfig:{stroke:!this._discrete||this._discrete==="x"?this._yTest.gridConfig().stroke:"transparent"},locale:this._locale,scalePadding:V.padding?V.padding():0};if(!te){re.barConfig={stroke:"transparent"};re.tickSize=0;re.shapeConfig={labelBounds:function e(t,n){var r=t.labelBounds,i=r.width,a=r.y;var o=B._height/2;var s=n?-o:0;return{x:s,y:a,width:i,height:o}},labelConfig:{padding:0,rotate:0,verticalAlign:function e(t){return t.id===ce[0]?"top":"bottom"}},labelRotation:false}}var ie=rt.elem("g.d3plus-plot-test",{enter:{opacity:0},parent:this._select}),ae=this._discrete==="x"&&!h?m.x2:undefined,oe=!ne?it.extent(m.x):this._discrete==="x"&&!v?m.x:undefined,se=this._discrete==="y"&&!g?m.y2:undefined,ce=!te?it.extent(m.y):this._discrete==="y"&&!_?m.y:undefined;if(ne){this._yTest.domain(F).height(a).maxSize(R/2).range([undefined,undefined]).select(ie.node()).ticks(ce).width(R).config(re).config(this._yConfig).scale(K).render()}var fe=this._yTest.outerBounds();var ue=fe.width?fe.width+this._yTest.padding():undefined;if(i){this._y2Test.domain(L).height(a).range([undefined,undefined]).select(ie.node()).ticks(se).width(R).config(re).config(ee).config(this._y2Config).scale(Y).render()}var le=this._y2Test.outerBounds();var de=le.width?le.width+this._y2Test.padding():undefined;var he={gridConfig:{stroke:!this._discrete||this._discrete==="y"?this._xTest.gridConfig().stroke:"transparent"},locale:this._locale,scalePadding:I.padding?I.padding():0};if(!ne){he.barConfig={stroke:"transparent"};he.tickSize=0;he.shapeConfig={labelBounds:function e(t,n){var r=t.labelBounds,i=r.height,a=r.y;var o=B._width/2;var s=n?-o:0;return{x:s,y:a,width:o,height:i}},labelConfig:{padding:0,rotate:0,textAnchor:function e(t){return t.id===oe[0]?"start":"end"}},labelRotation:false}}var ve=undefined;if(this._lineLabels){var ge=at.nest().key(function(e){return e.id}).entries(c.filter(function(e){return e.shape==="Line"}));if(ge.length&&ge.length<this._dataCutoff){var _e=rt.configPrep.bind(this)(this._shapeConfig,"shape","Line");_t.config(_e);var ye=_t.labelConfig();var pe=ye.fontSize!==undefined?ye.fontSize:yt.fontSize();var xe=ye.fontWeight!==undefined?ye.fontWeight:yt.fontWeight();var me=ye.fontFamily!==undefined?ye.fontFamily:yt.fontFamily();var be=ye.padding!==undefined?ye.padding:yt.padding();var ke=ge.map(function(e){var t=e.values[0];var n=B._drawLabel(t);var r=typeof pe==="function"?pe(t):pe;var i=typeof xe==="function"?xe(t):xe;var a=typeof me==="function"?me(t):me;if(a instanceof Array)a=a.map(function(e){return"'".concat(e,"'")}).join(", ");var o=typeof be==="function"?be(t):be;var s=ut.textWidth(n,{"font-size":r,"font-family":a,"font-weight":i});return s+o*2});var Ce=it.max(ke);var we=it.min([Ce,R/4]);ve=R-we-this._margin.right}}if(te){this._xTest.domain(q).height(a).maxSize(a/2).range([undefined,ve]).select(ie.node()).ticks(oe).width(R).config(he).config(this._xConfig).scale(J).render()}if(r){this._x2Test.domain(j).height(a).range([undefined,ve]).select(ie.node()).ticks(ae).width(R).config(he).tickSize(0).config($).config(this._x2Config).scale(Q).render()}var Se=this._xTest._getRange();var Ae=this._x2Test._getRange();var Oe=this._x2Test.outerBounds();var Pe=r?Oe.height+this._x2Test.padding():0;var ze=it.max([ue,Se[0],Ae[0]]);if(te){this._xTest.range([ze,undefined]).render()}var Te=ne?this._yTest.shapeConfig().labelConfig.fontSize()/2:0;var je=it.max([de,R-Se[1],R-Ae[1]]);var Me=this._xTest.outerBounds();var Le=Me.height+(ne?this._xTest.padding():0);this._padding.left+=ze;this._padding.right+=je;this._padding.bottom+=Le;this._padding.top+=Pe+Te;vt(ht(nt.prototype),"_draw",this).call(this,t);var De=this._margin.left+this._margin.right;var Ee=this._margin.top+this._margin.bottom;var Be=[Pe,a-(Le+Te+Ee)];if(ne){this._yTest.domain(F).height(a).maxSize(R/2).range(Be).select(ie.node()).ticks(ce).width(R).config(re).config(this._yConfig).scale(K).render()}fe=this._yTest.outerBounds();ue=fe.width?fe.width+this._yTest.padding():undefined;ze=it.max([ue,Se[0],Ae[0]]);if(i){this._y2Test.config(re).domain(L).gridSize(0).height(a).range(Be).select(ie.node()).width(R-it.max([0,je-de])).title(false).config(this._y2Config).config(ee).scale(Y).render()}le=this._y2Test.outerBounds();de=le.width?le.width+this._y2Test.padding():undefined;je=it.max([0,de,R-Se[1],R-Ae[1]]);var Re=[ze,R-(je+De)];var qe=rt.elem("g.d3plus-plot-background",{parent:l,transition:d});var We="translate(".concat(this._margin.left,", ").concat(this._margin.top+Pe+Te,")");var Fe="translate(".concat(this._margin.left,", ").concat(this._margin.top+Te,")");var Ne=te&&rt.elem("g.d3plus-plot-x-axis",{parent:l,transition:d,enter:{transform:We},update:{transform:We}});var Ie=r&&rt.elem("g.d3plus-plot-x2-axis",{parent:l,transition:d,enter:{transform:Fe},update:{transform:Fe}});var Ve=ze>ue?ze-ue:0;var Ge="translate(".concat(this._margin.left+Ve,", ").concat(this._margin.top+Te,")");var He=ne&&rt.elem("g.d3plus-plot-y-axis",{parent:l,transition:d,enter:{transform:Ge},update:{transform:Ge}});var Ue="translate(-".concat(this._margin.right,", ").concat(this._margin.top+Te,")");var Ke=i&&rt.elem("g.d3plus-plot-y2-axis",{parent:l,transition:d,enter:{transform:Ue},update:{transform:Ue}});this._xAxis.domain(q).height(a-(Pe+Te+Ee)).maxSize(a/2).range(Re).select(te?Ne.node():undefined).ticks(oe).width(R).config(he).config(this._xConfig).scale(J).render();if(r){this._x2Axis.domain(j).height(a-(Le+Te+Ee)).range(Re).select(Ie.node()).ticks(ae).width(R).config(he).config($).config(this._x2Config).scale(Q).render()}I=function e(t,n){if(n==="x2"){if(B._x2Config.scale==="log"&&t===0)t=j[0]<0?-1:1;return B._x2Axis._getPosition.bind(B._x2Axis)(t)}else{if(B._xConfig.scale==="log"&&t===0)t=q[0]<0?-1:1;return B._xAxis._getPosition.bind(B._xAxis)(t)}};Be=[this._xAxis.outerBounds().y+Pe,a-(Le+Te+Ee)];this._yAxis.domain(F).height(a).maxSize(R/2).range(Be).select(ne?He.node():undefined).ticks(ce).width(Re[Re.length-1]).config(re).config(this._yConfig).scale(K).render();if(i){this._y2Axis.config(re).domain(i?L:F).gridSize(0).height(a).range(Be).select(Ke.node()).width(R-it.max([0,je-de])).title(false).config(this._y2Config).config(ee).scale(Y).render()}V=function e(t,n){if(n==="y2"){if(B._y2Config.scale==="log"&&t===0)t=L[0]<0?-1:1;return B._y2Axis._getPosition.bind(B._y2Axis)(t)-Pe}else{if(B._yConfig.scale==="log"&&t===0)t=F[0]<0?-1:1;return B._yAxis._getPosition.bind(B._yAxis)(t)-Pe}};(new ft.Rect).data([{}]).select(qe.node()).x(Re[0]+(Re[1]-Re[0])/2).width(Re[1]-Re[0]).y(this._margin.top+Te+Be[0]+(Be[1]-Be[0])/2).height(Be[1]-Be[0]).config(this._backgroundConfig).render();var Ye=rt.elem("g.d3plus-plot-annotations",{parent:l,transition:d,enter:{transform:We},update:{transform:We}}).node();this._annotations.forEach(function(e){(new ft[e.shape]).config(e).config({x:function e(t){return t.x2?I(t.x2,"x2"):I(t.x)},x0:B._discrete==="x"?function(e){return e.x2?I(e.x2,"x2"):I(e.x)}:I(m.x[0]),x1:B._discrete==="x"?null:function(e){return e.x2?I(e.x2,"x2"):I(e.x)},y:function e(t){return t.y2?V(t.y2,"y2"):V(t.y)},y0:B._discrete==="y"?function(e){return e.y2?V(e.y2,"y2"):V(e.y)}:V(m.y[1])-Je,y1:B._discrete==="y"?null:function(e){return e.y2?V(e.y2,"y2"):V(e.y)-Je}}).select(Ye).render()});var Je=this._xAxis.barConfig()["stroke-width"];if(Je)Je/=2;var Qe=this._discrete||"x";var Xe={duration:this._duration,label:function e(t){return B._drawLabel(t.data,t.i)},select:rt.elem("g.d3plus-plot-shapes",{parent:l,transition:d,enter:{transform:We},update:{transform:We}}).node(),x:function e(t){return t.x2!==undefined?I(t.x2,"x2"):I(t.x)},x0:Qe==="x"?function(e){return e.x2?I(e.x2,"x2"):I(e.x)}:I(typeof this._baseline==="number"?this._baseline:m.x[0]),x1:Qe==="x"?null:function(e){return e.x2?I(e.x2,"x2"):I(e.x)},y:function e(t){return t.y2!==undefined?V(t.y2,"y2"):V(t.y)},y0:Qe==="y"?function(e){return e.y2?V(e.y2,"y2"):V(e.y)}:V(typeof this._baseline==="number"?this._baseline:m.y[1])-Je,y1:Qe==="y"?null:function(e){return e.y2?V(e.y2,"y2"):V(e.y)-Je}};if(this._stacked){var Ze=f==="x"?I:V;Xe["".concat(f)]=Xe["".concat(f,"0")]=function(e){var t=k.indexOf(e.id),n=x.indexOf(e.discrete);return t>=0?Ze(b[t][n][0]):Ze(m[f][f==="x"?0:1])};Xe["".concat(f,"1")]=function(e){var t=k.indexOf(e.id),n=x.indexOf(e.discrete);return t>=0?Ze(b[t][n][1]):Ze(m[f][f==="x"?0:1])}}var $e=Object.keys(this._on);H.forEach(function(t){var n=(new ft[t.key]).config(Xe).data(t.values);if(t.key==="Bar"){var e;var r=B._discrete==="x"?I:V;var i=B._discrete==="x"?W:N;var a=B._discrete==="x"?q:F;var o=B._discrete==="x"?Re:Be;if(i!=="Point"&&a.length===2){e=(r(t.values[B._discrete==="x"?0:t.values.length-1][B._discrete])-r(a[0]))*2}else if(a.length>1)e=r(a[1])-r(a[0]);else e=o[o.length-1]-o[0];if(B._groupPadding<e)e-=B._groupPadding;var s=e||1;var c=at.nest().key(function(e){return e[B._discrete]}).key(function(e){return e.group}).entries(t.values);var f=it.merge(c.map(function(e){return e.values.map(function(e){return e.key})}));var u=Array.from(new Set(f));if(it.max(c.map(function(e){return e.values.length}))===1){n[B._discrete](function(e,t){return Xe[B._discrete](e,t)})}else{s=(s-B._barPadding*u.length-1)/u.length;var l=e/2-s/2;var d=ot.scaleLinear().domain([0,u.length-1]).range([-l,l]);n[B._discrete](function(e,t){return Xe[B._discrete](e,t)+d(u.indexOf(e.group))})}n.width(s);n.height(s)}else if(t.key==="Line"){n.duration(R*1.5);if(B._confidence){var h=Object.assign({},Xe);var v=B._discrete||"x";var g=v==="x"?"y":"x";var _=v==="x"?V:I;h["".concat(g,"0")]=function(e){return _(B._confidence[0]?e.lci:e[g])};h["".concat(g,"1")]=function(e){return _(B._confidence[1]?e.hci:e[g])};var y=(new ft.Area).config(h).data(t.values);var p=Object.assign(B._shapeConfig,B._confidenceConfig);y.config(rt.configPrep.bind(B)(p,"shape","Area")).render();B._shapes.push(y)}n.config({label:B._lineLabels?B._drawLabel:false,labelBounds:B._lineLabels?function(e,t,n){var r=gt(n.points[0],2),i=r[0],a=r[1];var o=gt(n.points[n.points.length-1],2),s=o[0],c=o[1];var f=B._height/4;return{x:s-i,y:c-a-f/2,width:B._padding.right,height:f}}:false})}var x=$e.filter(function(e){return e.includes(".".concat(t.key))}),m=$e.filter(function(e){return!e.includes(".")}),b=$e.filter(function(e){return e.includes(".shape")});var k=function e(t){n.on(m[t],function(e){return B._on[m[t]](e.data,e.i)})};for(var C=0;C<m.length;C++){k(C)}var w=function e(t){n.on(b[t],function(e){return B._on[b[t]](e.data,e.i)})};for(var S=0;S<b.length;S++){w(S)}var A=function e(t){n.on(x[t],function(e){return B._on[x[t]](e.data,e.i)})};for(var O=0;O<x.length;O++){A(O)}var P=rt.configPrep.bind(B)(B._shapeConfig,"shape",t.key);if(B._shapeConfig.duration===undefined)delete P.duration;n.config(P).render();B._shapes.push(n);if(t.key==="Line"&&B._lineMarkers){var z=(new ft.Circle).data(t.values).config(Xe).config(B._lineMarkerConfig).id(function(e){return"".concat(e.id,"_").concat(e.discrete)});var T=function e(t){z.on(m[t],function(e){return B._on[m[t]](e.data,e.i)})};for(var j=0;j<m.length;j++){T(j)}var M=function e(t){z.on(b[t],function(e){return B._on[b[t]](e.data,e.i)})};for(var L=0;L<b.length;L++){M(L)}var D=function e(t){z.on(x[t],function(e){return B._on[x[t]](e.data,e.i)})};for(var E=0;E<x.length;E++){D(E)}z.render();B._shapes.push(z)}});var et=H.map(function(e){return e.key});if(et.includes("Line")){if(this._confidence)et.push("Area");if(this._labelMarkers)et.push("Circle")}var tt=this._previousShapes.filter(function(e){return!et.includes(e)});tt.forEach(function(e){(new ft[e]).config(Xe).data([]).render()});this._previousShapes=et;return this}},{key:"annotations",value:function e(t){return arguments.length?(this._annotations=t instanceof Array?t:[t],this):this._annotations}},{key:"backgroundConfig",value:function e(t){return arguments.length?(this._backgroundConfig=rt.assign(this._backgroundConfig,t),this):this._backgroundConfig}},{key:"barPadding",value:function e(t){return arguments.length?(this._barPadding=t,this):this._barPadding}},{key:"baseline",value:function e(t){return arguments.length?(this._baseline=t,this):this._baseline}},{key:"confidence",value:function e(t){if(arguments.length&&t instanceof Array){this._confidence=[];var n=t[0];this._confidence[0]=typeof n==="function"||!n?n:rt.accessor(n);var r=t[1];this._confidence[1]=typeof r==="function"||!r?r:rt.accessor(r);return this}else return this._confidence}},{key:"confidenceConfig",value:function e(t){return arguments.length?(this._confidenceConfig=rt.assign(this._confidenceConfig,t),this):this._confidenceConfig}},{key:"discrete",value:function e(t){return arguments.length?(this._discrete=t,this):this._discrete}},{key:"discreteCutoff",value:function e(t){return arguments.length?(this._discreteCutoff=t,this):this._discreteCutoff}},{key:"groupPadding",value:function e(t){return arguments.length?(this._groupPadding=t,this):this._groupPadding}},{key:"lineLabels",value:function e(t){return arguments.length?(this._lineLabels=t,this):this._lineLabels}},{key:"lineMarkerConfig",value:function e(t){return arguments.length?(this._lineMarkerConfig=rt.assign(this._lineMarkerConfig,t),this):this._lineMarkerConfig}},{key:"lineMarkers",value:function e(t){return arguments.length?(this._lineMarkers=t,this):this._lineMarkers}},{key:"shapeSort",value:function e(t){return arguments.length?(this._shapeSort=t,this):this._shapeSort}},{key:"size",value:function e(t){return arguments.length?(this._size=typeof t==="function"||!t?t:rt.accessor(t),this):this._size}},{key:"sizeMax",value:function e(t){return arguments.length?(this._sizeMax=t,this):this._sizeMax}},{key:"sizeMin",value:function e(t){return arguments.length?(this._sizeMin=t,this):this._sizeMin}},{key:"sizeScale",value:function e(t){return arguments.length?(this._sizeScale=t,this):this._sizeScale}},{key:"stacked",value:function e(t){return arguments.length?(this._stacked=t,this):this._stacked}},{key:"stackOffset",value:function e(t){return arguments.length?(this._stackOffset=typeof t==="function"?t:st["stackOffset".concat(t.charAt(0).toUpperCase()+t.slice(1))],this):this._stackOffset}},{key:"stackOrder",value:function e(t){if(arguments.length){if(typeof t==="string")this._stackOrder=t==="ascending"?C:t==="descending"?w:st["stackOrder".concat(t.charAt(0).toUpperCase()+t.slice(1))];else this._stackOrder=t;return this}else return this._stackOrder}},{key:"x",value:function e(t){if(arguments.length){if(typeof t==="function")this._x=t;else{this._x=rt.accessor(t);if(!this._aggs[t]&&this._discrete==="x"){this._aggs[t]=function(e){var t=Array.from(new Set(e));return t.length===1?t[0]:t}}}return this}else return this._x}},{key:"x2",value:function e(t){if(arguments.length){if(typeof t==="function")this._x2=t;else{this._x2=rt.accessor(t);if(!this._aggs[t]&&this._discrete==="x"){this._aggs[t]=function(e){var t=Array.from(new Set(e));return t.length===1?t[0]:t}}}return this}else return this._x2}},{key:"xConfig",value:function e(t){return arguments.length?(this._xConfig=rt.assign(this._xConfig,t),this):this._xConfig}},{key:"xCutoff",value:function e(t){return arguments.length?(this._xCutoff=t,this):this._xCutoff}},{key:"x2Config",value:function e(t){return arguments.length?(this._x2Config=rt.assign(this._x2Config,t),this):this._x2Config}},{key:"xDomain",value:function e(t){return arguments.length?(this._xDomain=t,this):this._xDomain}},{key:"x2Domain",value:function e(t){return arguments.length?(this._x2Domain=t,this):this._x2Domain}},{key:"xSort",value:function e(t){return arguments.length?(this._xSort=t,this):this._xSort}},{key:"x2Sort",value:function e(t){return arguments.length?(this._x2Sort=t,this):this._x2Sort}},{key:"y",value:function e(t){if(arguments.length){if(typeof t==="function")this._y=t;else{this._y=rt.accessor(t);if(!this._aggs[t]&&this._discrete==="y"){this._aggs[t]=function(e){var t=Array.from(new Set(e));return t.length===1?t[0]:t}}}return this}else return this._y}},{key:"y2",value:function e(t){if(arguments.length){if(typeof t==="function")this._y2=t;else{this._y2=rt.accessor(t);if(!this._aggs[t]&&this._discrete==="y2"){this._aggs[t]=function(e){var t=Array.from(new Set(e));return t.length===1?t[0]:t}}}return this}else return this._y2}},{key:"yConfig",value:function e(t){if(arguments.length){if(t.domain)t.domain=t.domain.slice().reverse();this._yConfig=rt.assign(this._yConfig,t);return this}return this._yConfig}},{key:"yCutoff",value:function e(t){return arguments.length?(this._yCutoff=t,this):this._yCutoff}},{key:"y2Config",value:function e(t){if(arguments.length){if(t.domain)t.domain=t.domain.slice().reverse();this._y2Config=rt.assign(this._y2Config,t);return this}return this._y2Config}},{key:"yDomain",value:function e(t){return arguments.length?(this._yDomain=t,this):this._yDomain}},{key:"y2Domain",value:function e(t){return arguments.length?(this._y2Domain=t,this):this._y2Domain}},{key:"ySort",value:function e(t){return arguments.length?(this._ySort=t,this):this._ySort}},{key:"y2Sort",value:function e(t){return arguments.length?(this._y2Sort=t,this):this._y2Sort}}]);return nt}(t.Viz);var P=function(e){o(t,e);function t(){var e;n(this,t);e=f(this,ht(t).call(this));e._baseline=0;e._discrete="x";e._shape=rt.constant("Area");e.x("x");return e}return t}(O);var z=function(e){o(t,e);function t(){var e;n(this,t);e=f(this,ht(t).call(this));e._baseline=0;e._discrete="x";e._shape=rt.constant("Bar");e.x("x");return e}return t}(O);var T=function(e){o(t,e);function t(){var i;n(this,t);i=f(this,ht(t).call(this));i._discrete="x";i._shape=rt.constant("Box");i.x("x");i._tooltipConfig=rt.assign(i._tooltipConfig,{title:function e(t,n){if(!t)return"";while(t.__d3plus__&&t.data){t=t.data;n=t.i}if(i._label)return i._label(t,n);var r=i._ids(t,n).slice(0,i._drawDepth);return r[r.length-1]}});return i}return t}(O);var j=function(e){o(t,e);function t(){var o;n(this,t);o=f(this,ht(t).call(this));o._discrete="x";o._shape=rt.constant("Line");o.x("x");o.y2(function(e){return o._y(e)});o.yConfig({tickFormat:function e(t){var n=o._formattedData;var r=n[0].x instanceof Date?n[0].x.getTime():n[0].x;var i=n.filter(function(e){return(e.x instanceof Date?e.x.getTime():e.x)===r});var a=i.find(function(e){return e.y===t});return a?o._drawLabel(a,a.i):""}});o.y2Config({tickFormat:function e(t){var n=o._formattedData;var r=n[n.length-1].x instanceof Date?n[n.length-1].x.getTime():n[n.length-1].x;var i=n.filter(function(e){return(e.x instanceof Date?e.x.getTime():e.x)===r});var a=i.find(function(e){return e.y===t});return a?o._drawLabel(a,a.i):""}});o.ySort(function(e,t){return o._y(t)-o._y(e)});o.y2Sort(function(e,t){return o._y(t)-o._y(e)});return o}return t}(O);var M=function(e){o(t,e);function t(){var e;n(this,t);e=f(this,ht(t).call(this));e._discrete="x";e._shape=rt.constant("Line");e.x("x");return e}return t}(O);var L=Math.PI*2;var D=function(e){o(x,e);function x(){var e;n(this,x);e=f(this,ht(x).call(this));e._axisConfig={shapeConfig:{fill:rt.constant("none"),labelConfig:{fontColor:"#000",padding:0,textAnchor:function e(t,n,r){return r.textAnchor},verticalAlign:"middle"},stroke:"#ccc",strokeWidth:rt.constant(1)}};e._discrete="metric";e._levels=6;e._metric=rt.accessor("metric");e._outerPadding=100;e._shape=rt.constant("Path");e._value=rt.accessor("value");return e}i(x,[{key:"_draw",value:function e(t){var h=this;vt(ht(x.prototype),"_draw",this).call(this,t);var f=this._height-this._margin.top-this._margin.bottom,u=this._width-this._margin.left-this._margin.right;var v=it.min([f,u])/2-this._outerPadding,n="translate(".concat(u/2,", ").concat(f/2,")");var r=at.nest().key(this._metric).entries(this._filteredData),i=at.nest().key(this._id).key(this._metric).entries(this._filteredData);var a=it.max(i.map(function(e){return e.values.map(function(e){return it.sum(e.values,function(e,t){return h._value(e,t)})})}).flat());var o=Array.from(Array(this._levels).keys()).map(function(e){return{id:e,r:v*((e+1)/h._levels)}});var s=rt.configPrep.bind(this)(this._axisConfig.shapeConfig,"shape","Circle");delete s.label;(new ft.Circle).data(o).select(rt.elem("g.d3plus-Radar-radial-circles",{parent:this._select,enter:{transform:n},update:{transform:n}}).node()).config(s).render();var g=r.length;var c=r.map(function(e,t){var n=h._outerPadding;var r=h._shapeConfig.labelConfig.fontSize&&h._shapeConfig.labelConfig.fontSize(e,t)||11;var i=r*1.4;var a=i*2;var o=10,s=parseInt(360-360/g*t/90,10)%4+1,c=L/g*t;var f=360/g*t;var u="start";var l=o;if(s===2||s===3){l=-n-o;u="end";f+=180}var d={x:l,y:-a/2,width:n,height:a};return{__d3plus__:true,data:rt.merge(e.values),i:t,id:e.key,angle:f,textAnchor:u,labelBounds:d,rotateAnchor:[-l,a/2],x:v*Math.cos(c),y:v*Math.sin(c)}}).sort(function(e,t){return e.key-t.key});(new ft.Rect).data(c).rotate(function(e){return e.angle||0}).width(0).height(0).x(function(e){return e.x}).y(function(e){return e.y}).label(function(e){return e.id}).labelBounds(function(e){return e.labelBounds}).labelConfig(this._axisConfig.shapeConfig.labelConfig).select(rt.elem("g.d3plus-Radar-text",{parent:this._select,enter:{transform:n},update:{transform:n}}).node()).render();(new ft.Path).data(c).d(function(e){return"M".concat(0,",",0," ",-e.x,",").concat(-e.y)}).select(rt.elem("g.d3plus-Radar-axis",{parent:this._select,enter:{transform:n},update:{transform:n}}).node()).config(rt.configPrep.bind(this)(this._axisConfig.shapeConfig,"shape","Path")).render();var l=i.map(function(e){var t=e.values.map(function(e,t){var n=it.sum(e.values,function(e,t){return h._value(e,t)});var r=n/a*v,i=L/g*t;return{x:r*Math.cos(i),y:r*Math.sin(i)}});var n="M ".concat(t[0].x," ").concat(t[0].y," ").concat(t.map(function(e){return"L ".concat(e.x," ").concat(e.y)}).join(" ")," L ").concat(t[0].x," ").concat(t[0].y);return{arr:e.values.map(function(e){return rt.merge(e.values)}),id:e.key,points:t,d:n,__d3plus__:true,data:rt.merge(e.values.map(function(e){return rt.merge(e.values)}))}});var d=rt.configPrep.bind(this)(this._shapeConfig,"shape","Path");var _=Object.keys(d.on);d.on={};var y=function e(t){var c=_[t];d.on[c]=function(e,t){var n=e.points.map(function(e){return e.x+u/2});var r=e.points.map(function(e){return e.y+f/2});var i=m.mouse(h._select.node());var a=n.map(function(e){return Math.abs(e-i[0])});var o=r.map(function(e){return Math.abs(e-i[1])});var s=a.map(function(e,t){return e+o[t]});h._on[c].bind(h)(e.arr[s.indexOf(it.min(s))],t)}};for(var p=0;p<_.length;p++){y(p)}this._shapes.push((new ft.Path).data(l).d(function(e){return e.d}).select(rt.elem("g.d3plus-Radar-items",{parent:this._select,enter:{transform:n},update:{transform:n}}).node()).config(d).render());return this}},{key:"axisConfig",value:function e(t){return arguments.length?(this._axisConfig=rt.assign(this._axisConfig,t),this):this._axisConfig}},{key:"metric",value:function e(t){return arguments.length?(this._metric=typeof t==="function"?t:rt.accessor(t),this):this._metric}},{key:"outerPadding",value:function e(t){return arguments.length?(this._outerPadding=t,this):this._outerPadding}},{key:"value",value:function e(t){return arguments.length?(this._value=typeof t==="function"?t:rt.accessor(t),this):this._value}}]);return x}(t.Viz);var E=function(e){o(t,e);function t(){var e;n(this,t);e=f(this,ht(t).call(this));e._stacked=true;return e}return t}(P);e.AreaPlot=P;e.BarChart=z;e.BoxWhisker=T;e.BumpChart=j;e.LinePlot=M;e.Plot=O;e.Radar=D;e.StackedArea=E;Object.defineProperty(e,"__esModule",{value:true})});