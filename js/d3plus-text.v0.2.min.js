!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("d3-selection")):"function"==typeof define&&define.amd?define("d3plus-text",["exports","d3-selection"],n):n(t.d3plus_text={},t.d3_selection)}(this,function(t,n){"use strict";function e(t){return function(){return t}}function r(t){if(t.includes(" ")){var n=t.split(/\s+/);return t.replace(" "+n[n.length-1],"...")}return"..."}function o(t){return t.match(l)}function i(){function t(){function t(t){t.attr("x",b+"px").attr("dx","0px").attr("dy",y+"px").attr("dominant-baseline","alphabetic").style("baseline-shift","0%")}function e(r){var u=w.html(),f=j+r,l=v.charAt(f.length);if(w.html(u+r),s.node().getBBox().height>o){if(w.remove(),w=n.select(s.node().lastChild),w.size()){var a=w.html(),c=i(a);w.html(c?c:a)}return!1}if(w.node().getComputedTextLength()>x)return w.html(u.trimRight()),1===z&&""===u?!1:(w=s.append("tspan").call(t),z++,e(r));var p=" "===l?" ":"";return j=f+p,w.html(u+r+p),!0}var r=l(),o=a(s),y=c(),v=d(s),x=h(s),b=g(s),z=1,j="";s.attr("y",m(s)+"px").attr("fill",u()).attr("font-family",f()).attr("font-size",r+"px").size("font-size",r+"px");var w=s.html("").append("tspan").call(t),C=!0,B=!1,F=void 0;try{for(var R,S=p(v)[Symbol.iterator]();!(C=(R=S.next()).done);C=!0){var _=R.value,k=e(_);if(!k)break}}catch(q){B=!0,F=q}finally{try{!C&&S["return"]&&S["return"]()}finally{if(B)throw F}}}var i=r,u=void 0,f=void 0,l=void 0,a=e(200),c=void 0,s=void 0,p=o,d=void 0,h=e(200),g=e(0),m=e(0);return t.ellipsis=function(n){return arguments.length?(i="function"==typeof n?n:e(n),t):i},t.fontColor=function(n){return arguments.length?(u="function"==typeof n?n:e(n),t):u},t.fontFamily=function(n){return arguments.length?(f="function"==typeof n?n:e(n),t):f},t.fontSize=function(n){return arguments.length?(l="function"==typeof n?n:e(n),t):l},t.height=function(n){return arguments.length?(a="function"==typeof n?n:e(n),t):a},t.select=function(r){return arguments.length?(s=n.select(r),void 0===d&&(d=e(s.text()),void 0===u&&(u=e(s.style("font-color"))),void 0===f&&(f=e(s.style("font-family"))),void 0===l&&(l=e(parseFloat(s.style("font-size"),10)),c=e(Math.ceil(1.1*l())))),t):s},t.split=function(n){return arguments.length?(p=n,t):p},t.text=function(n){return arguments.length?(d="function"==typeof n?n:e(n),t):d},t.width=function(n){return arguments.length?(h="function"==typeof n?n:e(n),t):h},t.x=function(n){return arguments.length?(g="function"==typeof n?n:e(n),t):g},t.y=function(n){return arguments.length?(m="function"==typeof n?n:e(n),t):m},t}var u="0.2.0",f=["-","/",";",":","&"],l=new RegExp("[^\\s\\"+f.join("\\")+"]+\\"+f.join("?\\")+"?","g");t.version=u,t.box=i});