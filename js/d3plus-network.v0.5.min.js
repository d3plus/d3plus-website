/*
  d3plus-network v0.5.8
  Javascript network visualizations built upon d3 modules.
  Copyright (c) 2019 D3plus - https://d3plus.org
  @license MIT
*/
(function(e,t){typeof exports==="object"&&typeof module!=="undefined"?t(exports,require("d3-array"),require("d3-collection"),require("d3-scale"),require("d3-zoom"),require("d3plus-common"),require("d3plus-shape"),require("d3plus-viz"),require("d3plus-color"),require("d3-sankey")):typeof define==="function"&&define.amd?define("d3plus-network",["exports","d3-array","d3-collection","d3-scale","d3-zoom","d3plus-common","d3plus-shape","d3plus-viz","d3plus-color","d3-sankey"],t):(e=e||self,t(e.d3plus={},e.d3Array,e.d3Collection,e.scales,e.d3Zoom,e.d3plusCommon,e.shapes,e.d3plusViz,e.d3plusColor,e.d3Sankey))})(this,function(e,I,R,W,f,N,V,a,F,t){"use strict";function Y(e){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){Y=function(e){return typeof e}}else{Y=function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e}}return Y(e)}function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}function i(e,t,n){if(t)r(e.prototype,t);if(n)r(e,n);return e}function o(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function")}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:true,configurable:true}});if(t)s(e,t)}function X(e){X=Object.setPrototypeOf?Object.getPrototypeOf:function e(t){return t.__proto__||Object.getPrototypeOf(t)};return X(e)}function s(e,t){s=Object.setPrototypeOf||function e(t,n){t.__proto__=n;return t};return s(e,t)}function l(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function h(e,t){if(t&&(typeof t==="object"||typeof t==="function")){return t}return l(e)}function u(e,t){while(!Object.prototype.hasOwnProperty.call(e,t)){e=X(e);if(e===null)break}return e}function H(e,t,n){if(typeof Reflect!=="undefined"&&Reflect.get){H=Reflect.get}else{H=function e(t,n,r){var i=u(t,n);if(!i)return;var a=Object.getOwnPropertyDescriptor(i,n);if(a.get){return a.get.call(r)}return a.value}}return H(e,t,n||e)}var c=function(e){o(B,e);function B(){var c;n(this,B);c=h(this,X(B).call(this));c._links=[];c._linkSize=N.constant(1);c._linkSizeMin=1;c._linkSizeScale="sqrt";c._noDataMessage=false;c._nodes=[];c._on["click.shape"]=function(e,t){c._tooltipClass.data([]).render();if(c._hover&&c._drawDepth>=c._groupBy.length-1){var n="".concat(c._nodeGroupBy&&c._nodeGroupBy[c._drawDepth](e,t)?c._nodeGroupBy[c._drawDepth](e,t):c._id(e,t));if(c._focus&&c._focus===n){c.active(false);c._on.mouseenter.bind(l(c))(e,t);c._focus=undefined;c._zoomToBounds(null)}else{c.hover(false);var r=c._linkLookup[n],i=c._nodeLookup[n];var a=[n];var o=[i.x-i.r,i.x+i.r],s=[i.y-i.r,i.y+i.r];r.forEach(function(e){a.push(e.id);if(e.x-e.r<o[0])o[0]=e.x-e.r;if(e.x+e.r>o[1])o[1]=e.x+e.r;if(e.y-e.r<s[0])s[0]=e.y-e.r;if(e.y+e.r>s[1])s[1]=e.y+e.r});c.active(function(e,t){if(e.source&&e.target)return e.source.id===n||e.target.id===n;else return a.includes("".concat(c._ids(e,t)[c._drawDepth]))});c._focus=n;var u=f.zoomTransform(c._container.node());o=o.map(function(e){return e*u.k+u.x});s=s.map(function(e){return e*u.k+u.y});c._zoomToBounds([[o[0],s[0]],[o[1],s[1]]])}}};c._on["click.legend"]=function(e,t){var n=c._id(e);var r=c._ids(e);r=r[r.length-1];if(c._hover&&c._drawDepth>=c._groupBy.length-1){if(c._focus&&c._focus===n){c.active(false);c._focus=undefined;c._zoomToBounds(null)}else{c.hover(false);var i=n.map(function(e){return c._nodeLookup[e]});var a=["".concat(r)];var o=[i[0].x-i[0].r,i[0].x+i[0].r],s=[i[0].y-i[0].r,i[0].y+i[0].r];i.forEach(function(e){a.push(e.id);if(e.x-e.r<o[0])o[0]=e.x-e.r;if(e.x+e.r>o[1])o[1]=e.x+e.r;if(e.y-e.r<s[0])s[0]=e.y-e.r;if(e.y+e.r>s[1])s[1]=e.y+e.r});c.active(function(e,t){if(e.source&&e.target)return a.includes(e.source.id)&&a.includes(e.target.id);else{var n=c._ids(e,t);return a.includes("".concat(n[n.length-1]))}});c._focus=n;var u=f.zoomTransform(c._container.node());o=o.map(function(e){return e*u.k+u.x});s=s.map(function(e){return e*u.k+u.y});c._zoomToBounds([[o[0],s[0]],[o[1],s[1]]])}c._on.mouseenter.bind(l(c))(e,t);c._on["mousemove.legend"].bind(l(c))(e,t)}};c._on.mouseenter=function(){};c._on["mouseleave.shape"]=function(){c.hover(false)};var u=c._on["mousemove.shape"];c._on["mousemove.shape"]=function(e,t){u(e,t);var n="".concat(c._nodeGroupBy&&c._nodeGroupBy[c._drawDepth](e,t)?c._nodeGroupBy[c._drawDepth](e,t):c._id(e,t)),r=c._linkLookup[n],i=c._nodeLookup[n];var a=[n];var o=[i.x-i.r,i.x+i.r],s=[i.y-i.r,i.y+i.r];r.forEach(function(e){a.push(e.id);if(e.x-e.r<o[0])o[0]=e.x-e.r;if(e.x+e.r>o[1])o[1]=e.x+e.r;if(e.y-e.r<s[0])s[0]=e.y-e.r;if(e.y+e.r>s[1])s[1]=e.y+e.r});c.hover(function(e,t){if(e.source&&e.target)return e.source.id===n||e.target.id===n;else return a.includes("".concat(c._ids(e,t)[c._drawDepth]))})};c._sizeMin=5;c._sizeScale="sqrt";c._shape=N.constant("Circle");c._shapeConfig=N.assign(c._shapeConfig,{ariaLabel:function e(t,n){var r=c._size?", ".concat(c._size(t,n)):"";return"".concat(c._drawLabel(t,n)).concat(r,".")},labelConfig:{duration:0,fontMin:1,fontResize:true,labelPadding:0,textAnchor:"middle",verticalAlign:"middle"},Path:{fill:"none",label:false,stroke:"#eee"}});c._x=N.accessor("x");c._y=N.accessor("y");c._zoom=true;return c}i(B,[{key:"_draw",value:function e(t){var i=this;H(X(B.prototype),"_draw",this).call(this,t);var n=this._height-this._margin.top-this._margin.bottom,r="translate(".concat(this._margin.left,", ").concat(this._margin.top,")"),a=this._transition,o=this._width-this._margin.left-this._margin.right;var s=this._filteredData.reduce(function(e,t,n){e[i._id(t,n)]=t;return e},{});var u=this._nodes.reduce(function(e,t,n){e[i._nodeGroupBy?i._nodeGroupBy[i._drawDepth](t,n):i._id(t,n)]=t;return e},{});u=Array.from(new Set(Object.keys(s).concat(Object.keys(u)))).map(function(e,t){var n=s[e],r=u[e];if(r===undefined)return false;return{__d3plus__:true,data:n||r,i:t,id:e,fx:n!==undefined&&i._x(n)!==undefined?i._x(n):i._x(r),fy:n!==undefined&&i._y(n)!==undefined?i._y(n):i._y(r),node:r,r:i._size?n!==undefined&&i._size(n)!==undefined?i._size(n):i._size(r):i._sizeMin,shape:n!==undefined&&i._shape(n)!==undefined?i._shape(n):i._shape(r)}}).filter(function(e){return e});var c=I.extent(u.map(function(e){return e.fx})),f=I.extent(u.map(function(e){return e.fy}));var l=W.scaleLinear().domain(c).range([0,o]),h=W.scaleLinear().domain(f).range([0,n]);var d=(c[1]-c[0])/(f[1]-f[0]),v=o/n;if(d>v){var p=n*v/d;h.range([(n-p)/2,n-(n-p)/2])}else{var _=o*d/v;l.range([(o-_)/2,o-(o-_)/2])}u.forEach(function(e){e.x=l(e.fx);e.y=h(e.fy)});var g=I.extent(u.map(function(e){return e.r}));var y=this._sizeMax||I.min(I.merge(u.map(function(t){return u.map(function(e){return t===e?null:V.pointDistance([t.x,t.y],[e.x,e.y])})})))/2;var m=W["scale".concat(this._sizeScale.charAt(0).toUpperCase()).concat(this._sizeScale.slice(1))]().domain(g).range([g[0]===g[1]?y:I.min([y/2,this._sizeMin]),y]),k=l.domain(),b=h.domain();var z=k[1]-k[0],x=b[1]-b[0];u.forEach(function(e){var t=m(e.r);if(k[0]>l.invert(e.x-t))k[0]=l.invert(e.x-t);if(k[1]<l.invert(e.x+t))k[1]=l.invert(e.x+t);if(b[0]>h.invert(e.y-t))b[0]=h.invert(e.y-t);if(b[1]<h.invert(e.y+t))b[1]=h.invert(e.y+t)});var w=k[1]-k[0],S=b[1]-b[0];y*=I.min([z/w,x/S]);m.range([g[0]===g[1]?y:I.min([y/2,this._sizeMin]),y]);l.domain(k);h.domain(b);u.forEach(function(e){e.x=l(e.fx);e.fx=e.x;e.y=h(e.fy);e.fy=e.y;e.r=m(e.r);e.width=e.r*2;e.height=e.r*2});var M=this._nodeLookup=u.reduce(function(e,t){e[t.id]=t;return e},{});var O=u.map(function(e){return e.node});var P=this._links.map(function(e){return{size:i._linkSize(e),source:typeof e.source==="number"?u[O.indexOf(i._nodes[e.source])]:M[e.source.id],target:typeof e.target==="number"?u[O.indexOf(i._nodes[e.target])]:M[e.target.id]}});this._linkLookup=P.reduce(function(e,t){if(!e[t.source.id])e[t.source.id]=[];e[t.source.id].push(t.target);if(!e[t.target.id])e[t.target.id]=[];e[t.target.id].push(t.source);return e},{});this._container=this._select.selectAll("svg.d3plus-network").data([0]);this._container=this._container.enter().append("svg").attr("class","d3plus-network").attr("opacity",0).attr("width",o).attr("height",n).attr("x",this._margin.left).attr("y",this._margin.top).style("background-color","transparent").merge(this._container);this._container.transition(this._transition).attr("opacity",1).attr("width",o).attr("height",n).attr("x",this._margin.left).attr("y",this._margin.top);var C=this._container.selectAll("rect.d3plus-network-hitArea").data([0]);C.enter().append("rect").attr("class","d3plus-network-hitArea").merge(C).attr("width",o).attr("height",n).attr("fill","transparent").on("click",function(){if(i._focus){i.active(false);i._focus=undefined;i._zoomToBounds(null)}});this._zoomGroup=this._container.selectAll("g.d3plus-network-zoomGroup").data([0]);var E=this._zoomGroup=this._zoomGroup.enter().append("g").attr("class","d3plus-network-zoomGroup").merge(this._zoomGroup);var j=I.extent(P,function(e){return e.size});if(j[0]!==j[1]){var L=W["scale".concat(this._linkSizeScale.charAt(0).toUpperCase()).concat(this._linkSizeScale.slice(1))]().domain(j).range([this._linkSizeMin,m.range()[0]]);P.forEach(function(e){e.size=L(e.size)})}var A=N.configPrep.bind(this)(this._shapeConfig,"edge","Path");delete A.on;this._shapes.push((new V.Path).config(A).strokeWidth(function(e){return e.size}).activeStyle({"stroke-width":function e(t){return t.size}}).d(function(e){return"M".concat(e.source.x,",").concat(e.source.y," ").concat(e.target.x,",").concat(e.target.y)}).data(P).select(N.elem("g.d3plus-network-links",{parent:E,transition:a,enter:{transform:r},update:{transform:r}}).node()).render());var q={label:function e(t){return u.length<=i._dataCutoff||i._hover&&i._hover(t)||i._active&&i._active(t)?i._drawLabel(t.data||t.node,t.i):false},select:N.elem("g.d3plus-network-nodes",{parent:E,transition:a,enter:{transform:r},update:{transform:r}}).node()};R.nest().key(function(e){return e.shape}).entries(u).forEach(function(e){i._shapes.push((new V[e.key]).config(N.configPrep.bind(i)(i._shapeConfig,"shape",e.key)).config(q).config(q[e.key]||{}).data(e.values).render())});return this}},{key:"hover",value:function e(t){this._hover=t;if(this._nodes.length<this._dataCutoff){this._shapes.forEach(function(e){return e.hover(t)});if(this._legend)this._legendClass.hover(t)}return this}},{key:"links",value:function e(t,n){if(arguments.length){var r=this._queue.find(function(e){return e[3]==="links"});var i=[a.dataLoad.bind(this),t,n,"links"];if(r)this._queue[this._queue.indexOf(r)]=i;else this._queue.push(i);return this}return this._links}},{key:"linkSize",value:function e(t){return arguments.length?(this._linkSize=typeof t==="function"?t:N.constant(t),this):this._linkSize}},{key:"linkSizeMin",value:function e(t){return arguments.length?(this._linkSizeMin=t,this):this._linkSizeMin}},{key:"linkSizeScale",value:function e(t){return arguments.length?(this._linkSizeScale=t,this):this._linkSizeScale}},{key:"nodeGroupBy",value:function e(t){var n=this;if(!arguments.length)return this._nodeGroupBy;if(!(t instanceof Array))t=[t];return this._nodeGroupBy=t.map(function(e){if(typeof e==="function")return e;else{if(!n._aggs[e]){n._aggs[e]=function(e){var t=Array.from(new Set(e));return t.length===1?t[0]:t}}return N.accessor(e)}}),this}},{key:"nodes",value:function e(t,n){if(arguments.length){var r=this._queue.find(function(e){return e[3]==="nodes"});var i=[a.dataLoad.bind(this),t,n,"nodes"];if(r)this._queue[this._queue.indexOf(r)]=i;else this._queue.push(i);return this}return this._nodes}},{key:"size",value:function e(t){return arguments.length?(this._size=typeof t==="function"||!t?t:N.accessor(t),this):this._size}},{key:"sizeMax",value:function e(t){return arguments.length?(this._sizeMax=t,this):this._sizeMax}},{key:"sizeMin",value:function e(t){return arguments.length?(this._sizeMin=t,this):this._sizeMin}},{key:"sizeScale",value:function e(t){return arguments.length?(this._sizeScale=t,this):this._sizeScale}},{key:"x",value:function e(t){if(arguments.length){if(typeof t==="function")this._x=t;else{this._x=N.accessor(t);if(!this._aggs[t])this._aggs[t]=function(e){return I.mean(e)}}return this}else return this._x}},{key:"y",value:function e(t){if(arguments.length){if(typeof t==="function")this._y=t;else{this._y=N.accessor(t);if(!this._aggs[t])this._aggs[t]=function(e){return I.mean(e)}}return this}else return this._y}}]);return B}(a.Viz);var d=function(e){o(D,e);function D(){var u;n(this,D);u=h(this,X(D).call(this));u._links=[];u._linkSize=N.constant(1);u._linkSizeMin=1;u._linkSizeScale="sqrt";u._noDataMessage=false;u._nodes=[];u._on.mouseenter=function(){};u._on["mouseleave.shape"]=function(){u.hover(false)};var c=u._on["mousemove.shape"];u._on["mousemove.shape"]=function(e,t){c(e,t);if(u._focus&&u._focus===e.id){u.hover(false);u._on.mouseenter.bind(l(u))(e,t);u._focus=undefined}else{var n=u._nodeGroupBy&&u._nodeGroupBy[u._drawDepth](e,t)?u._nodeGroupBy[u._drawDepth](e,t):u._id(e,t),r=u._linkLookup[n],i=u._nodeLookup[n];var a=[i.id];var o=[i.x-i.r,i.x+i.r],s=[i.y-i.r,i.y+i.r];r.forEach(function(e){a.push(e.id);if(e.x-e.r<o[0])o[0]=e.x-e.r;if(e.x+e.r>o[1])o[1]=e.x+e.r;if(e.y-e.r<s[0])s[0]=e.y-e.r;if(e.y+e.r>s[1])s[1]=e.y+e.r});u.hover(function(e,t){if(e.source&&e.target)return e.source.id===i.id||e.target.id===i.id;else return a.includes(u._ids(e,t)[u._drawDepth])})}};u._on["click.shape"]=function(e){u._center=e.id;u._draw()};u._sizeMin=5;u._sizeScale="sqrt";u._shape=N.constant("Circle");u._shapeConfig=N.assign(u._shapeConfig,{ariaLabel:function e(t,n){var r=u._size?", ".concat(u._size(t,n)):"";return"".concat(u._drawLabel(t,n)).concat(r,".")},labelConfig:{duration:0,fontMin:1,fontResize:true,labelPadding:0,textAnchor:"middle",verticalAlign:"middle"},Path:{fill:"none",label:false,stroke:"#eee",strokeWidth:1}});return u}i(D,[{key:"_draw",value:function e(t){var c=this;H(X(D.prototype),"_draw",this).call(this,t);var i=this._filteredData.reduce(function(e,t,n){e[c._id(t,n)]=t;return e},{});var f=this._nodes;if(!this._nodes.length&&this._links.length){var n=Array.from(new Set(this._links.reduce(function(e,t){return e.concat([t.source,t.target])},[])));f=n.map(function(e){return Y(e)==="object"?e:{id:e}})}f=f.reduce(function(e,t,n){e[c._nodeGroupBy?c._nodeGroupBy[c._drawDepth](t,n):c._id(t,n)]=t;return e},{});f=Array.from(new Set(Object.keys(i).concat(Object.keys(f)))).map(function(e,t){var n=i[e],r=f[e];if(r===undefined)return false;return{__d3plus__:true,data:n||r,i:t,id:e,node:r,shape:n!==undefined&&c._shape(n)!==undefined?c._shape(n):c._shape(r)}}).filter(function(e){return e});var r=this._nodeLookup=f.reduce(function(e,t){e[t.id]=t;return e},{});var a=this._links.map(function(n){var e=["source","target"];var t=e.reduce(function(e,t){e[t]=typeof n[t]==="number"?f[n[t]]:r[n[t].id||n[t]];return e},{});t.size=c._linkSize(n);return t});var o=a.reduce(function(e,t){if(!e[t.source.id]){e[t.source.id]=[]}e[t.source.id].push(t);if(!e[t.target.id]){e[t.target.id]=[]}e[t.target.id].push(t);return e},{});var l=this._height-this._margin.top-this._margin.bottom,s="translate(".concat(this._margin.left,", ").concat(this._margin.top,")"),u=this._transition,h=this._width-this._margin.left-this._margin.right;var d=[],v=I.min([l,h])/2,p=v/3;var _=p,g=p*2;var y=r[this._center];y.x=h/2;y.y=l/2;y.r=this._sizeMin?I.max([this._sizeMin,_*.65]):this._sizeMax?I.min([this._sizeMax,_*.65]):_*.65;var m=[y],k=[];o[this._center].forEach(function(e){var t=e.source.id===c._center?e.target:e.source;t.edges=o[t.id].filter(function(e){return e.source.id!==c._center||e.target.id!==c._center});t.edge=e;m.push(t);k.push(t)});k.sort(function(e,t){return e.edges.length-t.edges.length});var b=[];var z=0;k.forEach(function(e){var i=e.id;e.edges=e.edges.filter(function(e){return!m.includes(e.source)&&e.target.id===i||!m.includes(e.target)&&e.source.id===i});z+=e.edges.length||1;e.edges.forEach(function(e){var t=e.source,n=e.target;var r=n.id===i?t:n;m.push(r)})});var x=Math.PI*2;var w=0;k.forEach(function(a,e){var o=a.edges.length||1;var t=x/z*o;if(e===0){w-=t/2}var s=w+t/2-x/4;a.radians=s;a.x=h/2+_*Math.cos(s);a.y=l/2+_*Math.sin(s);w+=t;a.edges.forEach(function(e,t){var n=e.source.id===a.id?e.target:e.source;var r=x/z;var i=s-r*o/2+r/2+r*t;n.radians=i;n.x=h/2+g*Math.cos(i);n.y=l/2+g*Math.sin(i);b.push(n)})});var S=p/2;var M=p/4;var O=S/2-4;if(S/2-4<8){O=I.min([S/2,8])}var P=M/2-4;if(M/2-4<4){P=I.min([M/2,4])}if(P>p/10){P=p/10}if(P>O&&P>10){P=O*.75}if(O>P*1.5){O=P*1.5}O=Math.floor(O);P=Math.floor(P);var C;if(this._size){var E=I.extent(i,function(e){return e.size});if(E[0]===E[1]){E[0]=0}C=W.scaleLinear().domain(E).rangeRound([3,I.min([O,P])]);var j=y.size;y.r=C(j)}else{C=W.scaleLinear().domain([1,2]).rangeRound([O,P])}b.forEach(function(e){e.ring=2;var t=c._size?e.size:2;e.r=c._sizeMin?I.max([c._sizeMin,C(t)]):c._sizeMax?I.min([c._sizeMax,C(t)]):C(t)});k.forEach(function(e){e.ring=1;var t=c._size?e.size:1;e.r=c._sizeMin?I.max([c._sizeMin,C(t)]):c._sizeMax?I.min([c._sizeMax,C(t)]):C(t)});f=[y].concat(k).concat(b);k.forEach(function(u){var e=["source","target"];var n=u.edge;e.forEach(function(t){n[t]=f.find(function(e){return e.id===n[t].id})});d.push(n);o[u.id].forEach(function(r){var t=r.source.id===u.id?r.target:r.source;if(t.id!==y.id){var i=b.find(function(e){return e.id===t.id});if(!i){i=k.find(function(e){return e.id===t.id})}if(i){r.spline=true;var a=h/2;var o=l/2;var s=_+(g-_)*.5;var e=["source","target"];e.forEach(function(t,e){r["".concat(t,"X")]=r[t].x+Math.cos(r[t].ring===2?r[t].radians+Math.PI:r[t].radians)*r[t].r;r["".concat(t,"Y")]=r[t].y+Math.sin(r[t].ring===2?r[t].radians+Math.PI:r[t].radians)*r[t].r;r["".concat(t,"BisectX")]=a+s*Math.cos(r[t].radians);r["".concat(t,"BisectY")]=o+s*Math.sin(r[t].radians);r[t]=f.find(function(e){return e.id===r[t].id});if(r[t].edges===undefined)r[t].edges={};var n=e===0?r.target.id:r.source.id;if(r[t].id===u.id){r[t].edges[n]={angle:u.radians+Math.PI,radius:p/2}}else{r[t].edges[n]={angle:i.radians,radius:p/2}}});d.push(r)}}})});f.forEach(function(e){if(e.id!==c._center){var t=c._shapeConfig.labelConfig.fontSize&&c._shapeConfig.labelConfig.fontSize(e)||11;var n=t*1.4;var r=n*2;var i=5;var a=p-e.r;var o=e.radians*(180/Math.PI);var s=e.r+i;var u="start";if(o<-90||o>90){s=-e.r-a-i;u="end";o+=180}e.labelBounds={x:s,y:-n/2,width:a,height:r};e.rotate=o;e.textAnchor=u}else{e.labelBounds={x:-_/2,y:-_/2,width:_,height:_}}});this._linkLookup=a.reduce(function(e,t){if(!e[t.source.id])e[t.source.id]=[];e[t.source.id].push(t.target);if(!e[t.target.id])e[t.target.id]=[];e[t.target.id].push(t.source);return e},{});var L=I.extent(a,function(e){return e.size});if(L[0]!==L[1]){var A=I.min(f,function(e){return e.r});var q=W["scale".concat(this._linkSizeScale.charAt(0).toUpperCase()).concat(this._linkSizeScale.slice(1))]().domain(L).range([this._linkSizeMin,A]);a.forEach(function(e){e.size=q(e.size)})}var B=N.configPrep.bind(this)(this._shapeConfig,"edge","Path");delete B.on;this._shapes.push((new V.Path).config(B).strokeWidth(function(e){return e.size}).id(function(e){return"".concat(e.source.id,"_").concat(e.target.id)}).d(function(e){return e.spline?"M".concat(e.sourceX,",").concat(e.sourceY,"C").concat(e.sourceBisectX,",").concat(e.sourceBisectY," ").concat(e.targetBisectX,",").concat(e.targetBisectY," ").concat(e.targetX,",").concat(e.targetY):"M".concat(e.source.x,",").concat(e.source.y," ").concat(e.target.x,",").concat(e.target.y)}).data(d).select(N.elem("g.d3plus-rings-links",{parent:this._select,transition:u,enter:{transform:s},update:{transform:s}}).node()).render());var G=this;var T={label:function e(t){return f.length<=c._dataCutoff||c._hover&&c._hover(t)||c._active&&c._active(t)?c._drawLabel(t.data||t.node,t.i):false},labelBounds:function e(t){return t.labelBounds},labelConfig:{fontColor:function e(t){return t.id===c._center?N.configPrep.bind(G)(G._shapeConfig,"shape",t.key).labelConfig.fontColor(t):F.colorLegible(N.configPrep.bind(G)(G._shapeConfig,"shape",t.key).fill(t))},fontResize:function e(t){return t.id===c._center},padding:0,textAnchor:function e(t){return r[t.id].textAnchor||N.configPrep.bind(G)(G._shapeConfig,"shape",t.key).labelConfig.textAnchor},verticalAlign:function e(t){return t.id===c._center?"middle":"top"}},rotate:function e(t){return r[t.id].rotate||0},select:N.elem("g.d3plus-rings-nodes",{parent:this._select,transition:u,enter:{transform:s},update:{transform:s}}).node()};R.nest().key(function(e){return e.shape}).entries(f).forEach(function(e){c._shapes.push((new V[e.key]).config(N.configPrep.bind(c)(c._shapeConfig,"shape",e.key)).config(T).data(e.values).render())});return this}},{key:"center",value:function e(t){return arguments.length?(this._center=t,this):this._center}},{key:"hover",value:function e(t){this._hover=t;this._shapes.forEach(function(e){return e.hover(t)});if(this._legend)this._legendClass.hover(t);return this}},{key:"links",value:function e(t,n){if(arguments.length){var r=this._queue.find(function(e){return e[3]==="links"});var i=[a.dataLoad.bind(this),t,n,"links"];if(r)this._queue[this._queue.indexOf(r)]=i;else this._queue.push(i);return this}return this._links}},{key:"linkSize",value:function e(t){return arguments.length?(this._linkSize=typeof t==="function"?t:N.constant(t),this):this._linkSize}},{key:"linkSizeMin",value:function e(t){return arguments.length?(this._linkSizeMin=t,this):this._linkSizeMin}},{key:"linkSizeScale",value:function e(t){return arguments.length?(this._linkSizeScale=t,this):this._linkSizeScale}},{key:"nodeGroupBy",value:function e(t){var n=this;if(!arguments.length)return this._nodeGroupBy;if(!(t instanceof Array))t=[t];return this._nodeGroupBy=t.map(function(e){if(typeof e==="function")return e;else{if(!n._aggs[e]){n._aggs[e]=function(e){var t=Array.from(new Set(e));return t.length===1?t[0]:t}}return N.accessor(e)}}),this}},{key:"nodes",value:function e(t,n){if(arguments.length){var r=this._queue.find(function(e){return e[3]==="nodes"});var i=[a.dataLoad.bind(this),t,n,"nodes"];if(r)this._queue[this._queue.indexOf(r)]=i;else this._queue.push(i);return this}return this._nodes}},{key:"size",value:function e(t){return arguments.length?(this._size=typeof t==="function"||!t?t:N.accessor(t),this):this._size}},{key:"sizeMax",value:function e(t){return arguments.length?(this._sizeMax=t,this):this._sizeMax}},{key:"sizeMin",value:function e(t){return arguments.length?(this._sizeMin=t,this):this._sizeMin}},{key:"sizeScale",value:function e(t){return arguments.length?(this._sizeScale=t,this):this._sizeScale}}]);return D}(a.Viz);var v={center:t.sankeyCenter,justify:t.sankeyJustify,left:t.sankeyLeft,right:t.sankeyRight};var p=function(e){o(c,e);function c(){var s;n(this,c);s=h(this,X(c).call(this));s._nodeId=N.accessor("id");s._links=N.accessor("links");s._noDataMessage=false;s._nodes=N.accessor("nodes");s._nodeAlign=v.justify;s._nodePadding=8;s._nodeWidth=30;s._on.mouseenter=function(){};s._on["mouseleave.shape"]=function(){s.hover(false)};var u=s._on["mousemove.shape"];s._on["mousemove.shape"]=function(e,t){u(e,t);if(s._focus&&s._focus===e.id){s.hover(false);s._on.mouseenter.bind(l(s))(e,t);s._focus=undefined}else{var n=s._nodeId(e,t),r=s._nodeLookup[n],i=Object.keys(s._nodeLookup).reduce(function(e,t){e[s._nodeLookup[t]]=!isNaN(t)?parseInt(t,10):t;return e},{});var a=s._linkLookup[r];var o=[n];a.forEach(function(e){o.push(i[e])});s.hover(function(e,t){if(e.source&&e.target){return e.source.id===n||e.target.id===n}else{return o.includes(s._nodeId(e,t))}})}};s._path=t.sankeyLinkHorizontal();s._sankey=t.sankey();s._shape=N.constant("Rect");s._shapeConfig=N.assign(s._shapeConfig,{Path:{fill:"none",hoverStyle:{"stroke-width":function e(t){return Math.max(1,Math.abs(t.source.y1-t.source.y0)*(t.value/t.source.value)-2)}},label:false,stroke:"#DBDBDB",strokeOpacity:.5,strokeWidth:function e(t){return Math.max(1,Math.abs(t.source.y1-t.source.y0)*(t.value/t.source.value)-2)}},Rect:{}});s._value=N.constant(1);return s}i(c,[{key:"_draw",value:function e(t){var i=this;H(X(c.prototype),"_draw",this).call(this,t);var n=this._height-this._margin.top-this._margin.bottom,r=this._width-this._margin.left-this._margin.right;var a=this._nodes.map(function(e,t){return{__d3plus__:true,data:e,i:t,id:i._nodeId(e,t),node:e,shape:"Rect"}});var o=this._nodeLookup=a.reduce(function(e,t,n){e[t.id]=n;return e},{});var s=this._links.map(function(n,e){var t=["source","target"];var r=t.reduce(function(e,t){e[t]=typeof n[t]==="number"?o[n[t]]:o[n[t]];return e},{});return{source:r.source,target:r.target,value:i._value(n,e)}});this._linkLookup=s.reduce(function(e,t){if(!e[t.source])e[t.source]=[];e[t.source].push(t.target);if(!e[t.target])e[t.target]=[];e[t.target].push(t.source);return e},{});var u="translate(".concat(this._margin.left,", ").concat(this._margin.top,")");this._sankey.nodeAlign(this._nodeAlign).nodePadding(this._nodePadding).nodeWidth(this._nodeWidth).nodes(a).links(s).size([r,n])();this._shapes.push((new V.Path).config(this._shapeConfig.Path).data(s).d(this._path).select(N.elem("g.d3plus-Links",{parent:this._select,enter:{transform:u},update:{transform:u}}).node()).render());R.nest().key(function(e){return e.shape}).entries(a).forEach(function(e){i._shapes.push((new V[e.key]).data(e.values).height(function(e){return e.y1-e.y0}).width(function(e){return e.x1-e.x0}).x(function(e){return(e.x1+e.x0)/2}).y(function(e){return(e.y1+e.y0)/2}).select(N.elem("g.d3plus-sankey-nodes",{parent:i._select,enter:{transform:u},update:{transform:u}}).node()).config(N.configPrep.bind(i)(i._shapeConfig,"shape",e.key)).render())});return this}},{key:"hover",value:function e(t){this._hover=t;this._shapes.forEach(function(e){return e.hover(t)});if(this._legend)this._legendClass.hover(t);return this}},{key:"links",value:function e(t,n){if(arguments.length){var r=this._queue.find(function(e){return e[3]==="links"});var i=[a.dataLoad.bind(this),t,n,"links"];if(r)this._queue[this._queue.indexOf(r)]=i;else this._queue.push(i);return this}return this._links}},{key:"nodeAlign",value:function e(t){return arguments.length?(this._nodeAlign=typeof t==="function"?t:v[t],this):this._nodeAlign}},{key:"nodeId",value:function e(t){return arguments.length?(this._nodeId=typeof t==="function"?t:N.accessor(t),this):this._nodeId}},{key:"nodes",value:function e(t,n){if(arguments.length){var r=this._queue.find(function(e){return e[3]==="nodes"});var i=[a.dataLoad.bind(this),t,n,"nodes"];if(r)this._queue[this._queue.indexOf(r)]=i;else this._queue.push(i);return this}return this._nodes}},{key:"nodePadding",value:function e(t){return arguments.length?(this._nodePadding=t,this):this._nodePadding}},{key:"nodeWidth",value:function e(t){return arguments.length?(this._nodeWidth=t,this):this._nodeWidth}},{key:"value",value:function e(t){return arguments.length?(this._value=typeof t==="function"?t:N.accessor(t),this):this._value}}]);return c}(a.Viz);e.Network=c;e.Rings=d;e.Sankey=p;Object.defineProperty(e,"__esModule",{value:true})});(function(e){typeof define==="function"&&define.amd?define(e):e()})(function(){"use strict";var e=typeof globalThis!=="undefined"?globalThis:typeof window!=="undefined"?window:typeof global!=="undefined"?global:typeof self!=="undefined"?self:{};function t(e,t){return t={exports:{}},e(t,t.exports),t.exports}var n="object";var r=function(e){return e&&e.Math==Math&&e};var l=r(typeof globalThis==n&&globalThis)||r(typeof window==n&&window)||r(typeof self==n&&self)||r(typeof e==n&&e)||Function("return this")();var i=function(e){try{return!!e()}catch(e){return true}};var d=!i(function(){return Object.defineProperty({},"a",{get:function(){return 7}}).a!=7});var a={}.propertyIsEnumerable;var o=Object.getOwnPropertyDescriptor;var s=o&&!a.call({1:2},1);var u=s?function e(t){var n=o(this,t);return!!n&&n.enumerable}:a;var v={f:u};var c=function(e,t){return{enumerable:!(e&1),configurable:!(e&2),writable:!(e&4),value:t}};var f={}.toString;var h=function(e){return f.call(e).slice(8,-1)};var p="".split;var k=i(function(){return!Object("z").propertyIsEnumerable(0)})?function(e){return h(e)=="String"?p.call(e,""):Object(e)}:Object;var _=function(e){if(e==undefined)throw TypeError("Can't call method on "+e);return e};var g=function(e){return k(_(e))};var y=function(e){return typeof e==="object"?e!==null:typeof e==="function"};var m=function(e,t){if(!y(e))return e;var n,r;if(t&&typeof(n=e.toString)=="function"&&!y(r=n.call(e)))return r;if(typeof(n=e.valueOf)=="function"&&!y(r=n.call(e)))return r;if(!t&&typeof(n=e.toString)=="function"&&!y(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")};var b={}.hasOwnProperty;var z=function(e,t){return b.call(e,t)};var x=l.document;var w=y(x)&&y(x.createElement);var S=function(e){return w?x.createElement(e):{}};var M=!d&&!i(function(){return Object.defineProperty(S("div"),"a",{get:function(){return 7}}).a!=7});var O=Object.getOwnPropertyDescriptor;var P=d?O:function e(t,n){t=g(t);n=m(n,true);if(M)try{return O(t,n)}catch(e){}if(z(t,n))return c(!v.f.call(t,n),t[n])};var C={f:P};var E=function(e){if(!y(e)){throw TypeError(String(e)+" is not an object")}return e};var j=Object.defineProperty;var L=d?j:function e(t,n,r){E(t);n=m(n,true);E(r);if(M)try{return j(t,n,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported");if("value"in r)t[n]=r.value;return t};var A={f:L};var q=d?function(e,t,n){return A.f(e,t,c(1,n))}:function(e,t,n){e[t]=n;return e};var B=function(t,n){try{q(l,t,n)}catch(e){l[t]=n}return n};var G=t(function(e){var t="__core-js_shared__";var n=l[t]||B(t,{});(e.exports=function(e,t){return n[e]||(n[e]=t!==undefined?t:{})})("versions",[]).push({version:"3.1.3",mode:"global",copyright:"Â© 2019 Denis Pushkarev (zloirock.ru)"})});var T=G("native-function-to-string",Function.toString);var D=l.WeakMap;var I=typeof D==="function"&&/native code/.test(T.call(D));var R=0;var W=Math.random();var N=function(e){return"Symbol("+String(e===undefined?"":e)+")_"+(++R+W).toString(36)};var V=G("keys");var F=function(e){return V[e]||(V[e]=N(e))};var Y={};var X=l.WeakMap;var H,U,J;var K=function(e){return J(e)?U(e):H(e,{})};var Z=function(n){return function(e){var t;if(!y(e)||(t=U(e)).type!==n){throw TypeError("Incompatible receiver, "+n+" required")}return t}};if(I){var Q=new X;var $=Q.get;var ee=Q.has;var te=Q.set;H=function(e,t){te.call(Q,e,t);return t};U=function(e){return $.call(Q,e)||{}};J=function(e){return ee.call(Q,e)}}else{var ne=F("state");Y[ne]=true;H=function(e,t){q(e,ne,t);return t};U=function(e){return z(e,ne)?e[ne]:{}};J=function(e){return z(e,ne)}}var re={set:H,get:U,has:J,enforce:K,getterFor:Z};var ie=t(function(e){var t=re.get;var s=re.enforce;var u=String(T).split("toString");G("inspectSource",function(e){return T.call(e)});(e.exports=function(e,t,n,r){var i=r?!!r.unsafe:false;var a=r?!!r.enumerable:false;var o=r?!!r.noTargetGet:false;if(typeof n=="function"){if(typeof t=="string"&&!z(n,"name"))q(n,"name",t);s(n).source=u.join(typeof t=="string"?t:"")}if(e===l){if(a)e[t]=n;else B(t,n);return}else if(!i){delete e[t]}else if(!o&&e[t]){a=true}if(a)e[t]=n;else q(e,t,n)})(Function.prototype,"toString",function e(){return typeof this=="function"&&t(this).source||T.call(this)})});var ae=l;var oe=function(e){return typeof e=="function"?e:undefined};var se=function(e,t){return arguments.length<2?oe(ae[e])||oe(l[e]):ae[e]&&ae[e][t]||l[e]&&l[e][t]};var ue=Math.ceil;var ce=Math.floor;var fe=function(e){return isNaN(e=+e)?0:(e>0?ce:ue)(e)};var le=Math.min;var he=function(e){return e>0?le(fe(e),9007199254740991):0};var de=Math.max;var ve=Math.min;var pe=function(e,t){var n=fe(e);return n<0?de(n+t,0):ve(n,t)};var _e=function(s){return function(e,t,n){var r=g(e);var i=he(r.length);var a=pe(n,i);var o;if(s&&t!=t)while(i>a){o=r[a++];if(o!=o)return true}else for(;i>a;a++){if((s||a in r)&&r[a]===t)return s||a||0}return!s&&-1}};var ge={includes:_e(true),indexOf:_e(false)};var ye=ge.indexOf;var me=function(e,t){var n=g(e);var r=0;var i=[];var a;for(a in n)!z(Y,a)&&z(n,a)&&i.push(a);while(t.length>r)if(z(n,a=t[r++])){~ye(i,a)||i.push(a)}return i};var ke=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"];var be=ke.concat("length","prototype");var ze=Object.getOwnPropertyNames||function e(t){return me(t,be)};var xe={f:ze};var we=Object.getOwnPropertySymbols;var Se={f:we};var Me=se("Reflect","ownKeys")||function e(t){var n=xe.f(E(t));var r=Se.f;return r?n.concat(r(t)):n};var Oe=function(e,t){var n=Me(t);var r=A.f;var i=C.f;for(var a=0;a<n.length;a++){var o=n[a];if(!z(e,o))r(e,o,i(t,o))}};var Pe=/#|\.prototype\./;var Ce=function(e,t){var n=je[Ee(e)];return n==Ae?true:n==Le?false:typeof t=="function"?i(t):!!t};var Ee=Ce.normalize=function(e){return String(e).replace(Pe,".").toLowerCase()};var je=Ce.data={};var Le=Ce.NATIVE="N";var Ae=Ce.POLYFILL="P";var qe=Ce;var Be=C.f;var Ge=function(e,t){var n=e.target;var r=e.global;var i=e.stat;var a,o,s,u,c,f;if(r){o=l}else if(i){o=l[n]||B(n,{})}else{o=(l[n]||{}).prototype}if(o)for(s in t){c=t[s];if(e.noTargetGet){f=Be(o,s);u=f&&f.value}else u=o[s];a=qe(r?s:n+(i?".":"#")+s,e.forced);if(!a&&u!==undefined){if(typeof c===typeof u)continue;Oe(c,u)}if(e.sham||u&&u.sham){q(c,"sham",true)}ie(o,s,c,e)}};var Te=function(e){if(typeof e!="function"){throw TypeError(String(e)+" is not a function")}return e};var De=function(r,i,e){Te(r);if(i===undefined)return r;switch(e){case 0:return function(){return r.call(i)};case 1:return function(e){return r.call(i,e)};case 2:return function(e,t){return r.call(i,e,t)};case 3:return function(e,t,n){return r.call(i,e,t,n)}}return function(){return r.apply(i,arguments)}};var Ie=function(e){return Object(_(e))};var Re=Array.isArray||function e(t){return h(t)=="Array"};var We=!!Object.getOwnPropertySymbols&&!i(function(){return!String(Symbol())});var Ne=l.Symbol;var Ve=G("wks");var Fe=function(e){return Ve[e]||(Ve[e]=We&&Ne[e]||(We?Ne:N)("Symbol."+e))};var Ye=Fe("species");var Xe=function(e,t){var n;if(Re(e)){n=e.constructor;if(typeof n=="function"&&(n===Array||Re(n.prototype)))n=undefined;else if(y(n)){n=n[Ye];if(n===null)n=undefined}}return new(n===undefined?Array:n)(t===0?0:t)};var He=[].push;var Ue=function(d){var v=d==1;var p=d==2;var _=d==3;var g=d==4;var y=d==6;var m=d==5||y;return function(e,t,n,r){var i=Ie(e);var a=k(i);var o=De(t,n,3);var s=he(a.length);var u=0;var c=r||Xe;var f=v?c(e,s):p?c(e,0):undefined;var l,h;for(;s>u;u++)if(m||u in a){l=a[u];h=o(l,u,i);if(d){if(v)f[u]=h;else if(h)switch(d){case 3:return true;case 5:return l;case 6:return u;case 2:He.call(f,l)}else if(g)return false}}return y?-1:_||g?g:f}};var Je={forEach:Ue(0),map:Ue(1),filter:Ue(2),some:Ue(3),every:Ue(4),find:Ue(5),findIndex:Ue(6)};var Ke=Object.keys||function e(t){return me(t,ke)};var Ze=d?Object.defineProperties:function e(t,n){E(t);var r=Ke(n);var i=r.length;var a=0;var o;while(i>a)A.f(t,o=r[a++],n[o]);return t};var Qe=se("document","documentElement");var $e=F("IE_PROTO");var et="prototype";var tt=function(){};var nt=function(){var e=S("iframe");var t=ke.length;var n="<";var r="script";var i=">";var a="java"+r+":";var o;e.style.display="none";Qe.appendChild(e);e.src=String(a);o=e.contentWindow.document;o.open();o.write(n+r+i+"document.F=Object"+n+"/"+r+i);o.close();nt=o.F;while(t--)delete nt[et][ke[t]];return nt()};var rt=Object.create||function e(t,n){var r;if(t!==null){tt[et]=E(t);r=new tt;tt[et]=null;r[$e]=t}else r=nt();return n===undefined?r:Ze(r,n)};Y[$e]=true;var it=Fe("unscopables");var at=Array.prototype;if(at[it]==undefined){q(at,it,rt(null))}var ot=function(e){at[it][e]=true};var st=Je.find;var ut="find";var ct=true;if(ut in[])Array(1)[ut](function(){ct=false});Ge({target:"Array",proto:true,forced:ct},{find:function e(t){return st(this,t,arguments.length>1?arguments[1]:undefined)}});ot(ut);var ft=ge.includes;Ge({target:"Array",proto:true},{includes:function e(t){return ft(this,t,arguments.length>1?arguments[1]:undefined)}});ot("includes");var lt=Object.assign;var ht=!lt||i(function(){var e={};var t={};var n=Symbol();var r="abcdefghijklmnopqrst";e[n]=7;r.split("").forEach(function(e){t[e]=e});return lt({},e)[n]!=7||Ke(lt({},t)).join("")!=r})?function e(t,n){var r=Ie(t);var i=arguments.length;var a=1;var o=Se.f;var s=v.f;while(i>a){var u=k(arguments[a++]);var c=o?Ke(u).concat(o(u)):Ke(u);var f=c.length;var l=0;var h;while(f>l){h=c[l++];if(!d||s.call(u,h))r[h]=u[h]}}return r}:lt;Ge({target:"Object",stat:true,forced:Object.assign!==ht},{assign:ht});var dt=Fe("match");var vt=function(e){var t;return y(e)&&((t=e[dt])!==undefined?!!t:h(e)=="RegExp")};var pt=function(e){if(vt(e)){throw TypeError("The method doesn't accept regular expressions")}return e};var _t=Fe("match");var gt=function(t){var n=/./;try{"/./"[t](n)}catch(e){try{n[_t]=false;return"/./"[t](n)}catch(e){}}return false};var yt="".startsWith;var mt=Math.min;Ge({target:"String",proto:true,forced:!gt("startsWith")},{startsWith:function e(t){var n=String(_(this));pt(t);var r=he(mt(arguments.length>1?arguments[1]:undefined,n.length));var i=String(t);return yt?yt.call(n,i,r):n.slice(r,r+i.length)===i}});if(typeof window!=="undefined"){(function(){var r=function(e,t){var n=e.nodeType;if(n===3){t.push(e.textContent.replace(/&/,"&amp;").replace(/</,"&lt;").replace(">","&gt;"))}else if(n===1){t.push("<",e.tagName);if(e.hasAttributes()){[].forEach.call(e.attributes,function(e){t.push(" ",e.item.name,"='",e.item.value,"'")})}if(e.hasChildNodes()){t.push(">");[].forEach.call(e.childNodes,function(e){r(e,t)});t.push("</",e.tagName,">")}else{t.push("/>")}}else if(n==8){t.push("\x3c!--",e.nodeValue,"--\x3e")}};Object.defineProperty(SVGElement.prototype,"innerHTML",{get:function(){var e=[];var t=this.firstChild;while(t){r(t,e);t=t.nextSibling}return e.join("")},set:function(e){while(this.firstChild){this.removeChild(this.firstChild)}try{var t=new DOMParser;t.async=false;var n="<svg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'>"+e+"</svg>";var r=t.parseFromString(n,"text/xml").documentElement;var i=r.firstChild;while(i){this.appendChild(this.ownerDocument.importNode(i,true));i=i.nextSibling}}catch(e){}}});Object.defineProperty(SVGElement.prototype,"innerSVG",{get:function(){return this.innerHTML},set:function(e){this.innerHTML=e}})})()}});