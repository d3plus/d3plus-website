/*
  d3plus-network v0.5.6
  Javascript network visualizations built upon d3 modules.
  Copyright (c) 2019 D3plus - https://d3plus.org
  @license MIT
*/
if(typeof Object.assign!=="function"){Object.defineProperty(Object,"assign",{value:function e(t){"use strict";if(t===null){throw new TypeError("Cannot convert undefined or null to object")}var n=Object(t);for(var i=1;i<arguments.length;i++){var r=arguments[i];if(r!==null){for(var s in r){if(Object.prototype.hasOwnProperty.call(r,s)){n[s]=r[s]}}}}return n},writable:true,configurable:true})}if(!Array.prototype.includes){Object.defineProperty(Array.prototype,"includes",{value:function e(t,n){var i=Object(this);var r=i.length>>>0;if(r===0)return false;var s=n|0;var o=Math.max(s>=0?s:r-Math.abs(s),0);function a(e,t){return e===t||typeof e==="number"&&typeof t==="number"&&isNaN(e)&&isNaN(t)}while(o<r){if(a(i[o],t)){return true}o++}return false}})}if(!String.prototype.includes){Object.defineProperty(String.prototype,"includes",{value:function(e,t){if(typeof t!=="number"){t=0}if(t+e.length>this.length){return false}else{return this.indexOf(e,t)!==-1}}})}if(!Array.prototype.find){Object.defineProperty(Array.prototype,"find",{value:function(e){if(this==null){throw new TypeError('"this" is null or not defined')}var t=Object(this);var n=t.length>>>0;if(typeof e!=="function"){throw new TypeError("predicate must be a function")}var i=arguments[1];var r=0;while(r<n){var s=t[r];if(e.call(i,s,r,t)){return s}r++}return undefined},configurable:true,writable:true})}if(!String.prototype.startsWith){Object.defineProperty(String.prototype,"startsWith",{value:function(e,t){t=!t||t<0?0:+t;return this.substring(t,t+e.length)===e}})}if(typeof window!=="undefined"){(function(){var i=function(e,t){var n=e.nodeType;if(n===3){t.push(e.textContent.replace(/&/,"&amp;").replace(/</,"&lt;").replace(">","&gt;"))}else if(n===1){t.push("<",e.tagName);if(e.hasAttributes()){[].forEach.call(e.attributes,function(e){t.push(" ",e.item.name,"='",e.item.value,"'")})}if(e.hasChildNodes()){t.push(">");[].forEach.call(e.childNodes,function(e){i(e,t)});t.push("</",e.tagName,">")}else{t.push("/>")}}else if(n==8){t.push("\x3c!--",e.nodeValue,"--\x3e")}};Object.defineProperty(SVGElement.prototype,"innerHTML",{get:function(){var e=[];var t=this.firstChild;while(t){i(t,e);t=t.nextSibling}return e.join("")},set:function(e){while(this.firstChild){this.removeChild(this.firstChild)}try{var t=new DOMParser;t.async=false;var n="<svg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'>"+e+"</svg>";var i=t.parseFromString(n,"text/xml").documentElement;var r=i.firstChild;while(r){this.appendChild(this.ownerDocument.importNode(r,true));r=r.nextSibling}}catch(e){}}});Object.defineProperty(SVGElement.prototype,"innerSVG",{get:function(){return this.innerHTML},set:function(e){this.innerHTML=e}})})()}(function(e,t){typeof exports==="object"&&typeof module!=="undefined"?t(exports,require("d3-array"),require("d3-collection"),require("d3-scale"),require("d3-zoom"),require("d3plus-common"),require("d3plus-shape"),require("d3plus-viz"),require("d3plus-color"),require("d3-sankey")):typeof define==="function"&&define.amd?define("d3plus-network",["exports","d3-array","d3-collection","d3-scale","d3-zoom","d3plus-common","d3plus-shape","d3plus-viz","d3plus-color","d3-sankey"],t):t(e.d3plus={},e.d3Array,e.d3Collection,e.scales,e.d3Zoom,e.d3plusCommon,e.shapes,e.d3plusViz,e.d3plusColor,e.d3Sankey)})(this,function(e,I,N,W,c,R,V,s,X,t){"use strict";var n=function(j){function e(){var h=this;j.call(this);this._links=[];this._linkSize=R.constant(1);this._linkSizeMin=1;this._linkSizeScale="sqrt";this._noDataMessage=false;this._nodes=[];this._on["click.shape"]=function(e,t){h._tooltipClass.data([]).render();if(h._hover&&h._drawDepth>=h._groupBy.length-1){var n=""+(h._nodeGroupBy&&h._nodeGroupBy[h._drawDepth](e,t)?h._nodeGroupBy[h._drawDepth](e,t):h._id(e,t));if(h._focus&&h._focus===n){h.active(false);h._on.mouseenter.bind(h)(e,t);h._focus=undefined;h._zoomToBounds(null)}else{h.hover(false);var i=h._linkLookup[n],r=h._nodeLookup[n];var s=[n];var o=[r.x-r.r,r.x+r.r],a=[r.y-r.r,r.y+r.r];i.forEach(function(e){s.push(e.id);if(e.x-e.r<o[0]){o[0]=e.x-e.r}if(e.x+e.r>o[1]){o[1]=e.x+e.r}if(e.y-e.r<a[0]){a[0]=e.y-e.r}if(e.y+e.r>a[1]){a[1]=e.y+e.r}});h.active(function(e,t){if(e.source&&e.target){return e.source.id===n||e.target.id===n}else{return s.includes(""+h._ids(e,t)[h._drawDepth])}});h._focus=n;var u=c.zoomTransform(h._container.node());o=o.map(function(e){return e*u.k+u.x});a=a.map(function(e){return e*u.k+u.y});h._zoomToBounds([[o[0],a[0]],[o[1],a[1]]])}}};this._on["click.legend"]=function(e,t){var n=h._id(e);var i=h._ids(e);i=i[i.length-1];if(h._hover&&h._drawDepth>=h._groupBy.length-1){if(h._focus&&h._focus===n){h.active(false);h._focus=undefined;h._zoomToBounds(null)}else{h.hover(false);var r=n.map(function(e){return h._nodeLookup[e]});var s=[""+i];var o=[r[0].x-r[0].r,r[0].x+r[0].r],a=[r[0].y-r[0].r,r[0].y+r[0].r];r.forEach(function(e){s.push(e.id);if(e.x-e.r<o[0]){o[0]=e.x-e.r}if(e.x+e.r>o[1]){o[1]=e.x+e.r}if(e.y-e.r<a[0]){a[0]=e.y-e.r}if(e.y+e.r>a[1]){a[1]=e.y+e.r}});h.active(function(e,t){if(e.source&&e.target){return s.includes(e.source.id)&&s.includes(e.target.id)}else{var n=h._ids(e,t);return s.includes(""+n[n.length-1])}});h._focus=n;var u=c.zoomTransform(h._container.node());o=o.map(function(e){return e*u.k+u.x});a=a.map(function(e){return e*u.k+u.y});h._zoomToBounds([[o[0],a[0]],[o[1],a[1]]])}h._on.mouseenter.bind(h)(e,t);h._on["mousemove.legend"].bind(h)(e,t)}};this._on.mouseenter=function(){};this._on["mouseleave.shape"]=function(){h.hover(false)};var u=this._on["mousemove.shape"];this._on["mousemove.shape"]=function(e,t){u(e,t);var n=""+(h._nodeGroupBy&&h._nodeGroupBy[h._drawDepth](e,t)?h._nodeGroupBy[h._drawDepth](e,t):h._id(e,t)),i=h._linkLookup[n],r=h._nodeLookup[n];var s=[n];var o=[r.x-r.r,r.x+r.r],a=[r.y-r.r,r.y+r.r];i.forEach(function(e){s.push(e.id);if(e.x-e.r<o[0]){o[0]=e.x-e.r}if(e.x+e.r>o[1]){o[1]=e.x+e.r}if(e.y-e.r<a[0]){a[0]=e.y-e.r}if(e.y+e.r>a[1]){a[1]=e.y+e.r}});h.hover(function(e,t){if(e.source&&e.target){return e.source.id===n||e.target.id===n}else{return s.includes(""+h._ids(e,t)[h._drawDepth])}})};this._sizeMin=5;this._sizeScale="sqrt";this._shape=R.constant("Circle");this._shapeConfig=R.assign(this._shapeConfig,{ariaLabel:function(e,t){var n=h._size?", "+h._size(e,t):"";return""+h._drawLabel(e,t)+n+"."},labelConfig:{duration:0,fontMin:1,fontResize:true,labelPadding:0,textAnchor:"middle",verticalAlign:"middle"},Path:{fill:"none",label:false,stroke:"#eee"}});this._x=R.accessor("x");this._y=R.accessor("y");this._zoom=true}if(j)e.__proto__=j;e.prototype=Object.create(j&&j.prototype);e.prototype.constructor=e;e.prototype._draw=function e(t){var r=this;j.prototype._draw.call(this,t);var n=this._height-this._margin.top-this._margin.bottom,i="translate("+this._margin.left+", "+this._margin.top+")",s=this._transition,o=this._width-this._margin.left-this._margin.right;var a=this._filteredData.reduce(function(e,t,n){e[r._id(t,n)]=t;return e},{});var u=this._nodes.reduce(function(e,t,n){e[r._nodeGroupBy?r._nodeGroupBy[r._drawDepth](t,n):r._id(t,n)]=t;return e},{});u=Array.from(new Set(Object.keys(a).concat(Object.keys(u)))).map(function(e,t){var n=a[e],i=u[e];if(i===undefined){return false}return{__d3plus__:true,data:n||i,i:t,id:e,fx:n!==undefined&&r._x(n)!==undefined?r._x(n):r._x(i),fy:n!==undefined&&r._y(n)!==undefined?r._y(n):r._y(i),node:i,r:r._size?n!==undefined&&r._size(n)!==undefined?r._size(n):r._size(i):r._sizeMin,shape:n!==undefined&&r._shape(n)!==undefined?r._shape(n):r._shape(i)}}).filter(function(e){return e});var h=I.extent(u.map(function(e){return e.fx})),c=I.extent(u.map(function(e){return e.fy}));var f=W.scaleLinear().domain(h).range([0,o]),d=W.scaleLinear().domain(c).range([0,n]);var l=(h[1]-h[0])/(c[1]-c[0]),_=o/n;if(l>_){var p=n*_/l;d.range([(n-p)/2,n-(n-p)/2])}else{var g=o*l/_;f.range([(o-g)/2,o-(o-g)/2])}u.forEach(function(e){e.x=f(e.fx);e.y=d(e.fy)});var v=I.extent(u.map(function(e){return e.r}));var y=this._sizeMax||I.min(I.merge(u.map(function(t){return u.map(function(e){return t===e?null:V.pointDistance([t.x,t.y],[e.x,e.y])})})))/2;var m=W["scale"+this._sizeScale.charAt(0).toUpperCase()+this._sizeScale.slice(1)]().domain(v).range([v[0]===v[1]?y:I.min([y/2,this._sizeMin]),y]),k=f.domain(),z=d.domain();var x=k[1]-k[0],b=z[1]-z[0];u.forEach(function(e){var t=m(e.r);if(k[0]>f.invert(e.x-t)){k[0]=f.invert(e.x-t)}if(k[1]<f.invert(e.x+t)){k[1]=f.invert(e.x+t)}if(z[0]>d.invert(e.y-t)){z[0]=d.invert(e.y-t)}if(z[1]<d.invert(e.y+t)){z[1]=d.invert(e.y+t)}});var w=k[1]-k[0],S=z[1]-z[0];y*=I.min([x/w,b/S]);m.range([v[0]===v[1]?y:I.min([y/2,this._sizeMin]),y]);f.domain(k);d.domain(z);u.forEach(function(e){e.x=f(e.fx);e.fx=e.x;e.y=d(e.fy);e.fy=e.y;e.r=m(e.r);e.width=e.r*2;e.height=e.r*2});var M=this._nodeLookup=u.reduce(function(e,t){e[t.id]=t;return e},{});var C=u.map(function(e){return e.node});var L=this._links.map(function(e){return{size:r._linkSize(e),source:typeof e.source==="number"?u[C.indexOf(r._nodes[e.source])]:M[e.source.id],target:typeof e.target==="number"?u[C.indexOf(r._nodes[e.target])]:M[e.target.id]}});this._linkLookup=L.reduce(function(e,t){if(!e[t.source.id]){e[t.source.id]=[]}e[t.source.id].push(t.target);if(!e[t.target.id]){e[t.target.id]=[]}e[t.target.id].push(t.source);return e},{});this._container=this._select.selectAll("svg.d3plus-network").data([0]);this._container=this._container.enter().append("svg").attr("class","d3plus-network").attr("opacity",0).attr("width",o).attr("height",n).attr("x",this._margin.left).attr("y",this._margin.top).style("background-color","transparent").merge(this._container);this._container.transition(this._transition).attr("opacity",1).attr("width",o).attr("height",n).attr("x",this._margin.left).attr("y",this._margin.top);var P=this._container.selectAll("rect.d3plus-network-hitArea").data([0]);P.enter().append("rect").attr("class","d3plus-network-hitArea").merge(P).attr("width",o).attr("height",n).attr("fill","transparent").on("click",function(){if(r._focus){r.active(false);r._focus=undefined;r._zoomToBounds(null)}});this._zoomGroup=this._container.selectAll("g.d3plus-network-zoomGroup").data([0]);var B=this._zoomGroup=this._zoomGroup.enter().append("g").attr("class","d3plus-network-zoomGroup").merge(this._zoomGroup);var q=I.extent(L,function(e){return e.size});if(q[0]!==q[1]){var A=W["scale"+this._linkSizeScale.charAt(0).toUpperCase()+this._linkSizeScale.slice(1)]().domain(q).range([this._linkSizeMin,m.range()[0]]);L.forEach(function(e){e.size=A(e.size)})}var E=R.configPrep.bind(this)(this._shapeConfig,"edge","Path");delete E.on;this._shapes.push((new V.Path).config(E).strokeWidth(function(e){return e.size}).activeStyle({"stroke-width":function(e){return e.size}}).d(function(e){return"M"+e.source.x+","+e.source.y+" "+e.target.x+","+e.target.y}).data(L).select(R.elem("g.d3plus-network-links",{parent:B,transition:s,enter:{transform:i},update:{transform:i}}).node()).render());var O={label:function(e){return u.length<=r._dataCutoff||(r._hover&&r._hover(e)||r._active&&r._active(e))?r._drawLabel(e.data||e.node,e.i):false},select:R.elem("g.d3plus-network-nodes",{parent:B,transition:s,enter:{transform:i},update:{transform:i}}).node()};N.nest().key(function(e){return e.shape}).entries(u).forEach(function(e){r._shapes.push((new V[e.key]).config(R.configPrep.bind(r)(r._shapeConfig,"shape",e.key)).config(O).config(O[e.key]||{}).data(e.values).render())});return this};e.prototype.hover=function e(t){this._hover=t;if(this._nodes.length<this._dataCutoff){this._shapes.forEach(function(e){return e.hover(t)});if(this._legend){this._legendClass.hover(t)}}return this};e.prototype.links=function e(t,n){if(arguments.length){var i=this._queue.find(function(e){return e[3]==="links"});var r=[s.dataLoad.bind(this),t,n,"links"];if(i){this._queue[this._queue.indexOf(i)]=r}else{this._queue.push(r)}return this}return this._links};e.prototype.linkSize=function e(t){return arguments.length?(this._linkSize=typeof t==="function"?t:R.constant(t),this):this._linkSize};e.prototype.linkSizeMin=function e(t){return arguments.length?(this._linkSizeMin=t,this):this._linkSizeMin};e.prototype.linkSizeScale=function e(t){return arguments.length?(this._linkSizeScale=t,this):this._linkSizeScale};e.prototype.nodeGroupBy=function e(t){var n=this;if(!arguments.length){return this._nodeGroupBy}if(!(t instanceof Array)){t=[t]}return this._nodeGroupBy=t.map(function(e){if(typeof e==="function"){return e}else{if(!n._aggs[e]){n._aggs[e]=function(e){var t=Array.from(new Set(e));return t.length===1?t[0]:t}}return R.accessor(e)}}),this};e.prototype.nodes=function e(t,n){if(arguments.length){var i=this._queue.find(function(e){return e[3]==="nodes"});var r=[s.dataLoad.bind(this),t,n,"nodes"];if(i){this._queue[this._queue.indexOf(i)]=r}else{this._queue.push(r)}return this}return this._nodes};e.prototype.size=function e(t){return arguments.length?(this._size=typeof t==="function"||!t?t:R.accessor(t),this):this._size};e.prototype.sizeMax=function e(t){return arguments.length?(this._sizeMax=t,this):this._sizeMax};e.prototype.sizeMin=function e(t){return arguments.length?(this._sizeMin=t,this):this._sizeMin};e.prototype.sizeScale=function e(t){return arguments.length?(this._sizeScale=t,this):this._sizeScale};e.prototype.x=function e(t){if(arguments.length){if(typeof t==="function"){this._x=t}else{this._x=R.accessor(t);if(!this._aggs[t]){this._aggs[t]=function(e){return I.mean(e)}}}return this}else{return this._x}};e.prototype.y=function e(t){if(arguments.length){if(typeof t==="function"){this._y=t}else{this._y=R.accessor(t);if(!this._aggs[t]){this._aggs[t]=function(e){return I.mean(e)}}}return this}else{return this._y}};return e}(s.Viz);var i=function(T){function e(){var u=this;T.call(this);this._links=[];this._linkSize=R.constant(1);this._linkSizeMin=1;this._linkSizeScale="sqrt";this._noDataMessage=false;this._nodes=[];this._on.mouseenter=function(){};this._on["mouseleave.shape"]=function(){u.hover(false)};var h=this._on["mousemove.shape"];this._on["mousemove.shape"]=function(e,t){h(e,t);if(u._focus&&u._focus===e.id){u.hover(false);u._on.mouseenter.bind(u)(e,t);u._focus=undefined}else{var n=u._nodeGroupBy&&u._nodeGroupBy[u._drawDepth](e,t)?u._nodeGroupBy[u._drawDepth](e,t):u._id(e,t),i=u._linkLookup[n],r=u._nodeLookup[n];var s=[r.id];var o=[r.x-r.r,r.x+r.r],a=[r.y-r.r,r.y+r.r];i.forEach(function(e){s.push(e.id);if(e.x-e.r<o[0]){o[0]=e.x-e.r}if(e.x+e.r>o[1]){o[1]=e.x+e.r}if(e.y-e.r<a[0]){a[0]=e.y-e.r}if(e.y+e.r>a[1]){a[1]=e.y+e.r}});u.hover(function(e,t){if(e.source&&e.target){return e.source.id===r.id||e.target.id===r.id}else{return s.includes(u._ids(e,t)[u._drawDepth])}})}};this._on["click.shape"]=function(e){u._center=e.id;u._draw()};this._sizeMin=5;this._sizeScale="sqrt";this._shape=R.constant("Circle");this._shapeConfig=R.assign(this._shapeConfig,{ariaLabel:function(e,t){var n=u._size?", "+u._size(e,t):"";return""+u._drawLabel(e,t)+n+"."},labelConfig:{duration:0,fontMin:1,fontResize:true,labelPadding:0,textAnchor:"middle",verticalAlign:"middle"},Path:{fill:"none",label:false,stroke:"#eee",strokeWidth:1}})}if(T)e.__proto__=T;e.prototype=Object.create(T&&T.prototype);e.prototype.constructor=e;e.prototype._draw=function e(t){var h=this;T.prototype._draw.call(this,t);var r=this._filteredData.reduce(function(e,t,n){e[h._id(t,n)]=t;return e},{});var c=this._nodes;if(!this._nodes.length&&this._links.length){var n=Array.from(new Set(this._links.reduce(function(e,t){return e.concat([t.source,t.target])},[])));c=n.map(function(e){return typeof e==="object"?e:{id:e}})}c=c.reduce(function(e,t,n){e[h._nodeGroupBy?h._nodeGroupBy[h._drawDepth](t,n):h._id(t,n)]=t;return e},{});c=Array.from(new Set(Object.keys(r).concat(Object.keys(c)))).map(function(e,t){var n=r[e],i=c[e];if(i===undefined){return false}return{__d3plus__:true,data:n||i,i:t,id:e,node:i,shape:n!==undefined&&h._shape(n)!==undefined?h._shape(n):h._shape(i)}}).filter(function(e){return e});var i=this._nodeLookup=c.reduce(function(e,t){e[t.id]=t;return e},{});var s=this._links.map(function(n){var e=["source","target"];var t=e.reduce(function(e,t){e[t]=typeof n[t]==="number"?c[n[t]]:i[n[t].id||n[t]];return e},{});t.size=h._linkSize(n);return t});var o=s.reduce(function(e,t){if(!e[t.source.id]){e[t.source.id]=[]}e[t.source.id].push(t);if(!e[t.target.id]){e[t.target.id]=[]}e[t.target.id].push(t);return e},{});var f=this._height-this._margin.top-this._margin.bottom,a="translate("+this._margin.left+", "+this._margin.top+")",u=this._transition,d=this._width-this._margin.left-this._margin.right;var l=[],_=I.min([f,d])/2,p=_/3;var g=p,v=p*2;var y=i[this._center];y.x=d/2;y.y=f/2;y.r=this._sizeMin?I.max([this._sizeMin,g*.65]):this._sizeMax?I.min([this._sizeMax,g*.65]):g*.65;var m=[y],k=[];o[this._center].forEach(function(e){var t=e.source.id===h._center?e.target:e.source;t.edges=o[t.id].filter(function(e){return e.source.id!==h._center||e.target.id!==h._center});t.edge=e;m.push(t);k.push(t)});k.sort(function(e,t){return e.edges.length-t.edges.length});var z=[];var x=0;k.forEach(function(e){var r=e.id;e.edges=e.edges.filter(function(e){return!m.includes(e.source)&&e.target.id===r||!m.includes(e.target)&&e.source.id===r});x+=e.edges.length||1;e.edges.forEach(function(e){var t=e.source;var n=e.target;var i=n.id===r?t:n;m.push(i)})});var b=Math.PI*2;var w=0;k.forEach(function(s,e){var o=s.edges.length||1;var t=b/x*o;if(e===0){w-=t/2}var a=w+t/2-b/4;s.radians=a;s.x=d/2+g*Math.cos(a);s.y=f/2+g*Math.sin(a);w+=t;s.edges.forEach(function(e,t){var n=e.source.id===s.id?e.target:e.source;var i=b/x;var r=a-i*o/2+i/2+i*t;n.radians=r;n.x=d/2+v*Math.cos(r);n.y=f/2+v*Math.sin(r);z.push(n)})});var S=p/2;var M=p/4;var C=S/2-4;if(S/2-4<8){C=I.min([S/2,8])}var L=M/2-4;if(M/2-4<4){L=I.min([M/2,4])}if(L>p/10){L=p/10}if(L>C&&L>10){L=C*.75}if(C>L*1.5){C=L*1.5}C=Math.floor(C);L=Math.floor(L);var P;if(this._size){var B=I.extent(r,function(e){return e.size});if(B[0]===B[1]){B[0]=0}P=W.scaleLinear().domain(B).rangeRound([3,I.min([C,L])]);var q=y.size;y.r=P(q)}else{P=W.scaleLinear().domain([1,2]).rangeRound([C,L])}z.forEach(function(e){e.ring=2;var t=h._size?e.size:2;e.r=h._sizeMin?I.max([h._sizeMin,P(t)]):h._sizeMax?I.min([h._sizeMax,P(t)]):P(t)});k.forEach(function(e){e.ring=1;var t=h._size?e.size:1;e.r=h._sizeMin?I.max([h._sizeMin,P(t)]):h._sizeMax?I.min([h._sizeMax,P(t)]):P(t)});c=[y].concat(k).concat(z);k.forEach(function(u){var e=["source","target"];var n=u.edge;e.forEach(function(t){n[t]=c.find(function(e){return e.id===n[t].id})});l.push(n);o[u.id].forEach(function(i){var t=i.source.id===u.id?i.target:i.source;if(t.id!==y.id){var r=z.find(function(e){return e.id===t.id});if(!r){r=k.find(function(e){return e.id===t.id})}if(r){i.spline=true;var s=d/2;var o=f/2;var a=g+(v-g)*.5;var e=["source","target"];e.forEach(function(t,e){i[t+"X"]=i[t].x+Math.cos(i[t].ring===2?i[t].radians+Math.PI:i[t].radians)*i[t].r;i[t+"Y"]=i[t].y+Math.sin(i[t].ring===2?i[t].radians+Math.PI:i[t].radians)*i[t].r;i[t+"BisectX"]=s+a*Math.cos(i[t].radians);i[t+"BisectY"]=o+a*Math.sin(i[t].radians);i[t]=c.find(function(e){return e.id===i[t].id});if(i[t].edges===undefined){i[t].edges={}}var n=e===0?i.target.id:i.source.id;if(i[t].id===u.id){i[t].edges[n]={angle:u.radians+Math.PI,radius:p/2}}else{i[t].edges[n]={angle:r.radians,radius:p/2}}});l.push(i)}}})});c.forEach(function(e){if(e.id!==h._center){var t=h._shapeConfig.labelConfig.fontSize&&h._shapeConfig.labelConfig.fontSize(e)||11;var n=t*1.4;var i=n*2;var r=5;var s=p-e.r;var o=e.radians*(180/Math.PI);var a=e.r+r;var u="start";if(o<-90||o>90){a=-e.r-s-r;u="end";o+=180}e.labelBounds={x:a,y:-n/2,width:s,height:i};e.rotate=o;e.textAnchor=u}else{e.labelBounds={x:-g/2,y:-g/2,width:g,height:g}}});this._linkLookup=s.reduce(function(e,t){if(!e[t.source.id]){e[t.source.id]=[]}e[t.source.id].push(t.target);if(!e[t.target.id]){e[t.target.id]=[]}e[t.target.id].push(t.source);return e},{});var A=I.extent(s,function(e){return e.size});if(A[0]!==A[1]){var E=I.min(c,function(e){return e.r});var O=W["scale"+this._linkSizeScale.charAt(0).toUpperCase()+this._linkSizeScale.slice(1)]().domain(A).range([this._linkSizeMin,E]);s.forEach(function(e){e.size=O(e.size)})}var j=R.configPrep.bind(this)(this._shapeConfig,"edge","Path");delete j.on;this._shapes.push((new V.Path).config(j).strokeWidth(function(e){return e.size}).id(function(e){return e.source.id+"_"+e.target.id}).d(function(e){return e.spline?"M"+e.sourceX+","+e.sourceY+"C"+e.sourceBisectX+","+e.sourceBisectY+" "+e.targetBisectX+","+e.targetBisectY+" "+e.targetX+","+e.targetY:"M"+e.source.x+","+e.source.y+" "+e.target.x+","+e.target.y}).data(l).select(R.elem("g.d3plus-rings-links",{parent:this._select,transition:u,enter:{transform:a},update:{transform:a}}).node()).render());var G=this;var D={label:function(e){return c.length<=h._dataCutoff||(h._hover&&h._hover(e)||h._active&&h._active(e))?h._drawLabel(e.data||e.node,e.i):false},labelBounds:function(e){return e.labelBounds},labelConfig:{fontColor:function(e){return e.id===h._center?R.configPrep.bind(G)(G._shapeConfig,"shape",e.key).labelConfig.fontColor(e):X.colorLegible(R.configPrep.bind(G)(G._shapeConfig,"shape",e.key).fill(e))},fontResize:function(e){return e.id===h._center},padding:0,textAnchor:function(e){return i[e.id].textAnchor||R.configPrep.bind(G)(G._shapeConfig,"shape",e.key).labelConfig.textAnchor},verticalAlign:function(e){return e.id===h._center?"middle":"top"}},rotate:function(e){return i[e.id].rotate||0},select:R.elem("g.d3plus-rings-nodes",{parent:this._select,transition:u,enter:{transform:a},update:{transform:a}}).node()};N.nest().key(function(e){return e.shape}).entries(c).forEach(function(e){h._shapes.push((new V[e.key]).config(R.configPrep.bind(h)(h._shapeConfig,"shape",e.key)).config(D).data(e.values).render())});return this};e.prototype.center=function e(t){return arguments.length?(this._center=t,this):this._center};e.prototype.hover=function e(t){this._hover=t;this._shapes.forEach(function(e){return e.hover(t)});if(this._legend){this._legendClass.hover(t)}return this};e.prototype.links=function e(t,n){if(arguments.length){var i=this._queue.find(function(e){return e[3]==="links"});var r=[s.dataLoad.bind(this),t,n,"links"];if(i){this._queue[this._queue.indexOf(i)]=r}else{this._queue.push(r)}return this}return this._links};e.prototype.linkSize=function e(t){return arguments.length?(this._linkSize=typeof t==="function"?t:R.constant(t),this):this._linkSize};e.prototype.linkSizeMin=function e(t){return arguments.length?(this._linkSizeMin=t,this):this._linkSizeMin};e.prototype.linkSizeScale=function e(t){return arguments.length?(this._linkSizeScale=t,this):this._linkSizeScale};e.prototype.nodeGroupBy=function e(t){var n=this;if(!arguments.length){return this._nodeGroupBy}if(!(t instanceof Array)){t=[t]}return this._nodeGroupBy=t.map(function(e){if(typeof e==="function"){return e}else{if(!n._aggs[e]){n._aggs[e]=function(e){var t=Array.from(new Set(e));return t.length===1?t[0]:t}}return R.accessor(e)}}),this};e.prototype.nodes=function e(t,n){if(arguments.length){var i=this._queue.find(function(e){return e[3]==="nodes"});var r=[s.dataLoad.bind(this),t,n,"nodes"];if(i){this._queue[this._queue.indexOf(i)]=r}else{this._queue.push(r)}return this}return this._nodes};e.prototype.size=function e(t){return arguments.length?(this._size=typeof t==="function"||!t?t:R.accessor(t),this):this._size};e.prototype.sizeMax=function e(t){return arguments.length?(this._sizeMax=t,this):this._sizeMax};e.prototype.sizeMin=function e(t){return arguments.length?(this._sizeMin=t,this):this._sizeMin};e.prototype.sizeScale=function e(t){return arguments.length?(this._sizeScale=t,this):this._sizeScale};return e}(s.Viz);var r={center:t.sankeyCenter,justify:t.sankeyJustify,left:t.sankeyLeft,right:t.sankeyRight};var o=function(h){function e(){var a=this;h.call(this);this._nodeId=R.accessor("id");this._links=R.accessor("links");this._noDataMessage=false;this._nodes=R.accessor("nodes");this._nodeAlign=r.justify;this._nodePadding=8;this._nodeWidth=30;this._on.mouseenter=function(){};this._on["mouseleave.shape"]=function(){a.hover(false)};var u=this._on["mousemove.shape"];this._on["mousemove.shape"]=function(e,t){u(e,t);if(a._focus&&a._focus===e.id){a.hover(false);a._on.mouseenter.bind(a)(e,t);a._focus=undefined}else{var n=a._nodeId(e,t),i=a._nodeLookup[n],r=Object.keys(a._nodeLookup).reduce(function(e,t){e[a._nodeLookup[t]]=!isNaN(t)?parseInt(t,10):t;return e},{});var s=a._linkLookup[i];var o=[n];s.forEach(function(e){o.push(r[e])});a.hover(function(e,t){if(e.source&&e.target){return e.source.id===n||e.target.id===n}else{return o.includes(a._nodeId(e,t))}})}};this._path=t.sankeyLinkHorizontal();this._sankey=t.sankey();this._shape=R.constant("Rect");this._shapeConfig=R.assign(this._shapeConfig,{Path:{fill:"none",hoverStyle:{"stroke-width":function(e){return Math.max(1,Math.abs(e.source.y1-e.source.y0)*(e.value/e.source.value)-2)}},label:false,stroke:"#DBDBDB",strokeOpacity:.5,strokeWidth:function(e){return Math.max(1,Math.abs(e.source.y1-e.source.y0)*(e.value/e.source.value)-2)}},Rect:{}});this._value=R.constant(1)}if(h)e.__proto__=h;e.prototype=Object.create(h&&h.prototype);e.prototype.constructor=e;e.prototype._draw=function e(t){var r=this;h.prototype._draw.call(this,t);var n=this._height-this._margin.top-this._margin.bottom,i=this._width-this._margin.left-this._margin.right;var s=this._nodes.map(function(e,t){return{__d3plus__:true,data:e,i:t,id:r._nodeId(e,t),node:e,shape:"Rect"}});var o=this._nodeLookup=s.reduce(function(e,t,n){e[t.id]=n;return e},{});var a=this._links.map(function(n,e){var t=["source","target"];var i=t.reduce(function(e,t){e[t]=typeof n[t]==="number"?o[n[t]]:o[n[t]];return e},{});return{source:i.source,target:i.target,value:r._value(n,e)}});this._linkLookup=a.reduce(function(e,t){if(!e[t.source]){e[t.source]=[]}e[t.source].push(t.target);if(!e[t.target]){e[t.target]=[]}e[t.target].push(t.source);return e},{});var u="translate("+this._margin.left+", "+this._margin.top+")";this._sankey.nodeAlign(this._nodeAlign).nodePadding(this._nodePadding).nodeWidth(this._nodeWidth).nodes(s).links(a).size([i,n])();this._shapes.push((new V.Path).config(this._shapeConfig.Path).data(a).d(this._path).select(R.elem("g.d3plus-Links",{parent:this._select,enter:{transform:u},update:{transform:u}}).node()).render());N.nest().key(function(e){return e.shape}).entries(s).forEach(function(e){r._shapes.push((new V[e.key]).data(e.values).height(function(e){return e.y1-e.y0}).width(function(e){return e.x1-e.x0}).x(function(e){return(e.x1+e.x0)/2}).y(function(e){return(e.y1+e.y0)/2}).select(R.elem("g.d3plus-sankey-nodes",{parent:r._select,enter:{transform:u},update:{transform:u}}).node()).config(R.configPrep.bind(r)(r._shapeConfig,"shape",e.key)).render())});return this};e.prototype.hover=function e(t){this._hover=t;this._shapes.forEach(function(e){return e.hover(t)});if(this._legend){this._legendClass.hover(t)}return this};e.prototype.links=function e(t,n){if(arguments.length){var i=this._queue.find(function(e){return e[3]==="links"});var r=[s.dataLoad.bind(this),t,n,"links"];if(i){this._queue[this._queue.indexOf(i)]=r}else{this._queue.push(r)}return this}return this._links};e.prototype.nodeAlign=function e(t){return arguments.length?(this._nodeAlign=typeof t==="function"?t:r[t],this):this._nodeAlign};e.prototype.nodeId=function e(t){return arguments.length?(this._nodeId=typeof t==="function"?t:R.accessor(t),this):this._nodeId};e.prototype.nodes=function e(t,n){if(arguments.length){var i=this._queue.find(function(e){return e[3]==="nodes"});var r=[s.dataLoad.bind(this),t,n,"nodes"];if(i){this._queue[this._queue.indexOf(i)]=r}else{this._queue.push(r)}return this}return this._nodes};e.prototype.nodePadding=function e(t){return arguments.length?(this._nodePadding=t,this):this._nodePadding};e.prototype.nodeWidth=function e(t){return arguments.length?(this._nodeWidth=t,this):this._nodeWidth};e.prototype.value=function e(t){return arguments.length?(this._value=typeof t==="function"?t:R.accessor(t),this):this._value};return e}(s.Viz);e.Network=n;e.Rings=i;e.Sankey=o;Object.defineProperty(e,"__esModule",{value:true})});