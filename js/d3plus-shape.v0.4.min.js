!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("d3-selection"),require("d3-transition"),require("d3plus-text"),require("d3plus-color")):"function"==typeof define&&define.amd?define("d3plus-shape",["exports","d3-selection","d3-transition","d3plus-text","d3plus-color"],n):n(t.d3plus_shape=t.d3plus_shape||{},t.d3_selection,t.d3_transition,t.d3plus_text,t.d3plus_color)}(this,function(t,n,e,r,i){"use strict";function o(t){return function(){return t}}function u(t){return t.height}function c(t){return t.url}function f(t){return t.width}function a(t){return t.x||0}function l(t){return t.y||0}function h(t){function n(o){void 0===e&&n.select(m.select("body").append("svg").style("width",window.innerWidth+"px").style("height",window.innerHeight+"px").style("display","block").node());var u=e.selectAll(".d3plus-shape-image").data(t,h),c=u.enter().append("image").attr("class","d3plus-shape-image").attr("opacity",0),f=c.merge(u);return f.attr("xlink:href",s).transition().duration(r).attr("opacity",1).attr("width",function(t,n){return d(t,n)}).attr("height",function(t,n){return i(t,n)}).attr("x",function(t,n){return g(t,n)}).attr("y",function(t,n){return p(t,n)}).each(function(t,n){var e=m.select(this),r=s(t,n),i=0===r.indexOf("http://")||0===r.indexOf("https://");if(!i||0===r.indexOf(window.location.hostname)){var o=new Image;o.src=r,o.crossOrigin="Anonymous",o.onload=function(){var t=document.createElement("canvas");t.width=this.width,t.height=this.height;var n=t.getContext("2d");n.drawImage(this,0,0),e.attr("xlink:href",t.toDataURL("image/png"))}}}),u.exit().transition().duration(r).attr("width",function(t,n){return d(t,n)}).attr("height",function(t,n){return i(t,n)}).attr("x",function(t,n){return g(t,n)}).attr("y",function(t,n){return p(t,n)}).attr("opacity",0).remove(),o&&setTimeout(o,r+100),n}void 0===t&&(t=[]);var e,r=600,i=u,h=c,s=c,d=f,g=a,p=l;return n.data=function(e){return arguments.length?(t=e,n):t},n.duration=function(t){return arguments.length?(r=t,n):r},n.height=function(t){return arguments.length?(i="function"==typeof t?t:o(t),n):i},n.id=function(t){return arguments.length?(h=t,n):h},n.select=function(t){return arguments.length?(e=m.select(t),n):e},n.url=function(t){return arguments.length?(s=t,n):s},n.width=function(t){return arguments.length?(d="function"==typeof t?t:o(t),n):d},n.x=function(t){return arguments.length?(g="function"==typeof t?t:o(t),n):g},n.y=function(t){return arguments.length?(p="function"==typeof t?t:o(t),n):p},t.length?n():n}function s(t){return t.height}function d(t){return t.id}function g(t){return{width:t.width,height:t.height,x:-t.width/2,y:-t.height/2}}function p(t){return t.width}function y(t){return t.x}function x(t){return t.y}function v(t){function n(t,n){return i.contrast(m(t,n))}function e(n){function i(t,n){void 0===n&&(n=!0),t.attr("width",n?function(t,n){return W(t,n)}:0).attr("height",n?function(t,n){return _(t,n)}:0).attr("x",n?function(t,n){return-W(t,n)/2}:0).attr("y",n?function(t,n){return-_(t,n)/2}:0).attr("fill",function(t,n){return m(t,n)}).attr("stroke",function(t,n){return C(t,n)}).attr("stroke-width",function(t,n){return F(t,n)})}function o(t,n){void 0===n&&(n=!0),t.each(function(t,e){var i=_(t,e),o=W(t,e),a=n?v(t,e):!1;h().data(a?[{url:a}]:[]).duration(w).height(n?i:0).select(this).width(n?o:0).x(n?-o/2:0).y(n?-i/2:0)();var l=[],s=n?q(t,e):!1;if(s){var d=O({width:o,height:i},e),g=H(t,e);d.height-=2*g,d.width-=2*g,d.x+=g,d.y+=g,l.push(d)}r.box().data(l).delay(w/2).duration(w).fontColor(k(t,e)).fontFamily(u(t,e)).fontResize(A(t,e)).fontSize(c(t,e)).lineHeight(f(t,e)).textAnchor(I(t,e)).verticalAlign(R(t,e)).select(this).text(q(t,e))()})}void 0===a&&e.select(b.select("body").append("svg").style("width",window.innerWidth+"px").style("height",window.innerHeight+"px").style("display","block").node()),void 0===f&&(f=function(t,n){return 1.1*c(t,n)});var s=a.selectAll(".d3plus-shape-rect").data(t,z);s.transition().duration(w).attr("transform",function(t,n){return"translate("+j(t,n)+","+S(t,n)+")"}),s.exit().transition().delay(w).remove(),s.exit().selectAll("rect").transition().duration(w).attr("width",0).attr("height",0).attr("x",0).attr("y",0),s.exit().call(o,!1);var d=s.enter().append("g").attr("class","d3plus-shape-rect").attr("id",function(t,n){return"d3plus-shape-rect-"+z(t,n)}).attr("transform",function(t,n){return"translate("+j(t,n)+","+S(t,n)+")"});d.append("rect").call(i,!1);var g=d.merge(s);g.selectAll("rect").transition().duration(w).call(i),g.call(o);for(var p=Object.keys(l),y=0;y<p.length;y++)g.on(p[y],l[p[y]]);return n&&setTimeout(n,w+100),e}void 0===t&&(t=[]);var u,c,f,a,l={},v=o(!1),w=600,m=o("black"),k=n,A=o(!1),_=s,z=d,O=g,q=o(!1),H=o(5),C=o("black"),F=o(0),I=o("start"),R=o("top"),W=p,j=y,S=x;return e.backgroundImage=function(t){return arguments.length?(v="function"==typeof t?t:o(t),e):v},e.data=function(n){return arguments.length?(t=n,e):t},e.duration=function(t){return arguments.length?(w=t,e):w},e.fill=function(t){return arguments.length?(m="function"==typeof t?t:o(t),e):m},e.fontColor=function(t){return arguments.length?(k="function"==typeof t?t:o(t),e):k},e.fontFamily=function(t){return arguments.length?(u="function"==typeof t?t:o(t),e):u},e.fontResize=function(t){return arguments.length?(A="function"==typeof t?t:o(t),e):A},e.fontSize=function(t){return arguments.length?(c="function"==typeof t?t:o(t),e):c},e.height=function(t){return arguments.length?(_="function"==typeof t?t:o(t),e):_},e.id=function(t){return arguments.length?(z=t,e):z},e.innerBounds=function(t){return arguments.length?(O=t,e):O},e.label=function(t){return arguments.length?(q="function"==typeof t?t:o(t),e):q},e.labelPadding=function(t){return arguments.length?(H="function"==typeof t?t:o(t),e):H},e.lineHeight=function(t){return arguments.length?(f="function"==typeof t?t:o(t),e):f},e.on=function(t,n){return 2===arguments.length?(l[t]=n,e):arguments.length?l[t]:l},e.select=function(t){return arguments.length?(a=b.select(t),void 0===u&&(u=o(a.style("font-family"))),void 0===c&&(c=o(parseFloat(a.style("font-size"),10))),e):a},e.stroke=function(t){return arguments.length?(C="function"==typeof t?t:o(t),e):C},e.strokeWidth=function(t){return arguments.length?(F="function"==typeof t?t:o(t),e):F},e.textAnchor=function(t){return arguments.length?(I="function"==typeof t?t:o(t),e):I},e.verticalAlign=function(t){return arguments.length?(R="function"==typeof t?t:o(t),e):R},e.width=function(t){return arguments.length?(W="function"==typeof t?t:o(t),e):W},e.x=function(t){return arguments.length?(j="function"==typeof t?t:o(t),e):j},e.y=function(t){return arguments.length?(S="function"==typeof t?t:o(t),e):S},t.length?e():e}var w="0.4.4",m={select:n.select,transition:e.transition},b={select:n.select,transition:e.transition};t.version=w,t.image=h,t.rect=v});