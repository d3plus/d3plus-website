/*
  d3plus-export v0.3.8
  Export methods for transforming and downloading SVG.
  Copyright (c) 2019 D3plus - https://d3plus.org
  @license MIT
*/
if(typeof Object.assign!=="function"){Object.defineProperty(Object,"assign",{value:function e(t){"use strict";if(t===null){throw new TypeError("Cannot convert undefined or null to object")}var a=Object(t);for(var r=1;r<arguments.length;r++){var i=arguments[r];if(i!==null){for(var s in i){if(Object.prototype.hasOwnProperty.call(i,s)){a[s]=i[s]}}}}return a},writable:true,configurable:true})}if(!Array.prototype.includes){Object.defineProperty(Array.prototype,"includes",{value:function e(t,a){var r=Object(this);var i=r.length>>>0;if(i===0)return false;var s=a|0;var l=Math.max(s>=0?s:i-Math.abs(s),0);function n(e,t){return e===t||typeof e==="number"&&typeof t==="number"&&isNaN(e)&&isNaN(t)}while(l<i){if(n(r[l],t)){return true}l++}return false}})}(function(e,t){typeof exports==="object"&&typeof module!=="undefined"?t(exports,require("html2canvas"),require("canvg-browser"),require("d3-selection"),require("canvas-toBlob"),require("file-saver")):typeof define==="function"&&define.amd?define("d3plus-export",["exports","html2canvas","canvg-browser","d3-selection","canvas-toBlob","file-saver"],t):t(e.d3plus={},e.html2canvas,e.canvg,e.d3Selection,null,e.fileSaver)})(this,function(e,W,v,Z,t,s){"use strict";W=W&&W.hasOwnProperty("default")?W["default"]:W;v=v&&v.hasOwnProperty("default")?v["default"]:v;function ee(e){var t=e.attr("stroke-width");e.attr("stroke-width",!t?0:t);var a=["none","transparent"].includes(e.attr("fill"));var r=e.attr("fill-opacity");e.attr("fill-opacity",a?0:r)}var o={background:false,callback:function(){},exclude:[],padding:0,scale:1};var g={ignoreMouse:true,ignoreAnimation:true,ignoreDimensions:true,ignoreClear:true};function te(e){var t;var a=Z.select(e).attr("transform");var r=1,i=0,s=0;if(a){r=a.match(/scale\(([^a-z]+)\)/i);if(r){r=parseFloat(r[1])}else{r=1}var l=a.match(/translate\(([^a-z]+)\)/i);if(l){t=l[1].replace(", ",",").replace(/([^a-z]),*\s([^a-z])/gi,"$1,$2").split(",").map(function(e){return parseFloat(e)*r}),i=t[0],s=t[1]}}return[r,i,s]}function l(e,D){if(!e){return}if(!(e instanceof Array)){e=[e]}D=Object.assign({},o,D);var d=new RegExp(/(MSIE|Trident\/|Edge\/)/i).test(navigator.userAgent);var H=window?window.devicePixelRatio||1:1;var t=e[0];if(t.constructor===Object){t=t.element}var Y=D.height||parseFloat(Z.select(t).style("height")),_=D.width||parseFloat(Z.select(t).style("width"));var U,V,G=0,J=0;if(t.getBoundingClientRect){var a=t.getBoundingClientRect();G=a.left;J=a.top}else{G=t.offsetLeft;J=t.offsetTop}var h=document.createElement("canvas");h.width=(_+D.padding*2)*D.scale*H;h.height=(Y+D.padding*2)*D.scale*H;h.style.width=(_+D.padding*2)*D.scale;h.style.height=(Y+D.padding*2)*D.scale;var f=h.getContext("2d");f.scale(D.scale*H,D.scale*H);f.clearRect(0,0,h.width/H,h.height/H);if(D.background){f.beginPath();f.rect(0,0,h.width/H,h.height/H);f.fillStyle=D.background;f.fill()}var K=[];function r(e){var t=(this.tagName||"").toLowerCase();if(D.exclude.includes(this)||t==="foreignobject"){return}var a=Object.assign({},e);if(this.tagName){var r=Z.select(this).attr("opacity")||Z.select(this).style("opacity");var i=Z.select(this).style("display");var s=Z.select(this).style("visibility");if(i==="none"||s==="hidden"||r&&parseFloat(r)===0){return}var l=this.tagName.toLowerCase();if(l.length&&["defs","title","desc"].includes(l)){return}var n=te(this);var c=n[0];var o=n[1];var d=n[2];if(l==="g"){a.scale*=c;a.x+=o;a.y+=d}else if(l==="svg"){var h=this.getBoundingClientRect();a.x+=h.left-G;a.y+=h.top-J;var f=Z.select(this).attr("x");f=f?parseFloat(f)*a.scale:0;a.x+=f;var v=Z.select(this).attr("y");v=v?parseFloat(v)*a.scale:0;a.y+=v;a.clip={height:parseFloat(Z.select(this).attr("height")||Z.select(this).style("height")),width:parseFloat(Z.select(this).attr("width")||Z.select(this).style("width")),x:f,y:v}}else{var g=Z.select(this).attr("x");if(g){a.x+=parseFloat(g)*a.scale}var u=Z.select(this).attr("y");if(u){a.y+=parseFloat(u)*a.scale}}}if(!t.length){var p=(this.wholeText||"").replace(/\s/g,"");if(p.length){var y=this.nodeValue.replace(/^\s*/,"").replace(/^\n/,"").replace(/^\s*/,"").replace(/\n$/,"").replace(/\s*$/,"").replace(/\n$/,"");K.push({type:"text",style:this.parentNode,value:y,x:a.x,y:a.y})}}else if(t==="text"){var x=this.cloneNode(true);Z.select(x).call(ee);K.push(Object.assign({},a,{type:"svg",value:x}))}else if(["image","img"].includes(t)){var m=Z.select(this).attr("href")||Z.select(this).attr("xlink:href");if(m.length){var b=parseFloat(Z.select(this).attr("height"))*a.scale,w=parseFloat(Z.select(this).attr("width"))*a.scale;var O={clip:a.clip,height:b,loaded:false,type:"img",width:w,x:a.x,y:a.y};K.push(O);var j=new Image;j.crossOrigin="Anonymous";j.onload=function(){var e=document.createElement("canvas");var t=e.getContext("2d");e.height=b*H;e.width=w*H;t.drawImage(this,0,0,w*H,b*H);var a=document.createElement("img");a.src=e.toDataURL("image/png");O.value=a;O.loaded=true};j.src=m}}else if(!["svg","g","text"].includes(t)&&!Z.select(this).selectAll("svg").size()){var k=D.scale*H;var N={height:Y+D.padding*2+J,loaded:false,type:"html",width:_+D.padding*2+G,x:U-G,y:V-J};var F=document.createElement("canvas");F.width=(_+D.padding*2+G)*k;F.height=(Y+D.padding*2+J)*k;F.style.width=(_+D.padding*2+G)*k+"px";F.style.height=(Y+D.padding*2+J)*k+"px";var A=F.getContext("2d");A.scale(k,k);K.push(N);W(this,{allowTaint:true,canvas:F}).then(function(e){N.value=e;N.loaded=true})}else if(t!=="svg"&&this.childNodes.length>0&&!Z.select(this).selectAll("image, img, svg").size()){var C=this.cloneNode(true);Z.select(C).selectAll("*").each(function(){Z.select(this).call(ee);if(Z.select(this).attr("opacity")==="0"){this.parentNode.removeChild(this)}});K.push(Object.assign({},a,{type:"svg",value:C,tag:t}))}else if(this.childNodes.length>0){Q(this,a)}else{var z=this.cloneNode(true);Z.select(z).selectAll("*").each(function(){if(Z.select(this).attr("opacity")==="0"){this.parentNode.removeChild(this)}});if(t==="line"){Z.select(z).attr("x1",parseFloat(Z.select(z).attr("x1"))+a.x);Z.select(z).attr("x2",parseFloat(Z.select(z).attr("x2"))+a.x);Z.select(z).attr("y1",parseFloat(Z.select(z).attr("y1"))+a.y);Z.select(z).attr("y2",parseFloat(Z.select(z).attr("y2"))+a.y)}else if(t==="path"){var E=te(z);var T=E[0];var M=E[1];var P=E[2];if(Z.select(z).attr("transform")){Z.select(z).attr("transform","scale("+T+")translate("+(M+a.x)+","+(P+a.y)+")")}}Z.select(z).call(ee);var L=Z.select(z).attr("fill");var S=L&&L.indexOf("url")===0;K.push(Object.assign({},a,{type:"svg",value:z,tag:t}));if(S){var R=Z.select(L.slice(4,-1)).node().cloneNode(true);var B=(R.tagName||"").toLowerCase();if(B==="pattern"){var q=te(z);var I=q[0];var $=q[1];var X=q[2];a.scale*=I;a.x+=$;a.y+=X;Q(R,a)}}}}function Q(e,t){Z.selectAll(e.childNodes).each(function(){r.bind(this)(t)})}for(var i=0;i<e.length;i++){var s=e[i],l={scale:1,x:0,y:0};if(s.constructor===Object){l=Object.assign(l,s);s=s.element}U=l.x;V=l.y;r.bind(s)(l)}function n(){var e=true;for(var t=0;t<K.length;t++){if(K[t].loaded===false){e=false;break}}if(e){c()}else{setTimeout(n,500)}}n();function c(){for(var e=0;e<K.length;e++){var t=K[e];var a=t.clip||{height:Y,width:_,x:0,y:0};switch(t.type){case"img":f.save();f.beginPath();f.translate(D.padding+a.x,D.padding+a.y);f.rect(0,0,a.width,a.height);f.clip();f.drawImage(t.value,t.x+a.x,t.y+a.y,t.width,t.height);f.restore();break;case"html":f.save();f.beginPath();f.translate(D.padding,D.padding);f.drawImage(t.value,t.x,t.y,t.width,t.height);f.restore();break;case"text":var r=Z.select(t.style);var i=t.value.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");var s=r.style("color"),l=r.style("font-size");var n=r.style("font-family").split(",")[0];if(n.indexOf("'")!==0){n="'"+n+"'"}var c="<text stroke='none' dy='"+l+"' fill='"+s+"' font-family="+n+" font-size='"+l+"'>"+i+"</text>";f.save();f.translate(D.padding,D.padding);v(h,c,Object.assign({},g,{offsetX:t.x,offsetY:t.y}));f.restore();break;case"svg":var o=d?(new XMLSerializer).serializeToString(t.value):t.value.outerHTML;f.save();f.translate(D.padding+a.x+t.x,D.padding+a.y+t.y);f.rect(0,0,a.width,a.height);f.clip();v(h,o,Object.assign({},g,{offsetX:t.x+a.x,offsetY:t.y+a.y}));f.restore();break;default:console.warn("uncaught",t);break}}D.callback(h)}}var n={filename:"download",type:"png"};function a(e,t,a){if(t===void 0)t={};if(a===void 0)a={};if(!e){return}t=Object.assign({},n,t);var r=new RegExp(/(MSIE|Trident\/|Edge\/)/i).test(navigator.userAgent);if(!(e instanceof Array)&&t.type==="svg"){var i=r?(new XMLSerializer).serializeToString(e):e.outerHTML;s.saveAs(new Blob([i],{type:"application/svg+xml"}),t.filename+".svg")}l(e,Object.assign({},a,{callback:function(e){if(a.callback){a.callback(e)}if(["jpg","png"].includes(t.type)){e.toBlob(function(e){return s.saveAs(e,t.filename)})}}}))}e.dom2canvas=l;e.saveElement=a;Object.defineProperty(e,"__esModule",{value:true})});