/*
  d3plus-export v0.3.12
  Export methods for transforming and downloading SVG.
  Copyright (c) 2019 D3plus - https://d3plus.org
  @license MIT
*/
if(typeof Object.assign!=="function"){Object.defineProperty(Object,"assign",{value:function e(t){"use strict";if(t===null){throw new TypeError("Cannot convert undefined or null to object")}var a=Object(t);for(var r=1;r<arguments.length;r++){var i=arguments[r];if(i!==null){for(var s in i){if(Object.prototype.hasOwnProperty.call(i,s)){a[s]=i[s]}}}}return a},writable:true,configurable:true})}if(!Array.prototype.includes){Object.defineProperty(Array.prototype,"includes",{value:function e(t,a){var r=Object(this);var i=r.length>>>0;if(i===0)return false;var s=a|0;var l=Math.max(s>=0?s:i-Math.abs(s),0);function n(e,t){return e===t||typeof e==="number"&&typeof t==="number"&&isNaN(e)&&isNaN(t)}while(l<i){if(n(r[l],t)){return true}l++}return false}})}if(!String.prototype.includes){Object.defineProperty(String.prototype,"includes",{value:function(e,t){if(typeof t!=="number"){t=0}if(t+e.length>this.length){return false}else{return this.indexOf(e,t)!==-1}}})}if(!Array.prototype.find){Object.defineProperty(Array.prototype,"find",{value:function(e){if(this==null){throw new TypeError('"this" is null or not defined')}var t=Object(this);var a=t.length>>>0;if(typeof e!=="function"){throw new TypeError("predicate must be a function")}var r=arguments[1];var i=0;while(i<a){var s=t[i];if(e.call(r,s,i,t)){return s}i++}return undefined},configurable:true,writable:true})}if(!String.prototype.startsWith){Object.defineProperty(String.prototype,"startsWith",{value:function(e,t){t=!t||t<0?0:+t;return this.substring(t,t+e.length)===e}})}if(typeof window!=="undefined"){(function(){var r=function(e,t){var a=e.nodeType;if(a===3){t.push(e.textContent.replace(/&/,"&amp;").replace(/</,"&lt;").replace(">","&gt;"))}else if(a===1){t.push("<",e.tagName);if(e.hasAttributes()){[].forEach.call(e.attributes,function(e){t.push(" ",e.item.name,"='",e.item.value,"'")})}if(e.hasChildNodes()){t.push(">");[].forEach.call(e.childNodes,function(e){r(e,t)});t.push("</",e.tagName,">")}else{t.push("/>")}}else if(a==8){t.push("\x3c!--",e.nodeValue,"--\x3e")}};Object.defineProperty(SVGElement.prototype,"innerHTML",{get:function(){var e=[];var t=this.firstChild;while(t){r(t,e);t=t.nextSibling}return e.join("")},set:function(e){while(this.firstChild){this.removeChild(this.firstChild)}try{var t=new DOMParser;t.async=false;var a="<svg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'>"+e+"</svg>";var r=t.parseFromString(a,"text/xml").documentElement;var i=r.firstChild;while(i){this.appendChild(this.ownerDocument.importNode(i,true));i=i.nextSibling}}catch(e){}}});Object.defineProperty(SVGElement.prototype,"innerSVG",{get:function(){return this.innerHTML},set:function(e){this.innerHTML=e}})})()}(function(e,t){typeof exports==="object"&&typeof module!=="undefined"?t(exports,require("html2canvas"),require("canvg-browser"),require("d3-selection"),require("canvas-toBlob"),require("file-saver")):typeof define==="function"&&define.amd?define("d3plus-export",["exports","html2canvas","canvg-browser","d3-selection","canvas-toBlob","file-saver"],t):t(e.d3plus={},e.html2canvas,e.canvg,e.d3Selection,null,e.fileSaver)})(this,function(e,J,u,K,t,s){"use strict";J=J&&J.hasOwnProperty("default")?J["default"]:J;u=u&&u.hasOwnProperty("default")?u["default"]:u;function Q(e){var t=e.attr("stroke-width");e.attr("stroke-width",!t?0:t);var a=["none","transparent"].includes(e.attr("fill"));var r=e.attr("fill-opacity");e.attr("fill-opacity",a?0:r)}var c={background:false,callback:function(){},exclude:[],padding:0,scale:1};var p={ignoreMouse:true,ignoreAnimation:true,ignoreDimensions:true,ignoreClear:true};function Z(e){var t;var a=K.select(e).attr("transform");var r=1,i=0,s=0;if(a){r=a.match(/scale\(([^a-z]+)\)/i);if(r){r=parseFloat(r[1])}else{r=1}var l=a.match(/translate\(([^a-z]+)\)/i);if(l){t=l[1].replace(", ",",").replace(/([^a-z]),*\s([^a-z])/gi,"$1,$2").split(",").map(function(e){return parseFloat(e)*r}),i=t[0],s=t[1]}}return[r,i,s]}function l(e,H){if(!e){return}if(!(e instanceof Array)){e=[e]}H=Object.assign({},c,H);var h=new RegExp(/(MSIE|Trident\/|Edge\/)/i).test(navigator.userAgent);var V=window?window.devicePixelRatio||1:1;var t=e[0];if(t.constructor===Object){t=t.element}var $=H.height||parseFloat(K.select(t).style("height"))+parseFloat(K.select(t).style("padding-top"))+parseFloat(K.select(t).style("padding-bottom")),D=H.width||parseFloat(K.select(t).style("width"))+parseFloat(K.select(t).style("padding-left"))+parseFloat(K.select(t).style("padding-right"));var X,G,W=0,Y=0;if(t.getBoundingClientRect){var a=t.getBoundingClientRect();W=a.left;Y=a.top}else{W=t.offsetLeft;Y=t.offsetTop}var f=document.createElement("canvas");f.width=(D+H.padding*2)*H.scale*V;f.height=($+H.padding*2)*H.scale*V;f.style.width=(D+H.padding*2)*H.scale;f.style.height=($+H.padding*2)*H.scale;var d=f.getContext("2d");d.scale(H.scale*V,H.scale*V);d.clearRect(0,0,f.width/V,f.height/V);if(H.background){d.beginPath();d.rect(0,0,f.width/V,f.height/V);d.fillStyle=H.background;d.fill()}var _=[];function r(e){var t=(this.tagName||"").toLowerCase();if(H.exclude.includes(this)||t==="foreignobject"){return}var a=Object.assign({},e);if(this.tagName){var r=K.select(this).attr("opacity")||K.select(this).style("opacity");var i=K.select(this).style("display");var s=K.select(this).style("visibility");if(i==="none"||s==="hidden"||r&&parseFloat(r)===0){return}var l=this.tagName.toLowerCase();if(l.length&&["defs","title","desc"].includes(l)){return}if(l==="svg"){if(!a.svg){var n=this.getBoundingClientRect();var o=n.left;var c=n.top;a.x+=o-W;a.y+=c-Y;a.svg=true}var h=K.select(this).attr("x");h=h?parseFloat(h)*a.scale:0;a.x+=h;var f=K.select(this).attr("y");f=f?parseFloat(f)*a.scale:0;a.y+=f;a.clip={height:parseFloat(K.select(this).attr("height")||K.select(this).style("height")),width:parseFloat(K.select(this).attr("width")||K.select(this).style("width")),x:h,y:f}}else{var d=K.select(this).attr("x");if(d){a.x+=parseFloat(d)*a.scale}var u=K.select(this).attr("y");if(u){a.y+=parseFloat(u)*a.scale}}}if(!t.length){var p=(this.wholeText||"").replace(/\s/g,"");if(p.length){var g=this.nodeValue.replace(/^\s*/,"").replace(/^\n/,"").replace(/^\s*/,"").replace(/\n$/,"").replace(/\s*$/,"").replace(/\n$/,"");_.push({type:"text",style:this.parentNode,value:g,x:a.x,y:a.y})}}else if(t==="text"){var v=this.cloneNode(true);K.select(v).call(Q);_.push(Object.assign({},a,{type:"svg",value:v}))}else if(["image","img"].includes(t)){var y=K.select(this).attr("href")||K.select(this).attr("xlink:href");if(y.length){var m=parseFloat(K.select(this).attr("height"))*a.scale,w=parseFloat(K.select(this).attr("width"))*a.scale;var b={clip:a.clip,height:m,loaded:false,type:"img",width:w,x:a.x,y:a.y};_.push(b);var x=new Image;x.crossOrigin="Anonymous";x.onload=function(){var e=document.createElement("canvas");var t=e.getContext("2d");e.height=m*V;e.width=w*V;t.drawImage(this,0,0,w*V,m*V);var a=document.createElement("img");a.src=e.toDataURL("image/png");b.value=a;b.loaded=true};x.src=y}}else if(!["svg","g","text"].includes(t)&&!K.select(this).selectAll("svg").size()){var O=H.scale*V;var j={height:Math.floor($+H.padding*2+Y),loaded:false,type:"html",width:Math.floor(D+H.padding*2+W),x:Math.floor(X-W),y:Math.floor(G-Y)};var N=document.createElement("canvas");N.width=j.width*O;N.height=j.height*O;N.style.width=j.width*O+"px";N.style.height=j.height*O+"px";var F=N.getContext("2d");F.scale(O,O);_.push(j);J(this,{allowTaint:true,canvas:N,letterRendering:true}).then(function(e){j.value=e;j.loaded=true})}else if(t!=="svg"&&this.childNodes.length>0&&!K.select(this).selectAll("image, img, svg").size()){var C=this.cloneNode(true);K.select(C).selectAll("*").each(function(){K.select(this).call(Q);if(K.select(this).attr("opacity")==="0"){this.parentNode.removeChild(this)}});_.push(Object.assign({},a,{type:"svg",value:C,tag:t}))}else if(this.childNodes.length>0){U(this,a)}else{var k=this.cloneNode(true);K.select(k).selectAll("*").each(function(){if(K.select(this).attr("opacity")==="0"){this.parentNode.removeChild(this)}});if(t==="line"){K.select(k).attr("x1",parseFloat(K.select(k).attr("x1"))+a.x);K.select(k).attr("x2",parseFloat(K.select(k).attr("x2"))+a.x);K.select(k).attr("y1",parseFloat(K.select(k).attr("y1"))+a.y);K.select(k).attr("y2",parseFloat(K.select(k).attr("y2"))+a.y)}else if(t==="path"){var E=Z(k);var S=E[0];var A=E[1];var M=E[2];if(K.select(k).attr("transform")){K.select(k).attr("transform","scale("+S+")translate("+(A+a.x)+","+(M+a.y)+")")}}K.select(k).call(Q);var T=K.select(k).attr("fill");var P=T&&T.indexOf("url")===0;_.push(Object.assign({},a,{type:"svg",value:k,tag:t}));if(P){var z=K.select(T.slice(4,-1)).node().cloneNode(true);var L=(z.tagName||"").toLowerCase();if(L==="pattern"){var R=Z(k);var B=R[0];var q=R[1];var I=R[2];a.scale*=B;a.x+=q;a.y+=I;U(z,a)}}}}function U(e,t){K.selectAll(e.childNodes).each(function(){r.bind(this)(t)})}for(var i=0;i<e.length;i++){var s=e[i],l={scale:1,x:0,y:0,svg:false};if(s.constructor===Object){l=Object.assign(l,s);s=s.element}X=l.x;G=l.y;r.bind(s)(l)}function n(){var e=true;for(var t=0;t<_.length;t++){if(_[t].loaded===false){e=false;break}}if(e){o()}else{setTimeout(n,500)}}n();function o(){for(var e=0;e<_.length;e++){var t=_[e];var a=t.clip||{height:$,width:D,x:0,y:0};switch(t.type){case"img":d.save();d.beginPath();d.translate(H.padding+a.x,H.padding+a.y);d.rect(0,0,a.width,a.height);d.clip();d.drawImage(t.value,t.x+a.x,t.y+a.y,t.width,t.height);d.restore();break;case"html":d.save();d.beginPath();d.translate(H.padding,H.padding);d.drawImage(t.value,t.x,t.y,t.width,t.height);d.restore();break;case"text":var r=K.select(t.style);var i=t.value.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");var s=r.style("color"),l=r.style("font-size");var n=r.style("font-family").split(",")[0];if(n.indexOf("'")!==0){n="'"+n+"'"}var o="<text stroke='none' dy='"+l+"' fill='"+s+"' font-family="+n+" font-size='"+l+"'>"+i+"</text>";d.save();d.translate(H.padding,H.padding);u(f,o,Object.assign({},p,{offsetX:t.x,offsetY:t.y}));d.restore();break;case"svg":var c=h?(new XMLSerializer).serializeToString(t.value):t.value.outerHTML;d.save();d.translate(H.padding+a.x+t.x,H.padding+a.y+t.y);d.rect(0,0,a.width,a.height);d.clip();u(f,c,Object.assign({},p,{offsetX:t.x+a.x,offsetY:t.y+a.y}));d.restore();break;default:console.warn("uncaught",t);break}}H.callback(f)}}var n={filename:"download",type:"png"};function a(e,t,a){if(t===void 0)t={};if(a===void 0)a={};if(!e){return}t=Object.assign({},n,t);var r=new RegExp(/(MSIE|Trident\/|Edge\/)/i).test(navigator.userAgent);if(!(e instanceof Array)&&t.type==="svg"){var i=r?(new XMLSerializer).serializeToString(e):e.outerHTML;s.saveAs(new Blob([i],{type:"application/svg+xml"}),t.filename+".svg")}l(e,Object.assign({},a,{callback:function(e){if(a.callback){a.callback(e)}if(["jpg","png"].includes(t.type)){e.toBlob(function(e){return s.saveAs(e,t.filename+"."+t.type)})}}}))}e.dom2canvas=l;e.saveElement=a;Object.defineProperty(e,"__esModule",{value:true})});