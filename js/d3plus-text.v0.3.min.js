!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("d3")):"function"==typeof define&&define.amd?define("d3plus-text",["exports","d3"],n):n(t.d3plus_text={},t.d3)}(this,function(t,n){"use strict";function e(t){return function(){return t}}function i(t){var e=arguments.length<=1||void 0===arguments[1]?{"font-size":10,"font-family":"sans-serif"}:arguments[1],i=n.select("body").selectAll("canvas#d3plus-text-size").data([0]);i.enter().append("canvas").attr("id","d3plus-text-size").style("position","absolute").style("left","-9999px").style("top","-9999px").style("visibility","hidden").style("display","block");var r=i.node().getContext("2d"),o=[];if("font-style"in e&&o.push(e["font-style"]),"font-variant"in e&&o.push(e["font-variant"]),"font-weight"in e&&o.push(e["font-weight"]),"font-size"in e){var u=e["font-size"]+"px";"line-height"in e&&(u+="/"+e["line-height"]+"px"),o.push(u)}return"font-family"in e&&o.push(e["font-family"]),r.font=o.join(" "),t instanceof Array?t.map(function(t){return r.measureText(t).width}):r.measureText(t).width}function r(t){return t.height||200}function o(t,n){return t.id||""+n}function u(t){return t.match(g)}function f(t){return t.text}function a(t){return t.width||200}function s(t){return t.x||0}function l(t){return t.y||0}function c(){function t(t){return t+"..."}function c(){void 0===R&&c.select(n.select("body").append("svg").style("width",window.innerWidth+"px").style("height",window.innerHeight+"px").node());var t=R.selectAll(".d3plus-text-box").data(d,A);return t.enter().append("text").attr("class","d3plus-text-box").attr("id",function(t,n){return"d3plus-text-box-"+A(t,n)}),t.attr("y",function(t,n){return T(t,n)+"px"}).attr("fill",function(t,n){return y(t,n)}).attr("text-anchor",function(t,n){return F(t,n)}).attr("font-family",function(t,n){return m(t,n)}).each(function(t,e){function r(){if(s=1,l=[""],y>f)return void(l=[]);f>d&&(f=d);var t="",n=0;u&&(a=1.1*f,G["font-size"]=f,G["line-height"]=a),c=i(B,G);var e=!0,o=!1,h=void 0;try{for(var g,m=B[Symbol.iterator]();!(e=(g=m.next()).done);e=!0){var x=g.value,v=E.charAt(t.length+x.length),b=c[B.indexOf(x)];if(" "===v&&(x+=v),n+b>_-f){if(s++,a*s>A||b>_&&!R){if(u){if(f--,y>f){l=[];break}r()}else l[s-2]=p(l[s-2].trimRight());break}n=0,l.push(x)}else l[s-1]+=x;t+=x,n+=b," "===v&&(n+=T)}}catch(w){o=!0,h=w}finally{try{!e&&m["return"]&&m["return"]()}finally{if(o)throw h}}}function o(n){n.text(function(t){return t.trimRight()}).attr("x",H(t,e)+"px").attr("dx",D+"px").attr("dy",a+"px")}var u=b(t,e),f=u?x(t,e):w(t,e),a=u?1.1*f:M(t,e),s=1,l=[""],c=void 0,d=x(t,e),y=v(t,e),A=z(t,e),R=j(t,e),T=i(" ",G),E=C(t,e),O=F(t,e),W=S(t,e),_=q(t,e),B=k(E,e),D="start"===O?0:"end"===O?_:_/2,G={"font-family":m(t,e),"font-size":f,"line-height":a};if(A>a||u){if(u){c=i(B,G);var I=1.165+_/A*.1,J=_*A,K=n.max(c),L=n.sum(c,function(t){return t*a})*I;if(K>_||L>J){var N=Math.sqrt(J/L),P=_/K,Q=n.min([N,P]);f=Math.floor(f*Q)}var U=Math.floor(.8*A);f>U&&(f=U)}r(),n.select(this).attr("font-size",f+"px").style("font-size",f+"px")}var V=s*a,X="top"===W?0:"middle"===W?A/2-V/2:A-V;X-=.2*a,n.select(this).transition().duration(g).attr("transform","translate(0,"+X+")");var Y=n.select(this).selectAll("tspan").data(l);Y.exit().transition().duration(g).attr("opacity",0).remove(),Y.transition().duration(g).call(o),Y.enter().append("tspan").attr("dominant-baseline","alphabetic").style("baseline-shift","0%").attr("opacity",0).call(o).transition().duration(g).delay(h).attr("opacity",1)}),c}var d=arguments.length<=0||void 0===arguments[0]?[]:arguments[0],h=0,g=0,p=t,y=void 0,m=void 0,x=e(50),v=e(8),b=e(!1),w=void 0,z=r,A=o,M=void 0,j=e(!1),R=void 0,k=u,C=f,F=e("start"),S=e("top"),q=a,H=s,T=l;return c.data=function(t){return arguments.length?(d=t,c):d},c.delay=function(t){return arguments.length?(h=t,c):h},c.duration=function(t){return arguments.length?(g=t,c):g},c.ellipsis=function(t){return arguments.length?(p="function"==typeof t?t:e(t),c):p},c.fontColor=function(t){return arguments.length?(y="function"==typeof t?t:e(t),c):y},c.fontFamily=function(t){return arguments.length?(m="function"==typeof t?t:e(t),c):m},c.fontMax=function(t){return arguments.length?(x="function"==typeof t?t:e(t),c):x},c.fontMin=function(t){return arguments.length?(v="function"==typeof t?t:e(t),c):v},c.fontResize=function(t){return arguments.length?(b="function"==typeof t?t:e(t),c):b},c.fontSize=function(t){return arguments.length?(w="function"==typeof t?t:e(t),void 0===M&&(M=e(Math.ceil(1.1*w()))),c):w},c.height=function(t){return arguments.length?(z="function"==typeof t?t:e(t),c):z},c.id=function(t){return arguments.length?(A="function"==typeof t?t:e(t),c):A},c.lineHeight=function(t){return arguments.length?(M="function"==typeof t?t:e(t),c):M},c.overflow=function(t){return arguments.length?(j="function"==typeof t?t:e(t),c):j},c.select=function(t){return arguments.length?(R=n.select(t),void 0===y&&c.fontColor(R.style("font-color")),void 0===m&&c.fontFamily(R.style("font-family")),void 0===w&&c.fontSize(parseFloat(R.style("font-size"),10)),c):R},c.split=function(t){return arguments.length?(k=t,c):k},c.text=function(t){return arguments.length?(C="function"==typeof t?t:e(t),c):C},c.textAnchor=function(t){return arguments.length?(F="function"==typeof t?t:e(t),c):F},c.verticalAlign=function(t){return arguments.length?(S="function"==typeof t?t:e(t),c):S},c.width=function(t){return arguments.length?(q="function"==typeof t?t:e(t),c):q},c.x=function(t){return arguments.length?(H="function"==typeof t?t:e(t),c):H},c.y=function(t){return arguments.length?(T="function"==typeof t?t:e(t),c):T},d.length?c():c}n="default"in n?n["default"]:n;var d="0.3.1",h=["-","/",";",":","&"],g=new RegExp("[^\\s\\"+h.join("\\")+"]+\\"+h.join("?\\")+"?","g");t.version=d,t.box=c,t.width=i});