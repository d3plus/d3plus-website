/*
  d3plus-treemap v0.4.0
  A reusable tree map built on D3
  Copyright (c) 2016 D3plus - https://d3plus.org
  @license MIT
*/
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("d3plus-color"),require("d3plus-common"),require("d3plus-legend"),require("d3plus-tooltip"),require("d3plus-shape"),require("d3plus-text"),require("d3-color"),require("d3-collection"),require("d3-hierarchy"),require("d3-selection")):"function"==typeof define&&define.amd?define("d3plus-treemap",["exports","d3plus-color","d3plus-common","d3plus-legend","d3plus-tooltip","d3plus-shape","d3plus-text","d3-color","d3-collection","d3-hierarchy","d3-selection"],n):n(t.d3plus=t.d3plus||{},t.d3plusColor,t.d3plusCommon,t.d3plusLegend,t.d3plusTooltip,t.d3plusShape,t.d3plusText,t.d3Color,t.d3Collection,t.d3Hierarchy,t.d3Selection)}(this,function(t,n,e,r,o,u,i,a,c,l,d){"use strict";function s(t){function o(t,n){return n.value-t.value}function u(n){function r(t){for(var n=0;n<t.length;n++){var o=t[n];o.depth<=a?r(o.children):(o.id=a+o.data.key,o.data=e.merge(o.data.values),Z.push(o))}}var o={fill:function(t,n){return w(t.data,n)},opacity:function(t,n){return C(t.data,n)},stroke:function(t,n){return E(t.data,n)},strokeWidth:function(t,n){return R(t.data,n)}},l=Object.keys(b),f=l.filter(function(t){return!t.includes(".")}),B=l.filter(function(t){return t.includes(".legend")}),L=l.filter(function(t){return t.includes(".shape")});a=void 0!==i?i:z.length-1,d=z[a],void 0===h?(u.size(e.getSize(p.select("body").node())),u.select(p.select("body").append("svg").style("width",g[0]+"px").style("height",g[1]+"px").style("display","block").node())):void 0===g&&u.size(e.getSize(h.node()));var N=s||function(t,n){var e=d(t,n);if(e.constructor!==Array)return e;for(var r=a;r>=0&&(e=z[r](t,n),e.constructor===Array);r--);return e},V=c?t.filter(c):t,D=e.colorNest(V,w,z);D.data=D.data.map(function(t,n){var e={data:t,id:D.id(t,n)};return e});var F=h.selectAll("g.d3plus-treemap-legend").data(j?[0]:[]);F=F.enter().append("g").attr("class","d3plus-treemap-legend").attr("transform","translate(0,"+g[1]/2+")").merge(F),F.transition().duration(q).attr("transform","translate(0,"+g[1]/2+")"),v.config(o).duration(q).data(D.data).height(g[1]/2).label(function(t,n){return N(t.data,n)}).select(F.node()).verticalAlign("bottom").width(g[0]);for(var G=function(t){v.on(f[t],function(n,e){return b[f[t]](n.data,e)})},I=0;I<f.length;I++)G(I);for(var J=function(t){v.on(B[t],function(n,e){return b[B[t]](n.data,e)})},K=0;K<B.length;K++)J(K);j.constructor===Object&&v.config(j),v(),A.bottom=v.outerBounds().height+4*v.padding();var Q=h.selectAll("g.d3plus-treemap-titles").data([0]);Q=Q.enter().append("g").attr("class","d3plus-treemap-titles").merge(Q),y.data(k.length?[{text:"Back"}]:[]).select(Q.node()).x(2*P).y(0)(),A.top=k.length?y.fontSize()()+P:0;for(var U=p.nest(),X=0;X<=a;X++)U.key(z[X]);U=U.entries(V);var Y=p.treemap().padding(P).round(!0).size([g[0]-A.left-A.right,g[1]-A.top-A.bottom]).tile(_)(p.hierarchy({values:U},function(t){return t.values}).sum(W).sort(T)),Z=[];Y.children&&r(Y.children);var $=Y.value,tt=h.selectAll("g.d3plus-treemap-shapes").data([0]);tt=tt.enter().append("g").attr("class","d3plus-treemap-shapes").merge(tt),x.config(o).data(Z).duration(q).fontResize(function(t,n){return S(t.data,n)}).innerBounds(function(t){var n=t.height,e=Math.min(50,n/2);return[{width:t.width,height:n-e,x:-t.width/2,y:-n/2},{width:t.width,height:e,x:-t.width/2,y:n/2-e}]}).label(function(t,n){return[N(t.data,n),Math.round(W(t.data,n)/$*100)+"%"]}).labelPadding(function(t,n){return O(t.data,n)}).select(tt.node()).textAnchor(["start","middle"]).verticalAlign(["top","bottom"]);for(var nt=function(t){x.on(f[t],function(n,e){return b[f[t]](n.data,e)})},et=0;et<f.length;et++)nt(et);for(var rt=function(t){x.on(L[t],function(n,e){return b[L[t]](n.data,e)})},ot=0;ot<L.length;ot++)rt(ot);return M.constructor===Object&&x.config(M),x(),m.tbody([[W,function(t,n){return Math.round(W(t,n)/$*100)+"%"}]]).thead(["Value","Share"]).title(N),H.constructor===Object&&m.config(H),n&&setTimeout(n,q+100),u}void 0===t&&(t=[]);var i,a,c,d,s,h,g,y=f.textBox().on("click",function(){k.length?u.config(k.pop())():u.depth(a-1).filter(!1)()}),m=f.tooltip().pointerEvents("none"),v=r.legend(),x=f.rect().height(function(t){return t.y1-t.y0}).width(function(t){return t.x1-t.x0}).x(function(t){return A.left+t.x0+(t.x1-t.x0)/2}).y(function(t){return A.top+t.y0+(t.y1-t.y0)/2}),b={click:function(t,n){if(a<z.length-1){var e=z[a],r=d(t,n);B=!1,H&&m.data([])(),k.push({depth:u.depth(),filter:u.filter()}),u.config({depth:a+1,filter:function(t,n){return e(t,n)===r}})()}},mouseenter:function(t,n){var e=d(t,n);B=function(t,n){var r=d(t,n);return r.constructor===Array&&e.constructor!==Array?r.includes(e):r.constructor!==Array&&e.constructor===Array?e.includes(r):r===e},H&&m.data([t]).footer(a<z.length-1?"Click to Expand":"").translate(p.mouse(p.select("html").node()))(),u.update(100)},mousemove:function(){var t=m.duration();H&&m.duration(0).translate(p.mouse(p.select("html").node()))().duration(t)},mouseleave:function(){B=!1,H&&m.data([])(),u.update(100)}},k=[],A={bottom:0,left:0,right:0,top:0},q=600,w=function(t,e){return n.assign(d(t,e))},z=[e.accessor("id")],B=!1,O=e.constant(5),S=e.constant(!0),j=!0,C=function(t,n){return B?B(t,n)?1:.25:1},P=2,M={},T=o,E=function(t,n){return p.color(w(t,n)).darker()},R=function(t,n){return B&&B(t,n)?1:0},W=e.accessor("value"),_=l.treemapSquarify,H=!0;return u.config=function(t){if(arguments.length){for(var n in t)({}).hasOwnProperty.call(t,n)&&u[n](t[n]);return u}var e={};for(var r in u.prototype.constructor)"config"!==r&&{}.hasOwnProperty.call(u,r)&&(e[r]=u[r]());return e},u.data=function(n){return arguments.length?(t=n,u):t},u.depth=function(t){return arguments.length?(i=t,u):i},u.duration=function(t){return arguments.length?(q=t,u):q},u.fill=function(t){return arguments.length?(w="function"==typeof t?t:e.constant(t),u):w},u.filter=function(t){return arguments.length?(c=t,u):c},u.groupBy=function(t){return arguments.length?(t instanceof Array||(t=[t]),z=t.map(function(t){return"function"==typeof t?t:e.accessor(t)}),u):z},u.highlight=function(t){return arguments.length?(B=t,u):B},u.label=function(t){return arguments.length?(s="function"==typeof t?t:e.constant(t),u):s},u.labelPadding=function(t){return arguments.length?(O="function"==typeof t?t:e.constant(t),u):O},u.labelResize=function(t){return arguments.length?(S="function"==typeof t?t:e.constant(t),u):S},u.legend=function(t){return arguments.length?(j=t,u):j},u.on=function(t,n){return 2===arguments.length?(b[t]=n,u):arguments.length?b[t]:b},u.opacity=function(t){return arguments.length?(C="function"==typeof t?t:e.constant(t),u):C},u.padding=function(t){return arguments.length?(P="function"==typeof t?t:e.constant(t),u):P},u.rect=function(t){return arguments.length?(M=t,u):M},u.select=function(t){return arguments.length?(h=p.select(t),u):h},u.sort=function(t){return arguments.length?(T=t,u):T},u.size=function(t){return arguments.length?(g=t,u):g},u.stroke=function(t){return arguments.length?(E="function"==typeof t?t:e.constant(t),u):E},u.strokeWidth=function(t){return arguments.length?(R="function"==typeof t?t:e.constant(t),u):R},u.sum=function(t){return arguments.length?(W="function"==typeof t?t:e.constant(t),u):W},u.tile=function(t){return arguments.length?(_=t,u):_},u.tooltip=function(t){return arguments.length?(H=t,u):H},u.update=function(t){return void 0===t&&(t=0),v.duration(t)().duration(q),x.duration(t)().duration(q),u},t.length?u():u}var f={rect:u.rect,textBox:i.textBox,tooltip:o.tooltip},p={color:a.color,hierarchy:l.hierarchy,mouse:d.mouse,nest:c.nest,select:d.select,treemap:l.treemap};t.treemap=s,Object.defineProperty(t,"__esModule",{value:!0})});