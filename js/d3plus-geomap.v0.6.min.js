/*
  d3plus-geomap v0.6.12
  A reusable geo map built on D3 and Topojson
  Copyright (c) 2020 D3plus - https://d3plus.org
  @license MIT
*/
(function(t){typeof define==="function"&&define.amd?define(t):t()})(function(){"use strict";var t=typeof globalThis!=="undefined"?globalThis:typeof window!=="undefined"?window:typeof global!=="undefined"?global:typeof self!=="undefined"?self:{};function e(t,e){return e={exports:{}},t(e,e.exports),e.exports}var r=function(t){return t&&t.Math==Math&&t};var l=r(typeof globalThis=="object"&&globalThis)||r(typeof window=="object"&&window)||r(typeof self=="object"&&self)||r(typeof t=="object"&&t)||Function("return this")();var n=function(t){try{return!!t()}catch(t){return true}};var h=!n(function(){return Object.defineProperty({},"a",{get:function(){return 7}}).a!=7});var i={}.propertyIsEnumerable;var o=Object.getOwnPropertyDescriptor;var a=o&&!i.call({1:2},1);var u=a?function t(e){var r=o(this,e);return!!r&&r.enumerable}:i;var d={f:u};var s=function(t,e){return{enumerable:!(t&1),configurable:!(t&2),writable:!(t&4),value:e}};var c={}.toString;var f=function(t){return c.call(t).slice(8,-1)};var p="".split;var j=n(function(){return!Object("z").propertyIsEnumerable(0)})?function(t){return f(t)=="String"?p.call(t,""):Object(t)}:Object;var v=function(t){if(t==undefined)throw TypeError("Can't call method on "+t);return t};var g=function(t){return j(v(t))};var _=function(t){return typeof t==="object"?t!==null:typeof t==="function"};var y=function(t,e){if(!_(t))return t;var r,n;if(e&&typeof(r=t.toString)=="function"&&!_(n=r.call(t)))return n;if(typeof(r=t.valueOf)=="function"&&!_(n=r.call(t)))return n;if(!e&&typeof(r=t.toString)=="function"&&!_(n=r.call(t)))return n;throw TypeError("Can't convert object to primitive value")};var m={}.hasOwnProperty;var b=function(t,e){return m.call(t,e)};var S=l.document;var w=_(S)&&_(S.createElement);var x=function(t){return w?S.createElement(t):{}};var O=!h&&!n(function(){return Object.defineProperty(x("div"),"a",{get:function(){return 7}}).a!=7});var z=Object.getOwnPropertyDescriptor;var P=h?z:function t(e,r){e=g(e);r=y(r,true);if(O)try{return z(e,r)}catch(t){}if(b(e,r))return s(!d.f.call(e,r),e[r])};var k={f:P};var C=function(t){if(!_(t)){throw TypeError(String(t)+" is not an object")}return t};var M=Object.defineProperty;var E=h?M:function t(e,r,n){C(e);r=y(r,true);C(n);if(O)try{return M(e,r,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");if("value"in n)e[r]=n.value;return e};var F={f:E};var A=h?function(t,e,r){return F.f(t,e,s(1,r))}:function(t,e,r){t[e]=r;return t};var G=function(e,r){try{A(l,e,r)}catch(t){l[e]=r}return r};var T="__core-js_shared__";var q=l[T]||G(T,{});var D=q;var I=e(function(t){(t.exports=function(t,e){return D[t]||(D[t]=e!==undefined?e:{})})("versions",[]).push({version:"3.3.3",mode:"global",copyright:"Â© 2019 Denis Pushkarev (zloirock.ru)"})});var L=I("native-function-to-string",Function.toString);var B=l.WeakMap;var N=typeof B==="function"&&/native code/.test(L.call(B));var K=0;var R=Math.random();var V=function(t){return"Symbol("+String(t===undefined?"":t)+")_"+(++K+R).toString(36)};var W=I("keys");var U=function(t){return W[t]||(W[t]=V(t))};var H={};var Y=l.WeakMap;var J,Q,X;var Z=function(t){return X(t)?Q(t):J(t,{})};var $=function(r){return function(t){var e;if(!_(t)||(e=Q(t)).type!==r){throw TypeError("Incompatible receiver, "+r+" required")}return e}};if(N){var tt=new Y;var et=tt.get;var rt=tt.has;var nt=tt.set;J=function(t,e){nt.call(tt,t,e);return e};Q=function(t){return et.call(tt,t)||{}};X=function(t){return rt.call(tt,t)}}else{var it=U("state");H[it]=true;J=function(t,e){A(t,it,e);return e};Q=function(t){return b(t,it)?t[it]:{}};X=function(t){return b(t,it)}}var ot={set:J,get:Q,has:X,enforce:Z,getterFor:$};var at=e(function(t){var e=ot.get;var u=ot.enforce;var s=String(L).split("toString");I("inspectSource",function(t){return L.call(t)});(t.exports=function(t,e,r,n){var i=n?!!n.unsafe:false;var o=n?!!n.enumerable:false;var a=n?!!n.noTargetGet:false;if(typeof r=="function"){if(typeof e=="string"&&!b(r,"name"))A(r,"name",e);u(r).source=s.join(typeof e=="string"?e:"")}if(t===l){if(o)t[e]=r;else G(e,r);return}else if(!i){delete t[e]}else if(!a&&t[e]){o=true}if(o)t[e]=r;else A(t,e,r)})(Function.prototype,"toString",function t(){return typeof this=="function"&&e(this).source||L.call(this)})});var ut=l;var st=function(t){return typeof t=="function"?t:undefined};var ct=function(t,e){return arguments.length<2?st(ut[t])||st(l[t]):ut[t]&&ut[t][e]||l[t]&&l[t][e]};var ft=Math.ceil;var lt=Math.floor;var pt=function(t){return isNaN(t=+t)?0:(t>0?lt:ft)(t)};var ht=Math.min;var dt=function(t){return t>0?ht(pt(t),9007199254740991):0};var vt=Math.max;var gt=Math.min;var _t=function(t,e){var r=pt(t);return r<0?vt(r+e,0):gt(r,e)};var yt=function(u){return function(t,e,r){var n=g(t);var i=dt(n.length);var o=_t(r,i);var a;if(u&&e!=e)while(i>o){a=n[o++];if(a!=a)return true}else for(;i>o;o++){if((u||o in n)&&n[o]===e)return u||o||0}return!u&&-1}};var mt={includes:yt(true),indexOf:yt(false)};var jt=mt.indexOf;var bt=function(t,e){var r=g(t);var n=0;var i=[];var o;for(o in r)!b(H,o)&&b(r,o)&&i.push(o);while(e.length>n)if(b(r,o=e[n++])){~jt(i,o)||i.push(o)}return i};var St=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"];var wt=St.concat("length","prototype");var xt=Object.getOwnPropertyNames||function t(e){return bt(e,wt)};var Ot={f:xt};var zt=Object.getOwnPropertySymbols;var Pt={f:zt};var kt=ct("Reflect","ownKeys")||function t(e){var r=Ot.f(C(e));var n=Pt.f;return n?r.concat(n(e)):r};var Ct=function(t,e){var r=kt(e);var n=F.f;var i=k.f;for(var o=0;o<r.length;o++){var a=r[o];if(!b(t,a))n(t,a,i(e,a))}};var Mt=/#|\.prototype\./;var Et=function(t,e){var r=At[Ft(t)];return r==Tt?true:r==Gt?false:typeof e=="function"?n(e):!!e};var Ft=Et.normalize=function(t){return String(t).replace(Mt,".").toLowerCase()};var At=Et.data={};var Gt=Et.NATIVE="N";var Tt=Et.POLYFILL="P";var qt=Et;var Dt=k.f;var It=function(t,e){var r=t.target;var n=t.global;var i=t.stat;var o,a,u,s,c,f;if(n){a=l}else if(i){a=l[r]||G(r,{})}else{a=(l[r]||{}).prototype}if(a)for(u in e){c=e[u];if(t.noTargetGet){f=Dt(a,u);s=f&&f.value}else s=a[u];o=qt(n?u:r+(i?".":"#")+u,t.forced);if(!o&&s!==undefined){if(typeof c===typeof s)continue;Ct(c,s)}if(t.sham||s&&s.sham){A(c,"sham",true)}at(a,u,c,t)}};var Lt=function(t){if(typeof t!="function"){throw TypeError(String(t)+" is not a function")}return t};var Bt=function(n,i,t){Lt(n);if(i===undefined)return n;switch(t){case 0:return function(){return n.call(i)};case 1:return function(t){return n.call(i,t)};case 2:return function(t,e){return n.call(i,t,e)};case 3:return function(t,e,r){return n.call(i,t,e,r)}}return function(){return n.apply(i,arguments)}};var Nt=function(t){return Object(v(t))};var Kt=Array.isArray||function t(e){return f(e)=="Array"};var Rt=!!Object.getOwnPropertySymbols&&!n(function(){return!String(Symbol())});var Vt=l.Symbol;var Wt=I("wks");var Ut=function(t){return Wt[t]||(Wt[t]=Rt&&Vt[t]||(Rt?Vt:V)("Symbol."+t))};var Ht=Ut("species");var Yt=function(t,e){var r;if(Kt(t)){r=t.constructor;if(typeof r=="function"&&(r===Array||Kt(r.prototype)))r=undefined;else if(_(r)){r=r[Ht];if(r===null)r=undefined}}return new(r===undefined?Array:r)(e===0?0:e)};var Jt=[].push;var Qt=function(h){var d=h==1;var v=h==2;var g=h==3;var _=h==4;var y=h==6;var m=h==5||y;return function(t,e,r,n){var i=Nt(t);var o=j(i);var a=Bt(e,r,3);var u=dt(o.length);var s=0;var c=n||Yt;var f=d?c(t,u):v?c(t,0):undefined;var l,p;for(;u>s;s++)if(m||s in o){l=o[s];p=a(l,s,i);if(h){if(d)f[s]=p;else if(p)switch(h){case 3:return true;case 5:return l;case 6:return s;case 2:Jt.call(f,l)}else if(_)return false}}return y?-1:g||_?_:f}};var Xt={forEach:Qt(0),map:Qt(1),filter:Qt(2),some:Qt(3),every:Qt(4),find:Qt(5),findIndex:Qt(6)};var Zt=Object.keys||function t(e){return bt(e,St)};var $t=h?Object.defineProperties:function t(e,r){C(e);var n=Zt(r);var i=n.length;var o=0;var a;while(i>o)F.f(e,a=n[o++],r[a]);return e};var te=ct("document","documentElement");var ee=U("IE_PROTO");var re="prototype";var ne=function(){};var ie=function(){var t=x("iframe");var e=St.length;var r="<";var n="script";var i=">";var o="java"+n+":";var a;t.style.display="none";te.appendChild(t);t.src=String(o);a=t.contentWindow.document;a.open();a.write(r+n+i+"document.F=Object"+r+"/"+n+i);a.close();ie=a.F;while(e--)delete ie[re][St[e]];return ie()};var oe=Object.create||function t(e,r){var n;if(e!==null){ne[re]=C(e);n=new ne;ne[re]=null;n[ee]=e}else n=ie();return r===undefined?n:$t(n,r)};H[ee]=true;var ae=Ut("unscopables");var ue=Array.prototype;if(ue[ae]==undefined){A(ue,ae,oe(null))}var se=function(t){ue[ae][t]=true};var ce=Xt.find;var fe="find";var le=true;if(fe in[])Array(1)[fe](function(){le=false});It({target:"Array",proto:true,forced:le},{find:function t(e){return ce(this,e,arguments.length>1?arguments[1]:undefined)}});se(fe);var pe=mt.includes;It({target:"Array",proto:true},{includes:function t(e){return pe(this,e,arguments.length>1?arguments[1]:undefined)}});se("includes");var he=Object.assign;var de=!he||n(function(){var t={};var e={};var r=Symbol();var n="abcdefghijklmnopqrst";t[r]=7;n.split("").forEach(function(t){e[t]=t});return he({},t)[r]!=7||Zt(he({},e)).join("")!=n})?function t(e,r){var n=Nt(e);var i=arguments.length;var o=1;var a=Pt.f;var u=d.f;while(i>o){var s=j(arguments[o++]);var c=a?Zt(s).concat(a(s)):Zt(s);var f=c.length;var l=0;var p;while(f>l){p=c[l++];if(!h||u.call(s,p))n[p]=s[p]}}return n}:he;It({target:"Object",stat:true,forced:Object.assign!==de},{assign:de});var ve=Ut("match");var ge=function(t){var e;return _(t)&&((e=t[ve])!==undefined?!!e:f(t)=="RegExp")};var _e=function(t){if(ge(t)){throw TypeError("The method doesn't accept regular expressions")}return t};var ye=Ut("match");var me=function(e){var r=/./;try{"/./"[e](r)}catch(t){try{r[ye]=false;return"/./"[e](r)}catch(t){}}return false};It({target:"String",proto:true,forced:!me("includes")},{includes:function t(e){return!!~String(v(this)).indexOf(_e(e),arguments.length>1?arguments[1]:undefined)}});var je="".startsWith;var be=Math.min;It({target:"String",proto:true,forced:!me("startsWith")},{startsWith:function t(e){var r=String(v(this));_e(e);var n=dt(be(arguments.length>1?arguments[1]:undefined,r.length));var i=String(e);return je?je.call(r,i,n):r.slice(n,n+i.length)===i}});if(typeof window!=="undefined"){(function(){var n=function(t,e){var r=t.nodeType;if(r===3){e.push(t.textContent.replace(/&/,"&amp;").replace(/</,"&lt;").replace(">","&gt;"))}else if(r===1){e.push("<",t.tagName);if(t.hasAttributes()){[].forEach.call(t.attributes,function(t){e.push(" ",t.item.name,"='",t.item.value,"'")})}if(t.hasChildNodes()){e.push(">");[].forEach.call(t.childNodes,function(t){n(t,e)});e.push("</",t.tagName,">")}else{e.push("/>")}}else if(r==8){e.push("\x3c!--",t.nodeValue,"--\x3e")}};Object.defineProperty(SVGElement.prototype,"innerHTML",{get:function(){var t=[];var e=this.firstChild;while(e){n(e,t);e=e.nextSibling}return t.join("")},set:function(t){while(this.firstChild){this.removeChild(this.firstChild)}try{var e=new DOMParser;e.async=false;var r="<svg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'>"+t+"</svg>";var n=e.parseFromString(r,"text/xml").documentElement;var i=n.firstChild;while(i){this.appendChild(this.ownerDocument.importNode(i,true));i=i.nextSibling}}catch(t){}}});Object.defineProperty(SVGElement.prototype,"innerSVG",{get:function(){return this.innerHTML},set:function(t){this.innerHTML=t}})})()}});(function(t,e){typeof exports==="object"&&typeof module!=="undefined"?e(exports,require("d3-array"),require("d3-color"),require("d3-geo"),require("d3-geo-projection"),require("d3-scale"),require("d3-tile"),require("topojson-client"),require("d3plus-common"),require("d3plus-shape"),require("d3plus-viz")):typeof define==="function"&&define.amd?define("d3plus-geomap",["exports","d3-array","d3-color","d3-geo","d3-geo-projection","d3-scale","d3-tile","topojson-client","d3plus-common","d3plus-shape","d3plus-viz"],e):(t=t||self,e(t.d3plus={},t.d3Array,t.d3Color,t.d3GeoCore,t.d3GeoProjection,t.scales,t.d3Tile,t.topojsonClient,t.d3plusCommon,t.d3plusShape,t.d3plusViz))})(this,function(t,z,i,e,r,P,n,o,k,C,a){"use strict";function u(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}function s(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(t,n.key,n)}}function c(t,e,r){if(e)s(t.prototype,e);if(r)s(t,r);return t}function f(t,e){if(typeof e!=="function"&&e!==null){throw new TypeError("Super expression must either be null or a function")}t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:true,configurable:true}});if(e)l(t,e)}function M(t){M=Object.setPrototypeOf?Object.getPrototypeOf:function t(e){return e.__proto__||Object.getPrototypeOf(e)};return M(t)}function l(t,e){l=Object.setPrototypeOf||function t(e,r){e.__proto__=r;return e};return l(t,e)}function p(t){if(t===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t}function h(t,e){if(e&&(typeof e==="object"||typeof e==="function")){return e}return p(t)}function d(t,e){while(!Object.prototype.hasOwnProperty.call(t,e)){t=M(t);if(t===null)break}return t}function E(t,e,r){if(typeof Reflect!=="undefined"&&Reflect.get){E=Reflect.get}else{E=function t(e,r,n){var i=d(e,r);if(!i)return;var o=Object.getOwnPropertyDescriptor(i,r);if(o.get){return o.get.call(n)}return o.value}}return E(t,e,r||t)}var F=Object.assign({},e,r);function A(t,e){var r=e&&t.objects[e]?e:Object.keys(t.objects)[0];return o.feature(t,t.objects[r])}var v=function(t){f(O,t);function O(){var o;u(this,O);o=h(this,M(O).call(this));o._fitObject=false;o._noDataMessage=false;o._ocean="#d4dadc";o._point=k.accessor("point");o._pointSize=k.constant(1);o._pointSizeMax=10;o._pointSizeMin=5;o._pointSizeScale="linear";o._projection=F.geoMercator();o._projectionPadding=k.parseSides(20);o._shape=k.constant("Circle");o._shapeConfig=k.assign(o._shapeConfig,{ariaLabel:function t(e,r){return"".concat(o._drawLabel(e,r),", ").concat(o._pointSize(e,r))},hoverOpacity:1,Path:{ariaLabel:function t(e,r){var n=o._colorScale?", ".concat(o._colorScale(e,r)):"";return"".concat(o._drawLabel(e,r)).concat(n,".")},fill:function t(e,r){if(o._colorScale&&!o._coordData.features.includes(e)){var n=o._colorScale(e);if(n!==undefined&&n!==null){if(o._colorScaleClass._colorScale){return o._colorScaleClass._colorScale(n)}else{var i=o._colorScaleClass.color();if(i instanceof Array)i=i[i.length-1];return i}}}return o._topojsonFill(e,r)},on:{mouseenter:function t(e){return!o._coordData.features.includes(e)?o._on.mouseenter.bind(p(o))(e):null},"mousemove.shape":function t(e){return!o._coordData.features.includes(e)?o._on["mousemove.shape"].bind(p(o))(e):null},mouseleave:function t(e){return!o._coordData.features.includes(e)?o._on.mouseleave.bind(p(o))(e):null}},stroke:function t(e,r){var n=typeof o._shapeConfig.Path.fill==="function"?o._shapeConfig.Path.fill(e,r):o._shapeConfig.Path.fill;return i.color(n).darker()},strokeWidth:1}});o._tiles=true;o._tileGen=n.tile().wrap(false);o._tileUrl="https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}@2x.png";o._topojson=false;o._topojsonFill=k.constant("#f5f5f3");o._topojsonFilter=function(t){return!["010"].includes(t.id)};o._topojsonId=k.accessor("id");o._zoom=true;o._zoomSet=false;return o}c(O,[{key:"_renderTiles",value:function t(e){var r=this;var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var i=[];if(this._tiles){i=this._tileGen.extent(this._zoomBehavior.translateExtent()).scale(this._projection.scale()*(2*Math.PI)*e.k).translate(e.apply(this._projection.translate()))();this._tileGroup.transition().duration(n).attr("transform",e)}var o=this._tileGroup.selectAll("image.d3plus-geomap-tile").data(i,function(t){return"".concat(t.x,"-").concat(t.y,"-").concat(t.z)});o.exit().transition().duration(n).attr("opacity",0).remove();var a=i.scale/e.k;o.enter().append("image").attr("class","d3plus-geomap-tile").attr("opacity",0).attr("xlink:href",function(t){return r._tileUrl.replace("{s}",["a","b","c"][Math.random()*3|0]).replace("{z}",t.z).replace("{x}",t.x).replace("{y}",t.y)}).attr("width",a).attr("height",a).attr("x",function(t){return t.x*a+i.translate[0]*a-e.x/e.k}).attr("y",function(t){return t.y*a+i.translate[1]*a-e.y/e.k}).transition().duration(n).attr("opacity",1);o.attr("width",a).attr("height",a).attr("x",function(t){return t.x*a+i.translate[0]*a-e.x/e.k}).attr("y",function(t){return t.y*a+i.translate[1]*a-e.y/e.k})}},{key:"_draw",value:function t(e){var n=this;E(M(O.prototype),"_draw",this).call(this,e);var r=this._height-this._margin.top-this._margin.bottom,i=this._width-this._margin.left-this._margin.right;this._container=this._select.selectAll("svg.d3plus-geomap").data([0]);this._container=this._container.enter().append("svg").attr("class","d3plus-geomap").attr("opacity",0).attr("width",i).attr("height",r).attr("x",this._margin.left).attr("y",this._margin.top).style("background-color",this._ocean||"transparent").merge(this._container);this._container.transition(this._transition).attr("opacity",1).attr("width",i).attr("height",r).attr("x",this._margin.left).attr("y",this._margin.top);var o=this._container.selectAll("rect.d3plus-geomap-ocean").data([0]);o.enter().append("rect").attr("class","d3plus-geomap-ocean").merge(o).attr("width",i).attr("height",r).attr("fill",this._ocean||"transparent");this._tileGroup=this._container.selectAll("g.d3plus-geomap-tileGroup").data([0]);this._tileGroup=this._tileGroup.enter().append("g").attr("class","d3plus-geomap-tileGroup").merge(this._tileGroup);this._zoomGroup=this._container.selectAll("g.d3plus-geomap-zoomGroup").data([0]);this._zoomGroup=this._zoomGroup.enter().append("g").attr("class","d3plus-geomap-zoomGroup").merge(this._zoomGroup);var a=this._zoomGroup.selectAll("g.d3plus-geomap-paths").data([0]);a=a.enter().append("g").attr("class","d3plus-geomap-paths").merge(a);var u=this._coordData=this._topojson?A(this._topojson,this._topojsonKey):{type:"FeatureCollection",features:[]};if(this._topojsonFilter)u.features=u.features.filter(this._topojsonFilter);var s=this._path=F.geoPath().projection(this._projection);var c=this._filteredData.filter(function(t,e){return n._point(t,e)instanceof Array});var f=this._filteredData.filter(function(t,e){return!(n._point(t,e)instanceof Array)}).reduce(function(t,e){t[n._id(e)]=e;return t},{});var l=u.features.reduce(function(t,e){var r=n._topojsonId(e);t.push({__d3plus__:true,data:f[r],feature:e,id:r});return t},[]);var p=P["scale".concat(this._pointSizeScale.charAt(0).toUpperCase()).concat(this._pointSizeScale.slice(1))]().domain(z.extent(c,function(t,e){return n._pointSize(t,e)})).range([this._pointSizeMin,this._pointSizeMax]);if(!this._zoomSet){var h=this._fitObject?A(this._fitObject,this._fitKey):u;this._extentBounds={type:"FeatureCollection",features:this._fitFilter?h.features.filter(this._fitFilter):h.features.slice()};this._extentBounds.features=this._extentBounds.features.reduce(function(t,e){if(e.geometry){var r={type:e.type,id:e.id,geometry:{coordinates:e.geometry.coordinates,type:e.geometry.type}};if(e.geometry.type==="MultiPolygon"&&e.geometry.coordinates.length>1){var n=[],i=[];e.geometry.coordinates.forEach(function(t){r.geometry.coordinates=[t];n.push(s.area(r))});r.geometry.coordinates=[e.geometry.coordinates[n.indexOf(z.max(n))]];var o=s.centroid(r);e.geometry.coordinates.forEach(function(t){r.geometry.coordinates=[t];i.push(C.pointDistance(s.centroid(r),o))});var a=z.quantile(n.reduce(function(t,e,r){if(e)t.push(n[r]/e);return t},[]),.9);r.geometry.coordinates=e.geometry.coordinates.filter(function(t,e){var r=i[e];return r===0||n[e]/r>=a})}t.push(r)}return t},[]);if(!this._extentBounds.features.length&&c.length){var d=[[undefined,undefined],[undefined,undefined]];c.forEach(function(t,e){var r=n._projection(n._point(t,e));if(d[0][0]===void 0||r[0]<d[0][0])d[0][0]=r[0];if(d[1][0]===void 0||r[0]>d[1][0])d[1][0]=r[0];if(d[0][1]===void 0||r[1]<d[0][1])d[0][1]=r[1];if(d[1][1]===void 0||r[1]>d[1][1])d[1][1]=r[1]});this._extentBounds={type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"MultiPoint",coordinates:d.map(function(t){return n._projection.invert(t)})}}]};var v=z.max(c,function(t,e){return p(n._pointSize(t,e))});this._projectionPadding.top+=v;this._projectionPadding.right+=v;this._projectionPadding.bottom+=v;this._projectionPadding.left+=v}this._zoomBehavior.extent([[0,0],[i,r]]).scaleExtent([1,this._zoomMax]).translateExtent([[0,0],[i,r]]);this._zoomSet=true}this._projection=this._projection.fitExtent(this._extentBounds.features.length?[[this._projectionPadding.left,this._projectionPadding.top],[i-this._projectionPadding.right,r-this._projectionPadding.bottom]]:[[0,0],[i,r]],this._extentBounds.features.length?this._extentBounds:{type:"Sphere"});this._shapes.push((new C.Path).data(l).d(function(t){return s(t.feature)}).select(a.node()).x(0).y(0).config(k.configPrep.bind(this)(this._shapeConfig,"shape","Path")).render());var g=this._zoomGroup.selectAll("g.d3plus-geomap-pins").data([0]);g=g.enter().append("g").attr("class","d3plus-geomap-pins").merge(g);var _=(new C.Circle).config(k.configPrep.bind(this)(this._shapeConfig,"shape","Circle")).data(c).r(function(t,e){return p(n._pointSize(t,e))}).select(g.node()).sort(function(t,e){return n._pointSize(e)-n._pointSize(t)}).x(function(t,e){return n._projection(n._point(t,e))[0]}).y(function(t,e){return n._projection(n._point(t,e))[1]});var y=Object.keys(this._on);var m=y.filter(function(t){return t.includes(".Circle")}),j=y.filter(function(t){return!t.includes(".")}),b=y.filter(function(t){return t.includes(".shape")});for(var S=0;S<j.length;S++){_.on(j[S],this._on[j[S]])}for(var w=0;w<b.length;w++){_.on(b[w],this._on[b[w]])}for(var x=0;x<m.length;x++){_.on(m[x],this._on[m[x]])}this._shapes.push(_.render());return this}},{key:"fitFilter",value:function t(e){if(arguments.length){this._zoomSet=false;if(typeof e==="function")return this._fitFilter=e,this;if(!(e instanceof Array))e=[e];return this._fitFilter=function(t){return e.includes(t.id)},this}return this._fitFilter}},{key:"fitKey",value:function t(e){if(arguments.length){this._fitKey=e;this._zoomSet=false;return this}return this._fitKey}},{key:"fitObject",value:function t(e,r){if(arguments.length){if(typeof e==="string"){var n=this._queue.find(function(t){return t[3]==="fitObject"});var i=[a.dataLoad.bind(this),e,r,"fitObject"];if(n)this._queue[this._queue.indexOf(n)]=i;else this._queue.push(i)}else{this._fitObject=e}this._zoomSet=false;return this}return this._fitObject}},{key:"ocean",value:function t(e){return arguments.length?(this._ocean=e,this):this._ocean}},{key:"point",value:function t(e){return arguments.length?(this._point=typeof e==="function"?e:k.constant(e),this):this._point}},{key:"pointSize",value:function t(e){return arguments.length?(this._pointSize=typeof e==="function"?e:k.constant(e),this):this._pointSize}},{key:"pointSizeMax",value:function t(e){return arguments.length?(this._pointSizeMax=e,this):this._pointSizeMax}},{key:"pointSizeMin",value:function t(e){return arguments.length?(this._pointSizeMin=e,this):this._pointSizeMin}},{key:"projection",value:function t(e){if(arguments.length&&e!=="geoMercator")this._tiles=false;return arguments.length?(this._projection=typeof e==="string"?F[e]?F[e]():F.geoMercator():e,this):this._projection}},{key:"projectionPadding",value:function t(e){return arguments.length?(this._projectionPadding=k.parseSides(e),this):this._projectionPadding}},{key:"projectionRotate",value:function t(e){if(arguments.length){this._projection.rotate(e);this._tiles=false;this._zoomSet=false;return this}else{return this._projectionRotate}}},{key:"tiles",value:function t(e){return arguments.length?(this._tiles=e,this):this._tiles}},{key:"tileUrl",value:function t(e){return arguments.length?(this._tileUrl=e,this):this._tileUrl}},{key:"topojson",value:function t(e,r){if(arguments.length){if(typeof e==="string"){var n=this._queue.find(function(t){return t[3]==="topojson"});var i=[a.dataLoad.bind(this),e,r,"topojson"];if(n)this._queue[this._queue.indexOf(n)]=i;else this._queue.push(i)}else{this._topojson=e}this._zoomSet=false;return this}return this._topojson}},{key:"topojsonFill",value:function t(e){return arguments.length?(this._topojsonFill=typeof e==="function"?e:k.constant(e),this):this._topojsonFill}},{key:"topojsonFilter",value:function t(e){if(arguments.length){this._zoomSet=false;if(typeof e==="function")return this._topojsonFilter=e,this;if(!(e instanceof Array))e=[e];return this._topojsonFilter=function(t){return e.includes(t.id)},this}return this._topojsonFilter}},{key:"topojsonKey",value:function t(e){if(arguments.length){this._topojsonKey=e;this._zoomSet=false;return this}return this._topojsonKey}},{key:"topojsonId",value:function t(e){return arguments.length?(this._topojsonId=typeof e==="function"?e:k.accessor(e),this):this._topojsonId}}]);return O}(a.Viz);t.Geomap=v;Object.defineProperty(t,"__esModule",{value:true})});