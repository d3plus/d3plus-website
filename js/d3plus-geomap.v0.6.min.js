/*
  d3plus-geomap v0.6.13
  A reusable geo map built on D3 and Topojson
  Copyright (c) 2020 D3plus - https://d3plus.org
  @license MIT
*/
(function(t){typeof define==="function"&&define.amd?define(t):t()})(function(){"use strict";var t=typeof globalThis!=="undefined"?globalThis:typeof window!=="undefined"?window:typeof global!=="undefined"?global:typeof self!=="undefined"?self:{};function e(t,e){return e={exports:{}},t(e,e.exports),e.exports}var r=function(t){return t&&t.Math==Math&&t};var l=r(typeof globalThis=="object"&&globalThis)||r(typeof window=="object"&&window)||r(typeof self=="object"&&self)||r(typeof t=="object"&&t)||Function("return this")();var n=function(t){try{return!!t()}catch(t){return true}};var h=!n(function(){return Object.defineProperty({},"a",{get:function(){return 7}}).a!=7});var i={}.propertyIsEnumerable;var o=Object.getOwnPropertyDescriptor;var a=o&&!i.call({1:2},1);var s=a?function t(e){var r=o(this,e);return!!r&&r.enumerable}:i;var d={f:s};var u=function(t,e){return{enumerable:!(t&1),configurable:!(t&2),writable:!(t&4),value:e}};var c={}.toString;var f=function(t){return c.call(t).slice(8,-1)};var p="".split;var b=n(function(){return!Object("z").propertyIsEnumerable(0)})?function(t){return f(t)=="String"?p.call(t,""):Object(t)}:Object;var v=function(t){if(t==undefined)throw TypeError("Can't call method on "+t);return t};var g=function(t){return b(v(t))};var _=function(t){return typeof t==="object"?t!==null:typeof t==="function"};var y=function(t,e){if(!_(t))return t;var r,n;if(e&&typeof(r=t.toString)=="function"&&!_(n=r.call(t)))return n;if(typeof(r=t.valueOf)=="function"&&!_(n=r.call(t)))return n;if(!e&&typeof(r=t.toString)=="function"&&!_(n=r.call(t)))return n;throw TypeError("Can't convert object to primitive value")};var m={}.hasOwnProperty;var j=function(t,e){return m.call(t,e)};var S=l.document;var w=_(S)&&_(S.createElement);var O=function(t){return w?S.createElement(t):{}};var x=!h&&!n(function(){return Object.defineProperty(O("div"),"a",{get:function(){return 7}}).a!=7});var z=Object.getOwnPropertyDescriptor;var k=h?z:function t(e,r){e=g(e);r=y(r,true);if(x)try{return z(e,r)}catch(t){}if(j(e,r))return u(!d.f.call(e,r),e[r])};var P={f:k};var C=function(t){if(!_(t)){throw TypeError(String(t)+" is not an object")}return t};var M=Object.defineProperty;var E=h?M:function t(e,r,n){C(e);r=y(r,true);C(n);if(x)try{return M(e,r,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");if("value"in n)e[r]=n.value;return e};var A={f:E};var F=h?function(t,e,r){return A.f(t,e,u(1,r))}:function(t,e,r){t[e]=r;return t};var T=function(e,r){try{F(l,e,r)}catch(t){l[e]=r}return r};var G="__core-js_shared__";var q=l[G]||T(G,{});var D=q;var I=e(function(t){(t.exports=function(t,e){return D[t]||(D[t]=e!==undefined?e:{})})("versions",[]).push({version:"3.3.3",mode:"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})});var L=I("native-function-to-string",Function.toString);var B=l.WeakMap;var N=typeof B==="function"&&/native code/.test(L.call(B));var R=0;var K=Math.random();var U=function(t){return"Symbol("+String(t===undefined?"":t)+")_"+(++R+K).toString(36)};var V=I("keys");var W=function(t){return V[t]||(V[t]=U(t))};var Y={};var H=l.WeakMap;var Z,J,Q;var X=function(t){return Q(t)?J(t):Z(t,{})};var $=function(r){return function(t){var e;if(!_(t)||(e=J(t)).type!==r){throw TypeError("Incompatible receiver, "+r+" required")}return e}};if(N){var tt=new H;var et=tt.get;var rt=tt.has;var nt=tt.set;Z=function(t,e){nt.call(tt,t,e);return e};J=function(t){return et.call(tt,t)||{}};Q=function(t){return rt.call(tt,t)}}else{var it=W("state");Y[it]=true;Z=function(t,e){F(t,it,e);return e};J=function(t){return j(t,it)?t[it]:{}};Q=function(t){return j(t,it)}}var ot={set:Z,get:J,has:Q,enforce:X,getterFor:$};var at=e(function(t){var e=ot.get;var s=ot.enforce;var u=String(L).split("toString");I("inspectSource",function(t){return L.call(t)});(t.exports=function(t,e,r,n){var i=n?!!n.unsafe:false;var o=n?!!n.enumerable:false;var a=n?!!n.noTargetGet:false;if(typeof r=="function"){if(typeof e=="string"&&!j(r,"name"))F(r,"name",e);s(r).source=u.join(typeof e=="string"?e:"")}if(t===l){if(o)t[e]=r;else T(e,r);return}else if(!i){delete t[e]}else if(!a&&t[e]){o=true}if(o)t[e]=r;else F(t,e,r)})(Function.prototype,"toString",function t(){return typeof this=="function"&&e(this).source||L.call(this)})});var st=l;var ut=function(t){return typeof t=="function"?t:undefined};var ct=function(t,e){return arguments.length<2?ut(st[t])||ut(l[t]):st[t]&&st[t][e]||l[t]&&l[t][e]};var ft=Math.ceil;var lt=Math.floor;var pt=function(t){return isNaN(t=+t)?0:(t>0?lt:ft)(t)};var ht=Math.min;var dt=function(t){return t>0?ht(pt(t),9007199254740991):0};var vt=Math.max;var gt=Math.min;var _t=function(t,e){var r=pt(t);return r<0?vt(r+e,0):gt(r,e)};var yt=function(s){return function(t,e,r){var n=g(t);var i=dt(n.length);var o=_t(r,i);var a;if(s&&e!=e)while(i>o){a=n[o++];if(a!=a)return true}else for(;i>o;o++){if((s||o in n)&&n[o]===e)return s||o||0}return!s&&-1}};var mt={includes:yt(true),indexOf:yt(false)};var bt=mt.indexOf;var jt=function(t,e){var r=g(t);var n=0;var i=[];var o;for(o in r)!j(Y,o)&&j(r,o)&&i.push(o);while(e.length>n)if(j(r,o=e[n++])){~bt(i,o)||i.push(o)}return i};var St=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"];var wt=St.concat("length","prototype");var Ot=Object.getOwnPropertyNames||function t(e){return jt(e,wt)};var xt={f:Ot};var zt=Object.getOwnPropertySymbols;var kt={f:zt};var Pt=ct("Reflect","ownKeys")||function t(e){var r=xt.f(C(e));var n=kt.f;return n?r.concat(n(e)):r};var Ct=function(t,e){var r=Pt(e);var n=A.f;var i=P.f;for(var o=0;o<r.length;o++){var a=r[o];if(!j(t,a))n(t,a,i(e,a))}};var Mt=/#|\.prototype\./;var Et=function(t,e){var r=Ft[At(t)];return r==Gt?true:r==Tt?false:typeof e=="function"?n(e):!!e};var At=Et.normalize=function(t){return String(t).replace(Mt,".").toLowerCase()};var Ft=Et.data={};var Tt=Et.NATIVE="N";var Gt=Et.POLYFILL="P";var qt=Et;var Dt=P.f;var It=function(t,e){var r=t.target;var n=t.global;var i=t.stat;var o,a,s,u,c,f;if(n){a=l}else if(i){a=l[r]||T(r,{})}else{a=(l[r]||{}).prototype}if(a)for(s in e){c=e[s];if(t.noTargetGet){f=Dt(a,s);u=f&&f.value}else u=a[s];o=qt(n?s:r+(i?".":"#")+s,t.forced);if(!o&&u!==undefined){if(typeof c===typeof u)continue;Ct(c,u)}if(t.sham||u&&u.sham){F(c,"sham",true)}at(a,s,c,t)}};var Lt=function(t){if(typeof t!="function"){throw TypeError(String(t)+" is not a function")}return t};var Bt=function(n,i,t){Lt(n);if(i===undefined)return n;switch(t){case 0:return function(){return n.call(i)};case 1:return function(t){return n.call(i,t)};case 2:return function(t,e){return n.call(i,t,e)};case 3:return function(t,e,r){return n.call(i,t,e,r)}}return function(){return n.apply(i,arguments)}};var Nt=function(t){return Object(v(t))};var Rt=Array.isArray||function t(e){return f(e)=="Array"};var Kt=!!Object.getOwnPropertySymbols&&!n(function(){return!String(Symbol())});var Ut=l.Symbol;var Vt=I("wks");var Wt=function(t){return Vt[t]||(Vt[t]=Kt&&Ut[t]||(Kt?Ut:U)("Symbol."+t))};var Yt=Wt("species");var Ht=function(t,e){var r;if(Rt(t)){r=t.constructor;if(typeof r=="function"&&(r===Array||Rt(r.prototype)))r=undefined;else if(_(r)){r=r[Yt];if(r===null)r=undefined}}return new(r===undefined?Array:r)(e===0?0:e)};var Zt=[].push;var Jt=function(h){var d=h==1;var v=h==2;var g=h==3;var _=h==4;var y=h==6;var m=h==5||y;return function(t,e,r,n){var i=Nt(t);var o=b(i);var a=Bt(e,r,3);var s=dt(o.length);var u=0;var c=n||Ht;var f=d?c(t,s):v?c(t,0):undefined;var l,p;for(;s>u;u++)if(m||u in o){l=o[u];p=a(l,u,i);if(h){if(d)f[u]=p;else if(p)switch(h){case 3:return true;case 5:return l;case 6:return u;case 2:Zt.call(f,l)}else if(_)return false}}return y?-1:g||_?_:f}};var Qt={forEach:Jt(0),map:Jt(1),filter:Jt(2),some:Jt(3),every:Jt(4),find:Jt(5),findIndex:Jt(6)};var Xt=Object.keys||function t(e){return jt(e,St)};var $t=h?Object.defineProperties:function t(e,r){C(e);var n=Xt(r);var i=n.length;var o=0;var a;while(i>o)A.f(e,a=n[o++],r[a]);return e};var te=ct("document","documentElement");var ee=W("IE_PROTO");var re="prototype";var ne=function(){};var ie=function(){var t=O("iframe");var e=St.length;var r="<";var n="script";var i=">";var o="java"+n+":";var a;t.style.display="none";te.appendChild(t);t.src=String(o);a=t.contentWindow.document;a.open();a.write(r+n+i+"document.F=Object"+r+"/"+n+i);a.close();ie=a.F;while(e--)delete ie[re][St[e]];return ie()};var oe=Object.create||function t(e,r){var n;if(e!==null){ne[re]=C(e);n=new ne;ne[re]=null;n[ee]=e}else n=ie();return r===undefined?n:$t(n,r)};Y[ee]=true;var ae=Wt("unscopables");var se=Array.prototype;if(se[ae]==undefined){F(se,ae,oe(null))}var ue=function(t){se[ae][t]=true};var ce=Qt.find;var fe="find";var le=true;if(fe in[])Array(1)[fe](function(){le=false});It({target:"Array",proto:true,forced:le},{find:function t(e){return ce(this,e,arguments.length>1?arguments[1]:undefined)}});ue(fe);var pe=mt.includes;It({target:"Array",proto:true},{includes:function t(e){return pe(this,e,arguments.length>1?arguments[1]:undefined)}});ue("includes");var he=Object.assign;var de=!he||n(function(){var t={};var e={};var r=Symbol();var n="abcdefghijklmnopqrst";t[r]=7;n.split("").forEach(function(t){e[t]=t});return he({},t)[r]!=7||Xt(he({},e)).join("")!=n})?function t(e,r){var n=Nt(e);var i=arguments.length;var o=1;var a=kt.f;var s=d.f;while(i>o){var u=b(arguments[o++]);var c=a?Xt(u).concat(a(u)):Xt(u);var f=c.length;var l=0;var p;while(f>l){p=c[l++];if(!h||s.call(u,p))n[p]=u[p]}}return n}:he;It({target:"Object",stat:true,forced:Object.assign!==de},{assign:de});var ve=Wt("match");var ge=function(t){var e;return _(t)&&((e=t[ve])!==undefined?!!e:f(t)=="RegExp")};var _e=function(t){if(ge(t)){throw TypeError("The method doesn't accept regular expressions")}return t};var ye=Wt("match");var me=function(e){var r=/./;try{"/./"[e](r)}catch(t){try{r[ye]=false;return"/./"[e](r)}catch(t){}}return false};It({target:"String",proto:true,forced:!me("includes")},{includes:function t(e){return!!~String(v(this)).indexOf(_e(e),arguments.length>1?arguments[1]:undefined)}});var be="".startsWith;var je=Math.min;It({target:"String",proto:true,forced:!me("startsWith")},{startsWith:function t(e){var r=String(v(this));_e(e);var n=dt(je(arguments.length>1?arguments[1]:undefined,r.length));var i=String(e);return be?be.call(r,i,n):r.slice(n,n+i.length)===i}});if(typeof window!=="undefined"){(function(){var n=function(t,e){var r=t.nodeType;if(r===3){e.push(t.textContent.replace(/&/,"&amp;").replace(/</,"&lt;").replace(">","&gt;"))}else if(r===1){e.push("<",t.tagName);if(t.hasAttributes()){[].forEach.call(t.attributes,function(t){e.push(" ",t.item.name,"='",t.item.value,"'")})}if(t.hasChildNodes()){e.push(">");[].forEach.call(t.childNodes,function(t){n(t,e)});e.push("</",t.tagName,">")}else{e.push("/>")}}else if(r==8){e.push("\x3c!--",t.nodeValue,"--\x3e")}};Object.defineProperty(SVGElement.prototype,"innerHTML",{get:function(){var t=[];var e=this.firstChild;while(e){n(e,t);e=e.nextSibling}return t.join("")},set:function(t){while(this.firstChild){this.removeChild(this.firstChild)}try{var e=new DOMParser;e.async=false;var r="<svg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'>"+t+"</svg>";var n=e.parseFromString(r,"text/xml").documentElement;var i=n.firstChild;while(i){this.appendChild(this.ownerDocument.importNode(i,true));i=i.nextSibling}}catch(t){}}});Object.defineProperty(SVGElement.prototype,"innerSVG",{get:function(){return this.innerHTML},set:function(t){this.innerHTML=t}})})()}});(function(t,e){typeof exports==="object"&&typeof module!=="undefined"?e(exports,require("d3-array"),require("d3-color"),require("d3-zoom"),require("d3-geo"),require("d3-geo-projection"),require("d3-scale"),require("d3-tile"),require("topojson-client"),require("d3plus-common"),require("d3plus-shape"),require("d3plus-viz")):typeof define==="function"&&define.amd?define("d3plus-geomap",["exports","d3-array","d3-color","d3-zoom","d3-geo","d3-geo-projection","d3-scale","d3-tile","topojson-client","d3plus-common","d3plus-shape","d3plus-viz"],e):(t=t||self,e(t.d3plus={},t.d3Array,t.d3Color,t.d3Zoom,t.d3GeoCore,t.d3GeoProjection,t.scales,t.d3Tile,t.topojsonClient,t.d3plusCommon,t.d3plusShape,t.d3plusViz))})(this,function(t,z,i,u,e,r,k,n,o,P,C,a){"use strict";function s(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}function c(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(t,n.key,n)}}function f(t,e,r){if(e)c(t.prototype,e);if(r)c(t,r);return t}function l(t,e){if(typeof e!=="function"&&e!==null){throw new TypeError("Super expression must either be null or a function")}t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:true,configurable:true}});if(e)p(t,e)}function M(t){M=Object.setPrototypeOf?Object.getPrototypeOf:function t(e){return e.__proto__||Object.getPrototypeOf(e)};return M(t)}function p(t,e){p=Object.setPrototypeOf||function t(e,r){e.__proto__=r;return e};return p(t,e)}function h(t){if(t===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t}function d(t,e){if(e&&(typeof e==="object"||typeof e==="function")){return e}return h(t)}function v(t,e){while(!Object.prototype.hasOwnProperty.call(t,e)){t=M(t);if(t===null)break}return t}function E(t,e,r){if(typeof Reflect!=="undefined"&&Reflect.get){E=Reflect.get}else{E=function t(e,r,n){var i=v(e,r);if(!i)return;var o=Object.getOwnPropertyDescriptor(i,r);if(o.get){return o.get.call(n)}return o.value}}return E(t,e,r||t)}function g(t,e){return _(t)||y(t,e)||m()}function _(t){if(Array.isArray(t))return t}function y(t,e){if(!(Symbol.iterator in Object(t)||Object.prototype.toString.call(t)==="[object Arguments]")){return}var r=[];var n=true;var i=false;var o=undefined;try{for(var a=t[Symbol.iterator](),s;!(n=(s=a.next()).done);n=true){r.push(s.value);if(e&&r.length===e)break}}catch(t){i=true;o=t}finally{try{if(!n&&a["return"]!=null)a["return"]()}finally{if(i)throw o}}return r}function m(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}var b=[{matches:["cartodb","cartocdn"],text:"© <a href='http://www.openstreetmap.org/copyright' target='_blank'>OpenStreetMap</a> contributors, © <a href='https://carto.com/attribution' target='_blank'>CARTO</a>"},{matches:["opentopomap.org"],text:"© <a href='http://www.openstreetmap.org/copyright' target='_blank'>OpenStreetMap</a> contributors"},{matches:["arcgisonline.com"],text:"Powered by <a href='https://developers.arcgis.com/terms/attribution/' target='_blank'>Esri</a>"},{matches:["/watercolor/"],text:"Map tiles by <a href='http://stamen.com' target='_blank'>Stamen Design</a>, under <a href='http://creativecommons.org/licenses/by/3.0' target='_blank'>CC BY 3.0</a>. Data by <a href='http://openstreetmap.org' target='_blank'>OpenStreetMap</a>, under <a href='http://www.openstreetmap.org/copyright' target='_blank'>ODbL</a>."},{matches:["stamen-tiles","stamen.com"],text:"Map tiles by <a href='http://stamen.com' target='_blank'>Stamen Design</a>, under <a href='http://creativecommons.org/licenses/by/3.0' target='_blank'>CC BY 3.0</a>. Data by <a href='http://openstreetmap.org' target='_blank'>OpenStreetMap</a>, under <a href='http://creativecommons.org/licenses/by-sa/3.0' target='_blank'>CC BY SA</a>."}];var A=Object.assign({},e,r);function j(e){var t=b.find(function(t){return t.matches.some(function(t){return e.includes(t)})});return t?t.text:false}function F(t,e){var r=e&&t.objects[e]?e:Object.keys(t.objects)[0];return o.feature(t,r)}var S=function(t){l(x,t);function x(){var o;s(this,x);o=d(this,M(x).call(this));o._fitObject=false;o._noDataMessage=false;o._ocean="#d4dadc";o._point=P.accessor("point");o._pointSize=P.constant(1);o._pointSizeMax=10;o._pointSizeMin=5;o._pointSizeScale="linear";o._projection=A.geoMercator();o._projectionPadding=P.parseSides(20);o._shape=P.constant("Circle");o._shapeConfig=P.assign(o._shapeConfig,{ariaLabel:function t(e,r){return"".concat(o._drawLabel(e,r),", ").concat(o._pointSize(e,r))},hoverOpacity:1,Path:{ariaLabel:function t(e,r){var n=o._colorScale?", ".concat(o._colorScale(e,r)):"";return"".concat(o._drawLabel(e,r)).concat(n,".")},fill:function t(e,r){if(o._colorScale&&!o._coordData.features.includes(e)){var n=o._colorScale(e);if(n!==undefined&&n!==null){if(o._colorScaleClass._colorScale){return o._colorScaleClass._colorScale(n)}else{var i=o._colorScaleClass.color();if(i instanceof Array)i=i[i.length-1];return i}}}return o._topojsonFill(e,r)},on:{mouseenter:function t(e){return!o._coordData.features.includes(e)?o._on.mouseenter.bind(h(o))(e):null},"mousemove.shape":function t(e){return!o._coordData.features.includes(e)?o._on["mousemove.shape"].bind(h(o))(e):null},mouseleave:function t(e){return!o._coordData.features.includes(e)?o._on.mouseleave.bind(h(o))(e):null}},stroke:function t(e,r){var n=typeof o._shapeConfig.Path.fill==="function"?o._shapeConfig.Path.fill(e,r):o._shapeConfig.Path.fill;return i.color(n).darker()},strokeWidth:1}});o._tiles=true;o._tileGen=n.tile();o.tileUrl("https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}@2x.png");o._topojson=false;o._topojsonFill=P.constant("#f5f5f3");o._topojsonFilter=function(t){return!["010"].includes(t.id)};o._topojsonId=P.accessor("id");o._zoom=true;o._zoomSet=false;return o}f(x,[{key:"_renderTiles",value:function t(){var o=this;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:u.zoomTransform(this._container.node());var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var i=[];if(this._tiles){i=this._tileGen.extent(this._zoomBehavior.translateExtent()).scale(this._projection.scale()*(2*Math.PI)*n.k).translate(n.apply(this._projection.translate()))();this._tileGroup.transition().duration(e).attr("transform",n)}var r=this._tileGroup.selectAll("image.d3plus-geomap-tile").data(i,function(t){var e=g(t,3),r=e[0],n=e[1],i=e[2];return"".concat(r,"-").concat(n,"-").concat(i)});r.exit().transition().duration(e).attr("opacity",0).remove();var a=i.scale/n.k;var s=r.enter().append("image").attr("class","d3plus-geomap-tile");s.attr("opacity",0).transition().duration(e).attr("opacity",1);r.merge(s).attr("width",a).attr("height",a).attr("xlink:href",function(t){var e=g(t,3),r=e[0],n=e[1],i=e[2];return o._tileUrl.replace("{s}",["a","b","c"][Math.random()*3|0]).replace("{z}",i).replace("{x}",r).replace("{y}",n)}).attr("x",function(t){var e=g(t,1),r=e[0];return r*a+i.translate[0]*a-n.x/n.k}).attr("y",function(t){var e=g(t,2),r=e[1];return r*a+i.translate[1]*a-n.y/n.k})}},{key:"_draw",value:function t(e){var n=this;E(M(x.prototype),"_draw",this).call(this,e);var r=this._height-this._margin.top-this._margin.bottom,i=this._width-this._margin.left-this._margin.right;this._container=this._select.selectAll("svg.d3plus-geomap").data([0]);this._container=this._container.enter().append("svg").attr("class","d3plus-geomap").attr("opacity",0).attr("width",i).attr("height",r).attr("x",this._margin.left).attr("y",this._margin.top).style("background-color",this._ocean||"transparent").merge(this._container);this._container.transition(this._transition).attr("opacity",1).attr("width",i).attr("height",r).attr("x",this._margin.left).attr("y",this._margin.top);var o=this._container.selectAll("rect.d3plus-geomap-ocean").data([0]);o.enter().append("rect").attr("class","d3plus-geomap-ocean").merge(o).attr("width",i).attr("height",r).attr("fill",this._ocean||"transparent");this._tileGroup=this._container.selectAll("g.d3plus-geomap-tileGroup").data([0]);this._tileGroup=this._tileGroup.enter().append("g").attr("class","d3plus-geomap-tileGroup").merge(this._tileGroup);this._zoomGroup=this._container.selectAll("g.d3plus-geomap-zoomGroup").data([0]);this._zoomGroup=this._zoomGroup.enter().append("g").attr("class","d3plus-geomap-zoomGroup").merge(this._zoomGroup);var a=this._zoomGroup.selectAll("g.d3plus-geomap-paths").data([0]);a=a.enter().append("g").attr("class","d3plus-geomap-paths").merge(a);var s=this._coordData=this._topojson?F(this._topojson,this._topojsonKey):{type:"FeatureCollection",features:[]};if(this._topojsonFilter)s.features=s.features.filter(this._topojsonFilter);var u=this._path=A.geoPath().projection(this._projection);var c=this._filteredData.filter(function(t,e){return n._point(t,e)instanceof Array});var f=this._filteredData.filter(function(t,e){return!(n._point(t,e)instanceof Array)}).reduce(function(t,e){t[n._id(e)]=e;return t},{});var l=s.features.reduce(function(t,e){var r=n._topojsonId(e);t.push({__d3plus__:true,data:f[r],feature:e,id:r});return t},[]);var p=k["scale".concat(this._pointSizeScale.charAt(0).toUpperCase()).concat(this._pointSizeScale.slice(1))]().domain(z.extent(c,function(t,e){return n._pointSize(t,e)})).range([this._pointSizeMin,this._pointSizeMax]);if(!this._zoomSet){var h=this._fitObject?F(this._fitObject,this._fitKey):s;this._extentBounds={type:"FeatureCollection",features:this._fitFilter?h.features.filter(this._fitFilter):h.features.slice()};this._extentBounds.features=this._extentBounds.features.reduce(function(t,e){if(e.geometry){var r={type:e.type,id:e.id,geometry:{coordinates:e.geometry.coordinates,type:e.geometry.type}};if(e.geometry.type==="MultiPolygon"&&e.geometry.coordinates.length>1){var n=[],i=[];e.geometry.coordinates.forEach(function(t){r.geometry.coordinates=[t];n.push(u.area(r))});r.geometry.coordinates=[e.geometry.coordinates[n.indexOf(z.max(n))]];var o=u.centroid(r);e.geometry.coordinates.forEach(function(t){r.geometry.coordinates=[t];i.push(C.pointDistance(u.centroid(r),o))});var a=z.quantile(n.reduce(function(t,e,r){if(e)t.push(n[r]/e);return t},[]),.9);r.geometry.coordinates=e.geometry.coordinates.filter(function(t,e){var r=i[e];return r===0||n[e]/r>=a})}t.push(r)}return t},[]);if(!this._extentBounds.features.length&&c.length){var d=[[undefined,undefined],[undefined,undefined]];c.forEach(function(t,e){var r=n._projection(n._point(t,e));if(d[0][0]===void 0||r[0]<d[0][0])d[0][0]=r[0];if(d[1][0]===void 0||r[0]>d[1][0])d[1][0]=r[0];if(d[0][1]===void 0||r[1]<d[0][1])d[0][1]=r[1];if(d[1][1]===void 0||r[1]>d[1][1])d[1][1]=r[1]});this._extentBounds={type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"MultiPoint",coordinates:d.map(function(t){return n._projection.invert(t)})}}]};var v=z.max(c,function(t,e){return p(n._pointSize(t,e))});this._projectionPadding.top+=v;this._projectionPadding.right+=v;this._projectionPadding.bottom+=v;this._projectionPadding.left+=v}this._zoomBehavior.extent([[0,0],[i,r]]).scaleExtent([1,this._zoomMax]).translateExtent([[0,0],[i,r]]);this._zoomSet=true}this._projection=this._projection.fitExtent(this._extentBounds.features.length?[[this._projectionPadding.left,this._projectionPadding.top],[i-this._projectionPadding.right,r-this._projectionPadding.bottom]]:[[0,0],[i,r]],this._extentBounds.features.length?this._extentBounds:{type:"Sphere"});this._shapes.push((new C.Path).data(l).d(function(t){return u(t.feature)}).select(a.node()).x(0).y(0).config(P.configPrep.bind(this)(this._shapeConfig,"shape","Path")).render());var g=this._zoomGroup.selectAll("g.d3plus-geomap-pins").data([0]);g=g.enter().append("g").attr("class","d3plus-geomap-pins").merge(g);var _=(new C.Circle).config(P.configPrep.bind(this)(this._shapeConfig,"shape","Circle")).data(c).r(function(t,e){return p(n._pointSize(t,e))}).select(g.node()).sort(function(t,e){return n._pointSize(e)-n._pointSize(t)}).x(function(t,e){return n._projection(n._point(t,e))[0]}).y(function(t,e){return n._projection(n._point(t,e))[1]});var y=Object.keys(this._on);var m=y.filter(function(t){return t.includes(".Circle")}),b=y.filter(function(t){return!t.includes(".")}),j=y.filter(function(t){return t.includes(".shape")});for(var S=0;S<b.length;S++){_.on(b[S],this._on[b[S]])}for(var w=0;w<j.length;w++){_.on(j[w],this._on[j[w]])}for(var O=0;O<m.length;O++){_.on(m[O],this._on[m[O]])}this._shapes.push(_.render());return this}},{key:"fitFilter",value:function t(e){if(arguments.length){this._zoomSet=false;if(typeof e==="function")return this._fitFilter=e,this;if(!(e instanceof Array))e=[e];return this._fitFilter=function(t){return e.includes(t.id)},this}return this._fitFilter}},{key:"fitKey",value:function t(e){if(arguments.length){this._fitKey=e;this._zoomSet=false;return this}return this._fitKey}},{key:"fitObject",value:function t(e,r){if(arguments.length){if(typeof e==="string"){var n=this._queue.find(function(t){return t[3]==="fitObject"});var i=[a.dataLoad.bind(this),e,r,"fitObject"];if(n)this._queue[this._queue.indexOf(n)]=i;else this._queue.push(i)}else{this._fitObject=e}this._zoomSet=false;return this}return this._fitObject}},{key:"ocean",value:function t(e){return arguments.length?(this._ocean=e,this):this._ocean}},{key:"point",value:function t(e){return arguments.length?(this._point=typeof e==="function"?e:P.constant(e),this):this._point}},{key:"pointSize",value:function t(e){return arguments.length?(this._pointSize=typeof e==="function"?e:P.constant(e),this):this._pointSize}},{key:"pointSizeMax",value:function t(e){return arguments.length?(this._pointSizeMax=e,this):this._pointSizeMax}},{key:"pointSizeMin",value:function t(e){return arguments.length?(this._pointSizeMin=e,this):this._pointSizeMin}},{key:"projection",value:function t(e){if(arguments.length&&e!=="geoMercator")this.tiles(false);return arguments.length?(this._projection=typeof e==="string"?A[e]?A[e]():A.geoMercator():e,this):this._projection}},{key:"projectionPadding",value:function t(e){return arguments.length?(this._projectionPadding=P.parseSides(e),this):this._projectionPadding}},{key:"projectionRotate",value:function t(e){if(arguments.length){this._projection.rotate(e);this.tiles(false);this._zoomSet=false;return this}else{return this._projectionRotate}}},{key:"tiles",value:function t(e){if(arguments.length){this._tiles=e;var r=j(this._tileUrl);if(e&&this._attribution==="")this._attribution=r;else if(!e&&this._attribution===r)this._attribution="";return this}return this._tiles}},{key:"tileUrl",value:function t(e){if(arguments.length){this._tileUrl=e;if(this._tiles)this._attribution=j(e);if(this._tileGroup)this._renderTiles.bind(this)();return this}return this._tileUrl}},{key:"topojson",value:function t(e,r){if(arguments.length){if(typeof e==="string"){var n=this._queue.find(function(t){return t[3]==="topojson"});var i=[a.dataLoad.bind(this),e,r,"topojson"];if(n)this._queue[this._queue.indexOf(n)]=i;else this._queue.push(i)}else{this._topojson=e}this._zoomSet=false;return this}return this._topojson}},{key:"topojsonFill",value:function t(e){return arguments.length?(this._topojsonFill=typeof e==="function"?e:P.constant(e),this):this._topojsonFill}},{key:"topojsonFilter",value:function t(e){if(arguments.length){this._zoomSet=false;if(typeof e==="function")return this._topojsonFilter=e,this;if(!(e instanceof Array))e=[e];return this._topojsonFilter=function(t){return e.includes(t.id)},this}return this._topojsonFilter}},{key:"topojsonKey",value:function t(e){if(arguments.length){this._topojsonKey=e;this._zoomSet=false;return this}return this._topojsonKey}},{key:"topojsonId",value:function t(e){return arguments.length?(this._topojsonId=typeof e==="function"?e:P.accessor(e),this):this._topojsonId}}]);return x}(a.Viz);t.Geomap=S;Object.defineProperty(t,"__esModule",{value:true})});