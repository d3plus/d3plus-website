!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("d3-selection"),require("d3-transition"),require("d3plus-common"),require("d3plus-text"),require("d3plus-color")):"function"==typeof define&&define.amd?define("d3plus-shape",["exports","d3-selection","d3-transition","d3plus-common","d3plus-text","d3plus-color"],n):n(t.d3plus_shape=t.d3plus_shape||{},t.d3_selection,t.d3_transition,t.d3plus_common,t.d3plus_text,t.d3plus_color)}(this,function(t,n,e,o,r,i){"use strict";function c(t){return t.x||0}function u(t){return t.y||0}function a(t){function n(o){void 0===e&&n.select(h.select("body").append("svg").style("width",window.innerWidth+"px").style("height",window.innerHeight+"px").style("display","block").node());var c=e.selectAll(".d3plus-shape-image").data(t,a),u=c.enter().append("image").attr("class","d3plus-shape-image").attr("opacity",0),g=u.merge(c);return g.attr("xlink:href",s).transition().duration(r).attr("opacity",1).attr("width",function(t,n){return l(t,n)}).attr("height",function(t,n){return i(t,n)}).attr("x",function(t,n){return f(t,n)}).attr("y",function(t,n){return d(t,n)}).each(function(t,n){var e=h.select(this),o=s(t,n),r=0===o.indexOf("http://")||0===o.indexOf("https://");if(!r||0===o.indexOf(window.location.hostname)){var i=new Image;i.src=o,i.crossOrigin="Anonymous",i.onload=function(){var t=document.createElement("canvas");t.width=this.width,t.height=this.height;var n=t.getContext("2d");n.drawImage(this,0,0),e.attr("xlink:href",t.toDataURL("image/png"))}}}),c.exit().transition().duration(r).attr("width",function(t,n){return l(t,n)}).attr("height",function(t,n){return i(t,n)}).attr("x",function(t,n){return f(t,n)}).attr("y",function(t,n){return d(t,n)}).attr("opacity",0).remove(),o&&setTimeout(o,r+100),n}void 0===t&&(t=[]);var e,r=600,i=o.accessor("height"),a=o.accessor("url"),s=o.accessor("url"),l=o.accessor("width"),f=c,d=u;return n.data=function(e){return arguments.length?(t=e,n):t},n.duration=function(t){return arguments.length?(r=t,n):r},n.height=function(t){return arguments.length?(i="function"==typeof t?t:o.constant(t),n):i},n.id=function(t){return arguments.length?(a=t,n):a},n.select=function(t){return arguments.length?(e=h.select(t),n):e},n.url=function(t){return arguments.length?(s=t,n):s},n.width=function(t){return arguments.length?(l="function"==typeof t?t:o.constant(t),n):l},n.x=function(t){return arguments.length?(f="function"==typeof t?t:o.constant(t),n):f},n.y=function(t){return arguments.length?(d="function"==typeof t?t:o.constant(t),n):d},t.length?n():n}function s(t){return{width:t.width,height:t.height,x:-t.width/2,y:-t.height/2}}function l(t){function n(t,n){return i.contrast(y(t,n))}function e(n){function o(t,n){void 0===n&&(n=!0),t.attr("width",n?function(t,n){return H(t,n)}:0).attr("height",n?function(t,n){return m(t,n)}:0).attr("x",n?function(t,n){return-H(t,n)/2}:0).attr("y",n?function(t,n){return-m(t,n)/2}:0).attr("fill",function(t,n){return y(t,n)}).attr("stroke",function(t,n){return _(t,n)}).attr("stroke-width",function(t,n){return O(t,n)})}function i(t,n){void 0===n&&(n=!0),t.each(function(t,e){var o=m(t,e),i=H(t,e),s=n?g(t,e):!1;a().data(s?[{url:s}]:[]).duration(p).height(n?o:0).select(this).width(n?i:0).x(n?-i/2:0).y(n?-o/2:0)();var f=[],h=n?k(t,e):!1;if(h){var d=b({width:i,height:o},e),y=A(t,e);d.height-=2*y,d.width-=2*y,d.x+=y,d.y+=y,f.push(d)}r.box().data(f).delay(p/2).duration(p).fontColor(x(t,e)).fontFamily(c(t,e)).fontResize(v(t,e)).fontSize(u(t,e)).lineHeight(l(t,e)).textAnchor(q(t,e)).verticalAlign(z(t,e)).select(this).text(k(t,e))()})}void 0===f&&e.select(d.select("body").append("svg").style("width",window.innerWidth+"px").style("height",window.innerHeight+"px").style("display","block").node()),void 0===l&&(l=function(t,n){return 1.1*u(t,n)});var s=f.selectAll(".d3plus-shape-rect").data(t,w);s.transition().duration(p).attr("transform",function(t,n){return"translate("+j(t,n)+","+C(t,n)+")"}),s.exit().transition().delay(p).remove(),s.exit().selectAll("rect").transition().duration(p).attr("width",0).attr("height",0).attr("x",0).attr("y",0),s.exit().call(i,!1);var F=s.enter().append("g").attr("class","d3plus-shape-rect").attr("id",function(t,n){return"d3plus-shape-rect-"+w(t,n)}).attr("transform",function(t,n){return"translate("+j(t,n)+","+C(t,n)+")"});F.append("rect").call(o,!1);var I=F.merge(s);I.selectAll("rect").transition().duration(p).call(o),I.call(i);for(var R=Object.keys(h),W=0;W<R.length;W++)I.on(R[W],h[R[W]]);return n&&setTimeout(n,p+100),e}void 0===t&&(t=[]);var c,u,l,f,h={},g=o.constant(!1),p=600,y=o.constant("black"),x=n,v=o.constant(!1),m=o.accessor("height"),w=o.accessor("id"),b=s,k=o.constant(!1),A=o.constant(5),_=o.constant("black"),O=o.constant(0),q=o.constant("start"),z=o.constant("top"),H=o.accessor("width"),j=o.accessor("x"),C=o.accessor("y");return e.backgroundImage=function(t){return arguments.length?(g="function"==typeof t?t:o.constant(t),e):g},e.data=function(n){return arguments.length?(t=n,e):t},e.duration=function(t){return arguments.length?(p=t,e):p},e.fill=function(t){return arguments.length?(y="function"==typeof t?t:o.constant(t),e):y},e.fontColor=function(t){return arguments.length?(x="function"==typeof t?t:o.constant(t),e):x},e.fontFamily=function(t){return arguments.length?(c="function"==typeof t?t:o.constant(t),e):c},e.fontResize=function(t){return arguments.length?(v="function"==typeof t?t:o.constant(t),e):v},e.fontSize=function(t){return arguments.length?(u="function"==typeof t?t:o.constant(t),e):u},e.height=function(t){return arguments.length?(m="function"==typeof t?t:o.constant(t),e):m},e.id=function(t){return arguments.length?(w=t,e):w},e.innerBounds=function(t){return arguments.length?(b=t,e):b},e.label=function(t){return arguments.length?(k="function"==typeof t?t:o.constant(t),e):k},e.labelPadding=function(t){return arguments.length?(A="function"==typeof t?t:o.constant(t),e):A},e.lineHeight=function(t){return arguments.length?(l="function"==typeof t?t:o.constant(t),e):l},e.on=function(t,n){return 2===arguments.length?(h[t]=n,e):arguments.length?h[t]:h},e.select=function(t){return arguments.length?(f=d.select(t),void 0===c&&(c=o.constant(f.style("font-family"))),void 0===u&&(u=o.constant(parseFloat(f.style("font-size"),10))),e):f},e.stroke=function(t){return arguments.length?(_="function"==typeof t?t:o.constant(t),e):_},e.strokeWidth=function(t){return arguments.length?(O="function"==typeof t?t:o.constant(t),e):O},e.textAnchor=function(t){return arguments.length?(q="function"==typeof t?t:o.constant(t),e):q},e.verticalAlign=function(t){return arguments.length?(z="function"==typeof t?t:o.constant(t),e):z},e.width=function(t){return arguments.length?(H="function"==typeof t?t:o.constant(t),e):H},e.x=function(t){return arguments.length?(j="function"==typeof t?t:o.constant(t),e):j},e.y=function(t){return arguments.length?(C="function"==typeof t?t:o.constant(t),e):C},t.length?e():e}var f="0.5.0",h={select:n.select,transition:e.transition},d={select:n.select,transition:e.transition};t.version=f,t.image=a,t.rect=l,Object.defineProperty(t,"__esModule",{value:!0})});