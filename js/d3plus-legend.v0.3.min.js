/*
  d3plus-legend v0.3.1
  A collection of chart legends and keys.
  Copyright (c) 2016 D3plus - https://d3plus.org
  @license MIT
*/
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("d3plus-common"),require("d3-array"),require("d3-selection"),require("d3plus-shape"),require("d3plus-text")):"function"==typeof define&&define.amd?define("d3plus-legend",["exports","d3plus-common","d3-array","d3-selection","d3plus-shape","d3plus-text"],n):n(t.d3plus=t.d3plus||{},t.d3plusCommon,t.d3Array,t.d3Selection,t.d3plusShape,t.d3plusText)}(this,function(t,n,e,r,i,o){"use strict";function u(t){function u(t,n){var e=A[n];return{width:e.width,height:e.height,x:t.width/2+H,y:1-e.height/2}}function l(n,r){return"vertical"===F?d.x+O(n,r)/2:d.x+e.sum(t.slice(0,r).map(function(t,n){return O(t,n)}))+e.sum(A.slice(0,r).map(function(t){return t.width-b(n,r)}))+O(n,r)/2+3*H*r}function a(n,r){if("horizontal"===F)return d.y+e.max(A.map(function(t){return t.height}).concat(t.map(function(t,n){return O(t,n)})))/2;var i=O(n,r),o=A[r].height>i?A[r].height/2:i/2,u=e.sum(A.slice(0,r),function(t,n){return e.max([t.height,O(t.data,n)])});return d.y+u+o+H*r}function c(n){void 0===f&&c.select(r.select("body").append("svg").attr("width",window.innerWidth+"px").attr("height",window.innerHeight+"px").node()),void 0===h&&(h=function(t,n){return 1.1*b(t,n)});var u=f.selectAll("g.d3plus-legend-bg-group").data([0]);u=u.enter().append("g").attr("class","d3plus-legend-bg-group").merge(u),i.rect().data([{id:"legend-background"}]).duration(m).fill(p).height(k).select(u.node()).width(W).x(W/2).y(k/2)(),A=t.map(function(n,r){var i=v(n,r),u=h(n,r),l=b(n,r),a="horizontal"===F?k-(t.length+1)*H:k,c="vertical"===F?W-3*H-O(n,r):W,f=o.wrap().fontFamily(i).fontSize(l).lineHeight(u).width(c).height(a)(S(n,r));return f.width=Math.ceil(e.max(f.lines.map(function(t){return o.width(t,{"font-family":i,"font-size":l})})))+l,f.height=Math.ceil(f.lines.length*(u+1)),f.og={height:f.height,width:f.width},f.data=n,f.f=i,f.s=l,f.lh=u,f});var l,a,T=!0;if("horizontal"===F&&(l=W-e.sum(t.map(function(t,n){return O(t,n)+3*H}))-2*H,a=e.sum(A.map(function(t,n){return t.width-b(t,n)})),a>l)){var _=A.filter(function(t){return t.words.length>1}).sort(function(t,n){return n.sentence.length-t.sentence.length});if(_.length&&k>2*_[0].height)for(var D=2;D<=5;){var E=_.filter(function(t){return t.words.length>=D});if(!E.length)break;for(var G=function(t){var n=_[t],r=n.og.height*D,i=n.og.width*(1.5*(1/D)),u=o.wrap().fontFamily(n.f).fontSize(n.s).lineHeight(n.lh).width(i).height(r)(n.sentence);if(!u.truncated&&(a-=n.width,n.width=Math.ceil(e.max(u.lines.map(function(t){return o.width(t,{"font-family":n.f,"font-size":n.s})})))+n.s,n.height=u.lines.length*(n.lh+1),a+=n.width,a<=l))return"break"},J=0;J<_.length;J++){var K=G(J);if("break"===K)break}if(a<=l)break;D++}else T=!1}if(a>l&&(T=!1),!T){a=0;for(var L=0;L<A.length;L++)A[L].width=0,A[L].height=0}var N=e.max(A,function(t,n){return e.max([t.height,O(t.data,n)])}),Q=a+e.sum(t,function(t,n){return O(t,n)})+H*(t.length*(T?3:1)-2);d.width=Q,d.height=N;var U=H,V=H;"center"===g?U=(W-2*H-Q)/2:"right"===g&&(U=W-2*H-Q),"middle"===B?V=(k-2*H-N)/2:"bottom"===B&&(V=k-2*H-N),d.x=U,d.y=V;var X=f.selectAll("g.d3plus-legend-shape-group").data([0]);X=X.enter().append("g").attr("class","d3plus-legend-shape-group").merge(X);for(var Y=i.rect().config({backgroundImage:M,data:t,duration:m,fill:y,fontColor:w,fontFamily:v,fontResize:x,fontSize:b,height:O,id:z,lineHeight:h,opacity:C,innerBounds:q,label:!!T&&S,labelPadding:0,select:X.node(),stroke:P,strokeWidth:j,verticalAlign:"top",width:O,x:I,y:R}),Z=Object.keys(s),$=0;$<Z.length;$++)Y.on(Z[$],s[Z[$]]);return Y(),n&&setTimeout(n,m+100),c}void 0===t&&(t=[]);var h,f,s={},d={width:0,height:0,x:0,y:0},g="center",p="transparent",m=600,y=n.accessor("color"),w=n.constant("#444"),v=n.constant("sans-serif"),x=n.constant(!1),b=n.constant(10),k=100,z=n.accessor("id"),S=n.accessor("id"),q=u,A=[],C=1,F="horizontal",H=5,M=n.constant(!1),O=n.constant(10),P=n.constant("black"),j=n.constant(0),B="middle",W=400,I=l,R=a;return c.align=function(t){return arguments.length?(g=t,c):g},c.backgroundColor=function(t){return arguments.length?(p=t,c):p},c.config=function(t){if(arguments.length){for(var n in t)({}).hasOwnProperty.call(t,n)&&c[n](t[n]);return c}var e={};for(var r in c.prototype.constructor)"config"!==r&&{}.hasOwnProperty.call(c,r)&&(e[r]=c[r]());return e},c.data=function(n){return arguments.length?(t=n,c):t},c.duration=function(t){return arguments.length?(m=t,c):m},c.fill=function(t){return arguments.length?(y=t,c):y},c.fontColor=function(t){return arguments.length?(w="function"==typeof t?t:n.constant(t),c):w},c.fontFamily=function(t){return arguments.length?(v="function"==typeof t?t:n.constant(t),c):v},c.fontResize=function(t){return arguments.length?(x="function"==typeof t?t:n.constant(t),c):x},c.fontSize=function(t){return arguments.length?(b="function"==typeof t?t:n.constant(t),c):b},c.height=function(t){return arguments.length?(k=t,c):k},c.id=function(t){return arguments.length?(z=t,c):z},c.label=function(t){return arguments.length?(S="function"==typeof t?t:n.constant(t),c):S},c.labelBounds=function(t){return arguments.length?(q=t,c):q},c.on=function(t,n){return 2===arguments.length?(s[t]=n,c):arguments.length?s[t]:s},c.opacity=function(t){return arguments.length?(C="function"==typeof t?t:n.constant(t),c):C},c.orient=function(t){return arguments.length?(F=t,c):F},c.outerBounds=function(){return d},c.padding=function(t){return arguments.length?(H=t,c):H},c.select=function(t){return arguments.length?(f=r.select(t),c):f},c.shapeImage=function(t){return arguments.length?(M="function"==typeof t?t:n.constant(t),c):M},c.size=function(t){return arguments.length?(O="function"==typeof t?t:n.constant(t),c):O},c.stroke=function(t){return arguments.length?(P=t,c):P},c.strokeWidth=function(t){return arguments.length?(j=t,c):j},c.verticalAlign=function(t){return arguments.length?(B=t,c):B},c.width=function(t){return arguments.length?(W=t,c):W},c.x=function(t){return arguments.length?(I="function"==typeof t?t:n.constant(t),c):I},c.y=function(t){return arguments.length?(R="function"==typeof t?t:n.constant(t),c):R},t.length?c():c}t.legend=u,Object.defineProperty(t,"__esModule",{value:!0})});