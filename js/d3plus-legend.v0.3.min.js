/*
  d3plus-legend v0.3.0
  A collection of chart legends and keys.
  Copyright (c) 2016 D3plus - https://d3plus.org
  @license MIT
*/
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("d3plus-common"),require("d3-array"),require("d3-selection"),require("d3plus-shape"),require("d3plus-text")):"function"==typeof define&&define.amd?define("d3plus-legend",["exports","d3plus-common","d3-array","d3-selection","d3plus-shape","d3plus-text"],n):n(t.d3plus=t.d3plus||{},t.d3plusCommon,t.d3Array,t.d3Selection,t.d3plusShape,t.d3plusText)}(this,function(t,n,e,r,i,o){"use strict";function u(t){function u(t,n){var e=A[n];return{width:e.width,height:e.height,x:t.width/2+F,y:1-e.height/2}}function l(n,r){return"vertical"===C?d.x+M(n,r)/2:d.x+e.sum(t.slice(0,r).map(function(t,n){return M(t,n)}))+e.sum(A.slice(0,r).map(function(t){return t.width-b(n,r)}))+M(n,r)/2+3*F*r}function a(n,r){if("horizontal"===C)return d.y+e.max(A.map(function(t){return t.height}).concat(t.map(function(t,n){return M(t,n)})))/2;var i=M(n,r),o=A[r].height>i?A[r].height/2:i/2,u=e.sum(A.slice(0,r),function(t,n){return e.max([t.height,M(t.data,n)])});return d.y+u+o+F*r}function h(n){void 0===f&&h.select(r.select("body").append("svg").attr("width",window.innerWidth+"px").attr("height",window.innerHeight+"px").node()),void 0===c&&(c=function(t,n){return 1.1*b(t,n)});var u=f.selectAll("g.d3plus-legend-bg-group").data([0]);u=u.enter().append("g").attr("class","d3plus-legend-bg-group").merge(u),i.rect().data([{id:"legend-background"}]).duration(m).fill(p).height(k).select(u.node()).width(B).x(B/2).y(k/2)(),A=t.map(function(n,r){var i=v(n,r),u=c(n,r),l=b(n,r),a="horizontal"===C?k-(t.length+1)*F:k,h="vertical"===C?B-3*F-M(n,r):B,f=o.wrap().fontFamily(i).fontSize(l).lineHeight(u).width(h).height(a)(S(n,r));return f.width=Math.ceil(e.max(f.lines.map(function(t){return o.width(t,{"font-family":i,"font-size":l})})))+l,f.height=Math.ceil(f.lines.length*(u+1)),f.og={height:f.height,width:f.width},f.data=n,f.f=i,f.s=l,f.lh=u,f});var l,a,R=!0;if("horizontal"===C&&(l=B-e.sum(t.map(function(t,n){return M(t,n)+3*F}))-2*F,a=e.sum(A.map(function(t,n){return t.width-b(t,n)})),a>l)){var T=A.filter(function(t){return t.words.length>1}).sort(function(t,n){return n.sentence.length-t.sentence.length});if(T.length&&k>2*T[0].height)for(var _=2;_<=5;){var D=T.filter(function(t){return t.words.length>=_});if(!D.length)break;for(var E=function(t){var n=T[t],r=n.og.height*_,i=n.og.width*(1.5*(1/_)),u=o.wrap().fontFamily(n.f).fontSize(n.s).lineHeight(n.lh).width(i).height(r)(n.sentence);if(!u.truncated&&(a-=n.width,n.width=Math.ceil(e.max(u.lines.map(function(t){return o.width(t,{"font-family":n.f,"font-size":n.s})})))+n.s,n.height=u.lines.length*(n.lh+1),a+=n.width,a<=l))return"break"},G=0;G<T.length;G++){var J=E(G);if("break"===J)break}if(a<=l)break;_++}else R=!1}if(a>l&&(R=!1),!R){a=0;for(var K=0;K<A.length;K++)A[K].width=0,A[K].height=0}var L=e.max(A,function(t,n){return e.max([t.height,M(t.data,n)])}),N=a+e.sum(t,function(t,n){return M(t,n)})+F*(t.length*(R?3:1)-2);d.width=N,d.height=L;var Q=F,U=F;"center"===g?Q=(B-2*F-N)/2:"right"===g&&(Q=B-2*F-N),"middle"===j?U=(k-2*F-L)/2:"bottom"===j&&(U=k-2*F-L),d.x=Q,d.y=U;var V=f.selectAll("g.d3plus-legend-shape-group").data([0]);V=V.enter().append("g").attr("class","d3plus-legend-shape-group").merge(V);for(var X=i.rect().backgroundImage(H).data(t).duration(m).fill(y).fontColor(w).fontFamily(v).fontResize(x).fontSize(b).height(M).id(z).innerBounds(q).label(!!R&&S).labelPadding(0).lineHeight(c).select(V.node()).stroke(O).strokeWidth(P).verticalAlign("top").width(M).x(W).y(I),Y=Object.keys(s),Z=0;Z<Y.length;Z++)X.on(Y[Z],s[Y[Z]]);return X(),n&&setTimeout(n,m+100),h}void 0===t&&(t=[]);var c,f,s={},d={width:0,height:0,x:0,y:0},g="center",p="transparent",m=600,y=n.accessor("color"),w=n.constant("#444"),v=n.constant("sans-serif"),x=n.constant(!1),b=n.constant(10),k=100,z=n.accessor("id"),S=n.accessor("id"),q=u,A=[],C="horizontal",F=5,H=n.constant(!1),M=n.constant(10),O=n.constant("black"),P=n.constant(0),j="middle",B=400,W=l,I=a;return h.align=function(t){return arguments.length?(g=t,h):g},h.backgroundColor=function(t){return arguments.length?(p=t,h):p},h.config=function(t){if(arguments.length){for(var n in t)({}).hasOwnProperty.call(t,n)&&h[n](t[n]);return h}var e={};for(var r in h.prototype.constructor)"config"!==r&&{}.hasOwnProperty.call(h,r)&&(e[r]=h[r]());return e},h.data=function(n){return arguments.length?(t=n,h):t},h.duration=function(t){return arguments.length?(m=t,h):m},h.fill=function(t){return arguments.length?(y=t,h):y},h.fontColor=function(t){return arguments.length?(w="function"==typeof t?t:n.constant(t),h):w},h.fontFamily=function(t){return arguments.length?(v="function"==typeof t?t:n.constant(t),h):v},h.fontResize=function(t){return arguments.length?(x="function"==typeof t?t:n.constant(t),h):x},h.fontSize=function(t){return arguments.length?(b="function"==typeof t?t:n.constant(t),h):b},h.height=function(t){return arguments.length?(k=t,h):k},h.id=function(t){return arguments.length?(z=t,h):z},h.label=function(t){return arguments.length?(S="function"==typeof t?t:n.constant(t),h):S},h.labelBounds=function(t){return arguments.length?(q=t,h):q},h.on=function(t,n){return 2===arguments.length?(s[t]=n,h):arguments.length?s[t]:s},h.orient=function(t){return arguments.length?(C=t,h):C},h.outerBounds=function(){return d},h.padding=function(t){return arguments.length?(F=t,h):F},h.select=function(t){return arguments.length?(f=r.select(t),h):f},h.shapeImage=function(t){return arguments.length?(H="function"==typeof t?t:n.constant(t),h):H},h.size=function(t){return arguments.length?(M="function"==typeof t?t:n.constant(t),h):M},h.stroke=function(t){return arguments.length?(O=t,h):O},h.strokeWidth=function(t){return arguments.length?(P=t,h):P},h.verticalAlign=function(t){return arguments.length?(j=t,h):j},h.width=function(t){return arguments.length?(B=t,h):B},h.x=function(t){return arguments.length?(W="function"==typeof t?t:n.constant(t),h):W},h.y=function(t){return arguments.length?(I="function"==typeof t?t:n.constant(t),h):I},t.length?h():h}t.legend=u,Object.defineProperty(t,"__esModule",{value:!0})});