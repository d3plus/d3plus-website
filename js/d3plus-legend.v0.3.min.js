/*
  d3plus-legend v0.3.2
  A collection of chart legends and keys.
  Copyright (c) 2016 D3plus - https://d3plus.org
  @license MIT
*/
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("d3plus-common"),require("d3-array"),require("d3-selection"),require("d3plus-shape"),require("d3plus-text")):"function"==typeof define&&define.amd?define("d3plus-legend",["exports","d3plus-common","d3-array","d3-selection","d3plus-shape","d3plus-text"],n):n(t.d3plus=t.d3plus||{},t.d3plusCommon,t.d3Array,t.d3Selection,t.d3plusShape,t.d3plusText)}(this,function(t,n,e,r,i,o){"use strict";function u(t){function u(t,n){var e=q[n];return{width:e.width,height:e.height,x:t.width/2+F,y:1-e.height/2}}function l(n,r){return"vertical"===C?d.x+M(n,r)/2:d.x+e.sum(t.slice(0,r).map(function(t,n){return M(t,n)}))+e.sum(q.slice(0,r).map(function(t){return t.width-b(n,r)}))+M(n,r)/2+3*F*r}function a(n,r){if("horizontal"===C)return d.y+e.max(q.map(function(t){return t.height}).concat(t.map(function(t,n){return M(t,n)})))/2;var i=M(n,r),o=q[r].height>i?q[r].height/2:i/2,u=e.sum(q.slice(0,r),function(t,n){return e.max([t.height,M(t.data,n)])});return d.y+u+o+F*r}function c(n){void 0===f&&c.select(r.select("body").append("svg").attr("width",window.innerWidth+"px").attr("height",window.innerHeight+"px").node()),void 0===h&&(h=function(t,n){return 1.1*b(t,n)});var u=f.selectAll("g.d3plus-legend-bg-group").data([0]);u=u.enter().append("g").attr("class","d3plus-legend-bg-group").merge(u),i.rect().data([{id:"legend-background"}]).duration(m).fill(p).height(k).select(u.node()).width(B).x(B/2).y(k/2)(),q=t.map(function(n,r){var i=w(n,r),u=h(n,r),l=b(n,r),a="horizontal"===C?k-(t.length+1)*F:k,c="vertical"===C?B-3*F-M(n,r):B,f=o.textWrap().fontFamily(i).fontSize(l).lineHeight(u).width(c).height(a)(W(n,r));return f.width=Math.ceil(e.max(f.lines.map(function(t){return o.textWidth(t,{"font-family":i,"font-size":l})})))+l,f.height=Math.ceil(f.lines.length*(u+1)),f.og={height:f.height,width:f.width},f.data=n,f.f=i,f.s=l,f.lh=u,f});var l,a,T=!0;if("horizontal"===C&&(l=B-e.sum(t.map(function(t,n){return M(t,n)+3*F}))-2*F,a=e.sum(q.map(function(t,n){return t.width-b(t,n)})),a>l)){var _=q.filter(function(t){return t.words.length>1}).sort(function(t,n){return n.sentence.length-t.sentence.length});if(_.length&&k>2*_[0].height)for(var D=2;D<=5;){var E=_.filter(function(t){return t.words.length>=D});if(!E.length)break;for(var G=function(t){var n=_[t],r=n.og.height*D,i=n.og.width*(1.5*(1/D)),u=o.textWrap().fontFamily(n.f).fontSize(n.s).lineHeight(n.lh).width(i).height(r)(n.sentence);if(!u.truncated&&(a-=n.width,n.width=Math.ceil(e.max(u.lines.map(function(t){return o.textWidth(t,{"font-family":n.f,"font-size":n.s})})))+n.s,n.height=u.lines.length*(n.lh+1),a+=n.width,a<=l))return"break"},J=0;J<_.length;J++){var K=G(J);if("break"===K)break}if(a<=l)break;D++}else T=!1}if(a>l&&(T=!1),!T){a=0;for(var L=0;L<q.length;L++)q[L].width=0,q[L].height=0}var N=e.max(q,function(t,n){return e.max([t.height,M(t.data,n)])}),Q=a+e.sum(t,function(t,n){return M(t,n)})+F*(t.length*(T?3:1)-2);d.width=Q,d.height=N;var U=F,V=F;"center"===g?U=(B-2*F-Q)/2:"right"===g&&(U=B-2*F-Q),"middle"===j?V=(k-2*F-N)/2:"bottom"===j&&(V=k-2*F-N),d.x=U,d.y=V;var X=f.selectAll("g.d3plus-legend-shape-group").data([0]);X=X.enter().append("g").attr("class","d3plus-legend-shape-group").merge(X);for(var Y=i.rect().config({backgroundImage:H,data:t,duration:m,fill:y,fontColor:v,fontFamily:w,fontResize:x,fontSize:b,height:M,id:z,lineHeight:h,opacity:A,innerBounds:S,label:!!T&&W,labelPadding:0,select:X.node(),stroke:O,strokeWidth:P,verticalAlign:"top",width:M,x:I,y:R}),Z=Object.keys(s),$=0;$<Z.length;$++)Y.on(Z[$],s[Z[$]]);return Y(),n&&setTimeout(n,m+100),c}void 0===t&&(t=[]);var h,f,s={},d={width:0,height:0,x:0,y:0},g="center",p="transparent",m=600,y=n.accessor("color"),v=n.constant("#444"),w=n.constant("sans-serif"),x=n.constant(!1),b=n.constant(10),k=100,z=n.accessor("id"),W=n.accessor("id"),S=u,q=[],A=1,C="horizontal",F=5,H=n.constant(!1),M=n.constant(10),O=n.constant("black"),P=n.constant(0),j="middle",B=400,I=l,R=a;return c.align=function(t){return arguments.length?(g=t,c):g},c.backgroundColor=function(t){return arguments.length?(p=t,c):p},c.config=function(t){if(arguments.length){for(var n in t)({}).hasOwnProperty.call(t,n)&&c[n](t[n]);return c}var e={};for(var r in c.prototype.constructor)"config"!==r&&{}.hasOwnProperty.call(c,r)&&(e[r]=c[r]());return e},c.data=function(n){return arguments.length?(t=n,c):t},c.duration=function(t){return arguments.length?(m=t,c):m},c.fill=function(t){return arguments.length?(y=t,c):y},c.fontColor=function(t){return arguments.length?(v="function"==typeof t?t:n.constant(t),c):v},c.fontFamily=function(t){return arguments.length?(w="function"==typeof t?t:n.constant(t),c):w},c.fontResize=function(t){return arguments.length?(x="function"==typeof t?t:n.constant(t),c):x},c.fontSize=function(t){return arguments.length?(b="function"==typeof t?t:n.constant(t),c):b},c.height=function(t){return arguments.length?(k=t,c):k},c.id=function(t){return arguments.length?(z=t,c):z},c.label=function(t){return arguments.length?(W="function"==typeof t?t:n.constant(t),c):W},c.labelBounds=function(t){return arguments.length?(S=t,c):S},c.on=function(t,n){return 2===arguments.length?(s[t]=n,c):arguments.length?s[t]:s},c.opacity=function(t){return arguments.length?(A="function"==typeof t?t:n.constant(t),c):A},c.orient=function(t){return arguments.length?(C=t,c):C},c.outerBounds=function(){return d},c.padding=function(t){return arguments.length?(F=t,c):F},c.select=function(t){return arguments.length?(f=r.select(t),c):f},c.shapeImage=function(t){return arguments.length?(H="function"==typeof t?t:n.constant(t),c):H},c.size=function(t){return arguments.length?(M="function"==typeof t?t:n.constant(t),c):M},c.stroke=function(t){return arguments.length?(O=t,c):O},c.strokeWidth=function(t){return arguments.length?(P=t,c):P},c.verticalAlign=function(t){return arguments.length?(j=t,c):j},c.width=function(t){return arguments.length?(B=t,c):B},c.x=function(t){return arguments.length?(I="function"==typeof t?t:n.constant(t),c):I},c.y=function(t){return arguments.length?(R="function"==typeof t?t:n.constant(t),c):R},t.length?c():c}t.legend=u,Object.defineProperty(t,"__esModule",{value:!0})});