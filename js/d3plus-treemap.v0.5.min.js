/*
  d3plus-treemap v0.5.17
  A reusable tree map built on D3
  Copyright (c) 2016 D3plus - https://d3plus.org
  @license MIT
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3-collection"),require("d3-hierarchy"),require("d3plus-common"),require("d3plus-shape"),require("d3plus-viz")):"function"==typeof define&&define.amd?define("d3plus-treemap",["exports","d3-collection","d3-hierarchy","d3plus-common","d3plus-shape","d3plus-viz"],e):e(t.d3plus=t.d3plus||{},t.d3Collection,t.d3Hierarchy,t.d3plusCommon,t.d3plusShape,t.d3plusViz)}(this,function(t,e,i,n,r,o){"use strict";var s=function(t){function o(){t.call(this),this._padding=1,this._shapeConfig=Object.assign({},this._shapeConfig,{fontResize:!0}),this._sort=function(t,e){return e.value-t.value},this._sum=n.accessor("value"),this._tile=i.treemapSquarify,this._treemap=i.treemap().round(!0)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype.render=function(o){function s(t){for(var e=0;e<t.length;e++){var i=t[e];i.depth<=l._drawDepth?s(i.children):(i.id=i.data.key,i.data=n.merge(i.data.values),p.push(i))}}var u=this;t.prototype.render.call(this,o);for(var a=e.nest(),h=0;h<=this._drawDepth;h++)a.key(u._groupBy[h]);a=a.entries(this._filteredData);var d=this._treemap.padding(this._padding).size([this._width-this._margin.left-this._margin.right,this._height-this._margin.top-this._margin.bottom]).tile(this._tile)(i.hierarchy({values:a},function(t){return t.values}).sum(this._sum).sort(this._sort)),p=[],l=this;d.children&&s(d.children);var c=d.value,f=this._shapeConfig,_={},m=function(t){"labelBounds"!==t&&{}.hasOwnProperty.call(f,t)&&("function"==typeof f[t]?_[t]=function(e,i){return f[t](e.data,i)}:_[t]=f[t])};for(var y in f)m(y);var g="translate("+this._margin.left+", "+this._margin.top+")";return this._shapes.push((new r.Rect).config({on:Object.keys(this._on).filter(function(t){return!t.includes(".")||t.includes(".shape")}).reduce(function(t,e){return t[e]=function(t,i){return u._on[e]?u._on[e](t.data,i):null},t},{})}).data(p).duration(this._duration).height(function(t){return t.y1-t.y0}).label(function(t,e){return[u._drawLabel(t.data,e),Math.round(u._sum(t.data,e)/c*100)+"%"]}).labelBounds(function(t,e,i){var n=i.height,r=Math.min(50,.25*n);return[{width:i.width,height:n-r,x:-i.width/2,y:-n/2},{width:i.width,height:r,x:-i.width/2,y:n/2-r}]}).select(n.elem("g.d3plus-Treemap",{parent:this._select,enter:{transform:g},update:{transform:g}}).node()).textAnchor(["start","middle"]).verticalAlign(["top","bottom"]).width(function(t){return t.x1-t.x0}).x(function(t){return t.x0+(t.x1-t.x0)/2}).y(function(t){return t.y0+(t.y1-t.y0)/2}).config(_).render()),this},o.prototype.padding=function(t){return arguments.length?(this._padding="function"==typeof t?t:n.constant(t),this):this._padding},o.prototype.sort=function(t){return arguments.length?(this._sort=t,this):this._sort},o.prototype.sum=function(t){return arguments.length?(this._sum="function"==typeof t?t:n.constant(t),this):this._sum},o.prototype.tile=function(t){return arguments.length?(this._tile=t,this):this._tile},o}(o.Viz);t.Treemap=s,Object.defineProperty(t,"__esModule",{value:!0})});