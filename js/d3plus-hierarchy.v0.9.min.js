/*
  d3plus-hierarchy v0.9.0
  Nested, hierarchical, and cluster charts built on D3
  Copyright (c) 2020 D3plus - https://d3plus.org
  @license MIT
*/
(function(t){typeof define==="function"&&define.amd?define(t):t()})(function(){"use strict";var t=typeof globalThis!=="undefined"?globalThis:typeof window!=="undefined"?window:typeof global!=="undefined"?global:typeof self!=="undefined"?self:{};function e(t,e){return e={exports:{}},t(e,e.exports),e.exports}var r=function(t){return t&&t.Math==Math&&t};var f=r(typeof globalThis=="object"&&globalThis)||r(typeof window=="object"&&window)||r(typeof self=="object"&&self)||r(typeof t=="object"&&t)||Function("return this")();var o=function(t){try{return!!t()}catch(t){return true}};var v=!o(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7});var n={}.propertyIsEnumerable;var i=Object.getOwnPropertyDescriptor;var a=i&&!n.call({1:2},1);var u=a?function t(e){var r=i(this,e);return!!r&&r.enumerable}:n;var d={f:u};var c=function(t,e){return{enumerable:!(t&1),configurable:!(t&2),writable:!(t&4),value:e}};var s={}.toString;var l=function(t){return s.call(t).slice(8,-1)};var h="".split;var b=o(function(){return!Object("z").propertyIsEnumerable(0)})?function(t){return l(t)=="String"?h.call(t,""):Object(t)}:Object;var p=function(t){if(t==undefined)throw TypeError("Can't call method on "+t);return t};var _=function(t){return b(p(t))};var g=function(t){return typeof t==="object"?t!==null:typeof t==="function"};var y=function(t,e){if(!g(t))return t;var r,n;if(e&&typeof(r=t.toString)=="function"&&!g(n=r.call(t)))return n;if(typeof(r=t.valueOf)=="function"&&!g(n=r.call(t)))return n;if(!e&&typeof(r=t.toString)=="function"&&!g(n=r.call(t)))return n;throw TypeError("Can't convert object to primitive value")};var m={}.hasOwnProperty;var w=function(t,e){return m.call(t,e)};var O=f.document;var S=g(O)&&g(O.createElement);var k=function(t){return S?O.createElement(t):{}};var x=!v&&!o(function(){return Object.defineProperty(k("div"),"a",{get:function(){return 7}}).a!=7});var P=Object.getOwnPropertyDescriptor;var j=v?P:function t(e,r){e=_(e);r=y(r,true);if(x)try{return P(e,r)}catch(t){}if(w(e,r))return c(!d.f.call(e,r),e[r])};var C={f:j};var E=function(t){if(!g(t)){throw TypeError(String(t)+" is not an object")}return t};var A=Object.defineProperty;var T=v?A:function t(e,r,n){E(e);r=y(r,true);E(n);if(x)try{return A(e,r,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");if("value"in n)e[r]=n.value;return e};var D={f:T};var R=v?function(t,e,r){return D.f(t,e,c(1,r))}:function(t,e,r){t[e]=r;return t};var M=function(e,r){try{R(f,e,r)}catch(t){f[e]=r}return r};var z="__core-js_shared__";var L=f[z]||M(z,{});var N=L;var B=Function.toString;if(typeof N.inspectSource!="function"){N.inspectSource=function(t){return B.call(t)}}var q=N.inspectSource;var V=f.WeakMap;var W=typeof V==="function"&&/native code/.test(q(V));var F=e(function(t){(t.exports=function(t,e){return N[t]||(N[t]=e!==undefined?e:{})})("versions",[]).push({version:"3.6.5",mode:"global",copyright:"Â© 2020 Denis Pushkarev (zloirock.ru)"})});var H=0;var I=Math.random();var G=function(t){return"Symbol("+String(t===undefined?"":t)+")_"+(++H+I).toString(36)};var K=F("keys");var U=function(t){return K[t]||(K[t]=G(t))};var X={};var Y=f.WeakMap;var $,J,Q;var Z=function(t){return Q(t)?J(t):$(t,{})};var tt=function(r){return function(t){var e;if(!g(t)||(e=J(t)).type!==r){throw TypeError("Incompatible receiver, "+r+" required")}return e}};if(W){var et=new Y;var rt=et.get;var nt=et.has;var it=et.set;$=function(t,e){it.call(et,t,e);return e};J=function(t){return rt.call(et,t)||{}};Q=function(t){return nt.call(et,t)}}else{var at=U("state");X[at]=true;$=function(t,e){R(t,at,e);return e};J=function(t){return w(t,at)?t[at]:{}};Q=function(t){return w(t,at)}}var ot={set:$,get:J,has:Q,enforce:Z,getterFor:tt};var ut=e(function(t){var e=ot.get;var u=ot.enforce;var c=String(String).split("String");(t.exports=function(t,e,r,n){var i=n?!!n.unsafe:false;var a=n?!!n.enumerable:false;var o=n?!!n.noTargetGet:false;if(typeof r=="function"){if(typeof e=="string"&&!w(r,"name"))R(r,"name",e);u(r).source=c.join(typeof e=="string"?e:"")}if(t===f){if(a)t[e]=r;else M(e,r);return}else if(!i){delete t[e]}else if(!o&&t[e]){a=true}if(a)t[e]=r;else R(t,e,r)})(Function.prototype,"toString",function t(){return typeof this=="function"&&e(this).source||q(this)})});var ct=f;var st=function(t){return typeof t=="function"?t:undefined};var lt=function(t,e){return arguments.length<2?st(ct[t])||st(f[t]):ct[t]&&ct[t][e]||f[t]&&f[t][e]};var ft=Math.ceil;var ht=Math.floor;var vt=function(t){return isNaN(t=+t)?0:(t>0?ht:ft)(t)};var dt=Math.min;var pt=function(t){return t>0?dt(vt(t),9007199254740991):0};var _t=Math.max;var gt=Math.min;var yt=function(t,e){var r=vt(t);return r<0?_t(r+e,0):gt(r,e)};var mt=function(u){return function(t,e,r){var n=_(t);var i=pt(n.length);var a=yt(r,i);var o;if(u&&e!=e)while(i>a){o=n[a++];if(o!=o)return true}else for(;i>a;a++){if((u||a in n)&&n[a]===e)return u||a||0}return!u&&-1}};var bt={includes:mt(true),indexOf:mt(false)};var wt=bt.indexOf;var Ot=function(t,e){var r=_(t);var n=0;var i=[];var a;for(a in r)!w(X,a)&&w(r,a)&&i.push(a);while(e.length>n)if(w(r,a=e[n++])){~wt(i,a)||i.push(a)}return i};var St=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"];var kt=St.concat("length","prototype");var xt=Object.getOwnPropertyNames||function t(e){return Ot(e,kt)};var Pt={f:xt};var jt=Object.getOwnPropertySymbols;var Ct={f:jt};var Et=lt("Reflect","ownKeys")||function t(e){var r=Pt.f(E(e));var n=Ct.f;return n?r.concat(n(e)):r};var At=function(t,e){var r=Et(e);var n=D.f;var i=C.f;for(var a=0;a<r.length;a++){var o=r[a];if(!w(t,o))n(t,o,i(e,o))}};var Tt=/#|\.prototype\./;var Dt=function(t,e){var r=Mt[Rt(t)];return r==Lt?true:r==zt?false:typeof e=="function"?o(e):!!e};var Rt=Dt.normalize=function(t){return String(t).replace(Tt,".").toLowerCase()};var Mt=Dt.data={};var zt=Dt.NATIVE="N";var Lt=Dt.POLYFILL="P";var Nt=Dt;var Bt=C.f;var qt=function(t,e){var r=t.target;var n=t.global;var i=t.stat;var a,o,u,c,s,l;if(n){o=f}else if(i){o=f[r]||M(r,{})}else{o=(f[r]||{}).prototype}if(o)for(u in e){s=e[u];if(t.noTargetGet){l=Bt(o,u);c=l&&l.value}else c=o[u];a=Nt(n?u:r+(i?".":"#")+u,t.forced);if(!a&&c!==undefined){if(typeof s===typeof c)continue;At(s,c)}if(t.sham||c&&c.sham){R(s,"sham",true)}ut(o,u,s,t)}};var Vt=function(t){if(typeof t!="function"){throw TypeError(String(t)+" is not a function")}return t};var Wt=function(n,i,t){Vt(n);if(i===undefined)return n;switch(t){case 0:return function(){return n.call(i)};case 1:return function(t){return n.call(i,t)};case 2:return function(t,e){return n.call(i,t,e)};case 3:return function(t,e,r){return n.call(i,t,e,r)}}return function(){return n.apply(i,arguments)}};var Ft=function(t){return Object(p(t))};var Ht=Array.isArray||function t(e){return l(e)=="Array"};var It=!!Object.getOwnPropertySymbols&&!o(function(){return!String(Symbol())});var Gt=It&&!Symbol.sham&&typeof Symbol.iterator=="symbol";var Kt=F("wks");var Ut=f.Symbol;var Xt=Gt?Ut:Ut&&Ut.withoutSetter||G;var Yt=function(t){if(!w(Kt,t)){if(It&&w(Ut,t))Kt[t]=Ut[t];else Kt[t]=Xt("Symbol."+t)}return Kt[t]};var $t=Yt("species");var Jt=function(t,e){var r;if(Ht(t)){r=t.constructor;if(typeof r=="function"&&(r===Array||Ht(r.prototype)))r=undefined;else if(g(r)){r=r[$t];if(r===null)r=undefined}}return new(r===undefined?Array:r)(e===0?0:e)};var Qt=[].push;var Zt=function(v){var d=v==1;var p=v==2;var _=v==3;var g=v==4;var y=v==6;var m=v==5||y;return function(t,e,r,n){var i=Ft(t);var a=b(i);var o=Wt(e,r,3);var u=pt(a.length);var c=0;var s=n||Jt;var l=d?s(t,u):p?s(t,0):undefined;var f,h;for(;u>c;c++)if(m||c in a){f=a[c];h=o(f,c,i);if(v){if(d)l[c]=h;else if(h)switch(v){case 3:return true;case 5:return f;case 6:return c;case 2:Qt.call(l,f)}else if(g)return false}}return y?-1:_||g?g:l}};var te={forEach:Zt(0),map:Zt(1),filter:Zt(2),some:Zt(3),every:Zt(4),find:Zt(5),findIndex:Zt(6)};var ee=Object.keys||function t(e){return Ot(e,St)};var re=v?Object.defineProperties:function t(e,r){E(e);var n=ee(r);var i=n.length;var a=0;var o;while(i>a)D.f(e,o=n[a++],r[o]);return e};var ne=lt("document","documentElement");var ie=">";var ae="<";var oe="prototype";var ue="script";var ce=U("IE_PROTO");var se=function(){};var le=function(t){return ae+ue+ie+t+ae+"/"+ue+ie};var fe=function(t){t.write(le(""));t.close();var e=t.parentWindow.Object;t=null;return e};var he=function(){var t=k("iframe");var e="java"+ue+":";var r;t.style.display="none";ne.appendChild(t);t.src=String(e);r=t.contentWindow.document;r.open();r.write(le("document.F=Object"));r.close();return r.F};var ve;var de=function(){try{ve=document.domain&&new ActiveXObject("htmlfile")}catch(t){}de=ve?fe(ve):he();var t=St.length;while(t--)delete de[oe][St[t]];return de()};X[ce]=true;var pe=Object.create||function t(e,r){var n;if(e!==null){se[oe]=E(e);n=new se;se[oe]=null;n[ce]=e}else n=de();return r===undefined?n:re(n,r)};var _e=Yt("unscopables");var ge=Array.prototype;if(ge[_e]==undefined){D.f(ge,_e,{configurable:true,value:pe(null)})}var ye=function(t){ge[_e][t]=true};var me=Object.defineProperty;var be={};var we=function(t){throw t};var Oe=function(t,e){if(w(be,t))return be[t];if(!e)e={};var r=[][t];var n=w(e,"ACCESSORS")?e.ACCESSORS:false;var i=w(e,0)?e[0]:we;var a=w(e,1)?e[1]:undefined;return be[t]=!!r&&!o(function(){if(n&&!v)return true;var t={length:-1};if(n)me(t,1,{enumerable:true,get:we});else t[1]=1;r.call(t,i,a)})};var Se=te.find;var ke="find";var xe=true;var Pe=Oe(ke);if(ke in[])Array(1)[ke](function(){xe=false});qt({target:"Array",proto:true,forced:xe||!Pe},{find:function t(e){return Se(this,e,arguments.length>1?arguments[1]:undefined)}});ye(ke);var je=bt.includes;var Ce=Oe("indexOf",{ACCESSORS:true,1:0});qt({target:"Array",proto:true,forced:!Ce},{includes:function t(e){return je(this,e,arguments.length>1?arguments[1]:undefined)}});ye("includes");var Ee=Object.assign;var Ae=Object.defineProperty;var Te=!Ee||o(function(){if(v&&Ee({b:1},Ee(Ae({},"a",{enumerable:true,get:function(){Ae(this,"b",{value:3,enumerable:false})}}),{b:2})).b!==1)return true;var t={};var e={};var r=Symbol();var n="abcdefghijklmnopqrst";t[r]=7;n.split("").forEach(function(t){e[t]=t});return Ee({},t)[r]!=7||ee(Ee({},e)).join("")!=n})?function t(e,r){var n=Ft(e);var i=arguments.length;var a=1;var o=Ct.f;var u=d.f;while(i>a){var c=b(arguments[a++]);var s=o?ee(c).concat(o(c)):ee(c);var l=s.length;var f=0;var h;while(l>f){h=s[f++];if(!v||u.call(c,h))n[h]=c[h]}}return n}:Ee;qt({target:"Object",stat:true,forced:Object.assign!==Te},{assign:Te});var De=Yt("match");var Re=function(t){var e;return g(t)&&((e=t[De])!==undefined?!!e:l(t)=="RegExp")};var Me=function(t){if(Re(t)){throw TypeError("The method doesn't accept regular expressions")}return t};var ze=Yt("match");var Le=function(e){var r=/./;try{"/./"[e](r)}catch(t){try{r[ze]=false;return"/./"[e](r)}catch(t){}}return false};qt({target:"String",proto:true,forced:!Le("includes")},{includes:function t(e){return!!~String(p(this)).indexOf(Me(e),arguments.length>1?arguments[1]:undefined)}});var Ne=C.f;var Be="".startsWith;var qe=Math.min;var Ve=Le("startsWith");var We=!Ve&&!!function(){var t=Ne(String.prototype,"startsWith");return t&&!t.writable}();qt({target:"String",proto:true,forced:!We&&!Ve},{startsWith:function t(e){var r=String(p(this));Me(e);var n=pt(qe(arguments.length>1?arguments[1]:undefined,r.length));var i=String(e);return Be?Be.call(r,i,n):r.slice(n,n+i.length)===i}});if(typeof window!=="undefined"){(function(){try{if(typeof SVGElement==="undefined"||Boolean(SVGElement.prototype.innerHTML)){return}}catch(t){return}function r(t){switch(t.nodeType){case 1:return i(t);case 3:return e(t);case 8:return n(t)}}function e(t){return t.textContent.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function n(t){return"\x3c!--"+t.nodeValue+"--\x3e"}function i(t){var e="";e+="<"+t.tagName;if(t.hasAttributes()){[].forEach.call(t.attributes,function(t){e+=" "+t.name+'="'+t.value+'"'})}e+=">";if(t.hasChildNodes()){[].forEach.call(t.childNodes,function(t){e+=r(t)})}e+="</"+t.tagName+">";return e}Object.defineProperty(SVGElement.prototype,"innerHTML",{get:function(){var e="";[].forEach.call(this.childNodes,function(t){e+=r(t)});return e},set:function(t){while(this.firstChild){this.removeChild(this.firstChild)}try{var e=new DOMParser;e.async=false;var r="<svg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'>"+t+"</svg>";var n=e.parseFromString(r,"text/xml").documentElement;[].forEach.call(n.childNodes,function(t){this.appendChild(this.ownerDocument.importNode(t,true))}.bind(this))}catch(t){throw new Error("Error parsing markup string")}}});Object.defineProperty(SVGElement.prototype,"innerSVG",{get:function(){return this.innerHTML},set:function(t){this.innerHTML=t}})})()}});(function(t,e){typeof exports==="object"&&typeof module!=="undefined"?e(exports,require("d3-array"),require("d3-shape"),require("d3plus-common"),require("d3plus-shape"),require("d3plus-viz"),require("d3-collection"),require("d3-hierarchy"),require("d3-scale"),require("d3plus-format")):typeof define==="function"&&define.amd?define("d3plus-hierarchy",["exports","d3-array","d3-shape","d3plus-common","d3plus-shape","d3plus-viz","d3-collection","d3-hierarchy","d3-scale","d3plus-format"],e):(t=t||self,e(t.d3plus={},t.d3Array,t.d3Shape,t.d3plusCommon,t.d3plusShape,t.d3plusViz,t.d3Collection,t.d3Hierarchy,t.d3Scale,t.d3plusFormat))})(this,function(t,g,l,y,m,e,b,w,O,p){"use strict";function o(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(t,n.key,n)}}function r(t,e,r){if(e)n(t.prototype,e);if(r)n(t,r);return t}function S(t,e,r){if(e in t){Object.defineProperty(t,e,{value:r,enumerable:true,configurable:true,writable:true})}else{t[e]=r}return t}function i(t,e){if(typeof e!=="function"&&e!==null){throw new TypeError("Super expression must either be null or a function")}t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:true,configurable:true}});if(e)a(t,e)}function k(t){k=Object.setPrototypeOf?Object.getPrototypeOf:function t(e){return e.__proto__||Object.getPrototypeOf(e)};return k(t)}function a(t,e){a=Object.setPrototypeOf||function t(e,r){e.__proto__=r;return e};return a(t,e)}function u(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true}catch(t){return false}}function c(t){if(t===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t}function s(t,e){if(e&&(typeof e==="object"||typeof e==="function")){return e}return c(t)}function f(i){var a=u();return function t(){var e=k(i),r;if(a){var n=k(this).constructor;r=Reflect.construct(e,arguments,n)}else{r=e.apply(this,arguments)}return s(this,r)}}function h(t,e){while(!Object.prototype.hasOwnProperty.call(t,e)){t=k(t);if(t===null)break}return t}function x(t,e,r){if(typeof Reflect!=="undefined"&&Reflect.get){x=Reflect.get}else{x=function t(e,r,n){var i=h(e,r);if(!i)return;var a=Object.getOwnPropertyDescriptor(i,r);if(a.get){return a.get.call(n)}return a.value}}return x(t,e,r||t)}function v(t){return d(t)||_(t)||P(t)||C()}function d(t){if(Array.isArray(t))return j(t)}function _(t){if(typeof Symbol!=="undefined"&&Symbol.iterator in Object(t))return Array.from(t)}function P(t,e){if(!t)return;if(typeof t==="string")return j(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor)r=t.constructor.name;if(r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return j(t,e)}function j(t,e){if(e==null||e>t.length)e=t.length;for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function C(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var E=function(t){i(s,t);var e=f(s);function s(){var n;o(this,s);n=e.call(this);n._shapeConfig=y.assign(n._shapeConfig,{ariaLabel:function t(e,r){return n._pieData?"".concat(++n._pieData[r].index,". ").concat(n._drawLabel(e,r),", ").concat(n._value(e,r),"."):""},Path:{labelConfig:{fontResize:true}}});n._innerRadius=0;n._legendSort=function(t,e){return n._value(e)-n._value(t)};n._padPixel=0;n._pie=l.pie();n._sort=function(t,e){return n._value(e)-n._value(t)};n._value=y.accessor("value");return n}r(s,[{key:"_draw",value:function t(e){var r=this;x(k(s.prototype),"_draw",this).call(this,e);var n=this._height-this._margin.top-this._margin.bottom,i=this._width-this._margin.left-this._margin.right;var a=g.min([i,n])/2;var o=this._pieData=this._pie.padAngle(this._padAngle||this._padPixel/a).sort(this._sort).value(this._value)(this._filteredData);o.forEach(function(t,e){t.__d3plus__=true;t.i=e});var u=l.arc().innerRadius(this._innerRadius).outerRadius(a);var c="translate(".concat(i/2+this._margin.left,", ").concat(n/2+this._margin.top,")");this._shapes.push((new m.Path).data(o).d(u).select(y.elem("g.d3plus-Pie",{parent:this._select,enter:{transform:c},update:{transform:c}}).node()).config({id:function t(e){return r._ids(e).join("-")},x:0,y:0}).label(this._drawLabel).config(y.configPrep.bind(this)(this._shapeConfig,"shape","Path")).render());return this}},{key:"innerRadius",value:function t(e){return arguments.length?(this._innerRadius=e,this):this._innerRadius}},{key:"padAngle",value:function t(e){return arguments.length?(this._padAngle=e,this):this._padAngle}},{key:"padPixel",value:function t(e){return arguments.length?(this._padPixel=e,this):this._padPixel}},{key:"sort",value:function t(e){return arguments.length?(this._sort=e,this):this._sort}},{key:"value",value:function t(e){return arguments.length?(this._value=typeof e==="function"?e:y.accessor(e),this):this._value}}]);return s}(e.Viz);var A=function(t){i(r,t);var e=f(r);function r(){var t;o(this,r);t=e.call(this);t._innerRadius=function(){return g.min([t._width-t._margin.left-t._margin.right,t._height-t._margin.top-t._margin.bottom])/4};t._padPixel=2;return t}return r}(E);var T=function e(t){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];if(t.values){t.values.forEach(function(t){r.push(t);e(t,r)})}else{r.push(t)}return r};var D=function(t){i(l,t);var n=f(l);function l(){var a;o(this,l);a=n.call(this);a._layoutPadding=1;a._on.mouseenter=function(){};var e=a._on["mousemove.legend"];a._on["mousemove.legend"]=function(r,t){e(r,t);var n=a._ids(r,t);var i=T(r);a.hover(function(e){var t=Object.keys(e).filter(function(t){return t!=="value"}).every(function(t){return r[t]&&r[t].includes(e[t])});if(t)i.push(e);else if(n.includes(e.key))i.push.apply(i,v(T(e,[e])));return i.includes(e)})};var r=a._on["mousemove.shape"];a._on["mousemove.shape"]=function(e,t){if(e.__d3plusTooltip__)r(e,t);a.hover(function(t){return T(e,[e]).includes(t)})};a._pack=w.pack();a._packOpacity=y.constant(.25);a._shape=y.constant("Circle");a._shapeConfig=y.assign(a._shapeConfig,{Circle:{label:function t(e){return e.parent&&!e.children?e.id:false},labelConfig:{fontResize:true},opacity:function t(e){return e.__d3plusOpacity__}}});a._sort=function(t,e){return e.value-t.value};a._sum=y.accessor("value");return a}r(l,[{key:"_draw",value:function t(e){var r=this;x(k(l.prototype),"_draw",this).call(this,e);var n=this._height-this._margin.top-this._margin.bottom,i=this._width-this._margin.left-this._margin.right;var a=Math.min(n,i);var o="translate(".concat((i-a)/2,", ").concat((n-a)/2,")");var u=b.nest();for(var c=0;c<=this._drawDepth;c++){u.key(this._groupBy[c])}u=u.entries(this._filteredData);var s=this._pack.padding(this._layoutPadding).size([a,a])(w.hierarchy({key:u.key,values:u},function(t){return t.values}).sum(this._sum).sort(this._sort)).descendants();s.forEach(function(t,e){t.__d3plus__=true;t.i=e;t.id=t.parent?t.parent.data.key:null;t.data.__d3plusOpacity__=t.height?r._packOpacity(t.data,e):1;t.data.__d3plusTooltip__=!t.height?true:false});this._shapes.push((new m.Circle).data(s).select(y.elem("g.d3plus-Pack",{parent:this._select,enter:{transform:o},update:{transform:o}}).node()).config(y.configPrep.bind(this)(this._shapeConfig,"shape","Circle")).render());return this}},{key:"hover",value:function t(e){this._hover=e;this._shapes.forEach(function(t){return t.hover(e)});if(this._legend)this._legendClass.hover(e);return this}},{key:"layoutPadding",value:function t(e){return arguments.length?(this._layoutPadding=e,this):this._layoutPadding}},{key:"packOpacity",value:function t(e){return arguments.length?(this._packOpacity=typeof e==="function"?e:y.constant(e),this):this._packOpacity}},{key:"sort",value:function t(e){return arguments.length?(this._sort=e,this):this._sort}},{key:"sum",value:function t(e){return arguments.length?(this._sum=typeof e==="function"?e:y.accessor(e),this):this._sum}}]);return l}(e.Viz);function R(t,e){if(!(e instanceof Array))e=[e];var r=b.nest();for(var n=0;n<e.length;n++){r.key(e[n])}var i=r.entries(t);return M(i)}function M(t){return t.map(function(t){if(t.key&&t.values){if(t.values[0].key==="undefined")return t.values[0].values[0];else t.values=M(t.values)}return t})}var z=function(t){i(_,t);var e=f(_);function _(){var n;o(this,_);n=e.call(this);n._orient="vertical";n._separation=function(t,e){return t.parent===e.parent?1:2};n._shape=y.constant("Circle");n._shapeConfig=y.assign(n._shapeConfig,{ariaLabel:function t(e,r){return n._treeData?"".concat(n._treeData[r].depth,". ").concat(n._drawLabel(e,r),"."):""},labelConfig:{fontColor:"#444"},Path:{fill:"none",stroke:"#ccc",strokeWidth:1},r:y.constant(5),width:y.constant(10),height:y.constant(10)});n._tree=w.tree();return n}r(_,[{key:"_draw",value:function t(e){var f=this;x(k(_.prototype),"_draw",this).call(this,e);var r=this._orient==="vertical"?this._height-this._margin.top-this._margin.bottom:this._width-this._margin.left-this._margin.right,o=this._orient==="vertical"?"left":"top",n=this,i="translate(".concat(this._margin.left,", ").concat(this._margin.top,")"),u=this._orient==="horizontal"?this._height-this._margin.top-this._margin.bottom:this._width-this._margin.left-this._margin.right;var a=this._treeData=this._tree.separation(this._separation).size([u,r])(w.hierarchy({key:"root",values:R(this._filteredData,this._groupBy.slice(0,this._drawDepth+1))},function(t){return t.key&&t.values?t.values:null}).sort(this._sort)).descendants().filter(function(t){return t.depth<=f._groupBy.length&&t.parent});function c(t){return y.merge(t.values.map(function(t){return t.key&&t.values?c(t):t}),n._aggs)}a.forEach(function(t,e){if(t.data.key&&t.data.values)t.data=c(t.data);t.__d3plus__=true;t.i=e});var s=this._shapeConfig.r;if(typeof s!=="function")s=y.constant(s);var l=g.max(a,function(t){return t.depth===1?s(t.data,t.i):0});var h=g.max(a,function(t){return t.children?0:s(t.data,t.i)});var v=g.extent(a,function(t){return t.y});this._labelHeight=g.min([this._orient==="vertical"?50:100,(v[1]-l-h)/(this._groupBy.length+1)]);this._labelWidths=R(a,function(t){return t.depth}).map(function(a){return a.values.reduce(function(t,e,r){var n=r<a.values.length-1?a.values[r+1].x:u+f._margin[o],i=r?a.values[r-1].x:f._margin[o];return g.min([t,n-e.x,e.x-i])},u)});var d=O.scaleLinear().domain(v).range([l+this._labelHeight,r-h-this._labelHeight]);a.forEach(function(t){var e=d(t.y);if(f._orient==="horizontal"){t.y=t.x;t.x=e}else t.y=e});var p={parent:this._select,enter:{transform:i},update:{transform:i}};this._shapes.push((new m.Path).data(a.filter(function(t){return t.depth>1})).select(y.elem("g.d3plus-Tree-Links",p).node()).config(y.configPrep.bind(this)(this._shapeConfig,"shape","Path")).config({d:function t(e){var r=f._shapeConfig.r;if(typeof r==="function")r=r(e.data,e.i);var n=e.parent.x-e.x+(f._orient==="vertical"?0:r),i=e.parent.y-e.y+(f._orient==="vertical"?r:0),a=f._orient==="vertical"?0:-r,o=f._orient==="vertical"?-r:0;return f._orient==="vertical"?"M".concat(a,",").concat(o,"C").concat(a,",").concat((o+i)/2," ").concat(n,",").concat((o+i)/2," ").concat(n,",").concat(i):"M".concat(a,",").concat(o,"C").concat((a+n)/2,",").concat(o," ").concat((a+n)/2,",").concat(i," ").concat(n,",").concat(i)},id:function t(e,r){return f._ids(e,r).join("-")}}).render());this._shapes.push((new m.Circle).data(a).select(y.elem("g.d3plus-Tree-Shapes",p).node()).config(y.configPrep.bind(this)(this._shapeConfig,"shape","Circle")).config({id:function t(e,r){return f._ids(e,r).join("-")},label:function t(e,r){if(f._label)return f._label(e.data,r);var n=f._ids(e,r).slice(0,e.depth);return n[n.length-1]},labelConfig:{textAnchor:function t(e){return f._orient==="vertical"?"middle":e.data.children&&e.data.depth!==f._groupBy.length?"end":"start"},verticalAlign:function t(e){return f._orient==="vertical"?e.data.depth===1?"bottom":"top":"middle"}},hitArea:function t(e,r,n){var i=f._labelHeight,a=f._labelWidths[e.depth-1];return{width:f._orient==="vertical"?a:n.r*2+a,height:f._orient==="horizontal"?i:n.r*2+i,x:f._orient==="vertical"?-a/2:e.children&&e.depth!==f._groupBy.length?-(n.r+a):-n.r,y:f._orient==="horizontal"?-i/2:e.children&&e.depth!==f._groupBy.length?-(n.r+f._labelHeight):-n.r}},labelBounds:function t(e,r,n){var i;var a=f._labelHeight,o=f._orient==="vertical"?"height":"width",u=f._labelWidths[e.depth-1],c=f._orient==="vertical"?"width":"height",s=f._orient==="vertical"?"x":"y",l=f._orient==="vertical"?"y":"x";return i={},S(i,c,u),S(i,o,a),S(i,s,-u/2),S(i,l,e.children&&e.depth!==f._groupBy.length?-(n.r+a):n.r),i}}).render());return this}},{key:"orient",value:function t(e){return arguments.length?(this._orient=e,this):this._orient}},{key:"separation",value:function t(e){return arguments.length?(this._separation=e,this):this._separation}}]);return _}(e.Viz);var L=function(t){i(d,t);var e=f(d);function d(){var i;o(this,d);i=e.call(this);i._layoutPadding=1;i._legendSort=function(t,e){return i._sum(e)-i._sum(t)};i._legendTooltip=y.assign({},i._legendTooltip,{tbody:[]});i._shapeConfig=y.assign({},i._shapeConfig,{ariaLabel:function t(e,r){var n=i._rankData?"".concat(i._rankData.indexOf(e)+1,". "):"";return"".concat(n).concat(i._drawLabel(e,r),", ").concat(i._sum(e,r),".")},labelConfig:{fontMax:20,fontMin:8,fontResize:true,padding:5}});i._sort=function(t,e){var r=a(t);var n=a(e);return r&&!n?1:!r&&n?-1:e.value-t.value};i._sum=y.accessor("value");i._thresholdKey=i._sum;i._tile=w.treemapSquarify;i._tooltipConfig=y.assign({},i._tooltipConfig,{tbody:[[function(){return i._translate("Share")},function(t,e,r){return"".concat(p.formatAbbreviate(r.share*100,i._locale),"%")}]]});i._treemap=w.treemap().round(true);var a=function t(e){return e.children&&e.children.length===1&&e.children[0].data._isAggregation};return i}r(d,[{key:"_draw",value:function t(e){var r=this;x(k(d.prototype),"_draw",this).call(this,e);var n=b.nest();for(var i=0;i<=this._drawDepth;i++){n.key(this._groupBy[i])}n=n.entries(this._filteredData);var a=this._treemap.padding(this._layoutPadding).size([this._width-this._margin.left-this._margin.right,this._height-this._margin.top-this._margin.bottom]).tile(this._tile)(w.hierarchy({values:n},function(t){return t.values}).sum(this._sum).sort(this._sort));var o=[],u=this;function c(t){for(var e=0;e<t.length;e++){var r=t[e];if(r.depth<=u._drawDepth)c(r.children);else{var n=r.data.values.length===1?u._filteredData.indexOf(r.data.values[0]):undefined;r.__d3plus__=true;r.id=r.data.key;r.i=n>-1?n:undefined;r.data=y.merge(r.data.values,u._aggs);r.x=r.x0+(r.x1-r.x0)/2;r.y=r.y0+(r.y1-r.y0)/2;o.push(r)}}}if(a.children)c(a.children);this._rankData=o.sort(this._sort).map(function(t){return t.data});var s=a.value;o.forEach(function(t){t.share=r._sum(t.data,t.i)/s});var l="translate(".concat(this._margin.left,", ").concat(this._margin.top,")");var f=y.configPrep.bind(this)(this._shapeConfig,"shape","Rect");var h=f.labelConfig.fontMin;var v=f.labelConfig.padding;this._shapes.push((new m.Rect).data(o).label(function(t){return[r._drawLabel(t.data,t.i),"".concat(p.formatAbbreviate(t.share*100,r._locale),"%")]}).select(y.elem("g.d3plus-Treemap",{parent:this._select,enter:{transform:l},update:{transform:l}}).node()).config({height:function t(e){return e.y1-e.y0},labelBounds:function t(e,r,n){var i=n.height;var a=Math.min(50,(i-v*2)*.5);if(a<h)a=0;return[{width:n.width,height:i-a,x:-n.width/2,y:-i/2},{width:n.width,height:a+v*2,x:-n.width/2,y:i/2-a-v*2}]},labelConfig:{textAnchor:function t(e,r,n){var i,a=n;while(typeof i==="undefined"&&a){if(typeof a.l!=="undefined")i=a.l;a=a.__d3plusParent__}return i?"middle":"start"},verticalAlign:function t(e,r,n){var i,a=n;while(typeof i==="undefined"&&a){if(typeof a.l!=="undefined")i=a.l;a=a.__d3plusParent__}return i?"bottom":"top"}},width:function t(e){return e.x1-e.x0}}).config(f).render());return this}},{key:"_thresholdFunction",value:function t(e){var l=this._aggs;var f=this._drawDepth;var h=this._groupBy;var v=this._threshold;var d=this._thresholdKey;var p=g.sum(e,d);if(v&&d){return _(e,0)}function _(t,n){if(n<f){return b.nest().key(h[n]).entries(t).reduce(function(t,e){var r=_(e.values,n+1);return t.concat(r)},[])}if(n===f){var e=Math.min(1,Math.max(0,v(t)));if(!isFinite(e)||isNaN(e))return null;var r=[];var i=t.slice();var a=e*p;var o=i.length;while(o--){var u=i[o];if(d(u)<a){var c=i.indexOf(u);i.splice(c,1);r.push(u)}}if(r.length>0){var s=y.merge(r,l);s._isAggregation=true;s._threshold=e;i.push(s)}return i}throw new Error("Depth is higher than the amount of grouping levels.")}return e}},{key:"layoutPadding",value:function t(e){return arguments.length?(this._layoutPadding=typeof e==="function"?e:y.constant(e),this):this._layoutPadding}},{key:"sort",value:function t(e){return arguments.length?(this._sort=e,this):this._sort}},{key:"sum",value:function t(e){if(arguments.length){this._sum=typeof e==="function"?e:y.accessor(e);this._thresholdKey=this._sum;return this}else return this._sum}},{key:"tile",value:function t(e){return arguments.length?(this._tile=e,this):this._tile}}]);return d}(e.Viz);t.Donut=A;t.Pack=D;t.Pie=E;t.Tree=z;t.Treemap=L;Object.defineProperty(t,"__esModule",{value:true})});