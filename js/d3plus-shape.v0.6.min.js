/*
  d3plus-shape v0.6.2
  Fancy SVG shapes for visualizations
  Copyright (c) 2016 D3plus - https://d3plus.org
  @license MIT
*/
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("d3-selection"),require("d3-transition"),require("d3plus-common"),require("d3plus-text"),require("d3plus-color")):"function"==typeof define&&define.amd?define("d3plus-shape",["exports","d3-selection","d3-transition","d3plus-common","d3plus-text","d3plus-color"],n):n(t.d3plus=t.d3plus||{},t.d3Selection,t.d3Transition,t.d3plusCommon,t.d3plusText,t.d3plusColor)}(this,function(t,n,e,r,o,i){"use strict";function c(t){function n(r){void 0===e&&n.select(s.select("body").append("svg").style("width",window.innerWidth+"px").style("height",window.innerHeight+"px").style("display","block").node());var h=e.selectAll(".d3plus-shape-image").data(t,c),d=h.enter().append("image").attr("class","d3plus-shape-image").attr("opacity",0),g=d.merge(h);return g.attr("xlink:href",u).transition().duration(o).attr("opacity",1).attr("width",function(t,n){return a(t,n)}).attr("height",function(t,n){return i(t,n)}).attr("x",function(t,n){return f(t,n)}).attr("y",function(t,n){return l(t,n)}).each(function(t,n){var e=s.select(this),r=u(t,n),o=0===r.indexOf("http://")||0===r.indexOf("https://");if(!o||0===r.indexOf(window.location.hostname)){var i=new Image;i.src=r,i.crossOrigin="Anonymous",i.onload=function(){var t=document.createElement("canvas");t.width=this.width,t.height=this.height;var n=t.getContext("2d");n.drawImage(this,0,0),e.attr("xlink:href",t.toDataURL("image/png"))}}}),h.exit().transition().duration(o).attr("width",function(t,n){return a(t,n)}).attr("height",function(t,n){return i(t,n)}).attr("x",function(t,n){return f(t,n)}).attr("y",function(t,n){return l(t,n)}).attr("opacity",0).remove(),r&&setTimeout(r,o+100),n}void 0===t&&(t=[]);var e,o=600,i=r.accessor("height"),c=r.accessor("url"),u=r.accessor("url"),a=r.accessor("width"),f=r.accessor("x",0),l=r.accessor("y",0);return n.data=function(e){return arguments.length?(t=e,n):t},n.duration=function(t){return arguments.length?(o=t,n):o},n.height=function(t){return arguments.length?(i="function"==typeof t?t:r.constant(t),n):i},n.id=function(t){return arguments.length?(c=t,n):c},n.select=function(t){return arguments.length?(e=s.select(t),n):e},n.url=function(t){return arguments.length?(u=t,n):u},n.width=function(t){return arguments.length?(a="function"==typeof t?t:r.constant(t),n):a},n.x=function(t){return arguments.length?(f="function"==typeof t?t:r.constant(t),n):f},n.y=function(t){return arguments.length?(l="function"==typeof t?t:r.constant(t),n):l},t.length?n():n}function u(t){return{width:t.width,height:t.height,x:-t.width/2,y:-t.height/2}}function a(t){function n(t,n){return i.contrast(y(t,n))}function e(n){function r(t,n){void 0===n&&(n=!0),t.attr("width",n?function(t,n){return F(t,n)}:0).attr("height",n?function(t,n){return w(t,n)}:0).attr("x",n?function(t,n){return-F(t,n)/2}:0).attr("y",n?function(t,n){return-w(t,n)/2}:0).attr("fill",function(t,n){return y(t,n)}).attr("stroke",function(t,n){return C(t,n)}).attr("stroke-width",function(t,n){return H(t,n)})}function i(t,n){void 0===n&&(n=!0),t.each(function(t,e){var r=w(t,e),i=F(t,e),u=!!n&&g(t,e);c().data(u?[{url:u}]:[]).duration(p).height(n?r:0).select(this).width(n?i:0).x(n?-i/2:0).y(n?-r/2:0)();var f=[];if(n){var h=A({width:i,height:r},e),d=k(t,e),y=v(t,e),O=a(t,e),C=x(t,e),H=s(t,e),R=l(t,e),S=q(t,e),j=z(t,e),P=b(t,e);if(P!==!1&&void 0!==P){P.constructor!==Array&&(P=[P]);for(var T=0;T<P.length;T++){var I=h.constructor===Array?h[T]:Object.assign({},h),W=d.constructor===Array?d[T]:d;I.height-=2*W,I.width-=2*W,I.x+=W,I.y+=W,I.id=m(t,e)+"_"+T,I.text=P[T],I.fC=y.constructor===Array?y[T]:y,I.fF=O.constructor===Array?O[T]:O,I.fR=C.constructor===Array?C[T]:C,I.fS=H.constructor===Array?H[T]:H,I.lH=R.constructor===Array?R[T]:R,I.tA=S.constructor===Array?S[T]:S,I.vA=j.constructor===Array?j[T]:j,f.push(I)}}}o.box().data(f).delay(p/2).duration(p).fontColor(function(t){return t.fC}).fontFamily(function(t){return t.fF}).fontResize(function(t){return t.fR}).fontSize(function(t){return t.fS}).lineHeight(function(t){return t.lH}).textAnchor(function(t){return t.tA}).verticalAlign(function(t){return t.vA}).select(this)()})}void 0===h&&e.select(f.select("body").append("svg").style("width",window.innerWidth+"px").style("height",window.innerHeight+"px").style("display","block").node()),void 0===l&&(l=function(t,n){return 1.1*s(t,n)});var u=f.transition().duration(p),j=h.selectAll(".d3plus-shape-rect").data(t,m);j.transition(u).attr("transform",function(t,n){return"translate("+R(t,n)+","+S(t,n)+")"}),j.exit().transition().delay(p).remove(),j.exit().select("rect").transition(u).attr("width",0).attr("height",0).attr("x",0).attr("y",0),j.exit().call(i,!1);var P=j.enter().append("g").attr("class","d3plus-shape-rect").attr("id",function(t,n){return"d3plus-shape-rect-"+m(t,n)}).attr("transform",function(t,n){return"translate("+R(t,n)+","+S(t,n)+")"});P.append("rect").call(r,!1);var T=P.merge(j);T.select("rect").transition(u).call(r),T.call(i).transition(u).attr("opacity",O);for(var I=Object.keys(d),W=0;W<I.length;W++)T.on(I[W],d[I[W]]);return n&&setTimeout(n,p+100),e}void 0===t&&(t=[]);var a,s,l,h,d={},g=r.constant(!1),p=600,y=r.constant("black"),v=n,x=r.constant(!1),w=r.accessor("height"),m=r.accessor("id"),A=u,b=r.constant(!1),k=r.constant(5),O=r.constant(1),C=r.constant("black"),H=r.constant(0),q=r.constant("start"),z=r.constant("top"),F=r.accessor("width"),R=r.accessor("x"),S=r.accessor("y");return e.backgroundImage=function(t){return arguments.length?(g="function"==typeof t?t:r.constant(t),e):g},e.config=function(t){if(arguments.length){for(var n in t)({}).hasOwnProperty.call(t,n)&&e[n](t[n]);return e}var r={};for(var o in e.prototype.constructor)"config"!==o&&{}.hasOwnProperty.call(e,o)&&(r[o]=e[o]());return r},e.data=function(n){return arguments.length?(t=n,e):t},e.duration=function(t){return arguments.length?(p=t,e):p},e.fill=function(t){return arguments.length?(y="function"==typeof t?t:r.constant(t),e):y},e.fontColor=function(t){return arguments.length?(v="function"==typeof t?t:r.constant(t),e):v},e.fontFamily=function(t){return arguments.length?(a="function"==typeof t?t:r.constant(t),e):a},e.fontResize=function(t){return arguments.length?(x="function"==typeof t?t:r.constant(t),e):x},e.fontSize=function(t){return arguments.length?(s="function"==typeof t?t:r.constant(t),e):s},e.height=function(t){return arguments.length?(w="function"==typeof t?t:r.constant(t),e):w},e.id=function(t){return arguments.length?(m=t,e):m},e.innerBounds=function(t){return arguments.length?(A=t,e):A},e.label=function(t){return arguments.length?(b="function"==typeof t?t:r.constant(t),e):b},e.labelPadding=function(t){return arguments.length?(k="function"==typeof t?t:r.constant(t),e):k},e.lineHeight=function(t){return arguments.length?(l="function"==typeof t?t:r.constant(t),e):l},e.on=function(t,n){return 2===arguments.length?(d[t]=n,e):arguments.length?d[t]:d},e.opacity=function(t){return arguments.length?(O="function"==typeof t?t:r.constant(t),e):O},e.select=function(t){return arguments.length?(h=f.select(t),void 0===a&&(a=r.constant(h.style("font-family"))),void 0===s&&(s=r.constant(parseFloat(h.style("font-size"),10))),e):h},e.stroke=function(t){return arguments.length?(C="function"==typeof t?t:r.constant(t),e):C},e.strokeWidth=function(t){return arguments.length?(H="function"==typeof t?t:r.constant(t),e):H},e.textAnchor=function(t){return arguments.length?(q="function"==typeof t?t:r.constant(t),e):q},e.verticalAlign=function(t){return arguments.length?(z="function"==typeof t?t:r.constant(t),e):z},e.width=function(t){return arguments.length?(F="function"==typeof t?t:r.constant(t),e):F},e.x=function(t){return arguments.length?(R="function"==typeof t?t:r.constant(t),e):R},e.y=function(t){return arguments.length?(S="function"==typeof t?t:r.constant(t),e):S},t.length?e():e}var s={select:n.select,transition:e.transition},f={select:n.select,transition:e.transition};t.image=c,t.rect=a,Object.defineProperty(t,"__esModule",{value:!0})});