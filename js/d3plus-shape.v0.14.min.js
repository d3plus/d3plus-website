/*
  d3plus-shape v0.14.11
  Fancy SVG shapes for visualizations
  Copyright (c) 2018 D3plus - https://d3plus.org
  @license MIT
*/
if(typeof Object.assign!=="function"){Object.defineProperty(Object,"assign",{value:function t(e){"use strict";if(e===null){throw new TypeError("Cannot convert undefined or null to object")}var i=Object(e);for(var n=1;n<arguments.length;n++){var r=arguments[n];if(r!==null){for(var a in r){if(Object.prototype.hasOwnProperty.call(r,a)){i[a]=r[a]}}}}return i},writable:true,configurable:true})}if(!Array.prototype.includes){Object.defineProperty(Array.prototype,"includes",{value:function t(e,i){var n=Object(this);var r=n.length>>>0;if(r===0)return false;var a=i|0;var s=Math.max(a>=0?a:r-Math.abs(a),0);function o(t,e){return t===e||typeof t==="number"&&typeof e==="number"&&isNaN(t)&&isNaN(e)}while(s<r){if(o(n[s],e)){return true}s++}return false}})}(function(t,e){typeof exports==="object"&&typeof module!=="undefined"?e(exports,require("d3-selection"),require("d3-transition"),require("d3plus-common"),require("d3-array"),require("d3-color"),require("d3plus-color"),require("d3-shape"),require("d3plus-text"),require("d3-polygon"),require("d3-collection"),require("d3-interpolate-path")):typeof define==="function"&&define.amd?define("d3plus-shape",["exports","d3-selection","d3-transition","d3plus-common","d3-array","d3-color","d3plus-color","d3-shape","d3plus-text","d3-polygon","d3-collection","d3-interpolate-path"],e):e(t.d3plus={},t.d3Selection,t.d3Transition,t.d3plusCommon,t.d3Array,t.d3Color,t.d3plusColor,t.paths,t.d3plusText,t.d3Polygon,t.d3Collection,t.d3InterpolatePath)})(this,function(t,f,d,y,ut,r,i,v,g,ct,s,o){"use strict";var h=function t(){this._duration=600;this._height=y.accessor("height");this._id=y.accessor("id");this._pointerEvents=y.constant("auto");this._select;this._url=y.accessor("url");this._width=y.accessor("width");this._x=y.accessor("x",0);this._y=y.accessor("y",0)};h.prototype.render=function t(e){var i=this;if(this._select===void 0){this.select(f.select("body").append("svg").style("width",window.innerWidth+"px").style("height",window.innerHeight+"px").style("display","block").node())}var n=this._select.selectAll(".d3plus-Image").data(this._data,this._id);var r=n.enter().append("image").attr("class","d3plus-Image").attr("opacity",0).attr("width",0).attr("height",0).attr("x",function(t,e){return i._x(t,e)+i._width(t,e)/2}).attr("y",function(t,e){return i._y(t,e)+i._height(t,e)/2});var a=d.transition().duration(this._duration),s=this,o=r.merge(n);o.attr("xlink:href",this._url).style("pointer-events",this._pointerEvents).transition(a).attr("opacity",1).attr("width",function(t,e){return i._width(t,e)}).attr("height",function(t,e){return i._height(t,e)}).attr("x",function(t,e){return i._x(t,e)}).attr("y",function(t,e){return i._y(t,e)}).each(function(t,e){var i=f.select(this),n=s._url(t,e);var r=n.indexOf("http://")===0||n.indexOf("https://")===0;if(!r||n.indexOf(window.location.hostname)===0){var a=new h;a.src=n;a.crossOrigin="Anonymous";a.onload=function(){var t=document.createElement("canvas");t.width=this.width;t.height=this.height;var e=t.getContext("2d");e.drawImage(this,0,0);i.attr("xlink:href",t.toDataURL("image/png"))}}});n.exit().transition(a).attr("width",function(t,e){return i._width(t,e)}).attr("height",function(t,e){return i._height(t,e)}).attr("x",function(t,e){return i._x(t,e)}).attr("y",function(t,e){return i._y(t,e)}).attr("opacity",0).remove();if(e){setTimeout(e,this._duration+100)}return this};h.prototype.data=function t(e){return arguments.length?(this._data=e,this):this._data};h.prototype.duration=function t(e){return arguments.length?(this._duration=e,this):this._duration};h.prototype.height=function t(e){return arguments.length?(this._height=typeof e==="function"?e:y.constant(e),this):this._height};h.prototype.id=function t(e){return arguments.length?(this._id=e,this):this._id};h.prototype.pointerEvents=function t(e){return arguments.length?(this._pointerEvents=typeof e==="function"?e:y.constant(e),this):this._pointerEvents};h.prototype.select=function t(e){return arguments.length?(this._select=f.select(e),this):this._select};h.prototype.url=function t(e){return arguments.length?(this._url=e,this):this._url};h.prototype.width=function t(e){return arguments.length?(this._width=typeof e==="function"?e:y.constant(e),this):this._width};h.prototype.x=function t(e){return arguments.length?(this._x=typeof e==="function"?e:y.constant(e),this):this._x};h.prototype.y=function t(e){return arguments.length?(this._y=typeof e==="function"?e:y.constant(e),this):this._y};function pt(t,e){var i=e[0]-t[0],n=e[1]-t[1];return i*i+n*n}function x(t,e){return Math.sqrt(pt(t,e))}var e=function(e){function t(t){var n=this;if(t===void 0)t="g";e.call(this);this._activeOpacity=.25;this._activeStyle={stroke:function(t,e){var i=n._fill(t,e);if(["transparent","none"].includes(i)){i=n._stroke(t,e)}return r.color(i).darker(1)},"stroke-width":function(t,e){var i=n._strokeWidth(t,e)||1;return i*3}};this._ariaLabel=y.constant("");this._backgroundImage=y.constant(false);this._backgroundImageClass=new h;this._data=[];this._duration=600;this._fill=y.constant("black");this._fillOpacity=y.constant(1);this._hoverOpacity=.5;this._hoverStyle={stroke:function(t,e){var i=n._fill(t,e);if(["transparent","none"].includes(i)){i=n._stroke(t,e)}return r.color(i).darker(.5)},"stroke-width":function(t,e){var i=n._strokeWidth(t,e)||1;return i*2}};this._id=function(t,e){return t.id!==void 0?t.id:e};this._label=y.constant(false);this._labelClass=new g.TextBox;this._labelConfig={fontColor:function(t,e){return i.colorContrast(n._fill(t,e))},fontSize:12,padding:5};this._name="Shape";this._opacity=y.constant(1);this._pointerEvents=y.constant("visiblePainted");this._role=y.constant("presentation");this._rotate=y.constant(0);this._rx=y.constant(0);this._ry=y.constant(0);this._scale=y.constant(1);this._shapeRendering=y.constant("geometricPrecision");this._stroke=function(t,e){return r.color(n._fill(t,e)).darker(1)};this._strokeDasharray=y.constant("0");this._strokeLinecap=y.constant("butt");this._strokeOpacity=y.constant(1);this._strokeWidth=y.constant(0);this._tagName=t;this._textAnchor=y.constant("start");this._vectorEffect=y.constant("non-scaling-stroke");this._verticalAlign=y.constant("top");this._x=y.accessor("x",0);this._y=y.accessor("y",0)}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.prototype._aes=function t(){return{}};t.prototype._applyEvents=function t(e){var a=this;var s=Object.keys(this._on);var i=function(r){e.on(s[r],function(t,e){if(!a._on[s[r]]){return}if(t.i!==void 0){e=t.i}if(t.nested&&t.values){var i=f.mouse(a._select.node()),n=t.values.map(function(t){return x(i,[a._x(t,e),a._y(t,e)])});t=t.values[n.indexOf(ut.min(n))]}a._on[s[r]].bind(a)(t,e)})};for(var n=0;n<s.length;n++)i(n)};t.prototype._updateStyle=function t(e,i){var n=this;if(e.size()&&e.node().tagName==="g"){e=e.selectAll("*")}function r(t,e){return typeof this!=="function"?this:t.nested&&t.key&&t.values?this(t.values[0],n._data.indexOf(t.values[0])):this(t,e)}var a={};for(var s in i){if({}.hasOwnProperty.call(i,s)){a[s]=r.bind(i[s])}}e.transition().duration(0).call(y.attrize,a)};t.prototype._applyStyle=function t(e){var i=this;if(e.size()&&e.node().tagName==="g"){e=e.selectAll("*")}function n(t,e){return typeof this!=="function"?this:t.nested&&t.key&&t.values?this(t.values[0],i._data.indexOf(t.values[0])):this(t,e)}e.attr("fill",n.bind(this._fill)).attr("fill-opacity",n.bind(this._fillOpacity)).attr("rx",n.bind(this._rx)).attr("ry",n.bind(this._ry)).attr("stroke",n.bind(this._stroke)).attr("stroke-dasharray",n.bind(this._strokeDasharray)).attr("stroke-linecap",n.bind(this._strokeLinecap)).attr("stroke-opacity",n.bind(this._strokeOpacity)).attr("stroke-width",n.bind(this._strokeWidth)).attr("vector-effect",n.bind(this._vectorEffect))};t.prototype._applyTransform=function t(e){var i=this;e.attr("transform",function(t,e){return"\n        translate("+(t.__d3plusShape__?t.translate?t.translate:i._x(t.data,t.i)+","+i._y(t.data,t.i):i._x(t,e)+","+i._y(t,e))+")\n        scale("+(t.__d3plusShape__?t.scale||i._scale(t.data,t.i):i._scale(t,e))+")\n        rotate("+(t.__d3plusShape__?t.rotate?t.rotate:i._rotate(t.data||t,t.i):i._rotate(t.data||t,t.i))+")"})};t.prototype._nestWrapper=function t(i){return function(t,e){return i(t.__d3plusShape__?t.data:t,t.__d3plusShape__?t.i:e)}};t.prototype._renderActive=function t(){var r=this;this._group.selectAll(".d3plus-Shape, .d3plus-Image, .d3plus-textBox").each(function(t,e){if(!t){t={}}if(!t.parentNode){t.parentNode=this.parentNode}var i=t.parentNode;if(f.select(this).classed("d3plus-textBox")){t=t.data}if(t.__d3plusShape__||t.__d3plus__){while(t&&(t.__d3plusShape__||t.__d3plus__)){e=t.i;t=t.data}}else{e=r._data.indexOf(t)}var n=!r._active||typeof r._active!=="function"||!r._active(t,e)?i:r._activeGroup.node();if(n!==this.parentNode){n.appendChild(this);if(this.className.baseVal.includes("d3plus-Shape")){if(i===n){f.select(this).call(r._applyStyle.bind(r))}else{f.select(this).call(r._updateStyle.bind(r,f.select(this),r._activeStyle))}}}});this._group.selectAll("g.d3plus-"+this._name+"-shape, g.d3plus-"+this._name+"-image, g.d3plus-"+this._name+"-text").attr("opacity",this._hover?this._hoverOpacity:this._active?this._activeOpacity:1)};t.prototype._renderHover=function t(){var r=this;this._group.selectAll("g.d3plus-"+this._name+"-shape, g.d3plus-"+this._name+"-image, g.d3plus-"+this._name+"-text, g.d3plus-"+this._name+"-hover").selectAll(".d3plus-Shape, .d3plus-Image, .d3plus-textBox").each(function(t,e){if(!t){t={}}if(!t.parentNode){t.parentNode=this.parentNode}var i=t.parentNode;if(f.select(this).classed("d3plus-textBox")){t=t.data}if(t.__d3plusShape__||t.__d3plus__){while(t&&(t.__d3plusShape__||t.__d3plus__)){e=t.i;t=t.data}}else{e=r._data.indexOf(t)}var n=!r._hover||typeof r._hover!=="function"||!r._hover(t,e)?i:r._hoverGroup.node();if(n!==this.parentNode){n.appendChild(this)}if(this.className.baseVal.includes("d3plus-Shape")){if(i===n){f.select(this).call(r._applyStyle.bind(r))}else{f.select(this).call(r._updateStyle.bind(r,f.select(this),r._hoverStyle))}}});this._group.selectAll("g.d3plus-"+this._name+"-shape, g.d3plus-"+this._name+"-image, g.d3plus-"+this._name+"-text").attr("opacity",this._hover?this._hoverOpacity:this._active?this._activeOpacity:1)};t.prototype._renderImage=function t(){var l=this;var u=[];this._update.merge(this._enter).data().forEach(function(t,e){var i=l._aes(t,e);if(i.r||i.width&&i.height){var n=t;if(t.nested&&t.key&&t.values){n=t.values[0];e=l._data.indexOf(n)}var r=i.r?i.r*2:i.height,a=l._backgroundImage(n,e),s=i.r?i.r*2:i.width;if(a){var o=n.__d3plusShape__?n.translate?n.translate[0]:l._x(n.data,n.i):l._x(n,e),h=n.__d3plusShape__?n.translate?n.translate[1]:l._y(n.data,n.i):l._y(n,e);if(i.x){o+=i.x}if(i.y){h+=i.y}if(n.__d3plusShape__){n=n.data;e=n.i}u.push({__d3plus__:true,data:n,height:r,i:e,id:l._id(n,e),url:a,width:s,x:o+-s/2,y:h+-r/2})}}});this._backgroundImageClass.data(u).duration(this._duration).pointerEvents("none").select(y.elem("g.d3plus-"+this._name+"-image",{parent:this._group,update:{opacity:this._active?this._activeOpacity:1}}).node()).render()};t.prototype._renderLabels=function t(){var p=this;var _=[];this._update.merge(this._enter).data().forEach(function(t,e){var i=t;if(t.nested&&t.key&&t.values){i=t.values[0];e=p._data.indexOf(i)}var n=p._label(i,e);if(p._labelBounds&&n!==false&&n!==undefined&&n!==null){var r=p._labelBounds(i,e,p._aes(t,e));if(r){if(n.constructor!==Array){n=[n]}var a=i.__d3plusShape__?i.translate?i.translate[0]:p._x(i.data,i.i):p._x(i,e),s=i.__d3plusShape__?i.translate?i.translate[1]:p._y(i.data,i.i):p._y(i,e);if(i.__d3plusShape__){i=i.data;e=i.i}for(var o=0;o<n.length;o++){var h=r.constructor===Array?r[o]:Object.assign({},r);var l=p._rotate(i,e);var u=i.labelConfig&&i.labelConfig.rotate?i.labelConfig.rotate:r.angle!==undefined?r.angle:0;u+=l;var c=l!==0?[h.x*-1||0,h.y*-1||0]:[h.width/2,h.height/2];_.push({__d3plus__:true,data:i,height:h.height,l:o,id:p._id(i,e)+"_"+o,r:u,rotateAnchor:c,text:n[o],width:h.width,x:a+h.x,y:s+h.y})}}}});this._labelClass.data(_).duration(this._duration).pointerEvents("none").rotate(function(t){return t.__d3plus__?t.r:t.data.r}).rotateAnchor(function(t){return t.__d3plus__?t.rotateAnchor:t.data.rotateAnchor}).select(y.elem("g.d3plus-"+this._name+"-text",{parent:this._group,update:{opacity:this._active?this._activeOpacity:1}}).node()).config(this._labelConfig).render()};t.prototype.render=function t(e){var i=this;if(this._select===void 0){this.select(f.select("body").append("svg").style("width",window.innerWidth+"px").style("height",window.innerHeight+"px").style("display","block").node())}this._transition=d.transition().duration(this._duration);var n=this._data,r=this._id;if(this._dataFilter){n=this._dataFilter(n);if(n.key){r=n.key}}if(this._sort){n=n.sort(function(t,e){while(t.__d3plusShape__||t.__d3plus__){t=t.data}while(e.__d3plusShape__||e.__d3plus__){e=e.data}return i._sort(t,e)})}f.selectAll("g.d3plus-"+this._name+"-hover > *, g.d3plus-"+this._name+"-active > *").each(function(t){if(t&&t.parentNode){t.parentNode.appendChild(this)}else{this.parentNode.removeChild(this)}});this._group=y.elem("g.d3plus-"+this._name+"-group",{parent:this._select});var a=this._update=y.elem("g.d3plus-"+this._name+"-shape",{parent:this._group,update:{opacity:this._active?this._activeOpacity:1}}).selectAll(".d3plus-"+this._name).data(n,r);a.order().transition(this._transition).call(this._applyTransform.bind(this));var s=this._enter=a.enter().append(this._tagName).attr("class",function(t,e){return"d3plus-Shape d3plus-"+i._name+" d3plus-id-"+g.strip(i._nestWrapper(i._id)(t,e))}).call(this._applyTransform.bind(this)).attr("aria-label",this._ariaLabel).attr("role",this._role).attr("opacity",this._nestWrapper(this._opacity));var o=s.merge(a);o.attr("shape-rendering",this._nestWrapper(this._shapeRendering)).attr("pointer-events","none").transition(this._transition).attr("opacity",this._nestWrapper(this._opacity)).transition().attr("pointer-events",this._pointerEvents);var h=this._exit=a.exit();h.transition().delay(this._duration).remove();this._renderImage();this._renderLabels();this._hoverGroup=y.elem("g.d3plus-"+this._name+"-hover",{parent:this._group});this._activeGroup=y.elem("g.d3plus-"+this._name+"-active",{parent:this._group});var l=this._group.selectAll(".d3plus-HitArea").data(this._hitArea?n:[],r);l.order().call(this._applyTransform.bind(this));var u=this._name==="Line";u&&this._path.curve(v["curve"+this._curve.charAt(0).toUpperCase()+this._curve.slice(1)]).defined(this._defined).x(this._x).y(this._y);var c=l.enter().append(u?"path":"rect").attr("class",function(t,e){return"d3plus-HitArea d3plus-id-"+g.strip(i._nestWrapper(i._id)(t,e))}).attr("fill","black").attr("stroke","black").attr("pointer-events","painted").attr("opacity",0).call(this._applyTransform.bind(this));var p=this;var _=l.merge(c).each(function(t){var e=p._data.indexOf(t);var i=p._hitArea(t,e,p._aes(t,e));return i&&!(p._name==="Line"&&parseFloat(p._strokeWidth(t,e))>10)?f.select(this).call(y.attrize,i):f.select(this).remove()});l.exit().remove();this._applyEvents(this._hitArea?_:o);setTimeout(function(){if(i._active){i._renderActive()}else if(i._hover){i._renderHover()}if(e){e()}},this._duration+100);return this};t.prototype.active=function t(e){if(!arguments.length||e===undefined){return this._active}this._active=e;if(this._group){this._renderActive()}return this};t.prototype.activeOpacity=function t(e){return arguments.length?(this._activeOpacity=e,this):this._activeOpacity};t.prototype.activeStyle=function t(e){return arguments.length?(this._activeStyle=y.assign({},this._activeStyle,e),this):this._activeStyle};t.prototype.ariaLabel=function t(e){return e!==undefined?(this._ariaLabel=typeof e==="function"?e:y.constant(e),this):this._ariaLabel};t.prototype.backgroundImage=function t(e){return arguments.length?(this._backgroundImage=typeof e==="function"?e:y.constant(e),this):this._backgroundImage};t.prototype.data=function t(e){return arguments.length?(this._data=e,this):this._data};t.prototype.duration=function t(e){return arguments.length?(this._duration=e,this):this._duration};t.prototype.fill=function t(e){return arguments.length?(this._fill=typeof e==="function"?e:y.constant(e),this):this._fill};t.prototype.fillOpacity=function t(e){return arguments.length?(this._fillOpacity=typeof e==="function"?e:y.constant(e),this):this._fillOpacity};t.prototype.hover=function t(e){if(!arguments.length||e===void 0){return this._hover}this._hover=e;if(this._group){this._renderHover()}return this};t.prototype.hoverStyle=function t(e){return arguments.length?(this._hoverStyle=y.assign({},this._hoverStyle,e),this):this._hoverStyle};t.prototype.hoverOpacity=function t(e){return arguments.length?(this._hoverOpacity=e,this):this._hoverOpacity};t.prototype.hitArea=function t(e){return arguments.length?(this._hitArea=typeof e==="function"?e:y.constant(e),this):this._hitArea};t.prototype.id=function t(e){return arguments.length?(this._id=e,this):this._id};t.prototype.label=function t(e){return arguments.length?(this._label=typeof e==="function"?e:y.constant(e),this):this._label};t.prototype.labelBounds=function t(e){return arguments.length?(this._labelBounds=typeof e==="function"?e:y.constant(e),this):this._labelBounds};t.prototype.labelConfig=function t(e){return arguments.length?(this._labelConfig=y.assign(this._labelConfig,e),this):this._labelConfig};t.prototype.opacity=function t(e){return arguments.length?(this._opacity=typeof e==="function"?e:y.constant(e),this):this._opacity};t.prototype.pointerEvents=function t(e){return arguments.length?(this._pointerEvents=typeof e==="function"?e:y.constant(e),this):this._pointerEvents};t.prototype.role=function t(e){return e!==undefined?(this._role=typeof e==="function"?e:y.constant(e),this):this._role};t.prototype.rotate=function t(e){return arguments.length?(this._rotate=typeof e==="function"?e:y.constant(e),this):this._rotate};t.prototype.rx=function t(e){return arguments.length?(this._rx=typeof e==="function"?e:y.constant(e),this):this._rx};t.prototype.ry=function t(e){return arguments.length?(this._ry=typeof e==="function"?e:y.constant(e),this):this._ry};t.prototype.scale=function t(e){return arguments.length?(this._scale=typeof e==="function"?e:y.constant(e),this):this._scale};t.prototype.select=function t(e){return arguments.length?(this._select=f.select(e),this):this._select};t.prototype.shapeRendering=function t(e){return arguments.length?(this._shapeRendering=typeof e==="function"?e:y.constant(e),this):this._shapeRendering};t.prototype.sort=function t(e){return arguments.length?(this._sort=e,this):this._sort};t.prototype.stroke=function t(e){return arguments.length?(this._stroke=typeof e==="function"?e:y.constant(e),this):this._stroke};t.prototype.strokeDasharray=function t(e){return arguments.length?(this._strokeDasharray=typeof e==="function"?e:y.constant(e),this):this._strokeDasharray};t.prototype.strokeLinecap=function t(e){return arguments.length?(this._strokeLinecap=typeof e==="function"?e:y.constant(e),this):this._strokeLinecap};t.prototype.strokeOpacity=function t(e){return arguments.length?(this._strokeOpacity=typeof e==="function"?e:y.constant(e),this):this._strokeOpacity};t.prototype.strokeWidth=function t(e){return arguments.length?(this._strokeWidth=typeof e==="function"?e:y.constant(e),this):this._strokeWidth};t.prototype.textAnchor=function t(e){return arguments.length?(this._textAnchor=typeof e==="function"?e:y.constant(e),this):this._textAnchor};t.prototype.vectorEffect=function t(e){return arguments.length?(this._vectorEffect=typeof e==="function"?e:y.constant(e),this):this._vectorEffect};t.prototype.verticalAlign=function t(e){return arguments.length?(this._verticalAlign=typeof e==="function"?e:y.constant(e),this):this._verticalAlign};t.prototype.x=function t(e){return arguments.length?(this._x=typeof e==="function"?e:y.constant(e),this):this._x};t.prototype.y=function t(e){return arguments.length?(this._y=typeof e==="function"?e:y.constant(e),this):this._y};return t}(y.BaseClass);function m(t,e,i,n){var r=1e-9;var a=t[0]-e[0],s=i[0]-n[0],o=t[1]-e[1],h=i[1]-n[1];var l=a*h-o*s;if(Math.abs(l)<r){return null}var u=t[0]*e[1]-t[1]*e[0],c=i[0]*n[1]-i[1]*n[0];var p=(u*s-c*a)/l,_=(u*h-c*o)/l;return[p,_]}function b(t,e,i){var n=1e-9;var r=i[0];var a=i[1];return!(r<Math.min(t[0],e[0])-n||r>Math.max(t[0],e[0])+n||a<Math.min(t[1],e[1])-n||a>Math.max(t[1],e[1])+n)}function u(t,e,i,n){var r=m(t,e,i,n);if(!r){return false}return b(t,e,r)&&b(i,n,r)}function _t(t,e){var i=-1;var n=t.length;var r=e.length;var a=t[n-1];while(++i<n){var s=a;a=t[i];var o=-1;var h=e[r-1];while(++o<r){var l=h;h=e[o];if(u(s,a,l,h)){return false}}}return ct.polygonContains(e,t[0])}function ft(t,e,i){if(i===void 0)i=0;var n=1e-9;e=[e[0]+n*Math.cos(i),e[1]+n*Math.sin(i)];var r=e[0];var a=e[1];var s=[r+Math.cos(i),a+Math.sin(i)];var o=0;if(Math.abs(s[0]-r)<n){o=1}var h=-1;var l=t.length;var u=t[l-1];var c=Number.MAX_VALUE;var p=Number.MAX_VALUE;var _=null;var f=null;while(++h<l){var d=u;u=t[h];var y=m(e,s,d,u);if(y&&b(d,u,y)){var v=pt(e,y);if(y[o]<e[o]){if(v<c){c=v;_=y}}else if(y[o]>e[o]){if(v<p){p=v;f=y}}}}return[_,f]}function n(t,e,i){if(i===void 0)i=[0,0];var n=Math.cos(e),r=Math.sin(e),a=t[0]-i[0],s=t[1]-i[1];return[n*a-r*s+i[0],r*a+n*s+i[1]]}function dt(t,e,i){if(i===void 0)i=[0,0];return t.map(function(t){return n(t,e,i)})}function l(t,e,i){var n=e[0],r=e[1];var a=i[0]-n,s=i[1]-r;if(a!==0||s!==0){var o=((t[0]-n)*a+(t[1]-r)*s)/(a*a+s*s);if(o>1){n=i[0];r=i[1]}else if(o>0){n+=a*o;r+=s*o}}a=t[0]-n;s=t[1]-r;return a*a+s*s}function a(t,e){var i,n=t[0];var r=[n];for(var a=1,s=t.length;a<s;a++){i=t[a];if(pt(i,n)>e){r.push(i);n=i}}if(n!==i){r.push(i)}return r}function c(t,e,i,n,r){var a,s=n;for(var o=e+1;o<i;o++){var h=l(t[o],t[e],t[i]);if(h>s){a=o;s=h}}if(s>n){if(a-e>1){c(t,e,a,n,r)}r.push(t[a]);if(i-a>1){c(t,a,i,n,r)}}}function p(t,e){var i=t.length-1;var n=[t[0]];c(t,0,i,e,n);n.push(t[i]);return n}function yt(t,e,i){if(e===void 0)e=1;if(i===void 0)i=false;if(t.length<=2){return t}var n=e*e;t=i?t:a(t,n);t=p(t,n);return t}var vt=.5;var gt=5;var xt={};function _(t,e){var i,n;if(e===void 0)e={};if(t.length<3){if(e.verbose){console.error("polygon has to have at least 3 points",t)}return null}var r=[];e=Object.assign({angle:ut.range(-90,90+gt,gt),cache:true,maxAspectRatio:15,minAspectRatio:1,minHeight:0,minWidth:0,nTries:20,tolerance:.02,verbose:false},e);var a=e.angle instanceof Array?e.angle:typeof e.angle==="number"?[e.angle]:typeof e.angle==="string"&&!isNaN(e.angle)?[Number(e.angle)]:[];var s=e.aspectRatio instanceof Array?e.aspectRatio:typeof e.aspectRatio==="number"?[e.aspectRatio]:typeof e.aspectRatio==="string"&&!isNaN(e.aspectRatio)?[Number(e.aspectRatio)]:[];var o=e.origin&&e.origin instanceof Array?e.origin[0]instanceof Array?e.origin:[e.origin]:[];var h;if(e.cache){h=ut.merge(t).join(",");h+="-"+e.minAspectRatio;h+="-"+e.maxAspectRatio;h+="-"+e.minHeight;h+="-"+e.minWidth;h+="-"+a.join(",");h+="-"+o.join(",");if(xt[h]){return xt[h]}}var l=Math.abs(ct.polygonArea(t));if(l===0){if(e.verbose){console.error("polygon has 0 area",t)}return null}var u=ut.extent(t,function(t){return t[0]});var c=u[0];var p=u[1];var _=ut.extent(t,function(t){return t[1]});var f=_[0];var d=_[1];var y=Math.min(p-c,d-f)*e.tolerance;if(y>0){t=yt(t,y)}if(e.events){r.push({type:"simplify",poly:t})}i=ut.extent(t,function(t){return t[0]}),c=i[0],p=i[1];n=ut.extent(t,function(t){return t[1]}),f=n[0],d=n[1];var v=[p-c,d-f];var g=v[0];var x=v[1];var m=Math.min(g,x)/50;if(!o.length){var b=ct.polygonCentroid(t);if(isNaN(b[0])){if(e.verbose){console.error("cannot find centroid",t)}return null}if(ct.polygonContains(t,b)){o.push(b)}while(o.length<e.nTries){var w=Math.random()*g+c;var k=Math.random()*x+f;var A=[w,k];if(ct.polygonContains(t,A)){o.push(A)}}}if(e.events){r.push({type:"origins",points:o})}var O=0;var S=null;for(var M=0;M<a.length;M++){var C=a[M];var R=-C*Math.PI/180;if(e.events){r.push({type:"angle",angle:C})}for(var N=0;N<o.length;N++){var W=o[N];var P=ft(t,W,R);var j=P[0];var E=P[1];var I=ft(t,W,R+Math.PI/2);var L=I[0];var H=I[1];var B=[];if(j&&E){B.push([(j[0]+E[0])/2,(j[1]+E[1])/2])}if(L&&H){B.push([(L[0]+H[0])/2,(L[1]+H[1])/2])}if(e.events){r.push({type:"modifOrigin",idx:N,p1W:j,p2W:E,p1H:L,p2H:H,modifOrigins:B})}for(var q=0;q<B.length;q++){var T=B[q];if(e.events){r.push({type:"origin",cx:T[0],cy:T[1]})}var D=ft(t,T,R);var U=D[0];var F=D[1];if(U===null||F===null){continue}var z=Math.min(pt(T,U),pt(T,F));var X=2*Math.sqrt(z);var G=ft(t,T,R+Math.PI/2);var V=G[0];var Y=G[1];if(V===null||Y===null){continue}var Z=Math.min(pt(T,V),pt(T,Y));var J=2*Math.sqrt(Z);if(X*J<O){continue}var K=s;if(!K.length){var Q=Math.max(e.minAspectRatio,e.minWidth/J,O/(J*J));var $=Math.min(e.maxAspectRatio,X/e.minHeight,X*X/O);K=ut.range(Q,$+vt,vt)}for(var tt=0;tt<K.length;tt++){var et=K[tt];var it=Math.max(e.minWidth,Math.sqrt(O*et));var nt=Math.min(X,J*et);if(nt*J<O){continue}if(e.events&&nt-it>=m){r.push({type:"aRatio",aRatio:et})}while(nt-it>=m){var rt=(it+nt)/2;var at=rt/et;var st=T[0];var ot=T[1];var ht=[[st-rt/2,ot-at/2],[st+rt/2,ot-at/2],[st+rt/2,ot+at/2],[st-rt/2,ot+at/2]];ht=dt(ht,R,T);var lt=_t(ht,t);if(lt){O=rt*at;ht.push(ht[0]);S={area:O,cx:st,cy:ot,width:rt,height:at,angle:-C,points:ht};it=rt}else{nt=rt}if(e.events){r.push({type:"rectangle",areaFraction:rt*at/l,cx:st,cy:ot,width:rt,height:at,angle:C,insidePoly:lt})}}}}}}if(e.cache){xt[h]=S}return e.events?Object.assign(S||{},{events:r}):S}var w=function(a){function t(){var r=this;a.call(this);this._curve="linear";this._defined=function(){return true};this._labelBounds=function(t,e,i){var n=_(i.points);if(!n){return null}return{angle:n.angle,width:n.width,height:n.height,x:n.cx-n.width/2-r._x(t,e),y:n.cy-n.height/2-r._y(t,e)}};this._labelConfig=Object.assign(this._labelConfig,{textAnchor:"middle",verticalAlign:"middle"});this._name="Area";this._x=y.accessor("x");this._x0=y.accessor("x");this._x1=null;this._y=y.constant(0);this._y0=y.constant(0);this._y1=y.accessor("y")}if(a)t.__proto__=a;t.prototype=Object.create(a&&a.prototype);t.prototype.constructor=t;t.prototype._aes=function t(e){var i=this;var n=e.values.slice().sort(function(t,e){return i._y1?i._x(t)-i._x(e):i._y(t)-i._y(e)});var r=n.map(function(t,e){return[i._x0(t,e),i._y0(t,e)]});var a=n.reverse().map(function(t,e){return i._y1?[i._x(t,e),i._y1(t,e)]:[i._x1(t,e),i._y(t,e)]});var s=r.concat(a);if(r[0][1]>a[0][1]){s=s.reverse()}s.push(s[0]);return{points:s}};t.prototype._dataFilter=function t(n){var r=this;var e=s.nest().key(this._id).entries(n).map(function(t){t.data=y.merge(t.values);t.i=n.indexOf(t.values[0]);var e=ut.extent(t.values.map(r._x).concat(t.values.map(r._x0)).concat(r._x1?t.values.map(r._x1):[]));t.xR=e;t.width=e[1]-e[0];t.x=e[0]+t.width/2;var i=ut.extent(t.values.map(r._y).concat(t.values.map(r._y0)).concat(r._y1?t.values.map(r._y1):[]));t.yR=i;t.height=i[1]-i[0];t.y=i[0]+t.height/2;t.nested=true;t.translate=[t.x,t.y];t.__d3plusShape__=true;return t});e.key=function(t){return t.key};return e};t.prototype.render=function t(e){a.prototype.render.call(this,e);var i=this._path=v.area().defined(this._defined).curve(v["curve"+this._curve.charAt(0).toUpperCase()+this._curve.slice(1)]).x(this._x).x0(this._x0).x1(this._x1).y(this._y).y0(this._y0).y1(this._y1);var n=v.area().defined(function(t){return t}).curve(v["curve"+this._curve.charAt(0).toUpperCase()+this._curve.slice(1)]).x(this._x).x0(this._x0).x1(this._x1).y(this._y).y0(this._y0).y1(this._y1);this._enter.append("path").attr("transform",function(t){return"translate("+(-t.xR[0]-t.width/2)+", "+(-t.yR[0]-t.height/2)+")"}).attr("d",function(t){return i(t.values)}).call(this._applyStyle.bind(this));this._update.select("path").transition(this._transition).attr("transform",function(t){return"translate("+(-t.xR[0]-t.width/2)+", "+(-t.yR[0]-t.height/2)+")"}).attrTween("d",function(t){return o.interpolatePath(f.select(this).attr("d"),i(t.values))}).call(this._applyStyle.bind(this));this._exit.select("path").transition(this._transition).attrTween("d",function(t){return o.interpolatePath(f.select(this).attr("d"),n(t.values))});return this};t.prototype.curve=function t(e){return arguments.length?(this._curve=e,this):this._curve};t.prototype.defined=function t(e){return arguments.length?(this._defined=e,this):this._defined};t.prototype.x=function t(e){if(!arguments.length){return this._x}this._x=typeof e==="function"?e:y.constant(e);this._x0=this._x;return this};t.prototype.x0=function t(e){if(!arguments.length){return this._x0}this._x0=typeof e==="function"?e:y.constant(e);this._x=this._x0;return this};t.prototype.x1=function t(e){return arguments.length?(this._x1=typeof e==="function"||e===null?e:y.constant(e),this):this._x1};t.prototype.y=function t(e){if(!arguments.length){return this._y}this._y=typeof e==="function"?e:y.constant(e);this._y0=this._y;return this};t.prototype.y0=function t(e){if(!arguments.length){return this._y0}this._y0=typeof e==="function"?e:y.constant(e);this._y=this._y0;return this};t.prototype.y1=function t(e){return arguments.length?(this._y1=typeof e==="function"||e===null?e:y.constant(e),this):this._y1};return t}(e);var k=function(r){function t(){var n=this;r.call(this,"rect");this._name="Bar";this._height=y.constant(10);this._labelBounds=function(t,e,i){return{width:i.width,height:i.height,x:n._x1!==null?n._getX(t,e):-i.width/2,y:n._x1===null?n._getY(t,e):-i.height/2}};this._width=y.constant(10);this._x=y.accessor("x");this._x0=y.accessor("x");this._x1=null;this._y=y.constant(0);this._y0=y.constant(0);this._y1=y.accessor("y")}if(r)t.__proto__=r;t.prototype=Object.create(r&&r.prototype);t.prototype.constructor=t;t.prototype.render=function t(e){var i=this;r.prototype.render.call(this,e);this._enter.attr("width",function(t,e){return i._x1===null?i._getWidth(t,e):0}).attr("height",function(t,e){return i._x1!==null?i._getHeight(t,e):0}).attr("x",function(t,e){return i._x1===null?-i._getWidth(t,e)/2:0}).attr("y",function(t,e){return i._x1!==null?-i._getHeight(t,e)/2:0}).call(this._applyStyle.bind(this)).transition(this._transition).call(this._applyPosition.bind(this));this._update.transition(this._transition).call(this._applyStyle.bind(this)).call(this._applyPosition.bind(this));this._exit.transition(this._transition).attr("width",function(t,e){return i._x1===null?i._getWidth(t,e):0}).attr("height",function(t,e){return i._x1!==null?i._getHeight(t,e):0}).attr("x",function(t,e){return i._x1===null?-i._getWidth(t,e)/2:0}).attr("y",function(t,e){return i._x1!==null?-i._getHeight(t,e)/2:0});return this};t.prototype._aes=function t(e,i){return{height:this._getHeight(e,i),width:this._getWidth(e,i)}};t.prototype._applyPosition=function t(e){var i=this;e.attr("width",function(t,e){return i._getWidth(t,e)}).attr("height",function(t,e){return i._getHeight(t,e)}).attr("x",function(t,e){return i._x1!==null?i._getX(t,e):-i._getWidth(t,e)/2}).attr("y",function(t,e){return i._x1===null?i._getY(t,e):-i._getHeight(t,e)/2})};t.prototype._getHeight=function t(e,i){if(this._x1!==null){return this._height(e,i)}return Math.abs(this._y1(e,i)-this._y(e,i))};t.prototype._getWidth=function t(e,i){if(this._x1===null){return this._width(e,i)}return Math.abs(this._x1(e,i)-this._x(e,i))};t.prototype._getX=function t(e,i){var n=this._x1===null?this._x(e,i):this._x1(e,i)-this._x(e,i);if(n<0){return n}else{return 0}};t.prototype._getY=function t(e,i){var n=this._x1!==null?this._y(e,i):this._y1(e,i)-this._y(e,i);if(n<0){return n}else{return 0}};t.prototype.height=function t(e){return arguments.length?(this._height=typeof e==="function"?e:y.constant(e),this):this._height};t.prototype.width=function t(e){return arguments.length?(this._width=typeof e==="function"?e:y.constant(e),this):this._width};t.prototype.x0=function t(e){if(!arguments.length){return this._x0}this._x0=typeof e==="function"?e:y.constant(e);this._x=this._x0;return this};t.prototype.x1=function t(e){return arguments.length?(this._x1=typeof e==="function"||e===null?e:y.constant(e),this):this._x1};t.prototype.y0=function t(e){if(!arguments.length){return this._y0}this._y0=typeof e==="function"?e:y.constant(e);this._y=this._y0;return this};t.prototype.y1=function t(e){return arguments.length?(this._y1=typeof e==="function"||e===null?e:y.constant(e),this):this._y1};return t}(e);var A=function(i){function t(){i.call(this,"circle");this._labelBounds=function(t,e,i){return{width:i.r*1.5,height:i.r*1.5,x:-i.r*.75,y:-i.r*.75}};this._labelConfig=y.assign(this._labelConfig,{textAnchor:"middle",verticalAlign:"middle"});this._name="Circle";this._r=y.accessor("r")}if(i)t.__proto__=i;t.prototype=Object.create(i&&i.prototype);t.prototype.constructor=t;t.prototype._applyPosition=function t(e){var i=this;e.attr("r",function(t,e){return i._r(t,e)}).attr("x",function(t,e){return-i._r(t,e)/2}).attr("y",function(t,e){return-i._r(t,e)/2})};t.prototype.render=function t(e){i.prototype.render.call(this,e);this._enter.attr("r",0).attr("x",0).attr("y",0).call(this._applyStyle.bind(this)).transition(this._transition).call(this._applyPosition.bind(this));this._update.transition(this._transition).call(this._applyStyle.bind(this)).call(this._applyPosition.bind(this));this._exit.transition(this._transition).attr("r",0).attr("x",0).attr("y",0);return this};t.prototype._aes=function t(e,i){return{r:this._r(e,i)}};t.prototype.r=function t(e){return arguments.length?(this._r=typeof e==="function"?e:y.constant(e),this):this._r};return t}(e);var O=function(r){function t(){var e=this;r.call(this);this._curve="linear";this._defined=function(t){return t};this._fill=y.constant("none");this._hitArea=y.constant({d:function(t){return e._path(t.values)},fill:"none","stroke-width":10,transform:null});this._name="Line";this._path=v.line();this._stroke=y.constant("black");this._strokeWidth=y.constant(1)}if(r)t.__proto__=r;t.prototype=Object.create(r&&r.prototype);t.prototype.constructor=t;t.prototype._dataFilter=function t(n){var r=this;var e=s.nest().key(this._id).entries(n).map(function(t){t.data=y.merge(t.values);t.i=n.indexOf(t.values[0]);var e=ut.extent(t.values,r._x);t.xR=e;t.width=e[1]-e[0];t.x=e[0]+t.width/2;var i=ut.extent(t.values,r._y);t.yR=i;t.height=i[1]-i[0];t.y=i[0]+t.height/2;t.nested=true;t.translate=[t.x,t.y];t.__d3plusShape__=true;return t});e.key=function(t){return t.key};return e};t.prototype.render=function t(e){var i=this;r.prototype.render.call(this,e);var n=this;this._path.curve(v["curve"+this._curve.charAt(0).toUpperCase()+this._curve.slice(1)]).defined(this._defined).x(this._x).y(this._y);this._enter.append("path").attr("transform",function(t){return"translate("+(-t.xR[0]-t.width/2)+", "+(-t.yR[0]-t.height/2)+")"}).attr("d",function(t){return i._path(t.values)}).call(this._applyStyle.bind(this));this._update.select("path").transition(this._transition).attr("transform",function(t){return"translate("+(-t.xR[0]-t.width/2)+", "+(-t.yR[0]-t.height/2)+")"}).attrTween("d",function(t){return o.interpolatePath(f.select(this).attr("d"),n._path(t.values))}).call(this._applyStyle.bind(this));return this};t.prototype._aes=function t(e,i){var n=this;return{points:e.values.map(function(t){return[n._x(t,i),n._y(t,i)]})}};t.prototype.curve=function t(e){return arguments.length?(this._curve=e,this):this._curve};t.prototype.defined=function t(e){return arguments.length?(this._defined=e,this):this._defined};return t}(e);var S=Math.PI;function M(t,e,i){if(i===void 0)i="circle";if(t<0){t=S*2+t}if(i==="square"){var n=45*(S/180);var r=0,a=0;if(t<S/2){var s=Math.tan(t);r+=t<n?e:e/s;a+=t<n?s*e:e}else if(t<=S){var o=Math.tan(S-t);r-=t<S-n?e/o:e;a+=t<S-n?e:o*e}else if(t<n+S){r-=e;a-=Math.tan(t-S)*e}else if(t<3*S/2){r-=e/Math.tan(t-S);a-=e}else if(t<2*S-n){r+=e/Math.tan(2*S-t);a-=e}else{r+=e;a-=Math.tan(2*S-t)*e}return[r,a]}else if(i==="circle"){return[e*Math.cos(t),e*Math.sin(t)]}else{return null}}var C=Math.PI;function R(t,e){if(e===void 0)e=20;var i=[],n=/([MLA])([^MLAZ]+)/gi;var r=n.exec(t);while(r!==null){if(["M","L"].includes(r[1])){i.push(r[2].split(",").map(Number))}else if(r[1]==="A"){var a=r[2].split(",").map(Number);var s=a.slice(a.length-2,a.length),o=i[i.length-1],h=a[0],l=x(o,s);var u=Math.acos((h*h+h*h-l*l)/(2*h*h));if(a[2]){u=C*2-u}var c=u/(u/(C*2)*(h*C*2)/e);var p=Math.atan2(-o[1],-o[0])-C;var _=c;while(_<u){i.push(M(a[4]?p+_:p-_,h));_+=c}i.push(s)}r=n.exec(t)}return i}var N=function(i){function t(){var r=this;i.call(this,"path");this._d=y.accessor("path");this._labelBounds=function(t,e,i){var n=_(i.points,{angle:r._labelConfig.rotate?r._labelConfig.rotate(t,e):0});return{angle:n.angle,width:n.width,height:n.height,x:n.cx-n.width/2,y:n.cy-n.height/2}};this._name="Path";this._labelConfig=Object.assign(this._labelConfig,{textAnchor:"middle",verticalAlign:"middle"})}if(i)t.__proto__=i;t.prototype=Object.create(i&&i.prototype);t.prototype.constructor=t;t.prototype._aes=function t(e,i){return{points:R(this._d(e,i))}};t.prototype.render=function t(e){i.prototype.render.call(this,e);this._enter.attr("opacity",0).attr("d",this._d).call(this._applyStyle.bind(this)).transition(this._transition).attr("opacity",1);this._update.transition(this._transition).call(this._applyStyle.bind(this)).attr("opacity",1).attr("d",this._d);this._exit.transition(this._transition).attr("opacity",0);return this};t.prototype.d=function t(e){return arguments.length?(this._d=typeof e==="function"?e:y.constant(e),this):this._d};return t}(e);var W=function(i){function t(){i.call(this,"rect");this._height=y.accessor("height");this._labelBounds=function(t,e,i){return{width:i.width,height:i.height,x:-i.width/2,y:-i.height/2}};this._name="Rect";this._width=y.accessor("width")}if(i)t.__proto__=i;t.prototype=Object.create(i&&i.prototype);t.prototype.constructor=t;t.prototype.render=function t(e){i.prototype.render.call(this,e);this._enter.attr("width",0).attr("height",0).attr("x",0).attr("y",0).call(this._applyStyle.bind(this)).transition(this._transition).call(this._applyPosition.bind(this));this._update.transition(this._transition).call(this._applyStyle.bind(this)).call(this._applyPosition.bind(this));this._exit.transition(this._transition).attr("width",0).attr("height",0).attr("x",0).attr("y",0);return this};t.prototype._aes=function t(e,i){return{width:this._width(e,i),height:this._height(e,i)}};t.prototype._applyPosition=function t(e){var i=this;e.attr("width",function(t,e){return i._width(t,e)}).attr("height",function(t,e){return i._height(t,e)}).attr("x",function(t,e){return-i._width(t,e)/2}).attr("y",function(t,e){return-i._height(t,e)/2})};t.prototype.height=function t(e){return arguments.length?(this._height=typeof e==="function"?e:y.constant(e),this):this._height};t.prototype.width=function t(e){return arguments.length?(this._width=typeof e==="function"?e:y.constant(e),this):this._width};return t}(e);t.Image=h;t.Shape=e;t.Area=w;t.Bar=k;t.Circle=A;t.Line=O;t.Path=N;t.Rect=W;t.largestRect=_;t.lineIntersection=m;t.path2polygon=R;t.pointDistance=x;t.pointDistanceSquared=pt;t.pointRotate=n;t.polygonInside=_t;t.polygonRayCast=ft;t.polygonRotate=dt;t.segmentBoxContains=b;t.segmentsIntersect=u;t.shapeEdgePoint=M;t.simplify=yt;Object.defineProperty(t,"__esModule",{value:true})});