/*
  d3plus-plot v0.1.1
  A reusable plot built on D3
  Copyright (c) 2016 D3plus - https://d3plus.org
  @license MIT
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3-array"),require("d3-collection"),require("d3-scale"),require("d3plus-axis"),require("d3plus-common"),require("d3plus-shape"),require("d3plus-viz")):"function"==typeof define&&define.amd?define("d3plus-plot",["exports","d3-array","d3-collection","d3-scale","d3plus-axis","d3plus-common","d3plus-shape","d3plus-viz"],e):e(t.d3plus=t.d3plus||{},t.d3Array,t.d3Collection,t.scales,t.d3plusAxis,t.d3plusCommon,t.shapes,t.d3plusViz)}(this,function(t,e,i,n,r,s,o,a){"use strict";function d(t,e,i,n){var r=e.domain().slice(),s=e.range(),o=i.domain().slice(),a=i.range();return t.forEach(function(t){var d=n.r(t.data,t.i);if(e(t.x)-s[0]<2*d){var u=e.invert(e(t.x)-2*d);u<r[0]&&(r[0]=u)}if(s[1]-e(t.x)<2*d){var h=e.invert(e(t.x)+2*d);h>r[1]&&(r[1]=h)}if(i(t.y)-a[0]<2*d){var c=i.invert(i(t.y)-2*d);c>o[0]&&(o[0]=c)}if(a[1]-i(t.y)<2*d){var f=i.invert(i(t.y)+2*d);f<o[1]&&(o[1]=f)}}),e.domain(r),i.domain(o),[e,i]}function u(t,e,i,n){var r=e.domain().slice(),s=e.range(),o=i.domain().slice(),a=i.range();return t.forEach(function(t){var d=n.height(t.data,t.i),u=n.width(t.data,t.i);if(e(t.x)-s[0]<u){var h=e.invert(e(t.x)-u);h<r[0]&&(r[0]=h)}if(s[1]-e(t.x)<u){var c=e.invert(e(t.x)+u);c>r[1]&&(r[1]=c)}if(i(t.y)-a[0]<d){var f=i.invert(i(t.y)-d);f>o[0]&&(o[0]=f)}if(a[1]-i(t.y)<d){var l=i.invert(i(t.y)+d);l<o[1]&&(o[1]=l)}}),e.domain(r),i.domain(o),[e,i]}var h=function(t){function a(){t.call(this),this._buffer={Circle:d,Rect:u},this._shape=s.constant("Circle"),this._shapeConfig=Object.assign(this._shapeConfig,{Circle:{r:s.constant(5)},Line:{label:!1},Rect:{height:s.constant(10),width:s.constant(10)}}),this._x=s.accessor("x"),this._xAxis=(new r.AxisBottom).align("end"),this._xTest=(new r.AxisBottom).align("end").gridSize(0),this._xConfig={title:"X Axis"},this._y=s.accessor("y"),this._yAxis=(new r.AxisLeft).align("start"),this._yTest=(new r.AxisLeft).align("start").gridSize(0),this._yConfig={title:"Y Axis"}}return t&&(a.__proto__=t),a.prototype=Object.create(t&&t.prototype),a.prototype.constructor=a,a.prototype.render=function(r){var a=this;t.prototype.render.call(this,r);var d=this._filteredData.map(function(t,e){return{data:t,i:e,id:a._id(t,e),shape:a._shape(t,e),x:a._x(t,e),y:a._y(t,e)}}),u=this._height-this._margin.top-this._margin.bottom,h=this._select,c="translate("+this._margin.left+", "+this._margin.top+")",f=this._transition,l=this._width-this._margin.left-this._margin.right,p=n.scaleLinear().domain(e.extent(d,function(t){return t.x})).range([0,l]),_=n.scaleLinear().domain(e.extent(d,function(t){return t.y}).reverse()).range([0,u]),g=i.nest().key(function(t){return t.shape}).entries(d);g.forEach(function(t){if(a._buffer[t.key]){var e=a._buffer[t.key](t.values,p,_,a._shapeConfig[t.key]);p=e[0],_=e[1]}}),this._yTest.domain(_.domain()).height(u).select(s.elem("g.d3plus-plot-test",{enter:{opacity:0},parent:this._select}).node()).width(l).config(this._yConfig).render();var y=this._yTest.outerBounds().width+this._yTest.padding();this._xTest.domain(p.domain()).height(u).range([y,void 0]).select(s.elem("g.d3plus-plot-test",{enter:{opacity:0},parent:this._select}).node()).width(l).config(this._xConfig).render(),this._xAxis.domain(p.domain()).height(u).range([y,void 0]).select(s.elem("g.d3plus-plot-x-axis",{parent:h,transition:f,enter:{transform:c},update:{transform:c}}).node()).width(l).config(this._xConfig).render(),p=this._xAxis._d3Scale,this._yAxis.domain(_.domain()).height(u).range([this._xAxis.outerBounds().y,u-this._xTest.outerBounds().height]).select(s.elem("g.d3plus-plot-y-axis",{parent:h,transition:f,enter:{transform:c},update:{transform:c}}).node()).width(p.range()[1]+this._xAxis.padding()).config(this._yConfig).render(),_=this._yAxis._d3Scale;var x={duration:this._duration,fill:function(t){return a._shapeConfig.fill(t.data,t.i)},label:function(t){return a._drawLabel(t.data,t.i)},opacity:function(t){return a._shapeConfig.opacity(t.data,t.i)},select:s.elem("g.d3plus-plot-shapes",{parent:h,transition:f}).node(),stroke:function(t){return a._shapeConfig.stroke(t.data,t.i)},strokeWidth:function(t){return a._shapeConfig.strokeWidth(t.data,t.i)},x:function(t){return p(t.x)},y:function(t){return _(t.y)}},m=Object.keys(this._on);return g.forEach(function(t){for(var e=(new o[t.key]).config(x).data(t.values),i=m.filter(function(e){return e.includes("."+t.key)}),n=m.filter(function(t){return!t.includes(".")}),r=m.filter(function(t){return t.includes(".shape")}),s=function(t){e.on(n[t],function(e){return a._on[n[t]](e.data,e.i)})},d=0;d<n.length;d++)s(d);for(var u=function(t){e.on(r[t],function(e){return a._on[r[t]](e.data,e.i)})},h=0;h<r.length;h++)u(h);for(var c=function(t){e.on(i[t],function(e){return a._on[i[t]](e.data,e.i)})},f=0;f<i.length;f++)c(f);e.config(a._shapeConfig[t.key]||{}).render(),a._shapes.push(e)}),this},a.prototype.x=function(t){return arguments.length?(this._x="function"==typeof t?t:s.constant(t),this):this._x},a.prototype.y=function(t){return arguments.length?(this._y="function"==typeof t?t:s.constant(t),this):this._y},a}(a.Viz);t.Plot=h,Object.defineProperty(t,"__esModule",{value:!0})});