!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("d3plus-common"),require("d3-array"),require("d3-selection"),require("d3plus-shape"),require("d3plus-text")):"function"==typeof define&&define.amd?define("d3plus-legend",["exports","d3plus-common","d3-array","d3-selection","d3plus-shape","d3plus-text"],n):n(t.d3plus_legend=t.d3plus_legend||{},t.d3plus_common,t.d3_array,t.d3_selection,t.d3plus_shape,t.d3plus_text)}(this,function(t,n,e,i,r,o){"use strict";function u(t){function u(t,n){var e=A[n];return{width:e.width,height:e.height,x:t.width/2+H,y:1-e.height/2}}function l(n,i){return"vertical"===F?s.x+S(n,i)/2:s.x+e.sum(t.slice(0,i).map(function(t,n){return S(t,n)}))+e.sum(A.slice(0,i).map(function(t){return t.width-b(n,i)}))+S(n,i)/2+3*H*i}function a(n,i){if("horizontal"===F)return s.y+e.max(A.map(function(t){return t.height}).concat(t.map(function(t,n){return S(t,n)})))/2;var r=S(n,i),o=A[i].height>r?A[i].height/2:r/2,u=e.sum(A.slice(0,i),function(t,n){return e.max([t.height,S(t.data,n)])});return s.y+u+o+H*i}function h(n){void 0===f&&h.select(i.select("body").append("svg").attr("width",window.innerWidth+"px").attr("height",window.innerHeight+"px").node()),void 0===c&&(c=function(t,n){return 1.1*b(t,n)});var u=f.selectAll("g.d3plus-legend-bg-group").data([0]);u=u.enter().append("g").attr("class","d3plus-legend-bg-group").merge(u),r.rect().data([{id:"legend-background"}]).duration(m).fill(p).height(z).select(u.node()).width(B).x(B/2).y(z/2)(),A=t.map(function(n,i){var r=v(n,i),u=c(n,i),l=b(n,i),a="horizontal"===F?z-(t.length+1)*H:z,h="vertical"===F?B-3*H-S(n,i):B,f=o.wrap().fontFamily(r).fontSize(l).lineHeight(u).width(h).height(a)(_(n,i));return f.width=Math.ceil(e.max(f.lines.map(function(t){return o.width(t,{"font-family":r,"font-size":l})})))+l,f.height=Math.ceil(f.lines.length*(u+1)),f.og={height:f.height,width:f.width},f.data=n,f.f=r,f.s=l,f.lh=u,f});var l,a,O=!0;if("horizontal"===F&&(l=B-e.sum(t.map(function(t,n){return S(t,n)+3*H}))-2*H,a=e.sum(A.map(function(t,n){return t.width-b(t,n)})),a>l)){var P=A.filter(function(t){return t.words.length>1}).sort(function(t,n){return n.sentence.length-t.sentence.length});if(P.length&&z>2*P[0].height)for(var R=2;5>=R;){var T=P.filter(function(t){return t.words.length>=R});if(!T.length)break;for(var W=function(t){var n=P[t],i=n.og.height*R,r=n.og.width*(1.5*(1/R)),u=o.wrap().fontFamily(n.f).fontSize(n.s).lineHeight(n.lh).width(r).height(i)(n.sentence);return!u.truncated&&(a-=n.width,n.width=Math.ceil(e.max(u.lines.map(function(t){return o.width(t,{"font-family":n.f,"font-size":n.s})})))+n.s,n.height=u.lines.length*(n.lh+1),a+=n.width,l>=a)?"break":void 0},D=0;D<P.length;D++){var E=W(D);if("break"===E)break}if(l>=a)break;R++}else O=!1}if(a>l&&(O=!1),!O){a=0;for(var G=0;G<A.length;G++)A[G].width=0,A[G].height=0}var J=e.max(A,function(t,n){return e.max([t.height,S(t.data,n)])}),K=a+e.sum(t,function(t,n){return S(t,n)})+H*(t.length*(O?3:1)-2);s.width=K,s.height=J;var L=H,N=H;"center"===g?L=(B-2*H-K)/2:"right"===g&&(L=B-2*H-K),"middle"===j?N=(z-2*H-J)/2:"bottom"===j&&(N=z-2*H-J),s.x=L,s.y=N;var Q=f.selectAll("g.d3plus-legend-shape-group").data([0]);Q=Q.enter().append("g").attr("class","d3plus-legend-shape-group").merge(Q);for(var U=r.rect().backgroundImage(M).data(t).duration(m).fill(y).fontColor(w).fontFamily(v).fontResize(x).fontSize(b).height(S).id(k).innerBounds(q).label(O?_:!1).labelPadding(0).lineHeight(c).select(Q.node()).verticalAlign("top").width(S).x(C).y(I),V=Object.keys(d),X=0;X<V.length;X++)U.on(V[X],d[V[X]]);return U(),n&&setTimeout(n,m+100),h}void 0===t&&(t=[]);var c,f,d={},s={width:0,height:0,x:0,y:0},g="center",p="transparent",m=600,y=n.accessor("color"),w=n.constant("#444"),v=n.constant("sans-serif"),x=n.constant(!1),b=n.constant(10),z=100,k=n.accessor("id"),_=n.accessor("id"),q=u,A=[],F="horizontal",H=5,M=n.constant(!1),S=n.constant(10),j="middle",B=400,C=l,I=a;return h.align=function(t){return arguments.length?(g=t,h):g},h.backgroundColor=function(t){return arguments.length?(p=t,h):p},h.data=function(n){return arguments.length?(t=n,h):t},h.duration=function(t){return arguments.length?(m=t,h):m},h.fill=function(t){return arguments.length?(y=t,h):y},h.fontColor=function(t){return arguments.length?(w="function"==typeof t?t:n.constant(t),h):w},h.fontFamily=function(t){return arguments.length?(v="function"==typeof t?t:n.constant(t),h):v},h.fontResize=function(t){return arguments.length?(x="function"==typeof t?t:n.constant(t),h):x},h.fontSize=function(t){return arguments.length?(b="function"==typeof t?t:n.constant(t),h):b},h.height=function(t){return arguments.length?(z=t,h):z},h.id=function(t){return arguments.length?(k=t,h):k},h.label=function(t){return arguments.length?(_="function"==typeof t?t:n.constant(t),h):_},h.labelBounds=function(t){return arguments.length?(q=t,h):q},h.on=function(t,n){return 2===arguments.length?(d[t]=n,h):arguments.length?d[t]:d},h.orient=function(t){return arguments.length?(F=t,h):F},h.outerBounds=function(){return s},h.padding=function(t){return arguments.length?(H=t,h):H},h.select=function(t){return arguments.length?(f=i.select(t),h):f},h.shapeImage=function(t){return arguments.length?(M="function"==typeof t?t:n.constant(t),h):M},h.size=function(t){return arguments.length?(S="function"==typeof t?t:n.constant(t),h):S},h.verticalAlign=function(t){return arguments.length?(j=t,h):j},h.width=function(t){return arguments.length?(B=t,h):B},h.x=function(t){return arguments.length?(C="function"==typeof t?t:n.constant(t),h):C},h.y=function(t){return arguments.length?(I="function"==typeof t?t:n.constant(t),h):I},t.length?h():h}var l="0.2.1";t.version=l,t.shape=u,Object.defineProperty(t,"__esModule",{value:!0})});