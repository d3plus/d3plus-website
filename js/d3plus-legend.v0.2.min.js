!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("d3plus-common"),require("d3-array"),require("d3-selection"),require("d3plus-shape"),require("d3plus-text")):"function"==typeof define&&define.amd?define("d3plus-legend",["exports","d3plus-common","d3-array","d3-selection","d3plus-shape","d3plus-text"],n):n(t.d3plus_legend=t.d3plus_legend||{},t.d3plus_common,t.d3_array,t.d3_selection,t.d3plus_shape,t.d3plus_text)}(this,function(t,n,e,i,r,o){"use strict";function u(t){function u(t,n){var e=F[n];return{width:e.width,height:e.height,x:t.width/2+M,y:1-e.height/2}}function h(n,i){return"vertical"===H?s.x+j(n,i)/2:s.x+e.sum(t.slice(0,i).map(function(t,n){return j(t,n)}))+e.sum(F.slice(0,i).map(function(t){return t.width-b(n,i)}))+j(n,i)/2+3*M*i}function l(n,i){if("horizontal"===H)return s.y+e.max(F.map(function(t){return t.height}).concat(t.map(function(t,n){return j(t,n)})))/2;var r=j(n,i),o=F[i].height>r?F[i].height/2:r/2,u=e.sum(F.slice(0,i),function(t,n){return e.max([t.height,j(t.data,n)])});return s.y+u+o+M*i}function a(n){void 0===f&&a.select(i.select("body").append("svg").attr("width",window.innerWidth+"px").attr("height",window.innerHeight+"px").node()),void 0===c&&(c=function(t,n){return 1.1*b(t,n)}),r.rect().data([{id:"legend-background"}]).duration(m).fill(p).height(z).select(f.node()).width(B).x(B/2).y(z/2)(),F=t.map(function(n,i){var r=v(n,i),u=c(n,i),h=b(n,i),l="horizontal"===H?z-(t.length+1)*M:z,a="vertical"===H?B-3*M-j(n,i):B,f=o.wrap().fontFamily(r).fontSize(h).lineHeight(u).width(a).height(l)(_(n,i));return f.width=Math.ceil(e.max(f.lines.map(function(t){return o.width(t,{"font-family":r,"font-size":h})})))+h,f.height=Math.ceil(f.lines.length*(u+1)),f.og={height:f.height,width:f.width},f.data=n,f.f=r,f.s=h,f.lh=u,f});var u,h,l=!0;if("horizontal"===H&&(u=B-e.sum(t.map(function(t,n){return j(t,n)+3*M}))-2*M,h=e.sum(F.map(function(t,n){return t.width-b(t,n)})),h>u)){var O=F.filter(function(t){return t.words.length>1}).sort(function(t,n){return n.sentence.length-t.sentence.length});if(O.length&&z>2*O[0].height)for(var P=2;5>=P;){var R=O.filter(function(t){return t.words.length>=P});if(!R.length)break;for(var T=function(t){var n=O[t],i=n.og.height*P,r=n.og.width*(1.5*(1/P)),l=o.wrap().fontFamily(n.f).fontSize(n.s).lineHeight(n.lh).width(r).height(i)(n.sentence);return!l.truncated&&(h-=n.width,n.width=Math.ceil(e.max(l.lines.map(function(t){return o.width(t,{"font-family":n.f,"font-size":n.s})})))+n.s,n.height=l.lines.length*(n.lh+1),h+=n.width,u>=h)?"break":void 0},W=0;W<O.length;W++){var D=T(W);if("break"===D)break}if(u>=h)break;P++}else l=!1}if(h>u&&(l=!1),!l){h=0;for(var E=0;E<F.length;E++)F[E].width=0,F[E].height=0}var G=e.max(F,function(t,n){return e.max([t.height,j(t.data,n)])}),J=h+e.sum(t,function(t,n){return j(t,n)})+M*(t.length*(l?3:1)-2);s.width=J,s.height=G;var K=M,L=M;"center"===g?K=(B-2*M-J)/2:"right"===g&&(K=B-2*M-J),"middle"===A?L=(z-2*M-G)/2:"bottom"===A&&(L=z-2*M-G),s.x=K,s.y=L;var N=f.selectAll("g.d3plus-legend-shape-group").data([0]);N=N.enter().append("g").attr("class","d3plus-legend-shape-group").merge(N);for(var Q=r.rect().backgroundImage(S).data(t).duration(m).fill(y).fontColor(w).fontFamily(v).fontResize(x).fontSize(b).height(j).id(k).innerBounds(q).label(l?_:!1).labelPadding(0).lineHeight(c).select(N.node()).verticalAlign("top").width(j).x(C).y(I),U=Object.keys(d),V=0;V<U.length;V++)Q.on(U[V],d[U[V]]);return Q(),n&&setTimeout(n,m+100),a}void 0===t&&(t=[]);var c,f,d={},s={width:0,height:0,x:0,y:0},g="center",p="transparent",m=600,y=n.accessor("color"),w=n.constant("#444"),v=n.constant("sans-serif"),x=n.constant(!1),b=n.constant(10),z=100,k=n.accessor("id"),_=n.accessor("id"),q=u,F=[],H="horizontal",M=5,S=n.constant(!1),j=n.constant(10),A="middle",B=400,C=h,I=l;return a.align=function(t){return arguments.length?(g=t,a):g},a.backgroundColor=function(t){return arguments.length?(p=t,a):p},a.data=function(n){return arguments.length?(t=n,a):t},a.duration=function(t){return arguments.length?(m=t,a):m},a.fill=function(t){return arguments.length?(y=t,a):y},a.fontColor=function(t){return arguments.length?(w="function"==typeof t?t:n.constant(t),a):w},a.fontFamily=function(t){return arguments.length?(v="function"==typeof t?t:n.constant(t),a):v},a.fontResize=function(t){return arguments.length?(x="function"==typeof t?t:n.constant(t),a):x},a.fontSize=function(t){return arguments.length?(b="function"==typeof t?t:n.constant(t),a):b},a.height=function(t){return arguments.length?(z=t,a):z},a.id=function(t){return arguments.length?(k=t,a):k},a.label=function(t){return arguments.length?(_="function"==typeof t?t:n.constant(t),a):_},a.labelBounds=function(t){return arguments.length?(q=t,a):q},a.on=function(t,n){return 2===arguments.length?(d[t]=n,a):arguments.length?d[t]:d},a.orient=function(t){return arguments.length?(H=t,a):H},a.outerBounds=function(){return s},a.padding=function(t){return arguments.length?(M=t,a):M},a.select=function(t){return arguments.length?(f=i.select(t),a):f},a.shapeImage=function(t){return arguments.length?(S="function"==typeof t?t:n.constant(t),a):S},a.size=function(t){return arguments.length?(j="function"==typeof t?t:n.constant(t),a):j},a.verticalAlign=function(t){return arguments.length?(A=t,a):A},a.width=function(t){return arguments.length?(B=t,a):B},a.x=function(t){return arguments.length?(C="function"==typeof t?t:n.constant(t),a):C},a.y=function(t){return arguments.length?(I="function"==typeof t?t:n.constant(t),a):I},t.length?a():a}var h="0.2.0";t.version=h,t.shape=u,Object.defineProperty(t,"__esModule",{value:!0})});