/*
  d3plus-axis v0.3.1
  Beautiful javascript scales and axes.
  Copyright (c) 2016 D3plus - https://d3plus.org
  @license MIT
*/
!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports,require("d3-array"),require("d3-scale"),require("d3-selection"),require("d3-transition"),require("d3plus-common"),require("d3plus-shape"),require("d3plus-text")):"function"==typeof define&&define.amd?define("d3plus-axis",["exports","d3-array","d3-scale","d3-selection","d3-transition","d3plus-common","d3plus-shape","d3plus-text"],i):i(t.d3plus=t.d3plus||{},t.d3Array,t.scales,t.d3Selection,t.d3Transition,t.d3plusCommon,t.shapes,t.d3plusText)}(this,function(t,i,e,n,s,o,h,r){"use strict";function a(t){if(t.constructor===Date)return t;if(t.constructor===Number&&t>0&&(""+t).length>4&&t%1===0)return new Date(t);var i=""+t;if(i.includes("/")||i.includes(" ")||i.includes("-")&&i.indexOf("-"))return new Date(i);var e=new Date(i+"/01/01");return e.setFullYear(t),e}var _=function(t){function _(){var i=this;t.call(this),this._align="middle",this._barConfig={stroke:"#000","stroke-width":1},this._domain=[0,10],this._duration=600,this._gridConfig={stroke:"#ccc","stroke-width":1},this._height=400,this.orient("bottom"),this._outerBounds={width:0,height:0,x:0,y:0},this._padding=5,this._paddingInner=.1,this._paddingOuter=.1,this._scale="linear",this._shape="Line",this._shapeConfig={fill:"#000",fontColor:"#000",fontFamily:(new r.TextBox).fontFamily(),fontResize:!1,fontSize:o.constant(10),height:8,label:function(t){return t.text},labelBounds:function(t){return t.labelBounds},labelPadding:0,r:4,stroke:"#000",strokeWidth:1,textAnchor:function(){return"left"===i._orient?"end":"right"===i._orient?"start":"middle"},verticalAlign:function(){return"bottom"===i._orient?"top":"top"===i._orient?"bottom":"middle"},width:8},this._tickSize=5,this._titleConfig={fontFamily:"Verdana",fontSize:12,lineHeight:13,textAnchor:"middle"},this._width=400}return t&&(_.__proto__=t),_.prototype=Object.create(t&&t.prototype),_.prototype.constructor=_,_.prototype._barPosition=function(t){var i=this._position,e=i.height,n=i.x,s=i.y,h=i.opposite,r=this._d3Scale.domain(),a=this._margin[h],_=["top","left"].includes(this._orient)?this._outerBounds[s]+this._outerBounds[e]-a:this._outerBounds[s]+a;t.call(o.attrize,this._barConfig).attr(n+"1",this._d3Scale(r[0])-("band"===this._scale?this._d3Scale.step()-this._d3Scale.bandwidth():0)).attr(n+"2",this._d3Scale(r[r.length-1])+("band"===this._scale?this._d3Scale.step():0)).attr(s+"1",_).attr(s+"2",_)},_.prototype._gridPosition=function(t,i){void 0===i&&(i=!1);var e=this._position,n=e.height,s=e.x,h=e.y,r=e.opposite,a=this._margin[r],_=["top","left"].includes(this._orient)?this._outerBounds[h]+this._outerBounds[n]-a:this._outerBounds[h]+a,l=i?this._lastScale||this._d3Scale:this._d3Scale,d=["top","left"].includes(this._orient)?a:-a,u="band"===this._scale?this._d3Scale.bandwidth()/2:0,c=function(t){return l(t.id)+u};t.call(o.attrize,this._gridConfig).attr(s+"1",c).attr(s+"2",c).attr(h+"1",_).attr(h+"2",i?_:_+d)},_.prototype.align=function(t){return arguments.length?(this._align=t,this):this._align},_.prototype.barConfig=function(t){return arguments.length?(this._barConfig=Object.assign(this._barConfig,t),this):this._barConfig},_.prototype.domain=function(t){return arguments.length?(this._domain=t,this):this._domain},_.prototype.duration=function(t){return arguments.length?(this._duration=t,this):this._duration},_.prototype.grid=function(t){return arguments.length?(this._grid=t,this):this._grid},_.prototype.gridConfig=function(t){return arguments.length?(this._gridConfig=Object.assign(this._gridConfig,t),this):this._gridConfig},_.prototype.gridSize=function(t){return arguments.length?(this._gridSize=t,this):this._gridSize},_.prototype.height=function(t){return arguments.length?(this._height=t,this):this._height},_.prototype.labels=function(t){return arguments.length?(this._labels=t,this):this._labels},_.prototype.orient=function(t){if(arguments.length){var i=["top","bottom"].includes(t),e={top:"bottom",right:"left",bottom:"top",left:"right"};return this._position={horizontal:i,width:i?"width":"height",height:i?"height":"width",x:i?"x":"y",y:i?"y":"x",opposite:e[t]},this._orient=t,this}return this._orient},_.prototype.outerBounds=function(){return this._outerBounds},_.prototype.padding=function(t){return arguments.length?(this._padding=t,this):this._padding},_.prototype.paddingInner=function(t){return arguments.length?(this._paddingInner=t,this):this._paddingInner},_.prototype.paddingOuter=function(t){return arguments.length?(this._paddingOuter=t,this):this._paddingOuter},_.prototype.range=function(t){return arguments.length?(this._range=t,this):this._range},_.prototype.render=function(t){var _=this;void 0===this._select&&this.select(n.select("body").append("svg").attr("width",this._width+"px").attr("height",this._height+"px").node()),void 0===this._lineHeight&&(this._lineHeight=function(t,i){return 1.1*_._shapeConfig.fontSize(t,i)});var l=this._position,d=l.width,u=l.height,c=l.x,p=l.y,g=l.horizontal,f=l.opposite,m="d3plus-Axis-clip-"+this._uuid,y="Circle"===this._shape?this._shapeConfig.r:"Rect"===this._shape?this._shapeConfig[u]/2:this._tickSize,b=this._padding,S=this._select,x=s.transition().duration(this._duration),v="Circle"===this._shape?this._shapeConfig.r:"Rect"===this._shape?this._shapeConfig[d]/2:this._tickSize,C=this._range?this._range.slice():[void 0,void 0];if(void 0===C[0]&&(C[0]=b),void 0===C[1]&&(C[1]=this["_"+d]-b),this._size=C[1]-C[0],"ordinal"===this._scale&&this._domain.length>C.length&&(C=i.range(this._domain.length).map(function(t){return _._size*(t/(_._domain.length-1))+C[0]})),this._margin={top:0,right:0,bottom:0,left:0},this._title){var z=this._titleConfig.lineHeight?this._titleConfig.lineHeight:1.1*this._titleConfig.fontSize,B=r.textWrap().fontFamily(this._titleConfig.fontFamily).fontSize(this._titleConfig.fontSize).lineHeight(z).width(this._size).height(this["_"+u]-this._tickSize-b)(this._title);this._margin[this._orient]=B.lines.length*z+b}this._d3Scale=e["scale"+this._scale.charAt(0).toUpperCase()+this._scale.slice(1)]().domain("time"===this._scale?this._domain.map(a):this._domain).range(C),this._d3Scale.round&&this._d3Scale.round(!0),this._d3Scale.paddingInner&&this._d3Scale.paddingInner(this._paddingInner),this._d3Scale.paddingOuter&&this._d3Scale.paddingOuter(this._paddingOuter);var w=e.scaleSqrt().domain([10,400]).range([10,0===this._gridSize?32.5:75]),k=e.scaleSqrt().domain([10,400]).range([10,75]),O=this._ticks?"time"===this._scale?this._ticks.map(a):this._ticks:this._d3Scale.ticks?this._d3Scale.ticks(Math.floor(this._size/w(this._size))):this._domain,A=this._ticks&&!this._labels?O:this._labels?"time"===this._scale?this._labels.map(a):this._labels:this._d3Scale.ticks?this._d3Scale.ticks(Math.floor(this._size/k(this._size))):this._domain,j=this._d3Scale.tickFormat?this._d3Scale.tickFormat(A.length-1):function(t){return t};if("time"===this._scale&&(O=O.map(Number),A=A.map(Number)),this._visibleTicks=O,"band"===this._scale)this._space=this._d3Scale.bandwidth();else if(A.length>1){this._space=0;for(var F=0;F<A.length-1;F++){var q=_._d3Scale(A[F+1])-_._d3Scale(A[F]);q>_._space&&(_._space=q)}}else this._space=this._size;var H=A.map(function(t,e){var n=_._shapeConfig.fontFamily(t,e),s=_._shapeConfig.fontSize(t,e),o=_._shapeConfig.lineHeight?_._shapeConfig.lineHeight(t,e):1.1*s,h=r.textWrap().fontFamily(n).fontSize(s).lineHeight(o).width(g?_._space:_._width-y-b).height(g?_._height-y-b:_._space)(j(t));return h.lines=h.lines.filter(function(t){return""!==t}),h.d=t,h.fS=s,h.width=Math.ceil(i.max(h.lines.map(function(t){return r.textWidth(t,{"font-family":n,"font-size":s})})))+s/4,h.height=Math.ceil(h.lines.length*(o+1)),h.width%2&&h.width++,h}),P=C.slice(),I=C.length-1;if("band"!==this._scale&&H.length){var T=H[0],L=H[H.length-1],M=i.min([this._d3Scale(T.d)-T[d]/2,C[0]-v]);if(M<C[0]){var D=C[0]-M;void 0===this._range||void 0===this._range[0]?(this._size-=D,C[0]+=D):this._range&&(P[0]-=D)}var R=i.max([this._d3Scale(L.d)+L[d]/2,C[I]+v]);if(R>C[I]){var W=R-C[I];void 0===this._range||void 0===this._range[I]?(this._size-=W,C[I]-=W):this._range&&(P[I]+=W)}this._d3Scale.range(C)}var N,U="Line"===this._shape?0:y;this._outerBounds=(N={},N[u]=(i.max(H,function(t){return t[u]})||0)+(H.length?b:0),N[d]=P[I]-P[0],N[c]=P[0],N),this._margin[f]=void 0!==this._gridSize?i.max([this._gridSize,U]):this["_"+u]-this._margin[this._orient]-this._outerBounds[u]-2*b-y,this._margin[this._orient]+=y,this._outerBounds[u]+=this._margin[f]+this._margin[this._orient],this._outerBounds[p]="start"===this._align?this._padding:"end"===this._align?this["_"+u]-this._outerBounds[u]-this._padding:this["_"+u]/2-this._outerBounds[u]/2;var V=o.elem("g#d3plus-Axis-"+this._uuid,{parent:S});this._group=V;var Y=o.elem("g.grid",{parent:V}).selectAll("line").data((0!==this._gridSize?this._grid||O:[]).map(function(t){return{id:t}}),function(t){return t.id});Y.exit().transition(x).attr("opacity",0).call(this._gridPosition.bind(this)).remove(),Y.enter().append("line").attr("opacity",0).attr("clip-path","url(#"+m+")").call(this._gridPosition.bind(this),!0).merge(Y).transition(x).attr("opacity",1).call(this._gridPosition.bind(this));var E=i.max(H,function(t){return t.height})||0,G=g?1.1*this._space:1.1*(this._outerBounds.width-this._margin[this._position.opposite]-y-this._margin[this._orient]+b),J=O.concat(A.filter(function(t,i){return H[i].lines.length&&!O.includes(t)})).map(function(t){var i,e=_._margin[f],n=["top","left"].includes(_._orient)?_._outerBounds[p]+_._outerBounds[u]-e:_._outerBounds[p]+e,s=["top","left"].includes(_._orient)?-y:y,o="Line"===_._shape?s/2:s;return i={id:t,labelBounds:{x:g?-G/2:"left"===_._orient?-G-b+o:o+b,y:g?"bottom"===_._orient?o+b:o-b-E:-E/2,width:G,height:E},size:s,text:!!A.includes(t)&&j(t)},i[c]=_._d3Scale(t)+("band"===_._scale?_._d3Scale.bandwidth()/2:0),i[p]=n,i});"Line"===this._shape&&(J=J.concat(J.map(function(t){var i=Object.assign({},t);return i[p]+=t.size,i}))),(new h[this._shape]).data(J).duration(this._duration).select(o.elem("g.ticks",{parent:V}).node()).config(this._shapeConfig).render();var K=V.selectAll("line.bar").data([null]);return K.enter().append("line").attr("class","bar").attr("opacity",0).call(this._barPosition.bind(this)).merge(K).transition(x).attr("opacity",1).call(this._barPosition.bind(this)),(new r.TextBox).data(this._title?[{text:this._title}]:[]).duration(this._duration).height(this._outerBounds.height).rotate("left"===this._orient?-90:"right"===this._orient?90:0).select(o.elem("g.d3plus-Axis-title",{parent:V}).node()).text(function(t){return t.text}).textAnchor("middle").verticalAlign("bottom"===this._orient?"bottom":"top").width(this._outerBounds[d]).x(g?this._outerBounds.x:"left"===this._orient?this._outerBounds.x+this._margin[this._orient]/2-this._outerBounds[d]/2:this._outerBounds.x+this._outerBounds.width-this._margin[this._orient]/2-this._outerBounds[d]/2).y(g?this._outerBounds.y:this._outerBounds.y-this._margin[this._orient]/2+this._outerBounds[d]/2).config(this._titleConfig).render(),this._lastScale=this._d3Scale,t&&setTimeout(t,this._duration+100),this},_.prototype.scale=function(t){return arguments.length?(this._scale=t,this):this._scale},_.prototype.select=function(t){return arguments.length?(this._select=n.select(t),this):this._select},_.prototype.shape=function(t){return arguments.length?(this._shape=t,this):this._shape},_.prototype.shapeConfig=function(t){return arguments.length?(this._shapeConfig=Object.assign(this._shapeConfig,t),this):this._shapeConfig},_.prototype.ticks=function(t){return arguments.length?(this._ticks=t,this):this._ticks},_.prototype.tickSize=function(t){return arguments.length?(this._tickSize=t,this):this._tickSize},_.prototype.title=function(t){return arguments.length?(this._title=t,this):this._title},_.prototype.titleConfig=function(t){return arguments.length?(this._titleConfig=Object.assign(this._titleConfig,t),this):this._titleConfig},_.prototype.width=function(t){return arguments.length?(this._width=t,this):this._width},_}(o.BaseClass),l=function(t){function i(){t.call(this),this.orient("bottom")}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i}(_),d=function(t){function i(){t.call(this),this.orient("left")}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i}(_),u=function(t){function i(){t.call(this),this.orient("right")}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i}(_),c=function(t){function i(){t.call(this),this.orient("top")}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i}(_);t.Axis=_,t.AxisBottom=l,t.AxisLeft=d,t.AxisRight=u,t.AxisTop=c,t.date=a,Object.defineProperty(t,"__esModule",{value:!0})});