/*
  d3plus-axis v0.3.34
  Beautiful javascript scales and axes.
  Copyright (c) 2017 D3plus - https://d3plus.org
  @license MIT
*/
if(typeof Object.assign!=="function"){Object.defineProperty(Object,"assign",{value:function t(i){"use strict";if(i===null){throw new TypeError("Cannot convert undefined or null to object")}var e=Object(i);for(var n=1;n<arguments.length;n++){var r=arguments[n];if(r!==null){for(var s in r){if(Object.prototype.hasOwnProperty.call(r,s)){e[s]=r[s]}}}}return e},writable:true,configurable:true})}if(!Array.prototype.includes){Object.defineProperty(Array.prototype,"includes",{value:function t(i,e){var n=Object(this);var r=n.length>>>0;if(r===0)return false;var s=e|0;var o=Math.max(s>=0?s:r-Math.abs(s),0);function a(t,i){return t===i||typeof t==="number"&&typeof i==="number"&&isNaN(t)&&isNaN(i)}while(o<r){if(a(n[o],i)){return true}o++}return false}})}(function(t,i){typeof exports==="object"&&typeof module!=="undefined"?i(exports,require("d3-array"),require("d3-scale"),require("d3-selection"),require("d3-transition"),require("d3plus-common"),require("d3plus-shape"),require("d3plus-text")):typeof define==="function"&&define.amd?define("d3plus-axis",["exports","d3-array","d3-scale","d3-selection","d3-transition","d3plus-common","d3plus-shape","d3plus-text"],i):i(t.d3plus={},t.d3Array,t.scales,t.d3Selection,t.d3Transition,t.d3plusCommon,t.shapes,t.d3plusText)})(this,function(t,i,e,n,r,s,o,a){"use strict";var h=function(t){if(t.constructor===Date){return t}else if(t.constructor===Number&&(""+t).length>5&&t%1===0){return new Date(t)}var i=""+t;var e=new RegExp(/^\d{1,2}[./-]\d{1,2}[./-](-*\d{1,4})$/g).exec(i),n=new RegExp(/^[A-z]{1,3} [A-z]{1,3} \d{1,2} (-*\d{1,4}) \d{1,2}:\d{1,2}:\d{1,2} [A-z]{1,3}-*\d{1,4} \([A-z]{1,3}\)/g).exec(i);if(e){var r=e[1];if(r.indexOf("-")===0){i=i.replace(r,r.substr(1))}var s=new Date(i);s.setFullYear(r);return s}else if(n){var o=n[1];if(o.indexOf("-")===0){i=i.replace(o,o.substr(1))}var a=new Date(i);a.setFullYear(o);return a}else if(!i.includes("/")&&!i.includes(" ")&&(!i.includes("-")||!i.indexOf("-"))){var h=new Date(i+"/01/01");h.setFullYear(t);return h}else{return new Date(i)}};var l=function(t){function l(){var i=this;t.call(this);this._align="middle";this._barConfig={stroke:"#000","stroke-width":1};this._domain=[0,10];this._duration=600;this._gridConfig={stroke:"#ccc","stroke-width":1};this._height=400;this.orient("bottom");this._outerBounds={width:0,height:0,x:0,y:0};this._padding=5;this._paddingInner=.1;this._paddingOuter=.1;this._scale="linear";this._shape="Line";this._shapeConfig={fill:"#000",height:function(t){return t.tick?8:0},label:function(t){return t.text},labelBounds:function(t){return t.labelBounds},labelConfig:{fontColor:"#000",fontFamily:(new a.TextBox).fontFamily(),fontResize:false,fontSize:s.constant(10),textAnchor:function(){var t=a.rtl();return i._orient==="left"?t?"start":"end":i._orient==="right"?t?"end":"start":"middle"},verticalAlign:function(){return i._orient==="bottom"?"top":i._orient==="top"?"bottom":"middle"}},labelPadding:0,r:function(t){return t.tick?4:0},stroke:"#000",strokeWidth:1,width:function(t){return t.tick?8:0}};this._tickSize=5;this._titleClass=new a.TextBox;this._titleConfig={fontSize:12,textAnchor:"middle"};this._width=400}if(t)l.__proto__=t;l.prototype=Object.create(t&&t.prototype);l.prototype.constructor=l;l.prototype._barPosition=function t(i){var e=this._position;var n=e.height;var r=e.x;var o=e.y;var a=e.opposite;var h=this._d3Scale.domain(),l=this._margin[a],c=["top","left"].includes(this._orient)?this._outerBounds[o]+this._outerBounds[n]-l:this._outerBounds[o]+l;i.call(s.attrize,this._barConfig).attr(r+"1",this._d3Scale(h[0])-(this._scale==="band"?this._d3Scale.step()-this._d3Scale.bandwidth():0)).attr(r+"2",this._d3Scale(h[h.length-1])+(this._scale==="band"?this._d3Scale.step():0)).attr(o+"1",c).attr(o+"2",c)};l.prototype._gridPosition=function t(i,e){if(e===void 0)e=false;var n=this._position;var r=n.height;var o=n.x;var a=n.y;var h=n.opposite;var l=this._margin[h],c=["top","left"].includes(this._orient)?this._outerBounds[a]+this._outerBounds[r]-l:this._outerBounds[a]+l,d=e?this._lastScale||this._d3Scale:this._d3Scale,_=["top","left"].includes(this._orient)?l:-l,u=this._scale==="band"?this._d3Scale.bandwidth()/2:0,f=function(t){return d(t.id)+u};i.call(s.attrize,this._gridConfig).attr(o+"1",f).attr(o+"2",f).attr(a+"1",c).attr(a+"2",e?c:c+_)};l.prototype.render=function t(l){var c=this;if(this._select===void 0){this.select(n.select("body").append("svg").attr("width",this._width+"px").attr("height",this._height+"px").node())}var d=this._position;var _=d.width;var u=d.height;var f=d.x;var p=d.y;var g=d.horizontal;var v=d.opposite;var m="d3plus-Axis-clip-"+this._uuid,y=["top","left"].includes(this._orient),b=this._padding,S=this._select,x=r.transition().duration(this._duration);var C=this._range?this._range.slice():[undefined,undefined];if(C[0]===void 0){C[0]=b}if(C[1]===void 0){C[1]=this["_"+_]-b}this._size=C[1]-C[0];if(this._scale==="ordinal"&&this._domain.length>C.length){C=i.range(this._domain.length).map(function(t){return c._size*(t/(c._domain.length-1))+C[0]})}var w=this._margin={top:0,right:0,bottom:0,left:0};if(this._title){var z=this._titleConfig;var k=z.fontFamily;var O=z.fontSize;var A=z.lineHeight;var j=a.textWrap().fontFamily(typeof k==="function"?k():k).fontSize(typeof O==="function"?O():O).lineHeight(typeof A==="function"?A():A).width(this._size).height(this["_"+u]-this._tickSize-b);var B=j(this._title).lines.length;w[this._orient]=B*j.lineHeight()+b}this._d3Scale=e["scale"+this._scale.charAt(0).toUpperCase()+this._scale.slice(1)]().domain(this._scale==="time"?this._domain.map(h):this._domain);if(this._d3Scale.rangeRound){this._d3Scale.rangeRound(C)}else{this._d3Scale.range(C)}if(this._d3Scale.round){this._d3Scale.round(true)}if(this._d3Scale.paddingInner){this._d3Scale.paddingInner(this._paddingInner)}if(this._d3Scale.paddingOuter){this._d3Scale.paddingOuter(this._paddingOuter)}var F=e.scaleSqrt().domain([10,400]).range([10,this._gridSize===0?50:75]);var P=this._ticks?this._scale==="time"?this._ticks.map(h):this._ticks:this._d3Scale.ticks?this._d3Scale.ticks(Math.floor(this._size/F(this._size))):this._domain;var R=this._labels?this._scale==="time"?this._labels.map(h):this._labels:this._d3Scale.ticks?this._d3Scale.ticks(Math.floor(this._size/F(this._size))):P;P=P.slice();R=R.slice();var M=this._tickFormat?this._tickFormat:this._d3Scale.tickFormat?this._d3Scale.tickFormat(R.length-1):function(t){return t};if(this._scale==="time"){P=P.map(Number);R=R.map(Number)}else if(this._scale==="ordinal"){R=R.filter(function(t){return P.includes(t)})}P=P.sort(function(t,i){return c._d3Scale(t)-c._d3Scale(i)});R=R.sort(function(t,i){return c._d3Scale(t)-c._d3Scale(i)});var T=this._shape==="Circle"?this._shapeConfig.r:this._shape==="Rect"?this._shapeConfig[_]:this._shapeConfig.strokeWidth;var q=typeof T!=="function"?function(){return T}:T;var H=[];this._availableTicks=P;P.forEach(function(t,i){var e=q({id:t,tick:true},i);if(c._shape==="Circle"){e*=2}var n=c._d3Scale(t);if(!H.length||Math.abs(s.closest(n,H)-n)>e*2){H.push(n)}else{H.push(false)}});P=P.filter(function(t,i){return H[i]!==false});this._visibleTicks=P;var I=this._shape==="Circle"?typeof this._shapeConfig.r==="function"?this._shapeConfig.r({tick:true}):this._shapeConfig.r:this._shape==="Rect"?typeof this._shapeConfig[u]==="function"?this._shapeConfig[u]({tick:true}):this._shapeConfig[u]:this._tickSize,N=q({tick:true});if(typeof I==="function"){I=i.max(P.map(I))}if(this._shape==="Rect"){I/=2}if(typeof N==="function"){N=i.max(P.map(N))}if(this._shape!=="Circle"){N/=2}if(this._scale==="band"){this._space=this._d3Scale.bandwidth()}else if(R.length>1){this._space=0;for(var D=0;D<R.length-1;D++){var E=c._d3Scale(R[D+1])-c._d3Scale(R[D]);if(E>c._space){c._space=E}}}else{this._space=this._size}var W=R.map(function(t,e){var n=c._shapeConfig.labelConfig.fontFamily(t,e),r=c._shapeConfig.labelConfig.fontSize(t,e);var s=a.textWrap().fontFamily(n).fontSize(r).lineHeight(c._shapeConfig.lineHeight?c._shapeConfig.lineHeight(t,e):undefined).width(g?c._space*2:c._width-I-b).height(g?c._height-I-b:c._space*2);var o=s(M(t));o.lines=o.lines.filter(function(t){return t!==""});o.d=t;o.fS=r;o.width=o.lines.length?Math.ceil(i.max(o.lines.map(function(t){return a.textWidth(t,{"font-family":n,"font-size":r})})))+r/4:0;o.height=o.lines.length?Math.ceil(o.lines.length*(s.lineHeight()+1)):0;o.offset=0;if(o.width%2){o.width++}return o});W.forEach(function(t,i){if(i){var e=W[i-1];if(!e.offset&&c._d3Scale(t.d)-t[_]/2<c._d3Scale(e.d)+e[_]/2){t.offset=e[u]+c._padding}}});var L=i.max(W,function(t){return t.offset});if(L){W.forEach(function(t){if(t.offset){t.offset=L;t[u]+=L}})}var Y=C.slice();var U=C.length-1;if(this._scale!=="band"&&W.length){var $=W[0],G=W[W.length-1];var J=i.min([this._d3Scale($.d)-$[_]/2,C[0]-N]);if(J<C[0]){var K=C[0]-J;if(this._range===void 0||this._range[0]===void 0){this._size-=K;C[0]+=K}else if(this._range){Y[0]-=K}}var Q=i.max([this._d3Scale(G.d)+G[_]/2,C[U]+N]);if(Q>C[U]){var V=Q-C[U];if(this._range===void 0||this._range[U]===void 0){this._size-=V;C[U]-=V}else if(this._range){Y[U]+=V}}if(C.length>2){C=i.range(this._domain.length).map(function(t){return c._size*(t/(C.length-1))+C[0]})}C=C.map(Math.round);if(this._d3Scale.rangeRound){this._d3Scale.rangeRound(C)}else{this._d3Scale.range(C)}}if(this._scale==="band"){this._space=this._d3Scale.bandwidth()}else if(R.length>1){this._space=0;for(var X=0;X<R.length-1;X++){var Z=c._d3Scale(R[X+1])-c._d3Scale(R[X]);if(Z>c._space){c._space=Z}}}else{this._space=this._size}var tt=this._shape==="Line"?0:I;var it=this._outerBounds=(et={},et[u]=(i.max(W,function(t){return t[u]})||0)+(W.length?b:0),et[_]=Y[U]-Y[0],et[f]=Y[0],et);var et;w[v]=this._gridSize!==void 0?i.max([this._gridSize,tt]):this["_"+u]-w[this._orient]-it[u]-b*2-I;w[this._orient]+=I;it[u]+=w[v]+w[this._orient];it[p]=this._align==="start"?this._padding:this._align==="end"?this["_"+u]-it[u]-this._padding:this["_"+u]/2-it[u]/2;var nt=s.elem("g#d3plus-Axis-"+this._uuid,{parent:S});this._group=nt;var rt=s.elem("g.grid",{parent:nt}).selectAll("line").data((this._gridSize!==0?this._grid||P:[]).map(function(t){return{id:t}}),function(t){return t.id});rt.exit().transition(x).attr("opacity",0).call(this._gridPosition.bind(this)).remove();rt.enter().append("line").attr("opacity",0).attr("clip-path","url(#"+m+")").call(this._gridPosition.bind(this),true).merge(rt).transition(x).attr("opacity",1).call(this._gridPosition.bind(this));var st=i.max(W,function(t){return t.height})||0,ot=g?this._space:it.width-w[this._position.opposite]-I-w[this._orient]+b;var at=R.filter(function(t,i){return W[i].lines.length&&!P.includes(t)});var ht=P.concat(at).map(function(t,i,e){var n=W.filter(function(i){return i.d===t});var r=n.length?n[0].offset:0;var s=false;if(i){var o=W.filter(function(t){return t.d===e[i-1]});if(o.length&&o[0].offset===r){s=true}}if(i<e.length-1){var a=W.filter(function(t){return t.d===e[i+1]});if(a.length&&a[0].offset===r){s=true}}var h=w[v],l=y?it[p]+it[u]-h:it[p]+h,d=(I+r)*(y?-1:1);var _=s?ot:ot*1.9;return m={id:t,labelBounds:{x:g?-_/2:c._orient==="left"?-_-b+d:d+b,y:g?c._orient==="bottom"?d+b:d-b-st:-st/2,width:_,height:st},size:P.includes(t)?d:0,text:R.includes(t)?M(t):false,tick:P.includes(t)},m[f]=c._d3Scale(t)+(c._scale==="band"?c._d3Scale.bandwidth()/2:0),m[p]=l,m;var m});if(this._shape==="Line"){ht=ht.concat(ht.map(function(t){var i=Object.assign({},t);i[p]+=t.size;return i}))}(new o[this._shape]).data(ht).duration(this._duration).labelConfig({ellipsis:function(t){return t&&t.length?t+"...":""}}).select(s.elem("g.ticks",{parent:nt}).node()).config(this._shapeConfig).render();var lt=nt.selectAll("line.bar").data([null]);lt.enter().append("line").attr("class","bar").attr("opacity",0).call(this._barPosition.bind(this)).merge(lt).transition(x).attr("opacity",1).call(this._barPosition.bind(this));this._titleClass.data(this._title?[{text:this._title}]:[]).duration(this._duration).height(w[this._orient]).rotate(this._orient==="left"?-90:this._orient==="right"?90:0).select(s.elem("g.d3plus-Axis-title",{parent:nt}).node()).text(function(t){return t.text}).verticalAlign("middle").width(it[_]).x(g?it.x:this._orient==="left"?it.x+w[this._orient]/2-it[_]/2:it.x+it.width-w[this._orient]/2-it[_]/2).y(g?this._orient==="bottom"?it.y+it.height-w.bottom+b:it.y:it.y-w[this._orient]/2+it[_]/2).config(this._titleConfig).render();this._lastScale=this._d3Scale;if(l){setTimeout(l,this._duration+100)}return this};l.prototype.align=function t(i){return arguments.length?(this._align=i,this):this._align};l.prototype.barConfig=function t(i){return arguments.length?(this._barConfig=Object.assign(this._barConfig,i),this):this._barConfig};l.prototype.domain=function t(i){return arguments.length?(this._domain=i,this):this._domain};l.prototype.duration=function t(i){return arguments.length?(this._duration=i,this):this._duration};l.prototype.grid=function t(i){return arguments.length?(this._grid=i,this):this._grid};l.prototype.gridConfig=function t(i){return arguments.length?(this._gridConfig=Object.assign(this._gridConfig,i),this):this._gridConfig};l.prototype.gridSize=function t(i){return arguments.length?(this._gridSize=i,this):this._gridSize};l.prototype.height=function t(i){return arguments.length?(this._height=i,this):this._height};l.prototype.labels=function t(i){return arguments.length?(this._labels=i,this):this._labels};l.prototype.orient=function t(i){if(arguments.length){var e=["top","bottom"].includes(i),n={top:"bottom",right:"left",bottom:"top",left:"right"};this._position={horizontal:e,width:e?"width":"height",height:e?"height":"width",x:e?"x":"y",y:e?"y":"x",opposite:n[i]};return this._orient=i,this}return this._orient};l.prototype.outerBounds=function t(){return this._outerBounds};l.prototype.padding=function t(i){return arguments.length?(this._padding=i,this):this._padding};l.prototype.paddingInner=function t(i){return arguments.length?(this._paddingInner=i,this):this._paddingInner};l.prototype.paddingOuter=function t(i){return arguments.length?(this._paddingOuter=i,this):this._paddingOuter};l.prototype.range=function t(i){return arguments.length?(this._range=i,this):this._range};l.prototype.scale=function t(i){return arguments.length?(this._scale=i,this):this._scale};l.prototype.select=function t(i){return arguments.length?(this._select=n.select(i),this):this._select};l.prototype.shape=function t(i){return arguments.length?(this._shape=i,this):this._shape};l.prototype.shapeConfig=function t(i){return arguments.length?(this._shapeConfig=s.assign(this._shapeConfig,i),this):this._shapeConfig};l.prototype.tickFormat=function t(i){return arguments.length?(this._tickFormat=i,this):this._tickFormat};l.prototype.ticks=function t(i){return arguments.length?(this._ticks=i,this):this._ticks};l.prototype.tickSize=function t(i){return arguments.length?(this._tickSize=i,this):this._tickSize};l.prototype.title=function t(i){return arguments.length?(this._title=i,this):this._title};l.prototype.titleConfig=function t(i){return arguments.length?(this._titleConfig=Object.assign(this._titleConfig,i),this):this._titleConfig};l.prototype.width=function t(i){return arguments.length?(this._width=i,this):this._width};return l}(s.BaseClass);var c=function(t){function i(){t.call(this);this.orient("bottom")}if(t)i.__proto__=t;i.prototype=Object.create(t&&t.prototype);i.prototype.constructor=i;return i}(l);var d=function(t){function i(){t.call(this);this.orient("left")}if(t)i.__proto__=t;i.prototype=Object.create(t&&t.prototype);i.prototype.constructor=i;return i}(l);var _=function(t){function i(){t.call(this);this.orient("right")}if(t)i.__proto__=t;i.prototype=Object.create(t&&t.prototype);i.prototype.constructor=i;return i}(l);var u=function(t){function i(){t.call(this);this.orient("top")}if(t)i.__proto__=t;i.prototype=Object.create(t&&t.prototype);i.prototype.constructor=i;return i}(l);t.Axis=l;t.AxisBottom=c;t.AxisLeft=d;t.AxisRight=_;t.AxisTop=u;t.date=h;Object.defineProperty(t,"__esModule",{value:true})});