/*
  d3plus-axis v0.3.0
  Beautiful javascript scales and axes.
  Copyright (c) 2016 D3plus - https://d3plus.org
  @license MIT
*/
!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports,require("d3-array"),require("d3-scale"),require("d3-selection"),require("d3-transition"),require("d3plus-common"),require("d3plus-shape"),require("d3plus-text")):"function"==typeof define&&define.amd?define("d3plus-axis",["exports","d3-array","d3-scale","d3-selection","d3-transition","d3plus-common","d3plus-shape","d3plus-text"],i):i(t.d3plus=t.d3plus||{},t.d3Array,t.scales,t.d3Selection,t.d3Transition,t.d3plusCommon,t.shapes,t.d3plusText)}(this,function(t,i,e,n,s,o,h,r){"use strict";var a=function(t){function a(){var i=this;t.call(this),this._align="middle",this._barConfig={stroke:"#000","stroke-width":1},this._domain=[0,10],this._duration=600,this._gridConfig={stroke:"#ccc","stroke-width":1},this._height=400,this.orient("bottom"),this._outerBounds={width:0,height:0,x:0,y:0},this._padding=5,this._paddingInner=.1,this._paddingOuter=.1,this._scale="linear",this._shape="Line",this._shapeConfig={fill:"#000",fontColor:"#000",fontFamily:(new r.TextBox).fontFamily(),fontResize:!1,fontSize:o.constant(10),height:8,label:function(t){return t.text},labelBounds:function(t){return t.labelBounds},labelPadding:0,r:4,stroke:"#000",strokeWidth:1,textAnchor:function(){return"left"===i._orient?"end":"right"===i._orient?"start":"middle"},verticalAlign:function(){return"bottom"===i._orient?"top":"top"===i._orient?"bottom":"middle"},width:8},this._tickSize=5,this._titleConfig={fontFamily:"Verdana",fontSize:12,lineHeight:13,textAnchor:"middle"},this._width=400}return t&&(a.__proto__=t),a.prototype=Object.create(t&&t.prototype),a.prototype.constructor=a,a.prototype._barPosition=function(t){var i=this._position,e=i.height,n=i.x,s=i.y,h=i.opposite,r=this._d3Scale.domain(),a=this._margin[h],_=["top","left"].includes(this._orient)?this._outerBounds[s]+this._outerBounds[e]-a:this._outerBounds[s]+a;t.call(o.attrize,this._barConfig).attr(n+"1",this._d3Scale(r[0])-("band"===this._scale?this._d3Scale.step()-this._d3Scale.bandwidth():0)).attr(n+"2",this._d3Scale(r[r.length-1])+("band"===this._scale?this._d3Scale.step():0)).attr(s+"1",_).attr(s+"2",_)},a.prototype._gridPosition=function(t,i){void 0===i&&(i=!1);var e=this._position,n=e.height,s=e.x,h=e.y,r=e.opposite,a=this._margin[r],_=["top","left"].includes(this._orient)?this._outerBounds[h]+this._outerBounds[n]-a:this._outerBounds[h]+a,l=i?this._lastScale||this._d3Scale:this._d3Scale,d=["top","left"].includes(this._orient)?a:-a,c="band"===this._scale?this._d3Scale.bandwidth()/2:0,u=function(t){return l(t.id)+c};t.call(o.attrize,this._gridConfig).attr(s+"1",u).attr(s+"2",u).attr(h+"1",_).attr(h+"2",i?_:_+d)},a.prototype._parseDate=function(t){return t.constructor===Date?t:t.constructor===Number&&(""+t).length>4&&t%1===0?new Date(t):(t=""+t,4===t.length&&""+parseInt(t,10)===t&&(t+="/01/01"),new Date(t))},a.prototype.align=function(t){return arguments.length?(this._align=t,this):this._align},a.prototype.barConfig=function(t){return arguments.length?(this._barConfig=Object.assign(this._barConfig,t),this):this._barConfig},a.prototype.domain=function(t){return arguments.length?(this._domain=t,this):this._domain},a.prototype.duration=function(t){return arguments.length?(this._duration=t,this):this._duration},a.prototype.grid=function(t){return arguments.length?(this._grid=t,this):this._grid},a.prototype.gridConfig=function(t){return arguments.length?(this._gridConfig=Object.assign(this._gridConfig,t),this):this._gridConfig},a.prototype.gridSize=function(t){return arguments.length?(this._gridSize=t,this):this._gridSize},a.prototype.height=function(t){return arguments.length?(this._height=t,this):this._height},a.prototype.labels=function(t){return arguments.length?(this._labels=t,this):this._labels},a.prototype.orient=function(t){if(arguments.length){var i=["top","bottom"].includes(t),e={top:"bottom",right:"left",bottom:"top",left:"right"};return this._position={horizontal:i,width:i?"width":"height",height:i?"height":"width",x:i?"x":"y",y:i?"y":"x",opposite:e[t]},this._orient=t,this}return this._orient},a.prototype.outerBounds=function(){return this._outerBounds},a.prototype.padding=function(t){return arguments.length?(this._padding=t,this):this._padding},a.prototype.paddingInner=function(t){return arguments.length?(this._paddingInner=t,this):this._paddingInner},a.prototype.paddingOuter=function(t){return arguments.length?(this._paddingOuter=t,this):this._paddingOuter},a.prototype.range=function(t){return arguments.length?(this._range=t,this):this._range},a.prototype.render=function(t){var a=this;void 0===this._select&&this.select(n.select("body").append("svg").attr("width",this._width+"px").attr("height",this._height+"px").node()),void 0===this._lineHeight&&(this._lineHeight=function(t,i){return 1.1*a._shapeConfig.fontSize(t,i)});var _=this._position,l=_.width,d=_.height,c=_.x,u=_.y,p=_.horizontal,g=_.opposite,f="d3plus-Axis-clip-"+this._uuid,m="Circle"===this._shape?this._shapeConfig.r:"Rect"===this._shape?this._shapeConfig[d]/2:this._tickSize,y=this._padding,b=this._select,S=s.transition().duration(this._duration),x="Circle"===this._shape?this._shapeConfig.r:"Rect"===this._shape?this._shapeConfig[l]/2:this._tickSize,C=this._range?this._range.slice():[void 0,void 0];if(void 0===C[0]&&(C[0]=y),void 0===C[1]&&(C[1]=this["_"+l]-y),this._size=C[1]-C[0],"ordinal"===this._scale&&this._domain.length>C.length&&(C=i.range(this._domain.length).map(function(t){return a._size*(t/(a._domain.length-1))+C[0]})),this._margin={top:0,right:0,bottom:0,left:0},this._title){var v=this._titleConfig.lineHeight?this._titleConfig.lineHeight:1.1*this._titleConfig.fontSize,z=r.textWrap().fontFamily(this._titleConfig.fontFamily).fontSize(this._titleConfig.fontSize).lineHeight(v).width(this._size).height(this["_"+d]-this._tickSize-y)(this._title);this._margin[this._orient]=z.lines.length*v+y}this._d3Scale=e["scale"+this._scale.charAt(0).toUpperCase()+this._scale.slice(1)]().domain("time"===this._scale?this._domain.map(this._parseDate):this._domain).range(C),this._d3Scale.round&&this._d3Scale.round(!0),this._d3Scale.paddingInner&&this._d3Scale.paddingInner(this._paddingInner),this._d3Scale.paddingOuter&&this._d3Scale.paddingOuter(this._paddingOuter);var B=e.scaleSqrt().domain([10,400]).range([10,0===this._gridSize?32.5:75]),w=e.scaleSqrt().domain([10,400]).range([10,75]),k=this._ticks?"time"===this._scale?this._ticks.map(this._parseDate):this._ticks:this._d3Scale.ticks?this._d3Scale.ticks(Math.floor(this._size/B(this._size))):this._domain,O=this._ticks&&!this._labels?k:this._labels?"time"===this._scale?this._labels.map(this._parseDate):this._labels:this._d3Scale.ticks?this._d3Scale.ticks(Math.floor(this._size/w(this._size))):this._domain,A=this._d3Scale.tickFormat?this._d3Scale.tickFormat(O.length-1):function(t){return t};if("time"===this._scale&&(k=k.map(Number),O=O.map(Number)),this._visibleTicks=k,"band"===this._scale)this._space=this._d3Scale.bandwidth();else if(O.length>1){this._space=0;for(var j=0;j<O.length-1;j++){var q=a._d3Scale(O[j+1])-a._d3Scale(O[j]);q>a._space&&(a._space=q)}}else this._space=this._size;var F=O.map(function(t,e){var n=a._shapeConfig.fontFamily(t,e),s=a._shapeConfig.fontSize(t,e),o=a._shapeConfig.lineHeight?a._shapeConfig.lineHeight(t,e):1.1*s,h=r.textWrap().fontFamily(n).fontSize(s).lineHeight(o).width(p?a._space:a._width-m-y).height(p?a._height-m-y:a._space)(A(t));return h.lines=h.lines.filter(function(t){return""!==t}),h.d=t,h.fS=s,h.width=Math.ceil(i.max(h.lines.map(function(t){return r.textWidth(t,{"font-family":n,"font-size":s})})))+s/4,h.height=Math.ceil(h.lines.length*(o+1)),h.width%2&&h.width++,h}),H=C.slice(),P=C.length-1;if("band"!==this._scale&&F.length){var I=F[0],D=F[F.length-1],T=i.min([this._d3Scale(I.d)-I[l]/2,C[0]-x]);if(T<C[0]){var L=C[0]-T;void 0===this._range||void 0===this._range[0]?(this._size-=L,C[0]+=L):this._range&&(H[0]-=L)}var M=i.max([this._d3Scale(D.d)+D[l]/2,C[P]+x]);if(M>C[P]){var R=M-C[P];void 0===this._range||void 0===this._range[P]?(this._size-=R,C[P]-=R):this._range&&(H[P]+=R)}this._d3Scale.range(C)}var W,N="Line"===this._shape?0:m;this._outerBounds=(W={},W[d]=(i.max(F,function(t){return t[d]})||0)+(F.length?y:0),W[l]=H[P]-H[0],W[c]=H[0],W),this._margin[g]=void 0!==this._gridSize?i.max([this._gridSize,N]):this["_"+d]-this._margin[this._orient]-this._outerBounds[d]-2*y-m,this._margin[this._orient]+=m,this._outerBounds[d]+=this._margin[g]+this._margin[this._orient],this._outerBounds[u]="start"===this._align?this._padding:"end"===this._align?this["_"+d]-this._outerBounds[d]-this._padding:this["_"+d]/2-this._outerBounds[d]/2;var U=o.elem("g#d3plus-Axis-"+this._uuid,{parent:b});this._group=U;var V=o.elem("g.grid",{parent:U}).selectAll("line").data((0!==this._gridSize?this._grid||k:[]).map(function(t){return{id:t}}),function(t){return t.id});V.exit().transition(S).attr("opacity",0).call(this._gridPosition.bind(this)).remove(),V.enter().append("line").attr("opacity",0).attr("clip-path","url(#"+f+")").call(this._gridPosition.bind(this),!0).merge(V).transition(S).attr("opacity",1).call(this._gridPosition.bind(this));var E=i.max(F,function(t){return t.height})||0,G=p?1.1*this._space:1.1*(this._outerBounds.width-this._margin[this._position.opposite]-m-this._margin[this._orient]+y),J=k.concat(O.filter(function(t,i){return F[i].lines.length&&!k.includes(t)})).map(function(t){var i,e=a._margin[g],n=["top","left"].includes(a._orient)?a._outerBounds[u]+a._outerBounds[d]-e:a._outerBounds[u]+e,s=["top","left"].includes(a._orient)?-m:m,o="Line"===a._shape?s/2:s;return i={id:t,labelBounds:{x:p?-G/2:"left"===a._orient?-G-y+o:o+y,y:p?"bottom"===a._orient?o+y:o-y-E:-E/2,width:G,height:E},size:s,text:!!O.includes(t)&&A(t)},i[c]=a._d3Scale(t)+("band"===a._scale?a._d3Scale.bandwidth()/2:0),i[u]=n,i});"Line"===this._shape&&(J=J.concat(J.map(function(t){var i=Object.assign({},t);return i[u]+=t.size,i}))),(new h[this._shape]).data(J).duration(this._duration).select(o.elem("g.ticks",{parent:U}).node()).config(this._shapeConfig).render();var K=U.selectAll("line.bar").data([null]);return K.enter().append("line").attr("class","bar").attr("opacity",0).call(this._barPosition.bind(this)).merge(K).transition(S).attr("opacity",1).call(this._barPosition.bind(this)),(new r.TextBox).data(this._title?[{text:this._title}]:[]).duration(this._duration).height(this._outerBounds.height).rotate("left"===this._orient?-90:"right"===this._orient?90:0).select(o.elem("g.d3plus-Axis-title",{parent:U}).node()).text(function(t){return t.text}).textAnchor("middle").verticalAlign("bottom"===this._orient?"bottom":"top").width(this._outerBounds[l]).x(p?this._outerBounds.x:"left"===this._orient?this._outerBounds.x+this._margin[this._orient]/2-this._outerBounds[l]/2:this._outerBounds.x+this._outerBounds.width-this._margin[this._orient]/2-this._outerBounds[l]/2).y(p?this._outerBounds.y:this._outerBounds.y-this._margin[this._orient]/2+this._outerBounds[l]/2).config(this._titleConfig).render(),this._lastScale=this._d3Scale,t&&setTimeout(t,this._duration+100),this},a.prototype.scale=function(t){return arguments.length?(this._scale=t,this):this._scale},a.prototype.select=function(t){return arguments.length?(this._select=n.select(t),this):this._select},a.prototype.shape=function(t){return arguments.length?(this._shape=t,this):this._shape},a.prototype.shapeConfig=function(t){return arguments.length?(this._shapeConfig=Object.assign(this._shapeConfig,t),this):this._shapeConfig},a.prototype.ticks=function(t){return arguments.length?(this._ticks=t,this):this._ticks},a.prototype.tickSize=function(t){return arguments.length?(this._tickSize=t,this):this._tickSize},a.prototype.title=function(t){return arguments.length?(this._title=t,this):this._title},a.prototype.titleConfig=function(t){return arguments.length?(this._titleConfig=Object.assign(this._titleConfig,t),this):this._titleConfig},a.prototype.width=function(t){return arguments.length?(this._width=t,this):this._width},a}(o.BaseClass),_=function(t){function i(){t.call(this),this.orient("bottom")}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i}(a),l=function(t){function i(){t.call(this),this.orient("left")}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i}(a),d=function(t){function i(){t.call(this),this.orient("right")}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i}(a),c=function(t){function i(){t.call(this),this.orient("top")}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i}(a);t.Axis=a,t.AxisBottom=_,t.AxisLeft=l,t.AxisRight=d,t.AxisTop=c,Object.defineProperty(t,"__esModule",{value:!0})});