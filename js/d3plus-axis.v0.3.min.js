/*
  d3plus-axis v0.3.24
  Beautiful javascript scales and axes.
  Copyright (c) 2017 D3plus - https://d3plus.org
  @license MIT
*/
(function(t,i){typeof exports==="object"&&typeof module!=="undefined"?i(exports,require("d3-array"),require("d3-scale"),require("d3-selection"),require("d3-transition"),require("d3plus-common"),require("d3plus-shape"),require("d3plus-text")):typeof define==="function"&&define.amd?define("d3plus-axis",["exports","d3-array","d3-scale","d3-selection","d3-transition","d3plus-common","d3plus-shape","d3plus-text"],i):i(t.d3plus=t.d3plus||{},t.d3Array,t.scales,t.d3Selection,t.d3Transition,t.d3plusCommon,t.shapes,t.d3plusText)})(this,function(t,i,e,n,s,r,o,h){"use strict";var a=function(t){if(t.constructor===Date){return t}else if(t.constructor===Number&&(""+t).length>5&&t%1===0){return new Date(t)}var i=""+t;var e=new RegExp(/^\d{1,2}[.\/-]\d{1,2}[.\/-](-*\d{1,4})$/g).exec(i),n=new RegExp(/^[A-z]{1,3} [A-z]{1,3} \d{1,2} (-*\d{1,4}) \d{1,2}:\d{1,2}:\d{1,2} [A-z]{1,3}-*\d{1,4} \([A-z]{1,3}\)/g).exec(i);if(e){var s=e[1];if(s.indexOf("-")===0){i=i.replace(s,s.substr(1))}var r=new Date(i);r.setFullYear(s);return r}else if(n){var o=n[1];if(o.indexOf("-")===0){i=i.replace(o,o.substr(1))}var h=new Date(i);h.setFullYear(o);return h}else if(!i.includes("/")&&!i.includes(" ")&&(!i.includes("-")||!i.indexOf("-"))){var a=new Date(i+"/01/01");a.setFullYear(t);return a}else{return new Date(i)}};var _=function(t){function _(){var i=this;t.call(this);this._align="middle";this._barConfig={stroke:"#000","stroke-width":1};this._domain=[0,10];this._duration=600;this._gridConfig={stroke:"#ccc","stroke-width":1};this._height=400;this.orient("bottom");this._outerBounds={width:0,height:0,x:0,y:0};this._padding=5;this._paddingInner=.1;this._paddingOuter=.1;this._scale="linear";this._shape="Line";this._shapeConfig={fill:"#000",fontColor:"#000",fontFamily:(new h.TextBox).fontFamily(),fontResize:false,fontSize:r.constant(10),height:function(t){return t.tick?8:0},label:function(t){return t.text},labelBounds:function(t){return t.labelBounds},labelPadding:0,r:function(t){return t.tick?4:0},stroke:"#000",strokeWidth:1,textAnchor:function(){return i._orient==="left"?"end":i._orient==="right"?"start":"middle"},verticalAlign:function(){return i._orient==="bottom"?"top":i._orient==="top"?"bottom":"middle"},width:function(t){return t.tick?8:0}};this._tickSize=5;this._titleConfig={fontFamily:"Verdana",fontSize:12,lineHeight:13,textAnchor:"middle"};this._width=400}if(t)_.__proto__=t;_.prototype=Object.create(t&&t.prototype);_.prototype.constructor=_;_.prototype._barPosition=function t(i){var e=this._position;var n=e.height;var s=e.x;var o=e.y;var h=e.opposite;var a=this._d3Scale.domain(),_=this._margin[h],l=["top","left"].includes(this._orient)?this._outerBounds[o]+this._outerBounds[n]-_:this._outerBounds[o]+_;i.call(r.attrize,this._barConfig).attr(s+"1",this._d3Scale(a[0])-(this._scale==="band"?this._d3Scale.step()-this._d3Scale.bandwidth():0)).attr(s+"2",this._d3Scale(a[a.length-1])+(this._scale==="band"?this._d3Scale.step():0)).attr(o+"1",l).attr(o+"2",l)};_.prototype._gridPosition=function t(i,e){if(e===void 0)e=false;var n=this._position;var s=n.height;var o=n.x;var h=n.y;var a=n.opposite;var _=this._margin[a],l=["top","left"].includes(this._orient)?this._outerBounds[h]+this._outerBounds[s]-_:this._outerBounds[h]+_,d=e?this._lastScale||this._d3Scale:this._d3Scale,u=["top","left"].includes(this._orient)?_:-_,c=this._scale==="band"?this._d3Scale.bandwidth()/2:0,p=function(t){return d(t.id)+c};i.call(r.attrize,this._gridConfig).attr(o+"1",p).attr(o+"2",p).attr(h+"1",l).attr(h+"2",e?l:l+u)};_.prototype.align=function t(i){return arguments.length?(this._align=i,this):this._align};_.prototype.barConfig=function t(i){return arguments.length?(this._barConfig=Object.assign(this._barConfig,i),this):this._barConfig};_.prototype.domain=function t(i){return arguments.length?(this._domain=i,this):this._domain};_.prototype.duration=function t(i){return arguments.length?(this._duration=i,this):this._duration};_.prototype.grid=function t(i){return arguments.length?(this._grid=i,this):this._grid};_.prototype.gridConfig=function t(i){return arguments.length?(this._gridConfig=Object.assign(this._gridConfig,i),this):this._gridConfig};_.prototype.gridSize=function t(i){return arguments.length?(this._gridSize=i,this):this._gridSize};_.prototype.height=function t(i){return arguments.length?(this._height=i,this):this._height};_.prototype.labels=function t(i){return arguments.length?(this._labels=i,this):this._labels};_.prototype.orient=function t(i){if(arguments.length){var e=["top","bottom"].includes(i),n={top:"bottom",right:"left",bottom:"top",left:"right"};this._position={horizontal:e,width:e?"width":"height",height:e?"height":"width",x:e?"x":"y",y:e?"y":"x",opposite:n[i]};return this._orient=i,this}return this._orient};_.prototype.outerBounds=function t(){return this._outerBounds};_.prototype.padding=function t(i){return arguments.length?(this._padding=i,this):this._padding};_.prototype.paddingInner=function t(i){return arguments.length?(this._paddingInner=i,this):this._paddingInner};_.prototype.paddingOuter=function t(i){return arguments.length?(this._paddingOuter=i,this):this._paddingOuter};_.prototype.range=function t(i){return arguments.length?(this._range=i,this):this._range};_.prototype.render=function t(_){var l=this;if(this._select===void 0){this.select(n.select("body").append("svg").attr("width",this._width+"px").attr("height",this._height+"px").node())}if(this._lineHeight===void 0){this._lineHeight=function(t,i){return l._shapeConfig.fontSize(t,i)*1.1}}var d=this._position;var u=d.width;var c=d.height;var p=d.x;var f=d.y;var g=d.horizontal;var m=d.opposite;var v="d3plus-Axis-clip-"+this._uuid,y=this._padding,b=this._select,S=s.transition().duration(this._duration);var x=this._range?this._range.slice():[undefined,undefined];if(x[0]===void 0){x[0]=y}if(x[1]===void 0){x[1]=this["_"+u]-y}this._size=x[1]-x[0];if(this._scale==="ordinal"&&this._domain.length>x.length){x=i.range(this._domain.length).map(function(t){return l._size*(t/(l._domain.length-1))+x[0]})}this._margin={top:0,right:0,bottom:0,left:0};if(this._title){var C=this._titleConfig.lineHeight?this._titleConfig.lineHeight:this._titleConfig.fontSize*1.1,z=h.textWrap().fontFamily(this._titleConfig.fontFamily).fontSize(this._titleConfig.fontSize).lineHeight(C).width(this._size).height(this["_"+c]-this._tickSize-y)(this._title);this._margin[this._orient]=z.lines.length*C+y}this._d3Scale=e["scale"+this._scale.charAt(0).toUpperCase()+this._scale.slice(1)]().domain(this._scale==="time"?this._domain.map(a):this._domain);if(this._d3Scale.rangeRound){this._d3Scale.rangeRound(x)}else{this._d3Scale.range(x)}if(this._d3Scale.round){this._d3Scale.round(true)}if(this._d3Scale.paddingInner){this._d3Scale.paddingInner(this._paddingInner)}if(this._d3Scale.paddingOuter){this._d3Scale.paddingOuter(this._paddingOuter)}var k=e.scaleSqrt().domain([10,400]).range([10,this._gridSize===0?50:75]);var w=this._ticks?this._scale==="time"?this._ticks.map(a):this._ticks:this._d3Scale.ticks?this._d3Scale.ticks(Math.floor(this._size/k(this._size))):this._domain;var B=this._labels?this._scale==="time"?this._labels.map(a):this._labels:this._d3Scale.ticks?this._d3Scale.ticks(Math.floor(this._size/k(this._size))):w;var A=this._tickFormat?this._tickFormat:this._d3Scale.tickFormat?this._d3Scale.tickFormat(B.length-1):function(t){return t};if(this._scale==="time"){w=w.map(Number);B=B.map(Number)}var O=this._shape==="Circle"?this._shapeConfig.r:this._shape==="Rect"?this._shapeConfig[u]:this._shapeConfig.strokeWidth;var F=typeof O!=="function"?function(){return O}:O;var j=[];this._availableTicks=w;w.forEach(function(t,i){var e=F({id:t,tick:true},i);if(l._shape==="Circle"){e*=2}var n=l._d3Scale(t);if(!j.length||Math.abs(r.closest(n,j)-n)>e*2){j.push(n)}else{j.push(false)}});w=w.filter(function(t,i){return j[i]!==false});this._visibleTicks=w;var R=this._shape==="Circle"?typeof this._shapeConfig.r==="function"?this._shapeConfig.r({tick:true}):this._shapeConfig.r:this._shape==="Rect"?typeof this._shapeConfig[c]==="function"?this._shapeConfig[c]({tick:true}):this._shapeConfig[c]:this._tickSize,H=F({tick:true});if(typeof R==="function"){R=i.max(w.map(R))}if(this._shape==="Rect"){R/=2}if(typeof H==="function"){H=i.max(w.map(H))}if(this._shape!=="Circle"){H/=2}if(this._scale==="band"){this._space=this._d3Scale.bandwidth()}else if(B.length>1){this._space=0;for(var P=0;P<B.length-1;P++){var q=l._d3Scale(B[P+1])-l._d3Scale(B[P]);if(q>l._space){l._space=q}}}else{this._space=this._size}var T=B.map(function(t,e){var n=l._shapeConfig.fontFamily(t,e),s=l._shapeConfig.fontSize(t,e);var r=l._shapeConfig.lineHeight?l._shapeConfig.lineHeight(t,e):s*1.1;var o=h.textWrap().fontFamily(n).fontSize(s).lineHeight(r).width(g?l._space:l._width-R-y).height(g?l._height-R-y:l._space)(A(t));o.lines=o.lines.filter(function(t){return t!==""});o.d=t;o.fS=s;o.width=Math.ceil(i.max(o.lines.map(function(t){return h.textWidth(t,{"font-family":n,"font-size":s})})))+s/4;o.height=Math.ceil(o.lines.length*(r+1));if(o.width%2){o.width++}return o});var I=x.slice();var D=x.length-1;if(this._scale!=="band"&&T.length){var M=T[0],L=T[T.length-1];var W=i.min([this._d3Scale(M.d)-M[u]/2,x[0]-H]);if(W<x[0]){var E=x[0]-W;if(this._range===void 0||this._range[0]===void 0){this._size-=E;x[0]+=E}else if(this._range){I[0]-=E}}var N=i.max([this._d3Scale(L.d)+L[u]/2,x[D]+H]);if(N>x[D]){var Y=N-x[D];if(this._range===void 0||this._range[D]===void 0){this._size-=Y;x[D]-=Y}else if(this._range){I[D]+=Y}}if(this._d3Scale.rangeRound){this._d3Scale.rangeRound(x)}else{this._d3Scale.range(x)}}var U=this._shape==="Line"?0:R;this._outerBounds=(V={},V[c]=(i.max(T,function(t){return t[c]})||0)+(T.length?y:0),V[u]=I[D]-I[0],V[p]=I[0],V);var V;this._margin[m]=this._gridSize!==void 0?i.max([this._gridSize,U]):this["_"+c]-this._margin[this._orient]-this._outerBounds[c]-y*2-R;this._margin[this._orient]+=R;this._outerBounds[c]+=this._margin[m]+this._margin[this._orient];this._outerBounds[f]=this._align==="start"?this._padding:this._align==="end"?this["_"+c]-this._outerBounds[c]-this._padding:this["_"+c]/2-this._outerBounds[c]/2;var $=r.elem("g#d3plus-Axis-"+this._uuid,{parent:b});this._group=$;var G=r.elem("g.grid",{parent:$}).selectAll("line").data((this._gridSize!==0?this._grid||w:[]).map(function(t){return{id:t}}),function(t){return t.id});G.exit().transition(S).attr("opacity",0).call(this._gridPosition.bind(this)).remove();G.enter().append("line").attr("opacity",0).attr("clip-path","url(#"+v+")").call(this._gridPosition.bind(this),true).merge(G).transition(S).attr("opacity",1).call(this._gridPosition.bind(this));var J=i.max(T,function(t){return t.height})||0,K=g?this._space*1.1:(this._outerBounds.width-this._margin[this._position.opposite]-R-this._margin[this._orient]+y)*1.1;var Q=w.concat(B.filter(function(t,i){return T[i].lines.length&&!w.includes(t)})).map(function(t){var i=l._margin[m],e=["top","left"].includes(l._orient)?l._outerBounds[f]+l._outerBounds[c]-i:l._outerBounds[f]+i,n=["top","left"].includes(l._orient)?-R:R,s=l._shape==="Line"?n/2:n;return r={id:t,labelBounds:{x:g?-K/2:l._orient==="left"?-K-y+s:s+y,y:g?l._orient==="bottom"?s+y:s-y-J:-J/2,width:K,height:J},size:w.includes(t)?n:0,text:B.includes(t)?A(t):false,tick:w.includes(t)},r[p]=l._d3Scale(t)+(l._scale==="band"?l._d3Scale.bandwidth()/2:0),r[f]=e,r;var r});if(this._shape==="Line"){Q=Q.concat(Q.map(function(t){var i=Object.assign({},t);i[f]+=t.size;return i}))}(new o[this._shape]).data(Q).duration(this._duration).select(r.elem("g.ticks",{parent:$}).node()).config(this._shapeConfig).render();var X=$.selectAll("line.bar").data([null]);X.enter().append("line").attr("class","bar").attr("opacity",0).call(this._barPosition.bind(this)).merge(X).transition(S).attr("opacity",1).call(this._barPosition.bind(this));(new h.TextBox).data(this._title?[{text:this._title}]:[]).duration(this._duration).height(this._outerBounds.height).rotate(this._orient==="left"?-90:this._orient==="right"?90:0).select(r.elem("g.d3plus-Axis-title",{parent:$}).node()).text(function(t){return t.text}).textAnchor("middle").verticalAlign(this._orient==="bottom"?"bottom":"top").width(this._outerBounds[u]).x(g?this._outerBounds.x:this._orient==="left"?this._outerBounds.x+this._margin[this._orient]/2-this._outerBounds[u]/2:this._outerBounds.x+this._outerBounds.width-this._margin[this._orient]/2-this._outerBounds[u]/2).y(g?this._outerBounds.y:this._outerBounds.y-this._margin[this._orient]/2+this._outerBounds[u]/2).config(this._titleConfig).render();this._lastScale=this._d3Scale;if(_){setTimeout(_,this._duration+100)}return this};_.prototype.scale=function t(i){return arguments.length?(this._scale=i,this):this._scale};_.prototype.select=function t(i){return arguments.length?(this._select=n.select(i),this):this._select};_.prototype.shape=function t(i){return arguments.length?(this._shape=i,this):this._shape};_.prototype.shapeConfig=function t(i){return arguments.length?(this._shapeConfig=Object.assign(this._shapeConfig,i),this):this._shapeConfig};_.prototype.tickFormat=function t(i){return arguments.length?(this._tickFormat=i,this):this._tickFormat};_.prototype.ticks=function t(i){return arguments.length?(this._ticks=i,this):this._ticks};_.prototype.tickSize=function t(i){return arguments.length?(this._tickSize=i,this):this._tickSize};_.prototype.title=function t(i){return arguments.length?(this._title=i,this):this._title};_.prototype.titleConfig=function t(i){return arguments.length?(this._titleConfig=Object.assign(this._titleConfig,i),this):this._titleConfig};_.prototype.width=function t(i){return arguments.length?(this._width=i,this):this._width};return _}(r.BaseClass);var l=function(t){function i(){t.call(this);this.orient("bottom")}if(t)i.__proto__=t;i.prototype=Object.create(t&&t.prototype);i.prototype.constructor=i;return i}(_);var d=function(t){function i(){t.call(this);this.orient("left")}if(t)i.__proto__=t;i.prototype=Object.create(t&&t.prototype);i.prototype.constructor=i;return i}(_);var u=function(t){function i(){t.call(this);this.orient("right")}if(t)i.__proto__=t;i.prototype=Object.create(t&&t.prototype);i.prototype.constructor=i;return i}(_);var c=function(t){function i(){t.call(this);this.orient("top")}if(t)i.__proto__=t;i.prototype=Object.create(t&&t.prototype);i.prototype.constructor=i;return i}(_);t.Axis=_;t.AxisBottom=l;t.AxisLeft=d;t.AxisRight=u;t.AxisTop=c;t.date=a;Object.defineProperty(t,"__esModule",{value:true})});