/*
  d3plus-axis v0.3.41
  Beautiful javascript scales and axes.
  Copyright (c) 2017 D3plus - https://d3plus.org
  @license MIT
*/
if(typeof Object.assign!=="function"){Object.defineProperty(Object,"assign",{value:function t(i){"use strict";if(i===null){throw new TypeError("Cannot convert undefined or null to object")}var e=Object(i);for(var n=1;n<arguments.length;n++){var s=arguments[n];if(s!==null){for(var r in s){if(Object.prototype.hasOwnProperty.call(s,r)){e[r]=s[r]}}}}return e},writable:true,configurable:true})}if(!Array.prototype.includes){Object.defineProperty(Array.prototype,"includes",{value:function t(i,e){var n=Object(this);var s=n.length>>>0;if(s===0)return false;var r=e|0;var a=Math.max(r>=0?r:s-Math.abs(r),0);function o(t,i){return t===i||typeof t==="number"&&typeof i==="number"&&isNaN(t)&&isNaN(i)}while(a<s){if(o(n[a],i)){return true}a++}return false}})}(function(t,i){typeof exports==="object"&&typeof module!=="undefined"?i(exports,require("d3-array"),require("d3-scale"),require("d3-selection"),require("d3-transition"),require("d3plus-common"),require("d3plus-shape"),require("d3plus-text")):typeof define==="function"&&define.amd?define("d3plus-axis",["exports","d3-array","d3-scale","d3-selection","d3-transition","d3plus-common","d3plus-shape","d3plus-text"],i):i(t.d3plus={},t.d3Array,t.scales,t.d3Selection,t.d3Transition,t.d3plusCommon,t.shapes,t.d3plusText)})(this,function(t,i,e,n,s,r,a,o){"use strict";function h(t){if(t.constructor===Date){return t}else if(t.constructor===Number&&(""+t).length>5&&t%1===0){return new Date(t)}var i=""+t;var e=new RegExp(/^\d{1,2}[./-]\d{1,2}[./-](-*\d{1,4})$/g).exec(i),n=new RegExp(/^[A-z]{1,3} [A-z]{1,3} \d{1,2} (-*\d{1,4}) \d{1,2}:\d{1,2}:\d{1,2} [A-z]{1,3}-*\d{1,4} \([A-z]{1,3}\)/g).exec(i);if(e){var s=e[1];if(s.indexOf("-")===0){i=i.replace(s,s.substr(1))}var r=new Date(i);r.setFullYear(s);return r}else if(n){var a=n[1];if(a.indexOf("-")===0){i=i.replace(a,a.substr(1))}var o=new Date(i);o.setFullYear(a);return o}else if(!i.includes("/")&&!i.includes(" ")&&(!i.includes("-")||!i.indexOf("-"))){var h=new Date(i+"/01/01");h.setFullYear(t);return h}else{return new Date(i)}}var l=function(t){function l(){var i=this;t.call(this);this._align="middle";this._barConfig={stroke:"#000","stroke-width":1};this._domain=[0,10];this._duration=600;this._gridConfig={stroke:"#ccc","stroke-width":1};this._height=400;this.orient("bottom");this._outerBounds={width:0,height:0,x:0,y:0};this._padding=5;this._paddingInner=.1;this._paddingOuter=.1;this._scale="linear";this._shape="Line";this._shapeConfig={fill:"#000",height:function(t){return t.tick?8:0},label:function(t){return t.text},labelBounds:function(t){return t.labelBounds},labelConfig:{fontColor:"#000",fontFamily:(new o.TextBox).fontFamily(),fontResize:false,fontSize:r.constant(10),textAnchor:function(){var t=o.rtl();return i._orient==="left"?t?"start":"end":i._orient==="right"?t?"end":"start":"middle"},verticalAlign:function(){return i._orient==="bottom"?"top":i._orient==="top"?"bottom":"middle"}},labelPadding:0,r:function(t){return t.tick?4:0},stroke:"#000",strokeWidth:1,width:function(t){return t.tick?8:0}};this._tickSize=5;this._titleClass=new o.TextBox;this._titleConfig={fontSize:12,textAnchor:"middle"};this._width=400}if(t)l.__proto__=t;l.prototype=Object.create(t&&t.prototype);l.prototype.constructor=l;l.prototype._barPosition=function t(i){var e=this._position;var n=e.height;var s=e.x;var a=e.y;var o=e.opposite;var h=this._getDomain(),l=this._margin[o],c=["top","left"].includes(this._orient)?this._outerBounds[a]+this._outerBounds[n]-l:this._outerBounds[a]+l;i.call(r.attrize,this._barConfig).attr(s+"1",this._getPosition(h[0])-(this._scale==="band"?this._d3Scale.step()-this._d3Scale.bandwidth():0)).attr(s+"2",this._getPosition(h[h.length-1])+(this._scale==="band"?this._d3Scale.step():0)).attr(a+"1",c).attr(a+"2",c)};l.prototype._getDomain=function t(){var e=[];if(this._d3ScaleNegative){e=this._d3ScaleNegative.domain()}if(this._d3Scale){e=e.concat(this._d3Scale.domain())}var n=this._scale==="ordinal"?e:i.extent(e);return e[0]>e[1]?n.reverse():n};l.prototype._getPosition=function t(i){return i<0&&this._d3ScaleNegative?this._d3ScaleNegative(i):this._d3Scale(i)};l.prototype._getRange=function t(){var e=[];if(this._d3ScaleNegative){e=this._d3ScaleNegative.range()}if(this._d3Scale){e=e.concat(this._d3Scale.range())}return e[0]>e[1]?i.extent(e).reverse():i.extent(e)};l.prototype._getTicks=function t(){var i=e.scaleSqrt().domain([10,400]).range([10,50]);var n=[];if(this._d3ScaleNegative){var s=this._d3ScaleNegative.range();var r=s[1]-s[0];n=this._d3ScaleNegative.ticks(Math.floor(r/i(r)))}if(this._d3Scale){var a=this._d3Scale.range();var o=a[1]-a[0];n=n.concat(this._d3Scale.ticks(Math.floor(o/i(o))))}return n};l.prototype._gridPosition=function t(i,e){if(e===void 0)e=false;var n=this._position;var s=n.height;var a=n.x;var o=n.y;var h=n.opposite;var l=this._margin[h],c=["top","left"].includes(this._orient)?this._outerBounds[o]+this._outerBounds[s]-l:this._outerBounds[o]+l,d=e?this._lastScale||this._getPosition.bind(this):this._getPosition.bind(this),_=["top","left"].includes(this._orient)?l:-l,f=this._scale==="band"?this._d3Scale.bandwidth()/2:0,u=function(t){return d(t.id)+f};i.call(r.attrize,this._gridConfig).attr(a+"1",u).attr(a+"2",u).attr(o+"1",c).attr(o+"2",e?c:c+_)};l.prototype.render=function t(l){var c=this;var d,_;if(this._select===void 0){this.select(n.select("body").append("svg").attr("width",this._width+"px").attr("height",this._height+"px").node())}var f=this._position;var u=f.width;var g=f.height;var p=f.x;var v=f.y;var m=f.horizontal;var y=f.opposite;var b="d3plus-Axis-clip-"+this._uuid,S=["top","left"].includes(this._orient),x=this._padding,C=this._select,k=s.transition().duration(this._duration);var w=this._range?this._range.slice():[undefined,undefined];if(w[0]===void 0){w[0]=x}if(w[1]===void 0){w[1]=this["_"+u]-x}this._size=w[1]-w[0];if(this._scale==="ordinal"&&this._domain.length>w.length){w=i.range(this._domain.length).map(function(t){return c._size*(t/(c._domain.length-1))+w[0]})}var z=this._margin={top:0,right:0,bottom:0,left:0};if(this._title){var P=this._titleConfig;var O=P.fontFamily;var N=P.fontSize;var A=P.lineHeight;var j=o.textWrap().fontFamily(typeof O==="function"?O():O).fontSize(typeof N==="function"?N():N).lineHeight(typeof A==="function"?A():A).width(this._size).height(this["_"+g]-this._tickSize-x);var M=j(this._title).lines.length;z[this._orient]=M*j.lineHeight()+x}this._d3Scale=e["scale"+this._scale.charAt(0).toUpperCase()+this._scale.slice(1)]().domain(this._scale==="time"?this._domain.map(h):this._domain);if(this._d3Scale.rangeRound){this._d3Scale.rangeRound(w)}else{this._d3Scale.range(w)}if(this._d3Scale.round){this._d3Scale.round(true)}if(this._d3Scale.paddingInner){this._d3Scale.paddingInner(this._paddingInner)}if(this._d3Scale.paddingOuter){this._d3Scale.paddingOuter(this._paddingOuter)}this._d3ScaleNegative=null;if(this._scale==="log"){var B=this._d3Scale.domain();if(B[0]===0){B[0]=1}if(B[B.length-1]===0){B[B.length-1]=-1}var F=this._d3Scale.range();if(B[0]<0&&B[B.length-1]<0){this._d3ScaleNegative=this._d3Scale.copy().domain(B).range(F);this._d3Scale=null}else if(B[0]>0&&B[B.length-1]>0){this._d3Scale.domain(B).range(F)}else{var R=e.scaleLog().domain([1,B[B[1]>0?1:0]]).range([0,1]);var T=R(Math.abs(B[B[1]<0?1:0]));var q=T/(T+1)*(F[1]-F[0]);if(B[0]>0){q=F[1]-F[0]-q}this._d3ScaleNegative=this._d3Scale.copy();(B[0]<0?this._d3Scale:this._d3ScaleNegative).domain([Math.sign(B[1]),B[1]]).range([F[0]+q,F[1]]);(B[0]<0?this._d3ScaleNegative:this._d3Scale).domain([B[0],Math.sign(B[0])]).range([F[0],F[0]+q])}}var D=this._ticks?this._scale==="time"?this._ticks.map(h):this._ticks:(this._d3Scale?this._d3Scale.ticks:this._d3ScaleNegative.ticks)?this._getTicks():this._domain;var H=this._labels?this._scale==="time"?this._labels.map(h):this._labels:(this._d3Scale?this._d3Scale.ticks:this._d3ScaleNegative.ticks)?this._getTicks():D;D=D.slice();H=H.slice();if(this._scale==="log"){H=H.filter(function(t){return Math.abs(t).toString().charAt(0)==="1"&&(c._d3Scale?t!==-1:t!==1)})}var I="⁰¹²³⁴⁵⁶⁷⁸⁹";var E=this._tickFormat?this._tickFormat:function(t){if(c._scale==="log"){var i=Math.round(Math.log(Math.abs(t))/Math.LN10);var e=Math.abs(t).toString().charAt(0);var n="10 "+(""+i).split("").map(function(t){return I[t]}).join("");if(e!=="1"){n=e+" x "+n}return t<0?"-"+n:n}return c._d3Scale.tickFormat?c._d3Scale.tickFormat(H.length-1)(t):t};if(this._scale==="time"){D=D.map(Number);H=H.map(Number)}else if(this._scale==="ordinal"){H=H.filter(function(t){return D.includes(t)})}D=D.sort(function(t,i){return c._getPosition(t)-c._getPosition(i)});H=H.sort(function(t,i){return c._getPosition(t)-c._getPosition(i)});var L=this._shape==="Circle"?this._shapeConfig.r:this._shape==="Rect"?this._shapeConfig[u]:this._shapeConfig.strokeWidth;var W=typeof L!=="function"?function(){return L}:L;var Y=[];this._availableTicks=D;D.forEach(function(t,i){var e=W({id:t,tick:true},i);if(c._shape==="Circle"){e*=2}var n=c._getPosition(t);if(!Y.length||Math.abs(r.closest(n,Y)-n)>e*2){Y.push(n)}else{Y.push(false)}});D=D.filter(function(t,i){return Y[i]!==false});this._visibleTicks=D;var U=this._shape==="Circle"?typeof this._shapeConfig.r==="function"?this._shapeConfig.r({tick:true}):this._shapeConfig.r:this._shape==="Rect"?typeof this._shapeConfig[g]==="function"?this._shapeConfig[g]({tick:true}):this._shapeConfig[g]:this._tickSize,$=W({tick:true});if(typeof U==="function"){U=i.max(D.map(U))}if(this._shape==="Rect"){U/=2}if(typeof $==="function"){$=i.max(D.map($))}if(this._shape!=="Circle"){$/=2}if(this._scale==="band"){this._space=this._d3Scale.bandwidth()}else if(H.length>1){this._space=0;for(var G=0;G<H.length-1;G++){var J=c._getPosition(H[G+1])-c._getPosition(H[G]);if(J>c._space){c._space=J}}}else{this._space=this._size}var K=H.map(function(t,e){var n=c._shapeConfig.labelConfig.fontFamily(t,e),s=c._shapeConfig.labelConfig.fontSize(t,e);var r=o.textWrap().fontFamily(n).fontSize(s).lineHeight(c._shapeConfig.lineHeight?c._shapeConfig.lineHeight(t,e):undefined).width(m?c._space*2:c._width-U-x).height(m?c._height-U-x:c._space*2);var a=r(E(t));a.lines=a.lines.filter(function(t){return t!==""});a.d=t;a.fS=s;a.width=a.lines.length?Math.ceil(i.max(a.lines.map(function(t){return o.textWidth(t,{"font-family":n,"font-size":s})})))+s/4:0;a.height=a.lines.length?Math.ceil(a.lines.length*(r.lineHeight()+1)):0;a.offset=0;a.hidden=false;if(a.width%2){a.width++}return a});K.forEach(function(t,i){if(i){var e=K[i-1];if(!e.offset&&c._getPosition(t.d)-t[u]/2<c._getPosition(e.d)+e[u]/2){t.offset=e[g]+c._padding}}});var Q=i.max(K,function(t){return t.offset});if(Q){K.forEach(function(t){if(t.offset){t.offset=Q;t[g]+=Q}})}var V=w.slice();var X=w.length-1;if(this._scale!=="band"&&K.length){var Z=K[0],tt=K[K.length-1];var it=i.min([this._getPosition(Z.d)-Z[u]/2,w[0]-$]);if(it<w[0]){var et=w[0]-it;if(this._range===void 0||this._range[0]===void 0){this._size-=et;w[0]+=et}else if(this._range){V[0]-=et}}var nt=i.max([this._getPosition(tt.d)+tt[u]/2,w[X]+$]);if(nt>w[X]){var st=nt-w[X];if(this._range===void 0||this._range[X]===void 0){this._size-=st;w[X]-=st}else if(this._range){V[X]+=st}}if(w.length>2){w=i.range(this._domain.length).map(function(t){return c._size*(t/(w.length-1))+w[0]})}w=w.map(Math.round);if(this._d3ScaleNegative){var rt=this._d3ScaleNegative.range();this._d3ScaleNegative[this._d3ScaleNegative.rangeRound?"rangeRound":"range"](this._d3Scale&&this._d3Scale.range()[0]<rt[0]?[rt[0],w[1]]:[w[0],this._d3Scale?rt[1]:w[1]]);if(this._d3Scale){var at=this._d3Scale.range();this._d3Scale[this._d3Scale.rangeRound?"rangeRound":"range"](w[0]<rt[0]?[w[0],at[1]]:[at[0],w[1]])}}else{this._d3Scale[this._d3Scale.rangeRound?"rangeRound":"range"](w)}}if(this._scale==="band"){this._space=this._d3Scale.bandwidth()}else if(H.length>1){this._space=0;for(var ot=0;ot<H.length-1;ot++){var ht=c._getPosition(H[ot+1])-c._getPosition(H[ot]);if(ht>c._space){c._space=ht}}}else{this._space=this._size}var lt=this._shape==="Line"?0:U;var ct=this._outerBounds=(d={},d[g]=(i.max(K,function(t){return Math.ceil(t[g])})||0)+(K.length?x:0),d[u]=V[X]-V[0],d[p]=V[0],d);z[this._orient]+=U;z[y]=this._gridSize!==void 0?i.max([this._gridSize,lt]):this["_"+g]-z[this._orient]-ct[g]-x;ct[g]+=z[y]+z[this._orient];ct[v]=this._align==="start"?this._padding:this._align==="end"?this["_"+g]-ct[g]-this._padding:this["_"+g]/2-ct[g]/2;var dt=r.elem("g#d3plus-Axis-"+this._uuid,{parent:C});this._group=dt;var _t=r.elem("g.grid",{parent:dt}).selectAll("line").data((this._gridSize!==0?this._grid||D:[]).map(function(t){return{id:t}}),function(t){return t.id});_t.exit().transition(k).attr("opacity",0).call(this._gridPosition.bind(this)).remove();_t.enter().append("line").attr("opacity",0).attr("clip-path","url(#"+b+")").call(this._gridPosition.bind(this),true).merge(_t).transition(k).attr("opacity",1).call(this._gridPosition.bind(this));var ft=i.max(K,function(t){return t.height})||0;var ut=H.filter(function(t,i){return K[i].lines.length&&!D.includes(t)});var gt=D.concat(ut).map(function(t){var i=K.filter(function(i){return i.d===t});var e=i.length?K.indexOf(i[0]):undefined;var n=c._getPosition(t);var s=i.length?i[0].offset:0;var r=m?c._space:ct.width-z[c._position.opposite]-U-z[c._orient]+x;var a=i.length&&e>0?K.filter(function(t,i){return!t.hidden&&t.offset>=s&&i<e}):false;a=a.length?a[a.length-1]:false;var o=i.length&&e<K.length-1?K.filter(function(t,i){return!t.hidden&&t.offset>=s&&i>e}):false;o=o.length?o[0]:false;var h=Math.min(a?n-c._getPosition(a.d):r,o?c._getPosition(o.d)-n:r);if(i.length&&i[0].width>h){i[0].hidden=true;i[0].offset=s=0}var l=z[y],d=(U+s)*(S?-1:1),f=S?ct[v]+ct[g]-l:ct[v]+l;return _={id:t,labelBounds:{x:m?-h/2:c._orient==="left"?-r-x+d:d+x,y:m?c._orient==="bottom"?d+x:d-x-ft:-h/2,width:m?h:r,height:m?ft:h},size:D.includes(t)?d:0,text:H.includes(t)?E(t):false,tick:D.includes(t)},_[p]=n+(c._scale==="band"?c._d3Scale.bandwidth()/2:0),_[v]=f,_});if(this._shape==="Line"){gt=gt.concat(gt.map(function(t){var i=Object.assign({},t);i[v]+=t.size;return i}))}(new a[this._shape]).data(gt).duration(this._duration).labelConfig({ellipsis:function(t){return t&&t.length?t+"...":""}}).select(r.elem("g.ticks",{parent:dt}).node()).config(this._shapeConfig).render();var pt=dt.selectAll("line.bar").data([null]);pt.enter().append("line").attr("class","bar").attr("opacity",0).call(this._barPosition.bind(this)).merge(pt).transition(k).attr("opacity",1).call(this._barPosition.bind(this));this._titleClass.data(this._title?[{text:this._title}]:[]).duration(this._duration).height(z[this._orient]).rotate(this._orient==="left"?-90:this._orient==="right"?90:0).select(r.elem("g.d3plus-Axis-title",{parent:dt}).node()).text(function(t){return t.text}).verticalAlign("middle").width(ct[u]).x(m?ct.x:this._orient==="left"?ct.x+z[this._orient]/2-ct[u]/2:ct.x+ct.width-z[this._orient]/2-ct[u]/2).y(m?this._orient==="bottom"?ct.y+ct.height-z.bottom+x:ct.y:ct.y-z[this._orient]/2+ct[u]/2).config(this._titleConfig).render();this._lastScale=this._getPosition.bind(this);if(l){setTimeout(l,this._duration+100)}return this};l.prototype.align=function t(i){return arguments.length?(this._align=i,this):this._align};l.prototype.barConfig=function t(i){return arguments.length?(this._barConfig=Object.assign(this._barConfig,i),this):this._barConfig};l.prototype.domain=function t(i){return arguments.length?(this._domain=i,this):this._domain};l.prototype.duration=function t(i){return arguments.length?(this._duration=i,this):this._duration};l.prototype.grid=function t(i){return arguments.length?(this._grid=i,this):this._grid};l.prototype.gridConfig=function t(i){return arguments.length?(this._gridConfig=Object.assign(this._gridConfig,i),this):this._gridConfig};l.prototype.gridSize=function t(i){return arguments.length?(this._gridSize=i,this):this._gridSize};l.prototype.height=function t(i){return arguments.length?(this._height=i,this):this._height};l.prototype.labels=function t(i){return arguments.length?(this._labels=i,this):this._labels};l.prototype.orient=function t(i){if(arguments.length){var e=["top","bottom"].includes(i),n={top:"bottom",right:"left",bottom:"top",left:"right"};this._position={horizontal:e,width:e?"width":"height",height:e?"height":"width",x:e?"x":"y",y:e?"y":"x",opposite:n[i]};return this._orient=i,this}return this._orient};l.prototype.outerBounds=function t(){return this._outerBounds};l.prototype.padding=function t(i){return arguments.length?(this._padding=i,this):this._padding};l.prototype.paddingInner=function t(i){return arguments.length?(this._paddingInner=i,this):this._paddingInner};l.prototype.paddingOuter=function t(i){return arguments.length?(this._paddingOuter=i,this):this._paddingOuter};l.prototype.range=function t(i){return arguments.length?(this._range=i,this):this._range};l.prototype.scale=function t(i){return arguments.length?(this._scale=i,this):this._scale};l.prototype.select=function t(i){return arguments.length?(this._select=n.select(i),this):this._select};l.prototype.shape=function t(i){return arguments.length?(this._shape=i,this):this._shape};l.prototype.shapeConfig=function t(i){return arguments.length?(this._shapeConfig=r.assign(this._shapeConfig,i),this):this._shapeConfig};l.prototype.tickFormat=function t(i){return arguments.length?(this._tickFormat=i,this):this._tickFormat};l.prototype.ticks=function t(i){return arguments.length?(this._ticks=i,this):this._ticks};l.prototype.tickSize=function t(i){return arguments.length?(this._tickSize=i,this):this._tickSize};l.prototype.title=function t(i){return arguments.length?(this._title=i,this):this._title};l.prototype.titleConfig=function t(i){return arguments.length?(this._titleConfig=Object.assign(this._titleConfig,i),this):this._titleConfig};l.prototype.width=function t(i){return arguments.length?(this._width=i,this):this._width};return l}(r.BaseClass);var c=function(t){function i(){t.call(this);this.orient("bottom")}if(t)i.__proto__=t;i.prototype=Object.create(t&&t.prototype);i.prototype.constructor=i;return i}(l);var d=function(t){function i(){t.call(this);this.orient("left")}if(t)i.__proto__=t;i.prototype=Object.create(t&&t.prototype);i.prototype.constructor=i;return i}(l);var _=function(t){function i(){t.call(this);this.orient("right")}if(t)i.__proto__=t;i.prototype=Object.create(t&&t.prototype);i.prototype.constructor=i;return i}(l);var f=function(t){function i(){t.call(this);this.orient("top")}if(t)i.__proto__=t;i.prototype=Object.create(t&&t.prototype);i.prototype.constructor=i;return i}(l);t.Axis=l;t.AxisBottom=c;t.AxisLeft=d;t.AxisRight=_;t.AxisTop=f;t.date=h;Object.defineProperty(t,"__esModule",{value:true})});