!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("d3plus-common"),require("d3-array"),require("d3-selection"),require("d3plus-shape"),require("d3plus-text")):"function"==typeof define&&define.amd?define("d3plus-legend",["exports","d3plus-common","d3-array","d3-selection","d3plus-shape","d3plus-text"],n):n(t.d3plus_legend=t.d3plus_legend||{},t.d3plus_common,t.d3_array,t.d3_selection,t.d3plus_shape,t.d3plus_text)}(this,function(t,n,e,i,r,o){"use strict";function u(t){function u(t,n){var e=F[n];return{width:e.width,height:e.height,x:t.width/2+S,y:1-e.height/2}}function h(n,i){return"vertical"===H?s.x+B(n,i)/2:s.x+e.sum(t.slice(0,i).map(function(t,n){return B(t,n)}))+e.sum(F.slice(0,i).map(function(t){return t.width-b(n,i)}))+B(n,i)/2+3*S*i}function a(n,i){if("horizontal"===H)return s.y+e.max(F.map(function(t){return t.height}).concat(t.map(function(t,n){return B(t,n)})))/2;var r=B(n,i),o=F[i].height>r?F[i].height/2:r/2,u=e.sum(F.slice(0,i),function(t,n){return e.max([t.height,B(t.data,n)])});return s.y+u+o+S*i}function l(n){void 0===f&&l.select(i.select("body").append("svg").attr("width",window.innerWidth+"px").attr("height",window.innerHeight+"px").node()),void 0===c&&(c=function(t,n){return 1.1*b(t,n)}),r.rect().data([{id:"legend-background"}]).duration(m).fill(p).height(z).select(f.node()).width(M).x(M/2).y(z/2)(),F=t.map(function(n,i){var r=v(n,i),u=c(n,i),h=b(n,i),a="horizontal"===H?z-(t.length+1)*S:z,l="vertical"===H?M-3*S-B(n,i):M,f=o.wrap().fontFamily(r).fontSize(h).lineHeight(u).width(l).height(a)(_(n,i));return f.width=Math.ceil(e.max(f.lines.map(function(t){return o.width(t,{"font-family":r,"font-size":h})})))+h,f.height=Math.ceil(f.lines.length*(u+1)),f.og={height:f.height,width:f.width},f.data=n,f.f=r,f.s=h,f.lh=u,f});var u,h,a=!0;if("horizontal"===H&&(u=M-e.sum(t.map(function(t,n){return B(t,n)+3*S}))-2*S,h=e.sum(F.map(function(t,n){return t.width-b(t,n)})),h>u)){var R=F.filter(function(t){return t.words.length>1}).sort(function(t,n){return n.sentence.length-t.sentence.length});if(R.length&&z>2*R[0].height)for(var O=2;5>=O;){var P=R.filter(function(t){return t.words.length>=O});if(!P.length)break;for(var T=function(t){var n=R[t],i=n.og.height*O,r=n.og.width*(1.5*(1/O)),a=o.wrap().fontFamily(n.f).fontSize(n.s).lineHeight(n.lh).width(r).height(i)(n.sentence);return!a.truncated&&(h-=n.width,n.width=Math.ceil(e.max(a.lines.map(function(t){return o.width(t,{"font-family":n.f,"font-size":n.s})})))+n.s,n.height=a.lines.length*(n.lh+1),h+=n.width,u>=h)?"break":void 0},W=0;W<R.length;W++){var D=T(W);if("break"===D)break}if(u>=h)break;O++}else a=!1}if(h>u&&(a=!1),!a){h=0;for(var E=0;E<F.length;E++)F[E].width=0,F[E].height=0}var G=e.max(F,function(t,n){return e.max([t.height,B(t.data,n)])}),J=h+e.sum(t,function(t,n){return B(t,n)})+S*(t.length*(a?3:1)-2);s.width=J,s.height=G;var K=S,L=S;"center"===g?K=(M-2*S-J)/2:"right"===g&&(K=M-2*S-J),"middle"===C?L=(z-2*S-G)/2:"bottom"===C&&(L=z-2*S-G),s.x=K,s.y=L;var N=f.selectAll("g.d3plus-legend-shape-group").data([0]);N=N.enter().append("g").attr("class","d3plus-legend-shape-group").merge(N);for(var Q=r.rect().backgroundImage(A).data(t).duration(m).fill(w).fontColor(y).fontFamily(v).fontResize(x).fontSize(b).height(B).id(k).innerBounds(q).label(a?_:!1).labelPadding(0).lineHeight(c).select(N.node()).verticalAlign("top").width(B).x(j).y(I),U=Object.keys(d),V=0;V<U.length;V++)Q.on(U[V],d[U[V]]);return Q(),n&&setTimeout(n,m+100),l}void 0===t&&(t=[]);var c,f,d={},s={width:0,height:0,x:0,y:0},g="center",p="transparent",m=600,w=n.accessor("color"),y=n.constant("#444"),v=n.constant("sans-serif"),x=n.constant(!1),b=n.constant(10),z=100,k=n.accessor("id"),_=n.accessor("id"),q=u,F=[],H="horizontal",S=5,A=n.constant(!1),B=n.constant(10),C="middle",M=400,j=h,I=a;return l.align=function(t){return arguments.length?(g=t,l):g},l.backgroundColor=function(t){return arguments.length?(p=t,l):p},l.data=function(n){return arguments.length?(t=n,l):t},l.duration=function(t){return arguments.length?(m=t,l):m},l.fill=function(t){return arguments.length?(w=t,l):w},l.fontColor=function(t){return arguments.length?(y="function"==typeof t?t:n.constant(t),l):y},l.fontFamily=function(t){return arguments.length?(v="function"==typeof t?t:n.constant(t),l):v},l.fontResize=function(t){return arguments.length?(x="function"==typeof t?t:n.constant(t),l):x},l.fontSize=function(t){return arguments.length?(b="function"==typeof t?t:n.constant(t),l):b},l.height=function(t){return arguments.length?(z=t,l):z},l.id=function(t){return arguments.length?(k=t,l):k},l.label=function(t){return arguments.length?(_="function"==typeof t?t:n.constant(t),l):_},l.labelBounds=function(t){return arguments.length?(q=t,l):q},l.on=function(t,n){return 2===arguments.length?(d[t]=n,l):arguments.length?d[t]:d},l.orient=function(t){return arguments.length?(H=t,l):H},l.outerBounds=function(){return s},l.padding=function(t){return arguments.length?(S=t,l):S},l.select=function(t){return arguments.length?(f=i.select(t),l):f},l.shapeImage=function(t){return arguments.length?(A="function"==typeof t?t:n.constant(t),l):A},l.size=function(t){return arguments.length?(B="function"==typeof t?t:n.constant(t),l):B},l.verticalAlign=function(t){return arguments.length?(C=t,l):C},l.width=function(t){return arguments.length?(M=t,l):M},l.x=function(t){return arguments.length?(j="function"==typeof t?t:n.constant(t),l):j},l.y=function(t){return arguments.length?(I="function"==typeof t?t:n.constant(t),l):I},t.length?l():l}var h="0.1.3";t.version=h,t.shape=u});