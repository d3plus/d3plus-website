/*
  d3plus-timeline v0.3.8
  An easy-to-use javascript timeline.
  Copyright (c) 2017 D3plus - https://d3plus.org
  @license MIT
*/
if(typeof Object.assign!=="function"){Object.defineProperty(Object,"assign",{value:function t(e){"use strict";if(e===null){throw new TypeError("Cannot convert undefined or null to object")}var i=Object(e);for(var s=1;s<arguments.length;s++){var n=arguments[s];if(n!==null){for(var r in n){if(Object.prototype.hasOwnProperty.call(n,r)){i[r]=n[r]}}}}return i},writable:true,configurable:true})}if(!Array.prototype.includes){Object.defineProperty(Array.prototype,"includes",{value:function t(e,i){var s=Object(this);var n=s.length>>>0;if(n===0)return false;var r=i|0;var h=Math.max(r>=0?r:n-Math.abs(r),0);function o(t,e){return t===e||typeof t==="number"&&typeof e==="number"&&isNaN(t)&&isNaN(e)}while(h<n){if(o(s[h],e)){return true}h++}return false}})}(function(t,e){typeof exports==="object"&&typeof module!=="undefined"?e(exports,require("d3-brush"),require("d3-selection"),require("d3plus-axis"),require("d3plus-common")):typeof define==="function"&&define.amd?define("d3plus-timeline",["exports","d3-brush","d3-selection","d3plus-axis","d3plus-common"],e):e(t.d3plus={},t.d3Brush,t.d3Selection,t.d3plusAxis,t.d3plusCommon)})(this,function(t,e,i,s,n){"use strict";var r=function(t){function r(){var e=this;t.call(this);this._brushing=true;this._brushFilter=function(){return!i.event.button&&i.event.detail<2};this._domain=[2001,2010];this._gridSize=0;this._handleConfig={fill:"#444"};this._handleSize=6;this._height=100;this._on={};this.orient("bottom");this._scale="time";this._selectionConfig={fill:"#777","stroke-width":0};this._shape="Rect";this._shapeConfig=Object.assign({},this._shapeConfig,{height:function(t){return t.tick?10:0},width:function(t){return t.tick?e._domain.map(function(t){return s.date(t).getTime()}).includes(t.id)?2:1:0}});this._snapping=true}if(t)r.__proto__=t;r.prototype=Object.create(t&&t.prototype);r.prototype.constructor=r;r.prototype._brushBrush=function t(){if(i.event.sourceEvent&&i.event.sourceEvent.offsetX&&i.event.selection!==null&&(!this._brushing||this._snapping)){var e=(this._brushing?i.event.selection:[i.event.selection[0],i.event.selection[0]]).map(this._d3Scale.invert).map(Number);var r=this._availableTicks.map(Number);e[0]=s.date(n.closest(e[0],r));e[1]=s.date(n.closest(e[1],r));var h=+e[0]===+e[1];this._selection=h?e[0]:e;var o=e.map(this._d3Scale);if(h){o[0]-=.1;o[1]+=.1}this._brushGroup.call(this._brush.move,o)}this._brushStyle();if(this._on.brush){this._on.brush(this._selection)}};r.prototype._brushEnd=function t(){if(!i.event.sourceEvent){return}var e=(i.event.selection&&this._brushing?i.event.selection:[i.event.sourceEvent.offsetX,i.event.sourceEvent.offsetX]).map(this._d3Scale.invert).map(Number);var r=this._availableTicks.map(Number);e[0]=s.date(n.closest(e[0],r));e[1]=s.date(n.closest(e[1],r));var h=+e[0]===+e[1];if(this._brushing||!this._snapping){var o=e.map(this._d3Scale);if(h){o[0]-=.1;o[1]+=.1}this._brushGroup.transition(this._transition).call(this._brush.move,o)}this._brushStyle();this._selection=h?e[0]:e;if(this._on.end){this._on.end(this._selection)}};r.prototype._brushStart=function t(){if(i.event.sourceEvent!==null&&(!this._brushing||this._snapping)){var e=(i.event.selection&&this._brushing?i.event.selection:[i.event.sourceEvent.offsetX,i.event.sourceEvent.offsetX]).map(this._d3Scale.invert).map(Number);var r=this._availableTicks.map(Number);e[0]=s.date(n.closest(e[0],r));e[1]=s.date(n.closest(e[1],r));var h=+e[0]===+e[1];var o=e.map(this._d3Scale);if(h){o[0]-=.1;o[1]+=.1}this._brushGroup.call(this._brush.move,o)}this._brushStyle();if(this._on.start){this._on.start()}};r.prototype._brushStyle=function t(){var e=this._position;var i=e.height;var s=this._shape==="Circle"?typeof this._shapeConfig.r==="function"?this._shapeConfig.r({tick:true})*2:this._shapeConfig.r:this._shape==="Rect"?typeof this._shapeConfig[i]==="function"?this._shapeConfig[i]({tick:true}):this._shapeConfig[i]:this._tickSize;this._brushGroup.selectAll(".overlay").attr("cursor",this._brushing?"crosshair":"pointer");this._brushGroup.selectAll(".selection").call(n.attrize,this._selectionConfig).attr("height",s);this._brushGroup.selectAll(".handle").call(n.attrize,this._handleConfig).attr("height",s+this._handleSize)};r.prototype.render=function i(r){t.prototype.render.call(this,r);var h=this._position;var o=h.height;var a=h.y;var u=this._outerBounds[a],l=this._d3Scale.range();var c=this._brush=e.brushX().extent([[l[0],u],[l[1],u+this._outerBounds[o]]]).filter(this._brushFilter).handleSize(this._handleSize).on("start",this._brushStart.bind(this)).on("brush",this._brushBrush.bind(this)).on("end",this._brushEnd.bind(this));var _=this._availableTicks[this._availableTicks.length-1];var p=(this._selection===void 0?[_,_]:this._selection instanceof Array?this._selection.slice():[this._selection,this._selection]).map(s.date).map(this._d3Scale);if(p[0]===p[1]){p[0]-=.1;p[1]+=.1}this._brushGroup=n.elem("g.brushGroup",{parent:this._group});this._brushGroup.call(c).transition(this._transition).call(c.move,p);this._outerBounds.y-=this._handleSize/2;this._outerBounds.height+=this._handleSize/2;return this};r.prototype.brushing=function t(e){return arguments.length?(this._brushing=e,this):this._brushing};r.prototype.brushFilter=function t(e){return arguments.length?(this._brushFilter=e,this):this._brushFilter};r.prototype.handleConfig=function t(e){return arguments.length?(this._handleConfig=Object.assign(this._handleConfig,e),this):this._handleConfig};r.prototype.handleSize=function t(e){return arguments.length?(this._handleSize=e,this):this._handleSize};r.prototype.on=function t(e,i){return arguments.length===2?(this._on[e]=i,this):arguments.length?typeof e==="string"?this._on[e]:(this._on=Object.assign({},this._on,e),this):this._on};r.prototype.selectionConfig=function t(e){return arguments.length?(this._selectionConfig=Object.assign(this._selectionConfig,e),this):this._selectionConfig};r.prototype.selection=function t(e){return arguments.length?(this._selection=e,this):this._selection};r.prototype.snapping=function t(e){return arguments.length?(this._snapping=e,this):this._snapping};return r}(s.Axis);t.Timeline=r;Object.defineProperty(t,"__esModule",{value:true})});