/*
  d3plus-timeline v0.1.1
  An easy-to-use javascript timeline.
  Copyright (c) 2016 D3plus - https://d3plus.org
  @license MIT
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3-brush"),require("d3-selection"),require("d3plus-axis"),require("d3plus-common")):"function"==typeof define&&define.amd?define("d3plus-timeline",["exports","d3-brush","d3-selection","d3plus-axis","d3plus-common"],e):e(t.d3plus=t.d3plus||{},t.d3Brush,t.d3Selection,t.d3plusAxis,t.d3plusCommon)}(this,function(t,e,i,s,n){"use strict";var o=function(t){function s(){var e=this;t.call(this),this._domain=[2e3,2010],this._gridSize=0,this._handleConfig={fill:"red"},this._handleSize=6,this._height=100,this._on={},this.orient("bottom"),this._scale="time",this._shape="Rect",this._shapeConfig=Object.assign({},this._shapeConfig,{height:10,on:{click:function(t){e._on.end&&e._on.end(t.id),e.selection(t.id).render()}},width:function(t){return e._domain.map(function(t){return e._parseDate(t).getTime()}).includes(t.id)?2:1}}),this._tickShape="circle"}return t&&(s.__proto__=t),s.prototype=Object.create(t&&t.prototype),s.prototype.constructor=s,s.prototype._brushEnd=function(){if(i.event.sourceEvent){var t=(i.event.selection?i.event.selection:[i.event.sourceEvent.offsetX,i.event.sourceEvent.offsetX]).map(this._d3Scale.invert).map(Number),e=this._visibleTicks.map(Number);t[0]=this._parseDate(this._findClosest(t[0],e)),t[1]=this._parseDate(this._findClosest(t[1],e));var s=t.map(this._d3Scale),n=s[0]===s[1];n&&(s[0]--,s[1]++),this._brushGroup.transition(this._transition).call(this._brush.move,s),this._on.end&&this._on.end(n?t[0]:t)}},s.prototype._findClosest=function(t,e){return e.reduce(function(e,i){return Math.abs(i-t)<Math.abs(e-t)?i:e})},s.prototype.render=function(i){t.prototype.render.call(this,i);var s=this._position,o=s.height,h=s.y,r="Circle"===this._shape?2*this._shapeConfig.r:"Rect"===this._shape?this._shapeConfig[o]:this._tickSize,l=this._outerBounds[h],a=this._d3Scale.range(),c=this._brush=e.brushX().extent([[a[0],l],[a[1],l+r]]).handleSize(this._handleSize).on("start",this._on.start||null).on("brush",this._on.brush||null).on("end",this._brushEnd.bind(this)),_=this._visibleTicks[this._visibleTicks.length-1],u=(void 0===this._selection?[_,_]:this._selection instanceof Array?this._selection.slice():[this._selection,this._selection]).map(this._parseDate).map(this._d3Scale);u[0]===u[1]&&(u[0]--,u[1]++);var d=this._brushGroup=n.elem("g.brushGroup",{parent:this._group});return d.call(c).transition(this._transition).call(c.move,u),d.selectAll(".handle").transition(this._transition).call(n.attrize,this._handleConfig),this},s.prototype.handleConfig=function(t){return arguments.length?(this._handleConfig=Object.assign(this._handleConfig,t),this):this._handleConfig},s.prototype.handleSize=function(t){return arguments.length?(this._handleSize=t,this):this._handleSize},s.prototype.on=function(t,e){return 2===arguments.length?(this._on[t]=e,this):arguments.length?"string"==typeof t?this._on[t]:(this._on=Object.assign({},this._on,t),this):this._on},s.prototype.selectionConfig=function(t){return arguments.length?(this._selectionConfig=Object.assign(this._selectionConfig,t),this):this._selectionConfig},s.prototype.selection=function(t){return arguments.length?(this._selection=t,this):this._selection},s}(s.Axis);t.Timeline=o,Object.defineProperty(t,"__esModule",{value:!0})});