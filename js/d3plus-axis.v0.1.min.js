/*
  d3plus-axis v0.1.0
  Beautiful javascript scales and axes.
  Copyright (c) 2016 D3plus - https://d3plus.org
  @license MIT
*/
!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports,require("d3plus-common"),require("d3plus-text"),require("d3-array"),require("d3-scale"),require("d3-selection"),require("d3-transition")):"function"==typeof define&&define.amd?define("d3plus-axis",["exports","d3plus-common","d3plus-text","d3-array","d3-scale","d3-selection","d3-transition"],i):i(t.d3plus=t.d3plus||{},t.d3plusCommon,t.d3plusText,t.d3Array,t.scales,t.d3Selection,t.d3Transition)}(this,function(t,i,e,n,o,s,r){"use strict";var h=function(t){function h(){t.call(this),this._align="middle",this._domain=[0,10],this._duration=600,this._height=100,this.orient("bottom"),this._outerBounds={width:0,height:0,x:0,y:0},this._padding=5,this._scale="linear",this._strokeWidth=1,this._textBoxConfig={fontFamily:(new e.TextBox).fontFamily(),fontResize:!1,fontSize:i.constant(10)},this._tickScale=o.scaleSqrt().domain([10,400]).range([10,50]),this._tickSize=5,this._titleConfig={fontFamily:"Verdana",fontSize:12,lineHeight:13,textAnchor:"middle"},this._width=400}return t&&(h.__proto__=t),h.prototype=Object.create(t&&t.prototype),h.prototype.constructor=h,h.prototype._barPosition=function(t){var i=this._position,e=i.height,n=i.x,o=i.y,s=["top","left"].includes(this._orient)?this._outerBounds[o]+this._outerBounds[e]:this._outerBounds[o];t.attr(n+"1",this._d3Scale(this._d3Scale.domain()[0])).attr(n+"2",this._d3Scale(this._d3Scale.domain()[1])).attr(o+"1",s).attr(o+"2",s)},h.prototype._clipPosition=function(t){var i=this._position,e=i.width,n=i.height,o=i.x,s=i.y,r=this._d3Scale.domain(),h=this._strokeWidth,l=this._d3Scale(r[1])-this._d3Scale(r[0]),a=["top","left"].includes(this._orient)?this._outerBounds[s]+this._outerBounds[n]-this._tickSize:this._outerBounds[s];t.attr(o,this._d3Scale(this._d3Scale.domain()[0])-h).attr(s,a).attr(e,l+2*h).attr(n,this._tickSize+h)},h.prototype._tickPosition=function(t,i){void 0===i&&(i=!1);var e=this._position,n=e.height,o=e.x,s=e.y,r=["top","left"].includes(this._orient)?this._outerBounds[s]+this._outerBounds[n]:this._outerBounds[s],h=i?this._lastScale||this._d3Scale:this._d3Scale,l=["top","left"].includes(this._orient)?-this._tickSize:this._tickSize;t.attr("stroke-width",this._strokeWidth).attr(o+"1",function(t){return h(t.id)}).attr(o+"2",function(t){return h(t.id)}).attr(s+"1",r).attr(s+"2",i?r:r+l)},h.prototype.align=function(t){return arguments.length?(this._align=t,this):this._align},h.prototype.domain=function(t){return arguments.length?(this._domain=t,this):this._domain},h.prototype.duration=function(t){return arguments.length?(this._duration=t,this):this._duration},h.prototype.height=function(t){return arguments.length?(this._height=t,this):this._height},h.prototype.orient=function(t){if(arguments.length){var i=["top","bottom"].includes(t);return this._position={width:i?"width":"height",height:i?"height":"width",x:i?"x":"y",y:i?"y":"x"},this._orient=t,this}return this._orient},h.prototype.outerBounds=function(){return this._outerBounds},h.prototype.padding=function(t){return arguments.length?(this._padding=t,this):this._padding},h.prototype.range=function(t){return arguments.length?(this._range=t,this):this._range},h.prototype.render=function(t){var i=this;void 0===this._select&&this.select(s.select("body").append("svg").attr("width",this._width+"px").attr("height",this._height+"px").node());var h=r.transition().duration(this._duration);void 0===this._lineHeight&&(this._lineHeight=function(t,e){return 1.1*i._textBoxConfig.fontSize(t,e)});var l=this._position,a=l.width,d=l.height,_=l.x,c=l.y,u="d3plus-ShapeLegend-clip-"+this._uuid,p=this._padding,g=this._range?this._range.slice():[void 0,void 0];void 0===g[0]&&(g[0]=p),void 0===g[1]&&(g[1]=this["_"+a]-p);var f=g[1]-g[0];if(this._titleHeight=0,this._title){var x=this._titleConfig.lineHeight?this._titleConfig.lineHeight:1.1*this._titleConfig.fontSize,y=e.textWrap().fontFamily(this._titleConfig.fontFamily).fontSize(this._titleConfig.fontSize).lineHeight(x).width(f).height(this._height-this._tickSize-p)(this._title);this._titleHeight=y.lines.length*x+p}this._d3Scale=o["scale"+this._scale.charAt(0).toUpperCase()+this._scale.slice(1)]().domain(this._domain).rangeRound(g);var m=this._ticks||this._d3Scale.ticks(Math.floor(f/this._tickScale(f))),S=this._d3Scale.tickFormat(m.length-1);this._ticks||(m=m.map(S).map(Number));var B=this._tickLabels||m,v=0;if(B.length>1)for(var k=0;k<B.length;k++){var b=i._d3Scale(B[k+1])-i._d3Scale(B[k]);b>v&&(v=b)}else v=f;var w=B.map(function(t,o){var s=i._textBoxConfig.fontFamily(t,o),r=i._textBoxConfig.fontSize(t,o),h=i._textBoxConfig.lineHeight?i._textBoxConfig.lineHeight(t,o):1.1*r,l=e.textWrap().fontFamily(s).fontSize(r).lineHeight(h).width(v).height(i._height-i._tickSize-p)(t);return l.lines=l.lines.filter(function(t){return""!==t}),l.d=t,l.fS=r,l.width=Math.ceil(n.max(l.lines.map(function(t){return e.textWidth(t,{"font-family":s,"font-size":r})}))),l.height=Math.ceil(l.lines.length*(h+1)),l.width%2&&l.width++,l}),A=g.slice();if(w.length){var C=w[0],z=w[w.length-1],H=this._d3Scale(C.d)-C[a]/2-p;if(H<g[0]){var P=g[0]-H;void 0===this._range||void 0===this._range[0]?(f-=P,g[0]+=P):this._range&&(A[0]-=P)}var j=this._d3Scale(z.d)+z[a]/2+p;if(j>g[1]){var F=j-g[1];void 0===this._range||void 0===this._range[1]?(f-=F,g[1]-=F):this._range&&(A[1]+=F)}this._d3Scale.rangeRound(g)}var O,q=w.length?2*p:0;this._outerBounds=(O={},O[d]=this._titleHeight+this._tickSize+(n.max(w,function(t){return t[d]})||0)+q,O[a]=A[1]-A[0],O[_]=A[0],O),this._outerBounds[c]="start"===this._align?this._padding:"end"===this._align?this["_"+d]-this._outerBounds[d]:this["_"+d]/2-this._outerBounds[d]/2;var T=this._select.selectAll("g#d3plus-Axis-"+u).data([0]);T=T.enter().append("g").attr("id","d3plus-Axis-"+u).merge(T);var L=T.selectAll("defs").data([null]);L=L.enter().append("defs").merge(L);var W=L.selectAll("clipPath#"+u).data([null]);W=W.enter().append("clipPath").attr("id",u).merge(W);var M=W.selectAll("rect").data([null]);M.enter().append("rect").call(this._clipPosition.bind(this)).merge(M).transition(h).call(this._clipPosition.bind(this));var R=T.selectAll("line.bar").data([null]);R.enter().append("line").attr("class","bar").attr("stroke","#000").attr("opacity",0).call(this._barPosition.bind(this)).merge(R).transition(h).attr("opacity",1).call(this._barPosition.bind(this));var N=T.selectAll("line.tick").data(m.map(function(t){return{id:t}}),function(t){return t.id});N.exit().transition(h).attr("opacity",0).call(this._tickPosition.bind(this)).remove(),N.enter().append("line").attr("class","tick").attr("stroke","#000").attr("opacity",0).attr("clip-path","url(#"+u+")").call(this._tickPosition.bind(this),!0).merge(N).transition(h).attr("opacity",1).call(this._tickPosition.bind(this));var U=n.max(w,function(t){return t.height})||0,V=n.max(w,function(t){return t.width+t.fS})||0,D=T.selectAll("g.d3plus-Axis-title").data([null]);D=D.enter().append("g").attr("class","d3plus-Axis-title").merge(D),(new e.TextBox).data(this._title?[{text:this._title}]:[]).duration(this._duration).height(this._outerBounds.height).rotate("left"===this._orient?-90:"right"===this._orient?90:0).select(D.node()).text(function(t){return t.text}).textAnchor("middle").verticalAlign("bottom"===this._orient?"bottom":"top").width(this._outerBounds[a]).x(["top","bottom"].includes(this._orient)?this._outerBounds.x:"left"===this._orient?this._outerBounds.x+this._titleHeight/2-this._outerBounds[a]/2:this._outerBounds.x+this._outerBounds.width-this._titleHeight/2-this._outerBounds[a]/2).y(["top","bottom"].includes(this._orient)?this._outerBounds.y:this._outerBounds.y-this._titleHeight/2+this._outerBounds[a]/2).config(this._titleConfig).render();var E=T.selectAll("g.d3plus-Axis-ticks").data([null]);return E=E.enter().append("g").attr("class","d3plus-Axis-ticks").merge(E),(new e.TextBox).data(B.filter(function(t,i){return w[i].lines.length}).map(function(t){return{id:t}})).duration(this._duration).height(U).select(E.node()).text(function(t){return S(t.id)}).textAnchor("left"===this._orient?"end":"right"===this._orient?"start":"middle").verticalAlign("bottom"===this._orient?"top":"top"===this._orient?"bottom":"middle").width(V).x(function(t,e){return["top","bottom"].includes(i._orient)?i._d3Scale(t.id)-V/2:"left"===i._orient?i._titleHeight+i._outerBounds.x-i._textBoxConfig.fontSize(B[e],e)/2:i._outerBounds.x+i._tickSize+i._padding}).y(function(t){return["left","right"].includes(i._orient)?i._d3Scale(t.id)-U/2:"bottom"===i._orient?i._outerBounds.y+i._tickSize+p:i._titleHeight+i._outerBounds.y}).config(this._textBoxConfig).render(),this._lastScale=this._d3Scale,t&&setTimeout(t,this._duration+100),this},h.prototype.scale=function(t){return arguments.length?(this._scale=t,this):this._scale},h.prototype.select=function(t){return arguments.length?(this._select=s.select(t),this):this._select},h.prototype.textBoxConfig=function(t){return arguments.length?(this._textBoxConfig=Object.assign(this._textBoxConfig,t),this):this._textBoxConfig},h.prototype.tickLabels=function(t){return arguments.length?(this._tickLabels=t,this):this._tickLabels},h.prototype.ticks=function(t){return arguments.length?(this._ticks=t,this):this._ticks},h.prototype.tickSize=function(t){return arguments.length?(this._tickSize=t,this):this._tickSize},h.prototype.title=function(t){return arguments.length?(this._title=t,this):this._title},h.prototype.titleConfig=function(t){return arguments.length?(this._titleConfig=Object.assign(this._titleConfig,t),this):this._titleConfig},h.prototype.width=function(t){return arguments.length?(this._width=t,this):this._width},h}(i.BaseClass),l=function(t){function i(){t.call(this),this._height=100,this.orient("bottom"),this._width=400}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i}(h),a=function(t){function i(){t.call(this),this._height=400,this.orient("left"),this._width=100}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i}(h),d=function(t){function i(){t.call(this),this._height=400,this.orient("right"),this._width=100}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i}(h),_=function(t){function i(){t.call(this),this._height=100,this.orient("top"),this._width=400}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i}(h);t.Axis=h,t.AxisBottom=l,t.AxisLeft=a,t.AxisRight=d,t.AxisTop=_,Object.defineProperty(t,"__esModule",{value:!0})});