/*
  d3plus-axis v0.1.1
  Beautiful javascript scales and axes.
  Copyright (c) 2016 D3plus - https://d3plus.org
  @license MIT
*/
!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports,require("d3plus-common"),require("d3plus-text"),require("d3-array"),require("d3-scale"),require("d3-selection"),require("d3-transition")):"function"==typeof define&&define.amd?define("d3plus-axis",["exports","d3plus-common","d3plus-text","d3-array","d3-scale","d3-selection","d3-transition"],i):i(t.d3plus=t.d3plus||{},t.d3plusCommon,t.d3plusText,t.d3Array,t.scales,t.d3Selection,t.d3Transition)}(this,function(t,i,e,o,n,s,h){"use strict";var r=function(t){function r(){t.call(this),this._align="middle",this._domain=[0,10],this._duration=600,this._height=100,this.orient("bottom"),this._outerBounds={width:0,height:0,x:0,y:0},this._padding=5,this._scale="linear",this._strokeWidth=1,this._textBoxConfig={fontFamily:(new e.TextBox).fontFamily(),fontResize:!1,fontSize:i.constant(10)},this._tickScale=n.scaleSqrt().domain([10,400]).range([10,50]),this._tickSize=5,this._titleConfig={fontFamily:"Verdana",fontSize:12,lineHeight:13,textAnchor:"middle"},this._width=400}return t&&(r.__proto__=t),r.prototype=Object.create(t&&t.prototype),r.prototype.constructor=r,r.prototype._barPosition=function(t){var i=this._position,e=i.height,o=i.x,n=i.y,s=["top","left"].includes(this._orient)?this._outerBounds[n]+this._outerBounds[e]:this._outerBounds[n];t.attr(o+"1",this._d3Scale(this._d3Scale.domain()[0])).attr(o+"2",this._d3Scale(this._d3Scale.domain()[1])).attr(n+"1",s).attr(n+"2",s)},r.prototype._clipPosition=function(t){var i=this._position,e=i.width,o=i.height,n=i.x,s=i.y,h=this._d3Scale.domain(),r=this._strokeWidth,a=this._d3Scale(h[1])-this._d3Scale(h[0]),l=["top","left"].includes(this._orient)?this._outerBounds[s]+this._outerBounds[o]-this._tickSize:this._outerBounds[s];t.attr(n,this._d3Scale(this._d3Scale.domain()[0])-r).attr(s,l).attr(e,a+2*r).attr(o,this._tickSize+r)},r.prototype._tickPosition=function(t,i){void 0===i&&(i=!1);var e=this._position,o=e.height,n=e.x,s=e.y,h=["top","left"].includes(this._orient)?this._outerBounds[s]+this._outerBounds[o]:this._outerBounds[s],r=i?this._lastScale||this._d3Scale:this._d3Scale,a=["top","left"].includes(this._orient)?-this._tickSize:this._tickSize;t.attr("stroke-width",this._strokeWidth).attr(n+"1",function(t){return r(t.id)}).attr(n+"2",function(t){return r(t.id)}).attr(s+"1",h).attr(s+"2",i?h:h+a)},r.prototype.align=function(t){return arguments.length?(this._align=t,this):this._align},r.prototype.domain=function(t){return arguments.length?(this._domain=t,this):this._domain},r.prototype.duration=function(t){return arguments.length?(this._duration=t,this):this._duration},r.prototype.height=function(t){return arguments.length?(this._height=t,this):this._height},r.prototype.orient=function(t){if(arguments.length){var i=["top","bottom"].includes(t);return this._position={width:i?"width":"height",height:i?"height":"width",x:i?"x":"y",y:i?"y":"x"},this._orient=t,this}return this._orient},r.prototype.outerBounds=function(){return this._outerBounds},r.prototype.padding=function(t){return arguments.length?(this._padding=t,this):this._padding},r.prototype.range=function(t){return arguments.length?(this._range=t,this):this._range},r.prototype.render=function(t){var r=this;void 0===this._select&&this.select(s.select("body").append("svg").attr("width",this._width+"px").attr("height",this._height+"px").node());var a=this._select,l=h.transition().duration(this._duration);void 0===this._lineHeight&&(this._lineHeight=function(t,i){return 1.1*r._textBoxConfig.fontSize(t,i)});var _=this._position,d=_.width,c=_.height,u=_.x,p=_.y,g="d3plus-ShapeLegend-clip-"+this._uuid,f=this._padding,x=this._range?this._range.slice():[void 0,void 0];void 0===x[0]&&(x[0]=f),void 0===x[1]&&(x[1]=this["_"+d]-f);var y=x[1]-x[0];if(this._titleHeight=0,this._title){var m=this._titleConfig.lineHeight?this._titleConfig.lineHeight:1.1*this._titleConfig.fontSize,S=e.textWrap().fontFamily(this._titleConfig.fontFamily).fontSize(this._titleConfig.fontSize).lineHeight(m).width(y).height(this._height-this._tickSize-f)(this._title);this._titleHeight=S.lines.length*m+f}this._d3Scale=n["scale"+this._scale.charAt(0).toUpperCase()+this._scale.slice(1)]().domain(this._domain).rangeRound(x);var B=this._ticks||this._d3Scale.ticks(Math.floor(y/this._tickScale(y))),v=this._d3Scale.tickFormat(B.length-1);this._ticks||(B=B.map(v).map(Number));var k=this._tickLabels||B,b=0;if(k.length>1)for(var w=0;w<k.length;w++){var C=r._d3Scale(k[w+1])-r._d3Scale(k[w]);C>b&&(b=C)}else b=y;var z=k.map(function(t,i){var n=r._textBoxConfig.fontFamily(t,i),s=r._textBoxConfig.fontSize(t,i),h=r._textBoxConfig.lineHeight?r._textBoxConfig.lineHeight(t,i):1.1*s,a=e.textWrap().fontFamily(n).fontSize(s).lineHeight(h).width(b).height(r._height-r._tickSize-f)(t);return a.lines=a.lines.filter(function(t){return""!==t}),a.d=t,a.fS=s,a.width=Math.ceil(o.max(a.lines.map(function(t){return e.textWidth(t,{"font-family":n,"font-size":s})}))),a.height=Math.ceil(a.lines.length*(h+1)),a.width%2&&a.width++,a}),A=x.slice();if(z.length){var H=z[0],P=z[z.length-1],j=this._d3Scale(H.d)-H[d]/2-f;if(j<x[0]){var F=x[0]-j;void 0===this._range||void 0===this._range[0]?(y-=F,x[0]+=F):this._range&&(A[0]-=F)}var O=this._d3Scale(P.d)+P[d]/2+f;if(O>x[1]){var q=O-x[1];void 0===this._range||void 0===this._range[1]?(y-=q,x[1]-=q):this._range&&(A[1]+=q)}this._d3Scale.rangeRound(x)}var T,L=z.length?2*f:0;this._outerBounds=(T={},T[c]=this._titleHeight+this._tickSize+(o.max(z,function(t){return t[c]})||0)+L,T[d]=A[1]-A[0],T[u]=A[0],T),this._outerBounds[p]="start"===this._align?this._padding:"end"===this._align?this["_"+c]-this._outerBounds[c]:this["_"+c]/2-this._outerBounds[c]/2;var W=i.elem("g#d3plus-Axis-"+g,{parent:a}),M=i.elem("defs",{parent:W}),R=i.elem("clipPath#"+g,{parent:M}),N=R.selectAll("rect").data([null]);N.enter().append("rect").call(this._clipPosition.bind(this)).merge(N).transition(l).call(this._clipPosition.bind(this));var U=W.selectAll("line.bar").data([null]);U.enter().append("line").attr("class","bar").attr("stroke","#000").attr("opacity",0).call(this._barPosition.bind(this)).merge(U).transition(l).attr("opacity",1).call(this._barPosition.bind(this));var V=W.selectAll("line.tick").data(B.map(function(t){return{id:t}}),function(t){return t.id});V.exit().transition(l).attr("opacity",0).call(this._tickPosition.bind(this)).remove(),V.enter().append("line").attr("class","tick").attr("stroke","#000").attr("opacity",0).attr("clip-path","url(#"+g+")").call(this._tickPosition.bind(this),!0).merge(V).transition(l).attr("opacity",1).call(this._tickPosition.bind(this));var D=o.max(z,function(t){return t.height})||0,E=o.max(z,function(t){return t.width+t.fS})||0;return(new e.TextBox).data(this._title?[{text:this._title}]:[]).duration(this._duration).height(this._outerBounds.height).rotate("left"===this._orient?-90:"right"===this._orient?90:0).select(i.elem("g.d3plus-Axis-title",{parent:W}).node()).text(function(t){return t.text}).textAnchor("middle").verticalAlign("bottom"===this._orient?"bottom":"top").width(this._outerBounds[d]).x(["top","bottom"].includes(this._orient)?this._outerBounds.x:"left"===this._orient?this._outerBounds.x+this._titleHeight/2-this._outerBounds[d]/2:this._outerBounds.x+this._outerBounds.width-this._titleHeight/2-this._outerBounds[d]/2).y(["top","bottom"].includes(this._orient)?this._outerBounds.y:this._outerBounds.y-this._titleHeight/2+this._outerBounds[d]/2).config(this._titleConfig).render(),(new e.TextBox).data(k.filter(function(t,i){return z[i].lines.length}).map(function(t){return{id:t}})).duration(this._duration).height(D).select(i.elem("g.d3plus-Axis-ticks",{parent:W}).node()).text(function(t){return v(t.id)}).textAnchor("left"===this._orient?"end":"right"===this._orient?"start":"middle").verticalAlign("bottom"===this._orient?"top":"top"===this._orient?"bottom":"middle").width(E).x(function(t,i){return["top","bottom"].includes(r._orient)?r._d3Scale(t.id)-E/2:"left"===r._orient?r._titleHeight+r._outerBounds.x-r._textBoxConfig.fontSize(k[i],i)/2:r._outerBounds.x+r._tickSize+r._padding}).y(function(t){return["left","right"].includes(r._orient)?r._d3Scale(t.id)-D/2:"bottom"===r._orient?r._outerBounds.y+r._tickSize+f:r._titleHeight+r._outerBounds.y}).config(this._textBoxConfig).render(),this._lastScale=this._d3Scale,t&&setTimeout(t,this._duration+100),this},r.prototype.scale=function(t){return arguments.length?(this._scale=t,this):this._scale},r.prototype.select=function(t){return arguments.length?(this._select=s.select(t),this):this._select},r.prototype.textBoxConfig=function(t){return arguments.length?(this._textBoxConfig=Object.assign(this._textBoxConfig,t),this):this._textBoxConfig},r.prototype.tickLabels=function(t){return arguments.length?(this._tickLabels=t,this):this._tickLabels},r.prototype.ticks=function(t){return arguments.length?(this._ticks=t,this):this._ticks},r.prototype.tickSize=function(t){return arguments.length?(this._tickSize=t,this):this._tickSize},r.prototype.title=function(t){return arguments.length?(this._title=t,this):this._title},r.prototype.titleConfig=function(t){return arguments.length?(this._titleConfig=Object.assign(this._titleConfig,t),this):this._titleConfig},r.prototype.width=function(t){return arguments.length?(this._width=t,this):this._width},r}(i.BaseClass),a=function(t){function i(){t.call(this),this._height=100,this.orient("bottom"),this._width=400}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i}(r),l=function(t){function i(){t.call(this),this._height=400,this.orient("left"),this._width=100}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i}(r),_=function(t){function i(){t.call(this),this._height=400,this.orient("right"),this._width=100}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i}(r),d=function(t){function i(){t.call(this),this._height=100,this.orient("top"),this._width=400}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i}(r);t.Axis=r,t.AxisBottom=a,t.AxisLeft=l,t.AxisRight=_,t.AxisTop=d,Object.defineProperty(t,"__esModule",{value:!0})});