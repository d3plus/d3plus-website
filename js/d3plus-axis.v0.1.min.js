/*
  d3plus-axis v0.1.4
  Beautiful javascript scales and axes.
  Copyright (c) 2016 D3plus - https://d3plus.org
  @license MIT
*/
!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports,require("d3plus-common"),require("d3plus-text"),require("d3-array"),require("d3-scale"),require("d3-selection"),require("d3-transition")):"function"==typeof define&&define.amd?define("d3plus-axis",["exports","d3plus-common","d3plus-text","d3-array","d3-scale","d3-selection","d3-transition"],i):i(t.d3plus=t.d3plus||{},t.d3plusCommon,t.d3plusText,t.d3Array,t.scales,t.d3Selection,t.d3Transition)}(this,function(t,i,e,n,o,s,r){"use strict";var h=function(t){function h(){t.call(this),this._align="middle",this._barConfig={stroke:"#000","stroke-width":1},this._domain=[0,10],this._duration=600,this._gridConfig={stroke:"#ccc","stroke-width":1},this._height=400,this.orient("bottom"),this._outerBounds={width:0,height:0,x:0,y:0},this._padding=5,this._scale="linear",this._textBoxConfig={fontFamily:(new e.TextBox).fontFamily(),fontResize:!1,fontSize:i.constant(10)},this._tickConfig={stroke:"#000","stroke-width":1},this._tickScale=o.scaleSqrt().domain([10,400]).range([10,50]),this._tickSize=5,this._titleConfig={fontFamily:"Verdana",fontSize:12,lineHeight:13,textAnchor:"middle"},this._width=400}return t&&(h.__proto__=t),h.prototype=Object.create(t&&t.prototype),h.prototype.constructor=h,h.prototype._barPosition=function(t){var e=this._position,n=e.height,o=e.x,s=e.y,r=["top","left"].includes(this._orient)?this._outerBounds[s]+this._outerBounds[n]-this._gridLength:this._outerBounds[s]+this._gridLength;t.call(i.attrize,this._barConfig).attr(o+"1",this._d3Scale(this._d3Scale.domain()[0])).attr(o+"2",this._d3Scale(this._d3Scale.domain()[1])).attr(s+"1",r).attr(s+"2",r)},h.prototype._clipPosition=function(t){var i=this._position,e=i.width,o=i.height,s=i.x,r=i.y,h=this._d3Scale.domain(),a=n.max([this._gridConfig["stroke-width"],this._tickConfig["stroke-width"]]),l=this._d3Scale(h[1])-this._d3Scale(h[0]),_=["top","left"].includes(this._orient)?this._outerBounds[r]+this._outerBounds[o]-this._tickSize-this._gridLength:this._outerBounds[r];t.attr(s,this._d3Scale(this._d3Scale.domain()[0])-a).attr(r,_).attr(e,l+2*a).attr(o,this._gridLength+this._tickSize+a)},h.prototype._gridPosition=function(t,e){void 0===e&&(e=!1);var n=this._position,o=n.height,s=n.x,r=n.y,h=["top","left"].includes(this._orient)?this._outerBounds[r]+this._outerBounds[o]-this._gridLength:this._outerBounds[r]+this._gridLength,a=e?this._lastScale||this._d3Scale:this._d3Scale,l=["top","left"].includes(this._orient)?this._gridLength:-this._gridLength;t.call(i.attrize,this._gridConfig).attr(s+"1",function(t){return a(t.id)}).attr(s+"2",function(t){return a(t.id)}).attr(r+"1",h).attr(r+"2",e?h:h+l)},h.prototype._tickPosition=function(t,e){void 0===e&&(e=!1);var n=this._position,o=n.height,s=n.x,r=n.y,h=["top","left"].includes(this._orient)?this._outerBounds[r]+this._outerBounds[o]-this._gridLength:this._outerBounds[r]+this._gridLength,a=e?this._lastScale||this._d3Scale:this._d3Scale,l=["top","left"].includes(this._orient)?-this._tickSize:this._tickSize;t.call(i.attrize,this._tickConfig).attr(s+"1",function(t){return a(t.id)}).attr(s+"2",function(t){return a(t.id)}).attr(r+"1",h).attr(r+"2",e?h:h+l)},h.prototype.align=function(t){return arguments.length?(this._align=t,this):this._align},h.prototype.barConfig=function(t){return arguments.length?(this._barConfig=Object.assign(this._barConfig,t),this):this._barConfig},h.prototype.domain=function(t){return arguments.length?(this._domain=t,this):this._domain},h.prototype.duration=function(t){return arguments.length?(this._duration=t,this):this._duration},h.prototype.grid=function(t){return arguments.length?(this._grid=t,this):this._grid},h.prototype.gridConfig=function(t){return arguments.length?(this._gridConfig=Object.assign(this._gridConfig,t),this):this._gridConfig},h.prototype.gridSize=function(t){return arguments.length?(this._gridSize=t,this):this._gridSize},h.prototype.height=function(t){return arguments.length?(this._height=t,this):this._height},h.prototype.orient=function(t){if(arguments.length){var i=["top","bottom"].includes(t);return this._position={width:i?"width":"height",height:i?"height":"width",x:i?"x":"y",y:i?"y":"x"},this._orient=t,this}return this._orient},h.prototype.outerBounds=function(){return this._outerBounds},h.prototype.padding=function(t){return arguments.length?(this._padding=t,this):this._padding},h.prototype.range=function(t){return arguments.length?(this._range=t,this):this._range},h.prototype.render=function(t){var h=this;void 0===this._select&&this.select(s.select("body").append("svg").attr("width",this._width+"px").attr("height",this._height+"px").node());var a=this._select,l=r.transition().duration(this._duration);void 0===this._lineHeight&&(this._lineHeight=function(t,i){return 1.1*h._textBoxConfig.fontSize(t,i)});var _=this._position,d=_.width,c=_.height,u=_.x,g=_.y,p="d3plus-ShapeLegend-clip-"+this._uuid,f=this._padding,y=this._range?this._range.slice():[void 0,void 0];void 0===y[0]&&(y[0]=f),void 0===y[1]&&(y[1]=this["_"+d]-f);var x=y[1]-y[0];if(this._titleHeight=0,this._title){var m=this._titleConfig.lineHeight?this._titleConfig.lineHeight:1.1*this._titleConfig.fontSize,S=e.textWrap().fontFamily(this._titleConfig.fontFamily).fontSize(this._titleConfig.fontSize).lineHeight(m).width(x).height(this._height-this._tickSize-f)(this._title);this._titleHeight=S.lines.length*m+f}this._d3Scale=o["scale"+this._scale.charAt(0).toUpperCase()+this._scale.slice(1)]().domain(this._domain).rangeRound(y);var B=this._ticks||this._d3Scale.ticks(Math.floor(x/this._tickScale(x))),b=this._d3Scale.tickFormat(B.length-1);this._ticks||(B=B.map(b).map(Number));var k=this._tickLabels||B,v=0;if(k.length>1)for(var C=0;C<k.length;C++){var z=h._d3Scale(k[C+1])-h._d3Scale(k[C]);z>v&&(v=z)}else v=x;var w=k.map(function(t,i){var o=h._textBoxConfig.fontFamily(t,i),s=h._textBoxConfig.fontSize(t,i),r=h._textBoxConfig.lineHeight?h._textBoxConfig.lineHeight(t,i):1.1*s,a=e.textWrap().fontFamily(o).fontSize(s).lineHeight(r).width(v).height(h._height-h._tickSize-f)(t);return a.lines=a.lines.filter(function(t){return""!==t}),a.d=t,a.fS=s,a.width=Math.ceil(n.max(a.lines.map(function(t){return e.textWidth(t,{"font-family":o,"font-size":s})}))),a.height=Math.ceil(a.lines.length*(r+1)),a.width%2&&a.width++,a}),L=y.slice();if(w.length){var A=w[0],H=w[w.length-1],P=this._d3Scale(A.d)-A[d]/2-f;if(P<y[0]){var j=y[0]-P;void 0===this._range||void 0===this._range[0]?(x-=j,y[0]+=j):this._range&&(L[0]-=j)}var O=this._d3Scale(H.d)+H[d]/2+f;if(O>y[1]){var F=O-y[1];void 0===this._range||void 0===this._range[1]?(x-=F,y[1]-=F):this._range&&(L[1]+=F)}this._d3Scale.rangeRound(y)}var q,T=w.length?2*f:0;this._outerBounds=(q={},q[c]=this._titleHeight+this._tickSize+(n.max(w,function(t){return t[c]})||0)+T,q[d]=L[1]-L[0],q[u]=L[0],q),this._gridLength=void 0!==this._gridSize?this._gridSize:this["_"+c]-this._outerBounds[c]-2*f,this._outerBounds[c]+=this._gridLength,this._outerBounds[g]="start"===this._align?this._padding:"end"===this._align?this["_"+c]-this._outerBounds[c]:this["_"+c]/2-this._outerBounds[c]/2;var M=i.elem("g#d3plus-Axis-"+p,{parent:a}),R=i.elem("defs",{parent:M}),W=i.elem("clipPath#"+p,{parent:R}),N=W.selectAll("rect").data([null]);N.enter().append("rect").call(this._clipPosition.bind(this)).merge(N).transition(l).call(this._clipPosition.bind(this));var U=i.elem("g.grid",{parent:M}).selectAll("line").data((this._grid||B).map(function(t){return{id:t}}),function(t){return t.id});U.exit().transition(l).attr("opacity",0).call(this._gridPosition.bind(this)).remove(),U.enter().append("line").attr("opacity",0).attr("clip-path","url(#"+p+")").call(this._gridPosition.bind(this),!0).merge(U).transition(l).attr("opacity",1).call(this._gridPosition.bind(this));var V=i.elem("g.ticks",{parent:M}).selectAll("line").data(B.map(function(t){return{id:t}}),function(t){return t.id});V.exit().transition(l).attr("opacity",0).call(this._tickPosition.bind(this)).remove(),V.enter().append("line").attr("opacity",0).attr("clip-path","url(#"+p+")").call(this._tickPosition.bind(this),!0).merge(V).transition(l).attr("opacity",1).call(this._tickPosition.bind(this));var D=M.selectAll("line.bar").data([null]);D.enter().append("line").attr("class","bar").attr("opacity",0).call(this._barPosition.bind(this)).merge(D).transition(l).attr("opacity",1).call(this._barPosition.bind(this));var E=n.max(w,function(t){return t.height})||0;return(new e.TextBox).data(this._title?[{text:this._title}]:[]).duration(this._duration).height(this._outerBounds.height).rotate("left"===this._orient?-90:"right"===this._orient?90:0).select(i.elem("g.d3plus-Axis-title",{parent:M}).node()).text(function(t){return t.text}).textAnchor("middle").verticalAlign("bottom"===this._orient?"bottom":"top").width(this._outerBounds[d]).x(["top","bottom"].includes(this._orient)?this._outerBounds.x:"left"===this._orient?this._outerBounds.x+this._titleHeight/2-this._outerBounds[d]/2:this._outerBounds.x+this._outerBounds.width-this._titleHeight/2-this._outerBounds[d]/2).y(["top","bottom"].includes(this._orient)?this._outerBounds.y:this._outerBounds.y-this._titleHeight/2+this._outerBounds[d]/2).config(this._titleConfig).render(),(new e.TextBox).data(k.filter(function(t,i){return w[i].lines.length}).map(function(t){return{id:t}})).duration(this._duration).height(E).select(i.elem("g.d3plus-Axis-ticks",{parent:M}).node()).text(function(t){return b(t.id)}).textAnchor("left"===this._orient?"end":"right"===this._orient?"start":"middle").verticalAlign("bottom"===this._orient?"top":"top"===this._orient?"bottom":"middle").width(v).x(function(t,i){return["top","bottom"].includes(h._orient)?h._d3Scale(t.id)-v/2:"left"===h._orient?h._titleHeight+h._outerBounds.x-h._textBoxConfig.fontSize(k[i],i)/2:h._outerBounds.x+h._tickSize+h._gridLength+h._padding}).y(function(t){return["left","right"].includes(h._orient)?h._d3Scale(t.id)-E/2:"bottom"===h._orient?h._outerBounds.y+h._gridLength+h._tickSize+f:h._titleHeight+h._outerBounds.y}).config(this._textBoxConfig).render(),this._lastScale=this._d3Scale,t&&setTimeout(t,this._duration+100),this},h.prototype.scale=function(t){return arguments.length?(this._scale=t,this):this._scale},h.prototype.select=function(t){return arguments.length?(this._select=s.select(t),this):this._select},h.prototype.textBoxConfig=function(t){return arguments.length?(this._textBoxConfig=Object.assign(this._textBoxConfig,t),this):this._textBoxConfig},h.prototype.tickConfig=function(t){return arguments.length?(this._tickConfig=Object.assign(this._tickConfig,t),this):this._tickConfig},h.prototype.tickLabels=function(t){return arguments.length?(this._tickLabels=t,this):this._tickLabels},h.prototype.ticks=function(t){return arguments.length?(this._ticks=t,this):this._ticks},h.prototype.tickSize=function(t){return arguments.length?(this._tickSize=t,this):this._tickSize},h.prototype.title=function(t){return arguments.length?(this._title=t,this):this._title},h.prototype.titleConfig=function(t){return arguments.length?(this._titleConfig=Object.assign(this._titleConfig,t),this):this._titleConfig},h.prototype.width=function(t){return arguments.length?(this._width=t,this):this._width},h}(i.BaseClass),a=function(t){function i(){t.call(this),this.orient("bottom")}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i}(h),l=function(t){function i(){t.call(this),this.orient("left")}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i}(h),_=function(t){function i(){t.call(this),this.orient("right")}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i}(h),d=function(t){function i(){t.call(this),this.orient("top")}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i}(h);t.Axis=h,t.AxisBottom=a,t.AxisLeft=l,t.AxisRight=_,t.AxisTop=d,Object.defineProperty(t,"__esModule",{value:!0})});