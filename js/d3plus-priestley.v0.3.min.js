/*
  d3plus-priestley v0.3.2
  A reusable Priestley timeline built on D3.
  Copyright (c) 2019 D3plus - https://d3plus.org
  @license MIT
*/
if(typeof Object.assign!=="function"){Object.defineProperty(Object,"assign",{value:function t(e){"use strict";if(e===null){throw new TypeError("Cannot convert undefined or null to object")}var i=Object(e);for(var r=1;r<arguments.length;r++){var n=arguments[r];if(n!==null){for(var s in n){if(Object.prototype.hasOwnProperty.call(n,s)){i[s]=n[s]}}}}return i},writable:true,configurable:true})}if(!Array.prototype.includes){Object.defineProperty(Array.prototype,"includes",{value:function t(e,i){var r=Object(this);var n=r.length>>>0;if(n===0)return false;var s=i|0;var a=Math.max(s>=0?s:n-Math.abs(s),0);function o(t,e){return t===e||typeof t==="number"&&typeof e==="number"&&isNaN(t)&&isNaN(e)}while(a<n){if(o(r[a],e)){return true}a++}return false}})}if(!String.prototype.includes){Object.defineProperty(String.prototype,"includes",{value:function(t,e){if(typeof e!=="number"){e=0}if(e+t.length>this.length){return false}else{return this.indexOf(t,e)!==-1}}})}if(!Array.prototype.find){Object.defineProperty(Array.prototype,"find",{value:function(t){if(this==null){throw new TypeError('"this" is null or not defined')}var e=Object(this);var i=e.length>>>0;if(typeof t!=="function"){throw new TypeError("predicate must be a function")}var r=arguments[1];var n=0;while(n<i){var s=e[n];if(t.call(r,s,n,e)){return s}n++}return undefined},configurable:true,writable:true})}if(!String.prototype.startsWith){Object.defineProperty(String.prototype,"startsWith",{value:function(t,e){e=!e||e<0?0:+e;return this.substring(e,e+t.length)===t}})}if(typeof window!=="undefined"){(function(){var r=function(t,e){var i=t.nodeType;if(i===3){e.push(t.textContent.replace(/&/,"&amp;").replace(/</,"&lt;").replace(">","&gt;"))}else if(i===1){e.push("<",t.tagName);if(t.hasAttributes()){[].forEach.call(t.attributes,function(t){e.push(" ",t.item.name,"='",t.item.value,"'")})}if(t.hasChildNodes()){e.push(">");[].forEach.call(t.childNodes,function(t){r(t,e)});e.push("</",t.tagName,">")}else{e.push("/>")}}else if(i==8){e.push("\x3c!--",t.nodeValue,"--\x3e")}};Object.defineProperty(SVGElement.prototype,"innerHTML",{get:function(){var t=[];var e=this.firstChild;while(e){r(e,t);e=e.nextSibling}return t.join("")},set:function(t){while(this.firstChild){this.removeChild(this.firstChild)}try{var e=new DOMParser;e.async=false;var i="<svg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'>"+t+"</svg>";var r=e.parseFromString(i,"text/xml").documentElement;var n=r.firstChild;while(n){this.appendChild(this.ownerDocument.importNode(n,true));n=n.nextSibling}}catch(t){}}});Object.defineProperty(SVGElement.prototype,"innerSVG",{get:function(){return this.innerHTML},set:function(t){this.innerHTML=t}})})()}(function(t,e){typeof exports==="object"&&typeof module!=="undefined"?e(exports,require("d3-array"),require("d3-collection"),require("d3-scale"),require("d3plus-axis"),require("d3plus-common"),require("d3plus-shape"),require("d3plus-viz")):typeof define==="function"&&define.amd?define("d3plus-priestley",["exports","d3-array","d3-collection","d3-scale","d3plus-axis","d3plus-common","d3plus-shape","d3plus-viz"],e):e(t.d3plus={},t.d3Array,t.d3Collection,t.d3Scale,t.d3plusAxis,t.d3plusCommon,t.d3plusShape,t.d3plusViz)})(this,function(t,_,y,m,v,x,b,e){"use strict";var i=function(g){function t(){var i=this;g.call(this);this._axis=(new v.Axis).align("end").orient("bottom");this._axisConfig={scale:"time"};this._axisTest=(new v.Axis).align("end").gridSize(0).orient("bottom");this.end("end");this._shapeConfig=x.assign({},this._shapeConfig,{ariaLabel:function(t,e){return i._drawLabel(t,e)+", "+i._start(t,e)+" - "+i._end(t,e)+"."}});this.start("start")}if(g)t.__proto__=g;t.prototype=Object.create(g&&g.prototype);t.prototype.constructor=t;t.prototype.render=function t(e){var i=this;g.prototype.render.call(this,e);if(!this._filteredData){return this}var r=this._filteredData.map(function(t,e){return{__d3plus__:true,data:t,end:i._axisConfig.scale==="time"?v.date(i._end(t,e)):i._end(t,e),i:e,id:i._id(t,e),start:i._axisConfig.scale==="time"?v.date(i._start(t,e)):i._start(t,e)}}).filter(function(t){return t.end-t.start>0}).sort(function(t,e){return t.start-e.start});var n;if(this._groupBy.length>1&&this._drawDepth>0){var s=y.nest();var a=function(e){s.key(function(t){return i._groupBy[e](t.data,t.i)})};for(var o=0;o<i._drawDepth;o++)a(o);n=s.entries(r)}else{n=[{values:r}]}var u=0;n.forEach(function(t){var i=[];t.values.forEach(function(e){i=i.map(function(t){return t<=e.start?false:t});var t=i.indexOf(false);if(t<0){e.lane=u+i.length;i.push(e.end)}else{i[t]=e.end;e.lane=u+t}});u+=i.length});var l={domain:[_.min(r,function(t){return t.start})||0,_.max(r,function(t){return t.end})||0],height:this._height-this._margin.top-this._margin.bottom,width:this._width-this._margin.left-this._margin.right};var h="translate("+this._margin.left+", "+this._margin.top+")";this._axisTest.config(l).config(this._axisConfig).select(x.elem("g.d3plus-priestley-axis-test",{parent:this._select,enter:{opacity:0}}).node()).render();this._axis.config(l).config(this._axisConfig).select(x.elem("g.d3plus-priestley-axis",{parent:this._select,enter:{transform:h},update:{transform:h}}).node()).render();var f=this._axisTest._padding;var d=this._axis._d3Scale;var p=m.scalePoint().domain(_.range(0,u,1)).padding(.5).rangeRound([this._height-this._margin.bottom-this._axisTest.outerBounds().height-f,this._margin.top+f]);var c=p.step();this._shapes.push((new b.Rect).data(r).duration(this._duration).height(c>=this._padding*2?c-this._padding:c>2?c-2:c).label(function(t,e){return i._drawLabel(t.data,e)}).select(x.elem("g.d3plus-priestley-shapes",{parent:this._select}).node()).width(function(t){var e=Math.abs(d(t.end)-d(t.start));return e>2?e-2:e}).x(function(t){return d(t.start)+(d(t.end)-d(t.start))/2}).y(function(t){return p(t.lane)}).config(x.configPrep.bind(this)(this._shapeConfig,"shape","Rect")).render());return this};t.prototype.axisConfig=function t(e){return arguments.length?(this._axisConfig=x.assign(this._axisConfig,e),this):this._axisConfig};t.prototype.end=function t(e){if(arguments.length){if(typeof e==="function"){this._end=e}else{this._end=x.accessor(e);if(!this._aggs[e]){this._aggs[e]=function(t){return _.max(t)}}}return this}else{return this._end}};t.prototype.start=function t(e){if(arguments.length){if(typeof e==="function"){this._start=e}else{this._start=x.accessor(e);if(!this._aggs[e]){this._aggs[e]=function(t){return _.min(t)}}}return this}else{return this._start}};return t}(e.Viz);t.Priestley=i;Object.defineProperty(t,"__esModule",{value:true})});