/*
  d3plus-priestley v0.3.4
  A reusable Priestley timeline built on D3.
  Copyright (c) 2019 D3plus - https://d3plus.org
  @license MIT
*/
(function(t,r){typeof exports==="object"&&typeof module!=="undefined"?r(exports,require("d3-array"),require("d3-collection"),require("d3-scale"),require("d3plus-axis"),require("d3plus-common"),require("d3plus-shape"),require("d3plus-viz")):typeof define==="function"&&define.amd?define("d3plus-priestley",["exports","d3-array","d3-collection","d3-scale","d3plus-axis","d3plus-common","d3plus-shape","d3plus-viz"],r):(t=t||self,r(t.d3plus={},t.d3Array,t.d3Collection,t.d3Scale,t.d3plusAxis,t.d3plusCommon,t.d3plusShape,t.d3plusViz))})(this,function(t,g,y,m,b,_,w,r){"use strict";function e(t,r){if(!(t instanceof r)){throw new TypeError("Cannot call a class as a function")}}function n(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(t,n.key,n)}}function i(t,r,e){if(r)n(t.prototype,r);if(e)n(t,e);return t}function a(t,r){if(typeof r!=="function"&&r!==null){throw new TypeError("Super expression must either be null or a function")}t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:true,configurable:true}});if(r)o(t,r)}function x(t){x=Object.setPrototypeOf?Object.getPrototypeOf:function t(r){return r.__proto__||Object.getPrototypeOf(r)};return x(t)}function o(t,r){o=Object.setPrototypeOf||function t(r,e){r.__proto__=e;return r};return o(t,r)}function u(t){if(t===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t}function f(t,r){if(r&&(typeof r==="object"||typeof r==="function")){return r}return u(t)}function s(t,r){while(!Object.prototype.hasOwnProperty.call(t,r)){t=x(t);if(t===null)break}return t}function O(t,r,e){if(typeof Reflect!=="undefined"&&Reflect.get){O=Reflect.get}else{O=function t(r,e,n){var i=s(r,e);if(!i)return;var a=Object.getOwnPropertyDescriptor(i,e);if(a.get){return a.get.call(n)}return a.value}}return O(t,r,e||t)}var c=function(t){a(d,t);function d(){var n;e(this,d);n=f(this,x(d).call(this));n._axis=(new b.Axis).align("end").orient("bottom");n._axisConfig={scale:"time"};n._axisTest=(new b.Axis).align("end").gridSize(0).orient("bottom");n.end("end");n._shapeConfig=_.assign({},n._shapeConfig,{ariaLabel:function t(r,e){return"".concat(n._drawLabel(r,e),", ").concat(n._start(r,e)," - ").concat(n._end(r,e),".")}});n.start("start");return n}i(d,[{key:"render",value:function t(r){var e=this;O(x(d.prototype),"render",this).call(this,r);if(!this._filteredData)return this;var n=this._filteredData.map(function(t,r){return{__d3plus__:true,data:t,end:e._axisConfig.scale==="time"?b.date(e._end(t,r)):e._end(t,r),i:r,id:e._id(t,r),start:e._axisConfig.scale==="time"?b.date(e._start(t,r)):e._start(t,r)}}).filter(function(t){return t.end-t.start>0}).sort(function(t,r){return t.start-r.start});var i;if(this._groupBy.length>1&&this._drawDepth>0){var a=y.nest();var o=function t(r){a.key(function(t){return e._groupBy[r](t.data,t.i)})};for(var u=0;u<this._drawDepth;u++){o(u)}i=a.entries(n)}else i=[{values:n}];var f=0;i.forEach(function(t){var e=[];t.values.forEach(function(r){e=e.map(function(t){return t<=r.start?false:t});var t=e.indexOf(false);if(t<0){r.lane=f+e.length;e.push(r.end)}else{e[t]=r.end;r.lane=f+t}});f+=e.length});var s={domain:[g.min(n,function(t){return t.start})||0,g.max(n,function(t){return t.end})||0],height:this._height-this._margin.top-this._margin.bottom,width:this._width-this._margin.left-this._margin.right};var c="translate(".concat(this._margin.left,", ").concat(this._margin.top,")");this._axisTest.config(s).config(this._axisConfig).select(_.elem("g.d3plus-priestley-axis-test",{parent:this._select,enter:{opacity:0}}).node()).render();this._axis.config(s).config(this._axisConfig).select(_.elem("g.d3plus-priestley-axis",{parent:this._select,enter:{transform:c},update:{transform:c}}).node()).render();var l=this._axisTest._padding;var v=this._axis._d3Scale;var p=m.scalePoint().domain(g.range(0,f,1)).padding(.5).rangeRound([this._height-this._margin.bottom-this._axisTest.outerBounds().height-l,this._margin.top+l]);var h=p.step();this._shapes.push((new w.Rect).data(n).duration(this._duration).height(h>=this._padding*2?h-this._padding:h>2?h-2:h).label(function(t,r){return e._drawLabel(t.data,r)}).select(_.elem("g.d3plus-priestley-shapes",{parent:this._select}).node()).width(function(t){var r=Math.abs(v(t.end)-v(t.start));return r>2?r-2:r}).x(function(t){return v(t.start)+(v(t.end)-v(t.start))/2}).y(function(t){return p(t.lane)}).config(_.configPrep.bind(this)(this._shapeConfig,"shape","Rect")).render());return this}},{key:"axisConfig",value:function t(r){return arguments.length?(this._axisConfig=_.assign(this._axisConfig,r),this):this._axisConfig}},{key:"end",value:function t(r){if(arguments.length){if(typeof r==="function")this._end=r;else{this._end=_.accessor(r);if(!this._aggs[r])this._aggs[r]=function(t){return g.max(t)}}return this}else return this._end}},{key:"start",value:function t(r){if(arguments.length){if(typeof r==="function")this._start=r;else{this._start=_.accessor(r);if(!this._aggs[r])this._aggs[r]=function(t){return g.min(t)}}return this}else return this._start}}]);return d}(r.Viz);t.Priestley=c;Object.defineProperty(t,"__esModule",{value:true})});(function(t){typeof define==="function"&&define.amd?define(t):t()})(function(){"use strict";var t=typeof globalThis!=="undefined"?globalThis:typeof window!=="undefined"?window:typeof global!=="undefined"?global:typeof self!=="undefined"?self:{};function r(t,r){return r={exports:{}},t(r,r.exports),r.exports}var e="object";var n=function(t){return t&&t.Math==Math&&t};var l=n(typeof globalThis==e&&globalThis)||n(typeof window==e&&window)||n(typeof self==e&&self)||n(typeof t==e&&t)||Function("return this")();var i=function(t){try{return!!t()}catch(t){return true}};var p=!i(function(){return Object.defineProperty({},"a",{get:function(){return 7}}).a!=7});var a={}.propertyIsEnumerable;var o=Object.getOwnPropertyDescriptor;var u=o&&!a.call({1:2},1);var f=u?function t(r){var e=o(this,r);return!!e&&e.enumerable}:a;var h={f:f};var s=function(t,r){return{enumerable:!(t&1),configurable:!(t&2),writable:!(t&4),value:r}};var c={}.toString;var v=function(t){return c.call(t).slice(8,-1)};var d="".split;var _=i(function(){return!Object("z").propertyIsEnumerable(0)})?function(t){return v(t)=="String"?d.call(t,""):Object(t)}:Object;var g=function(t){if(t==undefined)throw TypeError("Can't call method on "+t);return t};var y=function(t){return _(g(t))};var m=function(t){return typeof t==="object"?t!==null:typeof t==="function"};var b=function(t,r){if(!m(t))return t;var e,n;if(r&&typeof(e=t.toString)=="function"&&!m(n=e.call(t)))return n;if(typeof(e=t.valueOf)=="function"&&!m(n=e.call(t)))return n;if(!r&&typeof(e=t.toString)=="function"&&!m(n=e.call(t)))return n;throw TypeError("Can't convert object to primitive value")};var w={}.hasOwnProperty;var x=function(t,r){return w.call(t,r)};var O=l.document;var j=m(O)&&m(O.createElement);var S=function(t){return j?O.createElement(t):{}};var P=!p&&!i(function(){return Object.defineProperty(S("div"),"a",{get:function(){return 7}}).a!=7});var E=Object.getOwnPropertyDescriptor;var C=p?E:function t(r,e){r=y(r);e=b(e,true);if(P)try{return E(r,e)}catch(t){}if(x(r,e))return s(!h.f.call(r,e),r[e])};var T={f:C};var k=function(t){if(!m(t)){throw TypeError(String(t)+" is not an object")}return t};var M=Object.defineProperty;var A=p?M:function t(r,e,n){k(r);e=b(e,true);k(n);if(P)try{return M(r,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");if("value"in n)r[e]=n.value;return r};var L={f:A};var D=p?function(t,r,e){return L.f(t,r,s(1,e))}:function(t,r,e){t[r]=e;return t};var N=function(r,e){try{D(l,r,e)}catch(t){l[r]=e}return e};var R=r(function(t){var r="__core-js_shared__";var e=l[r]||N(r,{});(t.exports=function(t,r){return e[t]||(e[t]=r!==undefined?r:{})})("versions",[]).push({version:"3.1.3",mode:"global",copyright:"Â© 2019 Denis Pushkarev (zloirock.ru)"})});var q=R("native-function-to-string",Function.toString);var z=l.WeakMap;var F=typeof z==="function"&&/native code/.test(q.call(z));var I=0;var V=Math.random();var W=function(t){return"Symbol("+String(t===undefined?"":t)+")_"+(++I+V).toString(36)};var G=R("keys");var B=function(t){return G[t]||(G[t]=W(t))};var H={};var K=l.WeakMap;var Y,J,Q;var U=function(t){return Q(t)?J(t):Y(t,{})};var X=function(e){return function(t){var r;if(!m(t)||(r=J(t)).type!==e){throw TypeError("Incompatible receiver, "+e+" required")}return r}};if(F){var Z=new K;var $=Z.get;var tt=Z.has;var rt=Z.set;Y=function(t,r){rt.call(Z,t,r);return r};J=function(t){return $.call(Z,t)||{}};Q=function(t){return tt.call(Z,t)}}else{var et=B("state");H[et]=true;Y=function(t,r){D(t,et,r);return r};J=function(t){return x(t,et)?t[et]:{}};Q=function(t){return x(t,et)}}var nt={set:Y,get:J,has:Q,enforce:U,getterFor:X};var it=r(function(t){var r=nt.get;var u=nt.enforce;var f=String(q).split("toString");R("inspectSource",function(t){return q.call(t)});(t.exports=function(t,r,e,n){var i=n?!!n.unsafe:false;var a=n?!!n.enumerable:false;var o=n?!!n.noTargetGet:false;if(typeof e=="function"){if(typeof r=="string"&&!x(e,"name"))D(e,"name",r);u(e).source=f.join(typeof r=="string"?r:"")}if(t===l){if(a)t[r]=e;else N(r,e);return}else if(!i){delete t[r]}else if(!o&&t[r]){a=true}if(a)t[r]=e;else D(t,r,e)})(Function.prototype,"toString",function t(){return typeof this=="function"&&r(this).source||q.call(this)})});var at=l;var ot=function(t){return typeof t=="function"?t:undefined};var ut=function(t,r){return arguments.length<2?ot(at[t])||ot(l[t]):at[t]&&at[t][r]||l[t]&&l[t][r]};var ft=Math.ceil;var st=Math.floor;var ct=function(t){return isNaN(t=+t)?0:(t>0?st:ft)(t)};var lt=Math.min;var vt=function(t){return t>0?lt(ct(t),9007199254740991):0};var pt=Math.max;var ht=Math.min;var dt=function(t,r){var e=ct(t);return e<0?pt(e+r,0):ht(e,r)};var gt=function(u){return function(t,r,e){var n=y(t);var i=vt(n.length);var a=dt(e,i);var o;if(u&&r!=r)while(i>a){o=n[a++];if(o!=o)return true}else for(;i>a;a++){if((u||a in n)&&n[a]===r)return u||a||0}return!u&&-1}};var yt={includes:gt(true),indexOf:gt(false)};var mt=yt.indexOf;var bt=function(t,r){var e=y(t);var n=0;var i=[];var a;for(a in e)!x(H,a)&&x(e,a)&&i.push(a);while(r.length>n)if(x(e,a=r[n++])){~mt(i,a)||i.push(a)}return i};var _t=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"];var wt=_t.concat("length","prototype");var xt=Object.getOwnPropertyNames||function t(r){return bt(r,wt)};var Ot={f:xt};var jt=Object.getOwnPropertySymbols;var St={f:jt};var Pt=ut("Reflect","ownKeys")||function t(r){var e=Ot.f(k(r));var n=St.f;return n?e.concat(n(r)):e};var Et=function(t,r){var e=Pt(r);var n=L.f;var i=T.f;for(var a=0;a<e.length;a++){var o=e[a];if(!x(t,o))n(t,o,i(r,o))}};var Ct=/#|\.prototype\./;var Tt=function(t,r){var e=Mt[kt(t)];return e==Lt?true:e==At?false:typeof r=="function"?i(r):!!r};var kt=Tt.normalize=function(t){return String(t).replace(Ct,".").toLowerCase()};var Mt=Tt.data={};var At=Tt.NATIVE="N";var Lt=Tt.POLYFILL="P";var Dt=Tt;var Nt=T.f;var Rt=function(t,r){var e=t.target;var n=t.global;var i=t.stat;var a,o,u,f,s,c;if(n){o=l}else if(i){o=l[e]||N(e,{})}else{o=(l[e]||{}).prototype}if(o)for(u in r){s=r[u];if(t.noTargetGet){c=Nt(o,u);f=c&&c.value}else f=o[u];a=Dt(n?u:e+(i?".":"#")+u,t.forced);if(!a&&f!==undefined){if(typeof s===typeof f)continue;Et(s,f)}if(t.sham||f&&f.sham){D(s,"sham",true)}it(o,u,s,t)}};var qt=function(t){if(typeof t!="function"){throw TypeError(String(t)+" is not a function")}return t};var zt=function(n,i,t){qt(n);if(i===undefined)return n;switch(t){case 0:return function(){return n.call(i)};case 1:return function(t){return n.call(i,t)};case 2:return function(t,r){return n.call(i,t,r)};case 3:return function(t,r,e){return n.call(i,t,r,e)}}return function(){return n.apply(i,arguments)}};var Ft=function(t){return Object(g(t))};var It=Array.isArray||function t(r){return v(r)=="Array"};var Vt=!!Object.getOwnPropertySymbols&&!i(function(){return!String(Symbol())});var Wt=l.Symbol;var Gt=R("wks");var Bt=function(t){return Gt[t]||(Gt[t]=Vt&&Wt[t]||(Vt?Wt:W)("Symbol."+t))};var Ht=Bt("species");var Kt=function(t,r){var e;if(It(t)){e=t.constructor;if(typeof e=="function"&&(e===Array||It(e.prototype)))e=undefined;else if(m(e)){e=e[Ht];if(e===null)e=undefined}}return new(e===undefined?Array:e)(r===0?0:r)};var Yt=[].push;var Jt=function(p){var h=p==1;var d=p==2;var g=p==3;var y=p==4;var m=p==6;var b=p==5||m;return function(t,r,e,n){var i=Ft(t);var a=_(i);var o=zt(r,e,3);var u=vt(a.length);var f=0;var s=n||Kt;var c=h?s(t,u):d?s(t,0):undefined;var l,v;for(;u>f;f++)if(b||f in a){l=a[f];v=o(l,f,i);if(p){if(h)c[f]=v;else if(v)switch(p){case 3:return true;case 5:return l;case 6:return f;case 2:Yt.call(c,l)}else if(y)return false}}return m?-1:g||y?y:c}};var Qt={forEach:Jt(0),map:Jt(1),filter:Jt(2),some:Jt(3),every:Jt(4),find:Jt(5),findIndex:Jt(6)};var Ut=Object.keys||function t(r){return bt(r,_t)};var Xt=p?Object.defineProperties:function t(r,e){k(r);var n=Ut(e);var i=n.length;var a=0;var o;while(i>a)L.f(r,o=n[a++],e[o]);return r};var Zt=ut("document","documentElement");var $t=B("IE_PROTO");var tr="prototype";var rr=function(){};var er=function(){var t=S("iframe");var r=_t.length;var e="<";var n="script";var i=">";var a="java"+n+":";var o;t.style.display="none";Zt.appendChild(t);t.src=String(a);o=t.contentWindow.document;o.open();o.write(e+n+i+"document.F=Object"+e+"/"+n+i);o.close();er=o.F;while(r--)delete er[tr][_t[r]];return er()};var nr=Object.create||function t(r,e){var n;if(r!==null){rr[tr]=k(r);n=new rr;rr[tr]=null;n[$t]=r}else n=er();return e===undefined?n:Xt(n,e)};H[$t]=true;var ir=Bt("unscopables");var ar=Array.prototype;if(ar[ir]==undefined){D(ar,ir,nr(null))}var or=function(t){ar[ir][t]=true};var ur=Qt.find;var fr="find";var sr=true;if(fr in[])Array(1)[fr](function(){sr=false});Rt({target:"Array",proto:true,forced:sr},{find:function t(r){return ur(this,r,arguments.length>1?arguments[1]:undefined)}});or(fr);var cr=yt.includes;Rt({target:"Array",proto:true},{includes:function t(r){return cr(this,r,arguments.length>1?arguments[1]:undefined)}});or("includes");var lr=Object.assign;var vr=!lr||i(function(){var t={};var r={};var e=Symbol();var n="abcdefghijklmnopqrst";t[e]=7;n.split("").forEach(function(t){r[t]=t});return lr({},t)[e]!=7||Ut(lr({},r)).join("")!=n})?function t(r,e){var n=Ft(r);var i=arguments.length;var a=1;var o=St.f;var u=h.f;while(i>a){var f=_(arguments[a++]);var s=o?Ut(f).concat(o(f)):Ut(f);var c=s.length;var l=0;var v;while(c>l){v=s[l++];if(!p||u.call(f,v))n[v]=f[v]}}return n}:lr;Rt({target:"Object",stat:true,forced:Object.assign!==vr},{assign:vr});var pr=Bt("match");var hr=function(t){var r;return m(t)&&((r=t[pr])!==undefined?!!r:v(t)=="RegExp")};var dr=function(t){if(hr(t)){throw TypeError("The method doesn't accept regular expressions")}return t};var gr=Bt("match");var yr=function(r){var e=/./;try{"/./"[r](e)}catch(t){try{e[gr]=false;return"/./"[r](e)}catch(t){}}return false};var mr="".startsWith;var br=Math.min;Rt({target:"String",proto:true,forced:!yr("startsWith")},{startsWith:function t(r){var e=String(g(this));dr(r);var n=vt(br(arguments.length>1?arguments[1]:undefined,e.length));var i=String(r);return mr?mr.call(e,i,n):e.slice(n,n+i.length)===i}});if(typeof window!=="undefined"){(function(){var n=function(t,r){var e=t.nodeType;if(e===3){r.push(t.textContent.replace(/&/,"&amp;").replace(/</,"&lt;").replace(">","&gt;"))}else if(e===1){r.push("<",t.tagName);if(t.hasAttributes()){[].forEach.call(t.attributes,function(t){r.push(" ",t.item.name,"='",t.item.value,"'")})}if(t.hasChildNodes()){r.push(">");[].forEach.call(t.childNodes,function(t){n(t,r)});r.push("</",t.tagName,">")}else{r.push("/>")}}else if(e==8){r.push("\x3c!--",t.nodeValue,"--\x3e")}};Object.defineProperty(SVGElement.prototype,"innerHTML",{get:function(){var t=[];var r=this.firstChild;while(r){n(r,t);r=r.nextSibling}return t.join("")},set:function(t){while(this.firstChild){this.removeChild(this.firstChild)}try{var r=new DOMParser;r.async=false;var e="<svg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'>"+t+"</svg>";var n=r.parseFromString(e,"text/xml").documentElement;var i=n.firstChild;while(i){this.appendChild(this.ownerDocument.importNode(i,true));i=i.nextSibling}}catch(t){}}});Object.defineProperty(SVGElement.prototype,"innerSVG",{get:function(){return this.innerHTML},set:function(t){this.innerHTML=t}})})()}});