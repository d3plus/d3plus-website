/*
  d3plus-priestley v0.3.5
  A reusable Priestley timeline built on D3.
  Copyright (c) 2020 D3plus - https://d3plus.org
  @license MIT
*/
(function(t){typeof define==="function"&&define.amd?define(t):t()})(function(){"use strict";var t=typeof globalThis!=="undefined"?globalThis:typeof window!=="undefined"?window:typeof global!=="undefined"?global:typeof self!=="undefined"?self:{};function r(t,r){return r={exports:{}},t(r,r.exports),r.exports}var e=function(t){return t&&t.Math==Math&&t};var l=e(typeof globalThis=="object"&&globalThis)||e(typeof window=="object"&&window)||e(typeof self=="object"&&self)||e(typeof t=="object"&&t)||Function("return this")();var o=function(t){try{return!!t()}catch(t){return true}};var d=!o(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7});var n={}.propertyIsEnumerable;var i=Object.getOwnPropertyDescriptor;var a=i&&!n.call({1:2},1);var u=a?function t(r){var e=i(this,r);return!!e&&e.enumerable}:n;var p={f:u};var f=function(t,r){return{enumerable:!(t&1),configurable:!(t&2),writable:!(t&4),value:r}};var s={}.toString;var c=function(t){return s.call(t).slice(8,-1)};var v="".split;var _=o(function(){return!Object("z").propertyIsEnumerable(0)})?function(t){return c(t)=="String"?v.call(t,""):Object(t)}:Object;var h=function(t){if(t==undefined)throw TypeError("Can't call method on "+t);return t};var g=function(t){return _(h(t))};var y=function(t){return typeof t==="object"?t!==null:typeof t==="function"};var m=function(t,r){if(!y(t))return t;var e,n;if(r&&typeof(e=t.toString)=="function"&&!y(n=e.call(t)))return n;if(typeof(e=t.valueOf)=="function"&&!y(n=e.call(t)))return n;if(!r&&typeof(e=t.toString)=="function"&&!y(n=e.call(t)))return n;throw TypeError("Can't convert object to primitive value")};var b={}.hasOwnProperty;var w=function(t,r){return b.call(t,r)};var O=l.document;var S=y(O)&&y(O.createElement);var x=function(t){return S?O.createElement(t):{}};var j=!d&&!o(function(){return Object.defineProperty(x("div"),"a",{get:function(){return 7}}).a!=7});var C=Object.getOwnPropertyDescriptor;var E=d?C:function t(r,e){r=g(r);e=m(e,true);if(j)try{return C(r,e)}catch(t){}if(w(r,e))return f(!p.f.call(r,e),r[e])};var P={f:E};var T=function(t){if(!y(t)){throw TypeError(String(t)+" is not an object")}return t};var A=Object.defineProperty;var k=d?A:function t(r,e,n){T(r);e=m(e,true);T(n);if(j)try{return A(r,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");if("value"in n)r[e]=n.value;return r};var M={f:k};var I=d?function(t,r,e){return M.f(t,r,f(1,e))}:function(t,r,e){t[r]=e;return t};var R=function(r,e){try{I(l,r,e)}catch(t){l[r]=e}return e};var L="__core-js_shared__";var D=l[L]||R(L,{});var N=D;var q=Function.toString;if(typeof N.inspectSource!="function"){N.inspectSource=function(t){return q.call(t)}}var z=N.inspectSource;var F=l.WeakMap;var W=typeof F==="function"&&/native code/.test(z(F));var V=r(function(t){(t.exports=function(t,r){return N[t]||(N[t]=r!==undefined?r:{})})("versions",[]).push({version:"3.6.4",mode:"global",copyright:"Â© 2020 Denis Pushkarev (zloirock.ru)"})});var G=0;var B=Math.random();var H=function(t){return"Symbol("+String(t===undefined?"":t)+")_"+(++G+B).toString(36)};var K=V("keys");var X=function(t){return K[t]||(K[t]=H(t))};var Y={};var J=l.WeakMap;var Q,U,Z;var $=function(t){return Z(t)?U(t):Q(t,{})};var tt=function(e){return function(t){var r;if(!y(t)||(r=U(t)).type!==e){throw TypeError("Incompatible receiver, "+e+" required")}return r}};if(W){var rt=new J;var et=rt.get;var nt=rt.has;var it=rt.set;Q=function(t,r){it.call(rt,t,r);return r};U=function(t){return et.call(rt,t)||{}};Z=function(t){return nt.call(rt,t)}}else{var at=X("state");Y[at]=true;Q=function(t,r){I(t,at,r);return r};U=function(t){return w(t,at)?t[at]:{}};Z=function(t){return w(t,at)}}var ot={set:Q,get:U,has:Z,enforce:$,getterFor:tt};var ut=r(function(t){var r=ot.get;var u=ot.enforce;var f=String(String).split("String");(t.exports=function(t,r,e,n){var i=n?!!n.unsafe:false;var a=n?!!n.enumerable:false;var o=n?!!n.noTargetGet:false;if(typeof e=="function"){if(typeof r=="string"&&!w(e,"name"))I(e,"name",r);u(e).source=f.join(typeof r=="string"?r:"")}if(t===l){if(a)t[r]=e;else R(r,e);return}else if(!i){delete t[r]}else if(!o&&t[r]){a=true}if(a)t[r]=e;else I(t,r,e)})(Function.prototype,"toString",function t(){return typeof this=="function"&&r(this).source||z(this)})});var ft=l;var st=function(t){return typeof t=="function"?t:undefined};var ct=function(t,r){return arguments.length<2?st(ft[t])||st(l[t]):ft[t]&&ft[t][r]||l[t]&&l[t][r]};var lt=Math.ceil;var vt=Math.floor;var dt=function(t){return isNaN(t=+t)?0:(t>0?vt:lt)(t)};var pt=Math.min;var ht=function(t){return t>0?pt(dt(t),9007199254740991):0};var gt=Math.max;var yt=Math.min;var mt=function(t,r){var e=dt(t);return e<0?gt(e+r,0):yt(e,r)};var bt=function(u){return function(t,r,e){var n=g(t);var i=ht(n.length);var a=mt(e,i);var o;if(u&&r!=r)while(i>a){o=n[a++];if(o!=o)return true}else for(;i>a;a++){if((u||a in n)&&n[a]===r)return u||a||0}return!u&&-1}};var _t={includes:bt(true),indexOf:bt(false)};var wt=_t.indexOf;var Ot=function(t,r){var e=g(t);var n=0;var i=[];var a;for(a in e)!w(Y,a)&&w(e,a)&&i.push(a);while(r.length>n)if(w(e,a=r[n++])){~wt(i,a)||i.push(a)}return i};var St=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"];var xt=St.concat("length","prototype");var jt=Object.getOwnPropertyNames||function t(r){return Ot(r,xt)};var Ct={f:jt};var Et=Object.getOwnPropertySymbols;var Pt={f:Et};var Tt=ct("Reflect","ownKeys")||function t(r){var e=Ct.f(T(r));var n=Pt.f;return n?e.concat(n(r)):e};var At=function(t,r){var e=Tt(r);var n=M.f;var i=P.f;for(var a=0;a<e.length;a++){var o=e[a];if(!w(t,o))n(t,o,i(r,o))}};var kt=/#|\.prototype\./;var Mt=function(t,r){var e=Rt[It(t)];return e==Dt?true:e==Lt?false:typeof r=="function"?o(r):!!r};var It=Mt.normalize=function(t){return String(t).replace(kt,".").toLowerCase()};var Rt=Mt.data={};var Lt=Mt.NATIVE="N";var Dt=Mt.POLYFILL="P";var Nt=Mt;var qt=P.f;var zt=function(t,r){var e=t.target;var n=t.global;var i=t.stat;var a,o,u,f,s,c;if(n){o=l}else if(i){o=l[e]||R(e,{})}else{o=(l[e]||{}).prototype}if(o)for(u in r){s=r[u];if(t.noTargetGet){c=qt(o,u);f=c&&c.value}else f=o[u];a=Nt(n?u:e+(i?".":"#")+u,t.forced);if(!a&&f!==undefined){if(typeof s===typeof f)continue;At(s,f)}if(t.sham||f&&f.sham){I(s,"sham",true)}ut(o,u,s,t)}};var Ft=function(t){if(typeof t!="function"){throw TypeError(String(t)+" is not a function")}return t};var Wt=function(n,i,t){Ft(n);if(i===undefined)return n;switch(t){case 0:return function(){return n.call(i)};case 1:return function(t){return n.call(i,t)};case 2:return function(t,r){return n.call(i,t,r)};case 3:return function(t,r,e){return n.call(i,t,r,e)}}return function(){return n.apply(i,arguments)}};var Vt=function(t){return Object(h(t))};var Gt=Array.isArray||function t(r){return c(r)=="Array"};var Bt=!!Object.getOwnPropertySymbols&&!o(function(){return!String(Symbol())});var Ht=Bt&&!Symbol.sham&&typeof Symbol.iterator=="symbol";var Kt=V("wks");var Xt=l.Symbol;var Yt=Ht?Xt:Xt&&Xt.withoutSetter||H;var Jt=function(t){if(!w(Kt,t)){if(Bt&&w(Xt,t))Kt[t]=Xt[t];else Kt[t]=Yt("Symbol."+t)}return Kt[t]};var Qt=Jt("species");var Ut=function(t,r){var e;if(Gt(t)){e=t.constructor;if(typeof e=="function"&&(e===Array||Gt(e.prototype)))e=undefined;else if(y(e)){e=e[Qt];if(e===null)e=undefined}}return new(e===undefined?Array:e)(r===0?0:r)};var Zt=[].push;var $t=function(d){var p=d==1;var h=d==2;var g=d==3;var y=d==4;var m=d==6;var b=d==5||m;return function(t,r,e,n){var i=Vt(t);var a=_(i);var o=Wt(r,e,3);var u=ht(a.length);var f=0;var s=n||Ut;var c=p?s(t,u):h?s(t,0):undefined;var l,v;for(;u>f;f++)if(b||f in a){l=a[f];v=o(l,f,i);if(d){if(p)c[f]=v;else if(v)switch(d){case 3:return true;case 5:return l;case 6:return f;case 2:Zt.call(c,l)}else if(y)return false}}return m?-1:g||y?y:c}};var tr={forEach:$t(0),map:$t(1),filter:$t(2),some:$t(3),every:$t(4),find:$t(5),findIndex:$t(6)};var rr=Object.keys||function t(r){return Ot(r,St)};var er=d?Object.defineProperties:function t(r,e){T(r);var n=rr(e);var i=n.length;var a=0;var o;while(i>a)M.f(r,o=n[a++],e[o]);return r};var nr=ct("document","documentElement");var ir=">";var ar="<";var or="prototype";var ur="script";var fr=X("IE_PROTO");var sr=function(){};var cr=function(t){return ar+ur+ir+t+ar+"/"+ur+ir};var lr=function(t){t.write(cr(""));t.close();var r=t.parentWindow.Object;t=null;return r};var vr=function(){var t=x("iframe");var r="java"+ur+":";var e;t.style.display="none";nr.appendChild(t);t.src=String(r);e=t.contentWindow.document;e.open();e.write(cr("document.F=Object"));e.close();return e.F};var dr;var pr=function(){try{dr=document.domain&&new ActiveXObject("htmlfile")}catch(t){}pr=dr?lr(dr):vr();var t=St.length;while(t--)delete pr[or][St[t]];return pr()};Y[fr]=true;var hr=Object.create||function t(r,e){var n;if(r!==null){sr[or]=T(r);n=new sr;sr[or]=null;n[fr]=r}else n=pr();return e===undefined?n:er(n,e)};var gr=Jt("unscopables");var yr=Array.prototype;if(yr[gr]==undefined){M.f(yr,gr,{configurable:true,value:hr(null)})}var mr=function(t){yr[gr][t]=true};var br=Object.defineProperty;var _r={};var wr=function(t){throw t};var Or=function(t,r){if(w(_r,t))return _r[t];if(!r)r={};var e=[][t];var n=w(r,"ACCESSORS")?r.ACCESSORS:false;var i=w(r,0)?r[0]:wr;var a=w(r,1)?r[1]:undefined;return _r[t]=!!e&&!o(function(){if(n&&!d)return true;var t={length:-1};if(n)br(t,1,{enumerable:true,get:wr});else t[1]=1;e.call(t,i,a)})};var Sr=tr.find;var xr="find";var jr=true;var Cr=Or(xr);if(xr in[])Array(1)[xr](function(){jr=false});zt({target:"Array",proto:true,forced:jr||!Cr},{find:function t(r){return Sr(this,r,arguments.length>1?arguments[1]:undefined)}});mr(xr);var Er=_t.includes;var Pr=Or("indexOf",{ACCESSORS:true,1:0});zt({target:"Array",proto:true,forced:!Pr},{includes:function t(r){return Er(this,r,arguments.length>1?arguments[1]:undefined)}});mr("includes");var Tr=Object.assign;var Ar=Object.defineProperty;var kr=!Tr||o(function(){if(d&&Tr({b:1},Tr(Ar({},"a",{enumerable:true,get:function(){Ar(this,"b",{value:3,enumerable:false})}}),{b:2})).b!==1)return true;var t={};var r={};var e=Symbol();var n="abcdefghijklmnopqrst";t[e]=7;n.split("").forEach(function(t){r[t]=t});return Tr({},t)[e]!=7||rr(Tr({},r)).join("")!=n})?function t(r,e){var n=Vt(r);var i=arguments.length;var a=1;var o=Pt.f;var u=p.f;while(i>a){var f=_(arguments[a++]);var s=o?rr(f).concat(o(f)):rr(f);var c=s.length;var l=0;var v;while(c>l){v=s[l++];if(!d||u.call(f,v))n[v]=f[v]}}return n}:Tr;zt({target:"Object",stat:true,forced:Object.assign!==kr},{assign:kr});var Mr=Jt("match");var Ir=function(t){var r;return y(t)&&((r=t[Mr])!==undefined?!!r:c(t)=="RegExp")};var Rr=function(t){if(Ir(t)){throw TypeError("The method doesn't accept regular expressions")}return t};var Lr=Jt("match");var Dr=function(r){var e=/./;try{"/./"[r](e)}catch(t){try{e[Lr]=false;return"/./"[r](e)}catch(t){}}return false};zt({target:"String",proto:true,forced:!Dr("includes")},{includes:function t(r){return!!~String(h(this)).indexOf(Rr(r),arguments.length>1?arguments[1]:undefined)}});var Nr=P.f;var qr="".startsWith;var zr=Math.min;var Fr=Dr("startsWith");var Wr=!Fr&&!!function(){var t=Nr(String.prototype,"startsWith");return t&&!t.writable}();zt({target:"String",proto:true,forced:!Wr&&!Fr},{startsWith:function t(r){var e=String(h(this));Rr(r);var n=ht(zr(arguments.length>1?arguments[1]:undefined,e.length));var i=String(r);return qr?qr.call(e,i,n):e.slice(n,n+i.length)===i}});if(typeof window!=="undefined"){(function(){var n=function(t,r){var e=t.nodeType;if(e===3){r.push(t.textContent.replace(/&/,"&amp;").replace(/</,"&lt;").replace(">","&gt;"))}else if(e===1){r.push("<",t.tagName);if(t.hasAttributes()){[].forEach.call(t.attributes,function(t){r.push(" ",t.item.name,"='",t.item.value,"'")})}if(t.hasChildNodes()){r.push(">");[].forEach.call(t.childNodes,function(t){n(t,r)});r.push("</",t.tagName,">")}else{r.push("/>")}}else if(e==8){r.push("\x3c!--",t.nodeValue,"--\x3e")}};Object.defineProperty(SVGElement.prototype,"innerHTML",{get:function(){var t=[];var r=this.firstChild;while(r){n(r,t);r=r.nextSibling}return t.join("")},set:function(t){while(this.firstChild){this.removeChild(this.firstChild)}try{var r=new DOMParser;r.async=false;var e="<svg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'>"+t+"</svg>";var n=r.parseFromString(e,"text/xml").documentElement;var i=n.firstChild;while(i){this.appendChild(this.ownerDocument.importNode(i,true));i=i.nextSibling}}catch(t){}}});Object.defineProperty(SVGElement.prototype,"innerSVG",{get:function(){return this.innerHTML},set:function(t){this.innerHTML=t}})})()}});(function(t,r){typeof exports==="object"&&typeof module!=="undefined"?r(exports,require("d3-array"),require("d3-collection"),require("d3-scale"),require("d3plus-axis"),require("d3plus-common"),require("d3plus-shape"),require("d3plus-viz")):typeof define==="function"&&define.amd?define("d3plus-priestley",["exports","d3-array","d3-collection","d3-scale","d3plus-axis","d3plus-common","d3plus-shape","d3plus-viz"],r):(t=t||self,r(t.d3plus={},t.d3Array,t.d3Collection,t.d3Scale,t.d3plusAxis,t.d3plusCommon,t.d3plusShape,t.d3plusViz))})(this,function(t,g,y,m,b,_,w,r){"use strict";function e(t,r){if(!(t instanceof r)){throw new TypeError("Cannot call a class as a function")}}function n(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(t,n.key,n)}}function i(t,r,e){if(r)n(t.prototype,r);if(e)n(t,e);return t}function a(t,r){if(typeof r!=="function"&&r!==null){throw new TypeError("Super expression must either be null or a function")}t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:true,configurable:true}});if(r)o(t,r)}function O(t){O=Object.setPrototypeOf?Object.getPrototypeOf:function t(r){return r.__proto__||Object.getPrototypeOf(r)};return O(t)}function o(t,r){o=Object.setPrototypeOf||function t(r,e){r.__proto__=e;return r};return o(t,r)}function u(t){if(t===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t}function f(t,r){if(r&&(typeof r==="object"||typeof r==="function")){return r}return u(t)}function s(t,r){while(!Object.prototype.hasOwnProperty.call(t,r)){t=O(t);if(t===null)break}return t}function S(t,r,e){if(typeof Reflect!=="undefined"&&Reflect.get){S=Reflect.get}else{S=function t(r,e,n){var i=s(r,e);if(!i)return;var a=Object.getOwnPropertyDescriptor(i,e);if(a.get){return a.get.call(n)}return a.value}}return S(t,r,e||t)}var c=function(t){a(h,t);function h(){var n;e(this,h);n=f(this,O(h).call(this));n._axis=(new b.Axis).align("end").orient("bottom");n._axisConfig={scale:"time"};n._axisTest=(new b.Axis).align("end").gridSize(0).orient("bottom");n.end("end");n._paddingInner=.05;n._paddingOuter=.05;n._shapeConfig=_.assign({},n._shapeConfig,{ariaLabel:function t(r,e){return"".concat(n._drawLabel(r,e),", ").concat(n._start(r,e)," - ").concat(n._end(r,e),".")}});n.start("start");return n}i(h,[{key:"_draw",value:function t(r){var e=this;S(O(h.prototype),"_draw",this).call(this,r);if(!this._filteredData)return this;var n=this._filteredData.map(function(t,r){return{__d3plus__:true,data:t,end:e._axisConfig.scale==="time"?b.date(e._end(t,r)):e._end(t,r),i:r,id:e._id(t,r),start:e._axisConfig.scale==="time"?b.date(e._start(t,r)):e._start(t,r)}}).filter(function(t){return t.end-t.start>0}).sort(function(t,r){return t.start-r.start});var i;if(this._groupBy.length>1&&this._drawDepth>0){var a=y.nest();var o=function t(r){a.key(function(t){return e._groupBy[r](t.data,t.i)})};for(var u=0;u<this._drawDepth;u++){o(u)}i=a.entries(n)}else i=[{values:n}];var f=0;i.forEach(function(t){var e=[];t.values.forEach(function(r){e=e.map(function(t){return t<=r.start?false:t});var t=e.indexOf(false);if(t<0){r.lane=f+e.length;e.push(r.end)}else{e[t]=r.end;r.lane=f+t}});f+=e.length});var s={domain:[g.min(n,function(t){return t.start})||0,g.max(n,function(t){return t.end})||0],height:this._height-this._margin.top-this._margin.bottom,width:this._width-this._margin.left-this._margin.right};var c="translate(".concat(this._margin.left,", ").concat(this._margin.top,")");this._axisTest.config(s).config(this._axisConfig).select(_.elem("g.d3plus-priestley-axis-test",{parent:this._select,enter:{opacity:0}}).node()).render();this._axis.config(s).config(this._axisConfig).select(_.elem("g.d3plus-priestley-axis",{parent:this._select,enter:{transform:c},update:{transform:c}}).node()).render();var l=this._axisTest._padding;var v=this._axis._d3Scale;var d=m.scaleBand().domain(g.range(0,f,1)).paddingInner(this._paddingInner).paddingOuter(this._paddingOuter).rangeRound([this._height-this._margin.bottom-this._axisTest.outerBounds().height-l,this._margin.top+l]);var p=d.bandwidth();this._shapes.push((new w.Rect).data(n).duration(this._duration).height(p).label(function(t,r){return e._drawLabel(t.data,r)}).select(_.elem("g.d3plus-priestley-shapes",{parent:this._select}).node()).width(function(t){var r=Math.abs(v(t.end)-v(t.start));return r>2?r-2:r}).x(function(t){return v(t.start)+(v(t.end)-v(t.start))/2}).y(function(t){return d(t.lane)+p/2}).config(_.configPrep.bind(this)(this._shapeConfig,"shape","Rect")).render());return this}},{key:"axisConfig",value:function t(r){return arguments.length?(this._axisConfig=_.assign(this._axisConfig,r),this):this._axisConfig}},{key:"end",value:function t(r){if(arguments.length){if(typeof r==="function")this._end=r;else{this._end=_.accessor(r);if(!this._aggs[r])this._aggs[r]=function(t){return g.max(t)}}return this}else return this._end}},{key:"paddingInner",value:function t(r){return arguments.length?(this._paddingInner=r,this):this._paddingInner}},{key:"paddingOuter",value:function t(r){return arguments.length?(this._paddingOuter=r,this):this._paddingOuter}},{key:"start",value:function t(r){if(arguments.length){if(typeof r==="function")this._start=r;else{this._start=_.accessor(r);if(!this._aggs[r])this._aggs[r]=function(t){return g.min(t)}}return this}else return this._start}}]);return h}(r.Viz);t.Priestley=c;Object.defineProperty(t,"__esModule",{value:true})});